function AreaWidget(f){var d="contains";var c="north";var h="south";var e="east";var b="west";var g="arealink";RamaddaUtil.inherit(this,{display:f,getHtml:function(){var p=this.display.getGet();var o=HtmlUtil.checkbox(this.display.getDomId(d),["title","Search mode: checked - contains, unchecked - overlaps"],false);var m=HtmlUtil.onClick(p+".areaWidget.areaLinkClick();",HtmlUtil.image(root+(this.linkArea?"/icons/link.png":"/icons/link_break.png"),[ATTR_TITLE,"Set bounds from map",ATTR_CLASS,"display-area-link","border","0",ATTR_ID,this.display.getDomId(g)]));var n=HtmlUtil.onClick(p+".areaWidget.useMyLocation();",HtmlUtil.image(root+"/icons/compass.png"),[ATTR_TITLE,"Set my location",ATTR_CLASS,"display-area-link","border","0"]);var l=HtmlUtil.onClick(p+".areaWidget.areaClear();",HtmlUtil.image(root+"/icons/eraser.png",[ATTR_TITLE,"Clear form",ATTR_CLASS,"display-area-link","border","0"]));var k=HtmlUtil.openTag(TAG_TABLE,[ATTR_CLASS,"display-area","border","0","cellpadding","0","cellspacing","0"]);k+=HtmlUtil.tr([],HtmlUtil.td(["align","center"],HtmlUtil.leftCenterRight(n,HtmlUtil.input(c,"",["placeholder","N",ATTR_CLASS,"input display-area-input","size","5",ATTR_ID,this.display.getDomId(c),ATTR_TITLE,"North"]),m,"20%","60%","20%")));k+=HtmlUtil.tr([],HtmlUtil.td([],HtmlUtil.input(b,"",["placeholder","W",ATTR_CLASS,"input  display-area-input","size","5",ATTR_ID,this.display.getDomId(b),ATTR_TITLE,"West"])+HtmlUtil.input(e,"",["placeholder","E",ATTR_CLASS,"input  display-area-input","size","5",ATTR_ID,this.display.getDomId(e),ATTR_TITLE,"East"])));k+=HtmlUtil.tr([],HtmlUtil.td(["align","center"],HtmlUtil.leftCenterRight(l,HtmlUtil.input(h,"",["placeholder","S",ATTR_CLASS,"input  display-area-input","size","5",ATTR_ID,this.display.getDomId(h),ATTR_TITLE,"South"]),o)));k+=HtmlUtil.closeTag(TAG_TABLE);return k},areaClear:function(){$("#"+this.display.getDomId(c)).val("");$("#"+this.display.getDomId(b)).val("");$("#"+this.display.getDomId(h)).val("");$("#"+this.display.getDomId(e)).val("");this.display.areaClear()},useMyLocation:function(){if(navigator.geolocation){var k=this;navigator.geolocation.getCurrentPosition(function(l){k.setUseMyLocation(l)})}else{}},setUseMyLocation:function(k){var l=k.coords.latitude;var n=k.coords.longitude;var m=5;if(this.display.myLocationOffset){m=parseFloat(this.display.myLocationOffset)}$("#"+this.display.getDomId(c)).val(l+m);$("#"+this.display.getDomId(b)).val(n-m);$("#"+this.display.getDomId(h)).val(l-m);$("#"+this.display.getDomId(e)).val(n+m);if(this.display.submitSearchForm){this.display.submitSearchForm()}},areaLinkClick:function(){this.linkArea=!this.linkArea;var l=root+(this.linkArea?"/icons/link.png":"/icons/link_break.png");$("#"+this.display.getDomId(g)).attr("src",l);if(this.linkArea&&this.lastBounds){var k=this.lastBounds;$("#"+this.display.getDomId(c)).val(formatLocationValue(k.top));$("#"+this.display.getDomId(b)).val(formatLocationValue(k.left));$("#"+this.display.getDomId(h)).val(formatLocationValue(k.bottom));$("#"+this.display.getDomId(e)).val(formatLocationValue(k.right))}},linkArea:false,lastBounds:null,handleEventMapBoundsChanged:function(l,k){bounds=k.bounds;this.lastBounds=bounds;if(!k.force&&!this.linkArea){return}$("#"+this.display.getDomId(c)).val(formatLocationValue(bounds.top));$("#"+this.display.getDomId(b)).val(formatLocationValue(bounds.left));$("#"+this.display.getDomId(h)).val(formatLocationValue(bounds.bottom));$("#"+this.display.getDomId(e)).val(formatLocationValue(bounds.right))},setSearchSettings:function(k){var l=$("#"+this.display.getDomId(d));if(l.is(":checked")){k.setAreaContains(true)}else{k.setAreaContains(false)}k.setBounds(this.display.getFieldValue(this.display.getDomId(c),null),this.display.getFieldValue(this.display.getDomId(b),null),this.display.getFieldValue(this.display.getDomId(h),null),this.display.getFieldValue(this.display.getDomId(e),null))}})}function DateRangeWidget(d){var b="date_start";var c="date_end";RamaddaUtil.inherit(this,{display:d,initHtml:function(){this.display.jq(b).datepicker();this.display.jq(c).datepicker()},setSearchSettings:function(f){var g=this.display.jq(b).val();var e=this.display.jq(b).val();f.setDateRange(g,e)},getHtml:function(){var e=HtmlUtil.input(b,"",["placeholder","Start date",ATTR_ID,d.getDomId(b),"size","10"])+" - "+HtmlUtil.input(c,"",["placeholder","End date",ATTR_ID,d.getDomId(c),"size","10"]);return e}})}var ID_FIELDS="fields";var ID_HEADER="header";var ID_TITLE=ATTR_TITLE;var ID_TITLE_EDIT="title_edit";var ID_DETAILS="details";var ID_DISPLAY_CONTENTS="contents";var ID_GROUP_CONTENTS="group_contents";var ID_DETAILS_MAIN="detailsmain";var ID_DISPLAY="display";var ID_TOOLBAR="toolbar";var ID_TOOLBAR_INNER="toolbarinner";var ID_LIST="list";var ID_DIALOG="dialog";var ID_DIALOG_TABS="dialog_tabs";var ID_DIALOG_BUTTON="dialog_button";var ID_FOOTER="footer";var ID_FOOTER_LEFT="footer_left";var ID_FOOTER_RIGHT="footer_right";var ID_MENU_BUTTON="menu_button";var ID_MENU_OUTER="menu_outer";var ID_MENU_INNER="menu_inner";var ID_REPOSITORY="repository";var displayDebug=false;var PROP_DISPLAY_FILTER="displayFilter";var PROP_EXCLUDE_ZERO="excludeZero";var PROP_DIVID="divid";var PROP_FIELDS="fields";var PROP_LAYOUT_HERE="layoutHere";var PROP_HEIGHT="height";var PROP_WIDTH="width";function initRamaddaDisplays(){if(window.globalDisplaysList==null){return}for(var b=0;b<window.globalDisplaysList.length;b++){window.globalDisplaysList[b].pageHasLoaded()}}function addRamaddaDisplay(b){if(window.globalDisplays==null){window.globalDisplays={};window.globalDisplaysList=[]}window.globalDisplaysList.push(b);window.globalDisplays[b.getId()]=b;if(b.displayId){window.globalDisplays[b.displayId]=b}}function ramaddaDisplayCheckLayout(){for(var b=0;b<window.globalDisplaysList.length;b++){if(window.globalDisplaysList[b].checkLayout){window.globalDisplaysList[b].checkLayout()}}}function getRamaddaDisplay(b){if(window.globalDisplays==null){return null}return window.globalDisplays[b]}function removeRamaddaDisplay(c){var b=getRamaddaDisplay(c);if(b){b.removeDisplay()}}function DisplayThing(e,c){if(c==null){c={}}for(var d in c){if(typeof c[d]=="string"){if(c[d]=="true"){c[d]=true}else{if(c[d]=="false"){c[d]=false}}}}for(var h in c){var f=h.split(".");if(f.length<=1){continue}var b=c;var g=b;var k=c[h];if(k=="true"){k=true}else{if(k=="false"){k=false}}for(var d=0;d<f.length;d++){var l=f[d];if(d==f.length-1){b[l]=k;break}var m=b[l];if(m==null){b[l]={};b=b[l]}else{b=m}}}this.displayId=null;$.extend(this,c);RamaddaUtil.defineMembers(this,{objectId:e,properties:c,displayParent:null,getId:function(){return this.objectId},setId:function(n){this.objectId=n},getTimeZone:function(){return this.getProperty("timeZone")},formatDate:function(p,o){if(!p.getTime&&p.v){p=p.v}if(!p.toLocaleDateString){return""+p}if(!o){o={}}var q;if(!Utils.isDefined(o.suffix)){q=o.suffix}else{q=this.getProperty("dateSuffix")}var n=this.getTimeZone();if(!q&&n){q=n}return Utils.formatDate(p,o.options,{timeZone:n,suffix:q})},getUniqueId:function(n){return HtmlUtil.getUniqueId(n)},handleError:function(o,n){GuiUtils.handleError("An error has occurred:"+n,true,true)},toString:function(){return"DisplayThing:"+this.getId()},getDomId:function(n){return this.getId()+"_"+n},jq:function(n){return $("#"+this.getDomId(n))},writeHtml:function(o,n){$("#"+this.getDomId(o)).html(n)},getRecordHtml:function(s,t){var B=false;if(Utils.isDefined(this.showGeo)){B=(""+this.showGeo)=="true"}var z="<table class=formtable>";if(false&&s.hasLocation()){var u=s.getLatitude();var n=s.getLongitude();z+="<tr><td align=right><b>Latitude:</b></td><td>"+number_format(u,4,".","")+"</td></tr>";z+="<tr><td align=right><b>Longitude:</b></td><td>"+number_format(n,4,".","")+"</td></tr>"}for(var o=0;o<2;o++){for(var q=0;q<s.getData().length;q++){var w=t[q];if(o==0&&!w.derived){continue}else{if(o==1&&w.derived){continue}}var v=w.getLabel();v=this.formatRecordLabel(v);if(!B){if(w.isFieldGeo()){continue}}var x=s.getValue(q);if(typeof x=="number"){var y=x+"";if(y.indexOf(".")>=0){var p=1;if(Math.abs(x)<1.5){p=3}x=number_format(x,p,".","")}}z+="<tr><td align=right><b>"+v+":</b></td><td>"+x+"</td></tr>"}}if(s.hasElevation()){z+="<tr><td  align=right><b>Elevation:</b></td><td>"+number_format(s.getElevation(),4,".","")+"</td></tr>"}z+="</table>";return z},formatRecordLabel:function(n){n=n.replace(/!!/g," -- ");return n},getFormValue:function(p,o){var n=$("#"+this.getDomId(p)).val();if(n!=null){if(n.length>0){this.setProperty(p,n)}if(n=="none"){this.setProperty(p,null)}return n}return this.getProperty(p,o)},getName:function(){return this.getFormValue("name",this.getId())},getEventSource:function(){return this.getFormValue("eventSource","")},setDisplayParent:function(n){this.displayParent=n},getDisplayParent:function(){if(this.displayParent==null){this.displayParent=this.getLayoutManager()}return this.displayParent},removeProperty:function(n){this.properties[n]=null},setProperty:function(n,o){this.properties[n]=o},getSelfProperty:function(n,o){if(this[n]!=null){return this[n]}return this.getProperty(n,o)},initTooltip:function(){},formatNumber:function(n){if(!this.getProperty("format",true)){return n}return Utils.formatNumber(n)},getProperty:function(n,p){if(this[n]){return this[n]}var o=this.properties[n];if(o!=null){return o}if(this.displayParent!=null){return this.displayParent.getProperty(n,p)}if(this.getDisplayManager){return this.getDisplayManager().getProperty(n,p)}return p}})}function RamaddaDisplay(o,h,m,e){RamaddaUtil.initMembers(this,{orientation:"horizontal"});var g;RamaddaUtil.inherit(this,g=new DisplayThing(h,e));this.getSuper=function(){return g};if(this.derived){if(this.derived.indexOf("[")==0){this.derived=JSON.parse(this.derived)}else{this.derived=[JSON.parse(this.derived)]}for(var f=0;f<this.derived.length;f++){var l=this.derived[f];if(!Utils.isDefined(l.isRow)&&!Utils.isDefined(l.isColumn)){l.isRow=true;l.isColumn=false}if(!l.isRow&&!l.isColumn){l.isRow=true}}}else{}RamaddaUtil.defineMembers(this,{displayReady:Utils.getPageLoaded(),type:m,displayManager:o,filters:[],dataCollection:new DataCollection(),selectedCbx:[],entries:[],wikiAttrs:["title","showTitle","showDetails","minDate","maxDate"],setDisplayReady:function(){this.displayReady=true},getDisplayReady:function(){return this.displayReady},getDisplayManager:function(){return this.displayManager},getLayoutManager:function(){return this.getDisplayManager().getLayoutManager()},displayError:function(d){this.displayHtml(HtmlUtil.getErrorDialog(d))},clearHtml:function(){this.displayHtml("")},displayHtml:function(d){this.jq(ID_DISPLAY).html(d)},notifyEvent:function(d,q,p){if(this[d]==null){return}this[d].apply(this,[q,p])},getColorTableName:function(){var d=this.getProperty("colorBar",this.getProperty("colorTable"));if(d=="none"){return null}return d},getColorTable:function(){var d=this.getColorTableName();if(d){return Utils.ColorTables[d]}return null},displayColorTable:function(v,t,d){t=parseFloat(t);d=parseFloat(d);var s=this.getColorTable();if(!s){return}var q=HtmlUtil.openTag("div",["class","display-colortable"])+"<table cellpadding=0 cellspacing=0 width=100% border=0><tr><td width=1%>"+this.formatNumber(t)+"&nbsp;</td>";var u=(d-t)/s.length;for(var p=0;p<s.length;p++){q+=HtmlUtil.td(["class","display-colortable-slice","style","background:"+s[p]+";","width","1"],HtmlUtil.div(["style","background:"+s[p]+";width:100%;height:10px;min-width:1px;","title",this.formatNumber(t+u*p)],""))}q+="<td width=1%>&nbsp;"+this.formatNumber(d)+"</td>";q+="</tr></table>";q+=HtmlUtil.closeTag("div");this.jq(v).html(q)},toString:function(){return"RamaddaDisplay:"+this.type+" - "+this.getId()},getType:function(){return this.type},getClass:function(d){if(d==null){return this.getBaseClass()}return this.getBaseClass()+"-"+d},getBaseClass:function(){return"display-"+this.getType()},setDisplayManager:function(d){this.displayManager=d;this.setDisplayParent(d.getLayoutManager())},setContents:function(d){d=HtmlUtil.div([ATTR_CLASS,"display-contents-inner display-"+this.getType()+"-inner"],d);this.writeHtml(ID_DISPLAY_CONTENTS,d)},addEntry:function(d){this.entries.push(d)},clearCachedData:function(){},setEntry:function(d){this.entries=[];this.addEntry(d);this.entry=d;this.entryId=d.getId();this.clearCachedData();if(this.properties.data){this.dataCollection=new DataCollection();this.properties.data=this.data=new PointData(d.getName(),null,null,this.getRamadda().getRoot()+"/entry/show?entryid="+d.getId()+"&output=points.product&product=points.json&max=5000",{entryId:this.entryId});this.data.loadData(this)}this.updateUI();var p="";if(this.getShowTitle()){p=d.getName();p=HtmlUtil.href(this.getRamadda().getEntryUrl(this.entryId),p);this.jq(ID_TITLE).html(p)}},handleEventRecordSelection:function(u,p){if(!u.getEntries){return}var d=u.getEntries();for(var q=0;q<d.length;q++){var t=d[q];var s=this.getEntries().indexOf(t)>=0;if(s){this.highlightEntry(t);break}}},areaClear:function(){this.getDisplayManager().notifyEvent("handleEventAreaClear",this)},handleEventEntryMouseover:function(p,d){},handleEventEntryMouseout:function(p,d){},handleEventEntrySelection:function(q,d){var p=this.getEntries().indexOf(d.entry)>=0;if(!p){return}if(d.selected){$("#"+this.getDomId(ID_TITLE)).addClass("display-title-select")}else{$("#"+this.getDomId(ID_TITLE)).removeClass("display-title-select")}},highlightEntry:function(d){$("#"+this.getDomId(ID_TITLE)).addClass("display-title-select")},getEntries:function(){return this.entries},getDisplayEntry:function(){var d=this.getEntries();if(d!=null&&d.length>0){return d[0]}if(this.entryId){var p={call:function(q){console.log("got entry "+q)}};return this.getRamadda().getEntry(this.entryId,p)}return null},hasEntries:function(){return this.entries!=null&&this.entries.length>0},getWaitImage:function(){return HtmlUtil.image(ramaddaBaseUrl+"/icons/progress.gif")},getLoadingMessage:function(d){if(!d){d="Loading data..."}return HtmlUtil.div(["text-align","center"],this.getMessage("&nbsp;"+d))},getMessage:function(d){return HtmlUtil.div([ATTR_CLASS,"display-message"],d)},getFieldValue:function(q,d){var p=$("#"+q);if(p.size()>0){return p.val()}return d},getFooter:function(){return HtmlUtil.div([ATTR_ID,this.getDomId(ID_FOOTER),ATTR_CLASS,"display-footer"],HtmlUtil.leftRight(HtmlUtil.div([ATTR_ID,this.getDomId(ID_FOOTER_LEFT),ATTR_CLASS,"display-footer-left"],""),HtmlUtil.div([ATTR_ID,this.getDomId(ID_FOOTER_RIGHT),ATTR_CLASS,"display-footer-right"],"")))},checkFixedLayout:function(){if(this.getIsLayoutFixed()){var p=this.getProperty(PROP_DIVID);if(p!=null){var d=this.getHtml();$("#"+p).html(d)}}},shouldSkipField:function(d){if(this.skipFields&&!this.skipFieldsList){this.skipFieldsList=this.skipFields.split(",")}if(this.skipFieldsList){return this.skipFieldsList.indexOf(d.getId())>=0}return false},fieldSelected:function(p){this.userHasSelectedAField=true;this.selectedFields=null;this.overrideFields=null;this.removeProperty(PROP_FIELDS);this.fieldSelectionChanged();if(p.shiftKey){var d=this.getSelectedFields();this.getDisplayManager().handleEventFieldsSelected(this,d)}},addFieldsCheckboxes:function(F){if(!this.hasData()){return}var S=this.getProperty(PROP_FIELDS);if(S!=null){if(S.length==0){S=null}}var E="";var v=this.getId()+"_checkbox";var I=this.getId()+"_groupby";var C=this.dataCollection.getList();if(F!=null){this.overrideFields=[]}var z={};var Q=this.getStandardData(null,{includeIndex:false});var N=this.dataCollection.getList()[0].getRecordFields();var M={};var y=null;for(var s=1;s<Q.length;s++){var G=Q[s];if(y==null){y=[];for(var t=0;t<G.length;t++){y.push(false)}}for(var t=0;t<G.length;t++){if(!y[t]){if(G[t]!=null){y[t]=true}}}}for(var t=0;t<G.length;t++){}for(var u=0;u<C.length;u++){var P=C[u];var K=this.getFieldsToSelect(P);if(this.canDoGroupBy()){var N=P.getRecordFields();var O=0;for(f=0;f<N.length;f++){var q=N[f];if(q.getType()!="string"){continue}if(O==0){E+=HtmlUtil.div([ATTR_CLASS,"display-dialog-subheader"],"Group By");E+=HtmlUtil.openTag(TAG_DIV,[ATTR_CLASS,"display-fields"]);var D=this.groupBy==null||this.groupBy=="";E+=HtmlUtil.tag(TAG_DIV,[ATTR_TITLE,"none"],HtmlUtil.radio("none",this.getDomId("groupby"),I,"none",!D)+" None")}O++;var D=this.groupBy==q.getId();var d="groupby_"+u+"_"+f;q.radioId=this.getDomId(d);E+=HtmlUtil.tag(TAG_DIV,[ATTR_TITLE,q.getId()],HtmlUtil.radio(q.radioId,this.getDomId("groupby"),I,q.getId(),D)+" "+q.getLabel()+" ("+q.getId()+")")}if(O>0){E+=HtmlUtil.closeTag(TAG_DIV)}}if(K.length>0){var J=this.getSelectedFields([]);var x=[];for(f=0;f<J.length;f++){x.push(J[f].getId())}var R="";E+=HtmlUtil.div([ATTR_CLASS,"display-dialog-subheader"],"Displayed Fields");E+=HtmlUtil.openTag(TAG_DIV,[ATTR_CLASS,"display-fields"]);for(var t=0;t<K.length;t++){var q=K[t];var d="cbx_"+u+"_"+t;q.checkboxId=this.getDomId(d);var D=false;var H=(y?y[q.getIndex()]:true);if(F!=null){for(var p=0;p<F.length;p++){if(F[p].getId()==q.getId()){D=true;this.overrideFields.push(q.getId());break}}}else{if(x.length>0){D=x.indexOf(q.getId())>=0}else{if(S!=null){D=(S.indexOf(q.getId())>=0);if(!D){D=(S.indexOf("#"+(t+1))>=0)}}else{if(this.overrideFields!=null){D=this.overrideFields.indexOf(q.getId())>=0;if(!D){D=(this.overrideFields.indexOf("#"+(t+1))>=0)}}else{if(this.selectedCbx.indexOf(q.getId())>=0){D=true}else{if(this.selectedCbx.length==0){D=(f==0)}}}}}}var B=q.getLabel();if(z[B]){if(Utils.stringDefined(q.getUnit())){B=B+" ("+q.getUnit()+")"}else{B=B+" "+z[B]}z[B]++}else{z[B]=1}if(!H){R+=HtmlUtil.div([],B)}else{if(q.derived){B+=" (derived)"}var w;if(this.canDoMultiFields()){w=HtmlUtil.checkbox(q.checkboxId,["class",v],D)}else{w=HtmlUtil.radio(q.checkboxId,"field_radio",v,"",D)}E+=HtmlUtil.tag(TAG_DIV,[ATTR_TITLE,q.getId()],w+" "+B)}}}if(R!=""){E+=HtmlUtil.div(["style","border-top:1px #888  solid;"],"<b>No Data Available</b>"+R)}E+=HtmlUtil.closeTag(TAG_DIV)}this.writeHtml(ID_FIELDS,E);this.userHasSelectedAField=false;var L=this;$("."+v).click(function(T){console.log("field selected");L.fieldSelected(T)});$("."+I).change(function(T){L.groupBy=$(this).val();if(L.displayData){L.displayData()}})},fieldSelectionChanged:function(){var d="the display";this.setDisplayTitle();if(this.displayData){this.clearCachedData();this.displayData()}},defaultSelectedToAll:function(){return false},setSelectedFields:function(d){this.clearCachedData();this.selectedFields=d;this.addFieldsCheckboxes(d)},getSelectedFields:function(p){this.lastSelectedFields=this.getSelectedFieldsInner(p);var d=this.getProperty(PROP_FIELDS);if(d){d.length=0}this.setDisplayTitle();return this.lastSelectedFields},getSelectedFieldsInner:function(C){if(this.selectedFields){return this.selectedFields}var G=[];var u=this.dataCollection.getList();var H=this.getProperty(PROP_FIELDS);for(var s=0;s<u.length;s++){var E=u[s];var y=this.getFieldsToSelect(E);if(H!=null&&H.length>0){for(var B=0;B<H.length;B++){var t=H[B];for(var z=0;z<y.length;z++){var q=y[z];var x=q.getId();if(x==t||("#"+(z+1))==t){G.push(q);break}}}}}if(H!=null&&H.length>0){return G}var d=null;var F=null;this.selectedCbx=[];var v=false;for(var s=0;s<u.length;s++){var E=u[s];d=this.getFieldsToSelect(E);for(B=0;B<d.length;B++){var q=d[B];if(F==null&&q.isNumeric){F=q}var p="cbx_"+s+"_"+B;var D=this.getDomId(p);var w=$("#"+D);if(w.size()){v=true}else{continue}if(w.is(":checked")){this.selectedCbx.push(q.getId());G.push(q)}}}if(G.length==0&&!v){if(this.lastSelectedFields&&this.lastSelectedFields.length>0){return this.lastSelectedFields}}if(G.length==0){return this.getDefaultSelectedFields(d,C)}return G},getDefaultSelectedFields:function(d,s){if(this.defaultSelectedToAll()&&this.allFields!=null){var p=[];for(f=0;f<this.allFields.length;f++){var q=this.allFields[f];if(!q.isFieldGeo()){p.push(q)}}return p}if(s!=null){return s}for(f=0;f<d.length;f++){var q=d[f];if(q.isNumeric&&!q.isFieldGeo()){return[q]}}return[]},getFieldOfType:function(d,p){d=this.getFieldsOfType(d,p);if(d.length==0){return null}return d[0]},getFieldsOfType:function(d,q){var s=[];var p=q=="numeric";for(a in d){var t=d[a];if(p){if(t.isFieldNumeric()){s.push(t)}}else{if(t.getType()==q){s.push(t)}}}return s},getColumnValues:function(p,u){var w=[];var q=Number.MAX_VALUE;var t=Number.MIN_VALUE;for(var d=0;d<p.length;d++){var s=p[d];var x=s.getData();var v=x[u.getIndex()];w.push(v);if(Utils.isNumber(v)){q=Math.min(q,v);t=Math.max(t,v)}}return{values:w,min:q,max:t}},filterData:function(s,x){if(!s){var D=this.getData();if(D==null){return null}s=D.getRecords()}if(!x){x=D.getRecordFields()}var t=this.getProperty("patternFilterField");var I=this.getProperty("numericFilterField");var E=this.getProperty("filterPattern");var y=false;if(E){y=E.startsWith("!");if(y){E=E.substring(1)}}var C=this.getProperty("numericFilterValue");var w=this.getProperty("numericFilterOperator","<");if((I||t)&&(E||(C&&w))){var v=null;var d=null;for(var B=0;B<x.length;B++){if(!v&&(x[B].getId()==t||t=="#"+(B+1))){v=x[B]}if(!d&&(x[B].getId()==I||I=="#"+(B+1))){d=x[B]}if(v&&d){break}}if(v||d){var F=[];var G;if(C){G=parseFloat(C)}var H=true;for(var B=0;B<s.length;B++){var p=s[B];var q=p;if(p.getData){H=false;q=p.getData()}if(H&&B==0){F.push(p);continue}var u=false;if(d&&C&&w){var z=parseFloat(q[d.getIndex()]);var G=parseFloat(C);if(w=="<"){u=z<G}else{if(w=="<="){u=z<=G}else{if(w=="=="){u=z==G}else{if(w==">"){u=z>G}else{if(w==">="){u=z>=G}}}}}if(!u){continue}}if(v&&E){var z=""+q[v.getIndex()];u=z.match(E);if(y){u=!u}}if(u){F.push(p)}}s=F}}return s},canDoGroupBy:function(){return false},canDoMultiFields:function(){return true},getFieldsToSelect:function(d){return d.getChartableFields(this)},getGet:function(){return"getRamaddaDisplay('"+this.getId()+"')"},publish:function(w){if(w==null){w="wikipage"}var v=[];var p=prompt("Name","");if(p==null){return}v.push("name");v.push(p);v.push("type");v.push(w);var t="";var z="";if(w=="wikipage"){z+='+section label="{{name}}"\n${extra}\n'}else{if(w=="blogentry"){z="<wiki>\n"}}z+=t;z+=this.getWikiText();for(var q=0;q<this.displays.length;q++){var u=this.displays[q];if(u.getIsLayoutFixed()){continue}z+=u.getWikiText()}if(w=="wikipage"){z+="-section\n\n"}else{if(w=="blogentry"){}}var y="";var s=this.getChildEntries();for(var q=0;q<s.length;q++){var x=s[q];y+=x.getId()+","}if(s.length>0){v.push("entries");v.push(y)}if(w=="media_photoalbum"){z=""}v.push("description_encoded");v.push(window.btoa(z));var d=HtmlUtil.getUrl(ramaddaBaseUrl+"/entry/publish",v);window.open(d,"_blank")},getChildEntries:function(v){var p={};var t=[];for(var s=0;s<this.displays.length;s++){var u=this.displays[s];if(!v&&u.getIsLayoutFixed()){continue}if(u.getEntries){var d=u.getEntries();if(d){for(var q=0;q<d.length;q++){if(p[d[q].getId()]!=null){continue}p[d[q].getId()]=true;t.push(d[q])}}}}return t},copyDisplayedEntries:function(){var s=[];for(var q=0;q<this.displays.length;q++){var t=this.displays[q];if(t.getIsLayoutFixed()){continue}if(t.getEntries){var d=t.getEntries();if(d){for(var p=0;p<d.length;p++){s.push(d[p])}}}}return this.copyEntries(s)},defineWikiAttributes:function(p){for(var d=0;d<p.length;d++){if(this.wikiAttrs.indexOf(p[d])<0){this.wikiAttrs.push(p[d])}}},getWikiAttributes:function(p){for(var q=0;q<this.wikiAttrs.length;q++){var d=this[this.wikiAttrs[q]];if(Utils.isDefined(d)){p.push(this.wikiAttrs[q]);p.push(d)}}},getWikiText:function(){var q=["layoutHere","false","type",this.type,"column",this.getColumn(),"row",this.getRow()];this.getWikiAttributes(q);var s=null;if(this.getEntries){var d=this.getEntries();if(d&&d.length>0){s=d[0].getId()}}if(!s){s=this.entryId}if(s){q.push("entry");q.push(s)}var p="{{display "+HtmlUtil.attrs(q)+"}}\n\n";return p},copyEntries:function(d){var u=[];var p={};for(var t=0;t<d.length;t++){var v=d[t];if(p[v.getId()]!=null){continue}p[v.getId()]=v;u.push(v)}var w="";for(var s=0;s<u.length;s++){var v=u[s];w+=v.getId()+","}var q=ramaddaBaseUrl+"/entry/copy?action.force=copy&from="+w;window.open(q,"_blank")},entryHtmlHasBeenDisplayed:function(q){if(q.getIsGroup()){var p=this;var s=function(t){var u=HtmlUtil.openTag(TAG_OL,[ATTR_CLASS,"display-entrylist-list",ATTR_ID,p.getDomId(ID_LIST)]);u+=p.getEntriesTree(t);u+=HtmlUtil.closeTag(TAG_OL);p.jq(ID_GROUP_CONTENTS+q.getIdForDom()).html(u);p.addEntrySelect()};var d=q.getChildrenEntries(s)}},getEntryHtml:function(q,t){var x={showHeader:true,headerRight:false,showDetails:this.getShowDetails()};$.extend(x,t);t=x;var d=this.getEntryMenuButton(q);var z="";if(t.showHeader){var u=d+" "+q.getLink(q.getIconImage()+" "+q.getName());if(t.headerRight){z+=HtmlUtil.leftRight(u,t.headerRight)}else{z+=u}}var v=HtmlUtil.getUniqueId("entry_");z+=HtmlUtil.div(["id",v],"");if(false){var w=this.getRamadda().getRoot()+"/entry/show?entryid="+q.getId()+"&decorate=false&output=metadataxml&details=true";console.log(w);$("#"+v).load(w,function(){alert("Load was performed.")})}z+=q.getDescription();var B=q.getMetadata();if(q.isImage()){var H=HtmlUtil.tag(TAG_IMG,["src",q.getResourceUrl(),ATTR_CLASS,"display-entry-image"]);z+=HtmlUtil.href(q.getResourceUrl(),H)+"<br>"}else{for(var F=0;F<B.length;F++){if(B[F].type=="content.thumbnail"){var D=B[F].value.attr1;var w;if(D.indexOf("http")==0){w=D}else{w=ramaddaBaseUrl+"/metadata/view/"+D+"?element=1&entryid="+q.getId()+"&metadata.id="+B[F].id+"&thumbnail=false"}z+=HtmlUtil.image(w,[ATTR_CLASS,"display-entry-thumbnail"])}}}if(q.getIsGroup()){z+=HtmlUtil.div([ATTR_ID,this.getDomId(ID_GROUP_CONTENTS+q.getIdForDom())],"")}z+=HtmlUtil.formTable();if(t.showDetails){if(q.url){z+=HtmlUtil.formEntry("URL:",HtmlUtil.href(q.url,q.url))}if(q.remoteUrl){z+=HtmlUtil.formEntry("URL:",HtmlUtil.href(q.remoteUrl,q.remoteUrl))}if(q.remoteRepository){z+=HtmlUtil.formEntry("From:",HtmlUtil.href(q.remoteRepository.url,q.remoteRepository.name))}}var p=q.getAttributes();if(q.getFilesize()>0){z+=HtmlUtil.formEntry("File:",q.getFilename()+" "+HtmlUtil.href(q.getResourceUrl(),HtmlUtil.image(ramaddaBaseUrl+"/icons/download.png"))+" "+q.getFormattedFilesize())}for(var C=0;C<p.length;C++){var s=p[C];var y=s.value;if(s.getCanShow&&!s.getCanShow()){continue}if(Utils.isFalse(s.canshow)){continue}if(s.isUrl&&s.isUrl()){var G="";var E=y.split("\n");for(var F=0;F<E.length;F++){var w=E[F].trim();if(w.length==0){continue}G+=HtmlUtil.href(w,w);G+="<br>"}y=G}z+=HtmlUtil.formEntry(s.label+":",y)}z+=HtmlUtil.closeTag(TAG_TABLE);return z},getEntriesTree:function(K,x){if(!x){x={}}var d=this.getProperty("columns",null);if(d!=null){var v=this.getProperty("columnNames",null);if(v!=null){v=v.split(",")}d=d.split(",");var Q=[];var L=[];for(var R=0;R<d.length;R++){var O=d[R].split(":");var M=null,V=null;if(O.length>1){if(O[0]=="property"){V="property";M=d[R]}else{M=O[0];V=O[1]}}else{M=d[R];V=M}Q.push(M);L.push(V)}d=Q;if(v==null){v=L}return this.getEntriesTable(K,d,v)}var t=x.suffix;var N="";if(!t){t="null"}else{N=t;t="'"+t+"'"}var S=x.showIndex;var H="";var P="entryrow_"+this.getId();var E=true;if(this.entriesMap==null){this.entriesMap={}}for(var R=0;R<K.length;R++){E=!E;var q=K[R];this.entriesMap[q.getId()]=q;var I=this.makeEntryToolbar(q);var F=q.getDisplayName();if(F.length>100){F=F.substring(0,99)+"..."}var U=q.getIconImage([ATTR_TITLE,"View entry"]);var D=HtmlUtil.tag(TAG_A,[ATTR_HREF,q.getEntryUrl()],U+" "+F);F="";var B=q.getIdForDom()+N;var w=q.getId();var u=HtmlUtil.image(icon_tree_closed,[ATTR_BORDER,"0","tree-open","false",ATTR_ID,this.getDomId(ID_TREE_LINK+B)]);var C=this.getGet()+".toggleEntryDetails(event, '"+w+"',"+t+");";var z=this.getGet()+".entryHeaderClick(event, '"+w+"',"+t+"); ";var J=HtmlUtil.onClick(C,u);var p="";if(S){p="#"+(R+1)+" "}var y=HtmlUtil.div([ATTR_CLASS,"display-entrylist-name"],J+" "+p+D+" "+F);var T=HtmlUtil.div([ATTR_ID,this.getDomId(ID_DETAILS+B),ATTR_CLASS,"display-entrylist-details"],HtmlUtil.div([ATTR_CLASS,"display-entrylist-details-inner",ATTR_ID,this.getDomId(ID_DETAILS_INNER+B)],""));var G;if(this.getProperty("showToolbar",true)){G=HtmlUtil.leftRight(y,I,"8","4")}else{G=y}var s=HtmlUtil.div(["onclick",z,ATTR_ID,this.getDomId(ID_DETAILS_MAIN+B),ATTR_CLASS,"display-entrylist-entry-main entry-main-display-entrylist-"+(E?"even":"odd"),ATTR_ENTRYID,w],G);var G=HtmlUtil.div([ATTR_ID,this.getDomId("entryinner_"+B)],s+T);H+=HtmlUtil.tag(TAG_DIV,[ATTR_ID,this.getDomId("entry_"+B),ATTR_ENTRYID,w,ATTR_CLASS,"display-entrylist-entry"+P],G);H+="\n"}return H},addEntrySelect:function(){var d=this;var p=$("#"+this.getDomId(ID_DISPLAY_CONTENTS)+"  ."+this.getClass("entry-main"));p.unbind();p.mouseover(function(w){var u=$(this).attr(ATTR_ENTRYID);entry=d.getEntry(u);if(!entry){console.log("no entry:"+u);return}d.getDisplayManager().handleEventEntryMouseover(d,{entry:entry});if(true){return}var y=Utils.cleanId(u);var t=d.getEntryToolbarId(y);var v=$("#"+t);v.show();var q="right top+1";var s="right top";var x=d.getDomId(ID_DETAILS_MAIN+y);v.position({of:$("#"+x),my:q,at:s,collision:"none none"})});p.mouseout(function(u){var s=$(this).attr(ATTR_ENTRYID);entry=d.getEntry(s);if(!entry){return}d.getDisplayManager().handleEventEntryMouseout(d,{entry:entry});var v=Utils.cleanId(s);var q=d.getEntryToolbarId(s);var t=$("#"+q)});if(this.madeList){}this.madeList=true;if(false){this.jq(ID_LIST).selectable({cancel:"a",selected:function(u,v){var q=v.selected.getAttribute(ATTR_ENTRYID);d.toggleEntryDetails(u,q);if(true){return}d.hideEntryDetails(q);var t=d.getEntry(q);if(t==null){return}var s=null;if(u.shiftKey){s={zoomIn:true}}d.selectedEntries.push(t);d.getDisplayManager().handleEventEntrySelection(d,{entry:t,selected:true,zoom:s});d.lastSelectedEntry=t},unselected:function(u,v){if(true){return}var s=v.unselected.getAttribute(ATTR_ENTRYID);var t=d.getEntry(s);var q=d.selectedEntries.indexOf(t);if(q>-1){d.selectedEntries.splice(q,1);d.getDisplayManager().handleEventEntrySelection(d,{entry:t,selected:false})}}})}},getEntriesTable:function(x,t,B){if(this.entriesMap==null){this.entriesMap={}}var d=this.getProperty("columnWidths",null);if(d!=null){d=d.split(",")}var w=HtmlUtil.openTag(TAG_TABLE,[ATTR_WIDTH,"100%","cellpadding","0","cellspacing","0"]);w+=HtmlUtil.openTag(TAG_TR,["valign","top"]);for(var v=0;v<B.length;v++){w+=HtmlUtil.td([ATTR_ALIGN,"center",ATTR_CLASS,"display-entrytable-header"],B[v])}w+=HtmlUtil.closeTag(TAG_TR);for(var v=0;v<x.length;v++){w+=HtmlUtil.openTag(TAG_TR,["valign","top"]);var D=x[v];this.entriesMap[D.getId()]=D;for(var u=0;u<t.length;u++){var p=null;if(d!=null){p=d[u]}var s=t[u];var C="";if(s=="name"){C=HtmlUtil.tag(TAG_A,[ATTR_HREF,D.getEntryUrl()],D.getName())}else{if(s.match(".*property:.*")){var y=s.substring("property:".length);var z=D.getMetadata();C="";for(var u=0;u<z.length;u++){var q=z[u];if(q.type==y){if(C!=""){C+="<br>"}C+=q.value.attr1}}}else{if(s=="description"){C=D.getDescription()}else{if(s=="date"){C=D.ymd;if(C==null){C=D.startDate}}else{C=D.getAttributeValue(s)}}}}var E=[ATTR_CLASS,"display-entrytable-cell"];if(p!=null){E.push(ATTR_WIDTH);E.push(p)}w+=HtmlUtil.td(E,C)}w+=HtmlUtil.closeTag(TAG_TR)}w+=HtmlUtil.closeTag(TAG_TABLE);return w},makeEntryToolbar:function(v){var p=this.getGet();var w=[];if(v.getType().getId()=="type_wms_layer"){w.push(HtmlUtil.tag(TAG_A,["onclick",p+".addMapLayer("+HtmlUtil.sqt(v.getId())+");"],HtmlUtil.image(ramaddaBaseUrl+"/icons/map.png",["border",0,ATTR_TITLE,"Add Map Layer"])))}if(v.getType().getId()=="geo_shapefile"){w.push(HtmlUtil.tag(TAG_A,["onclick",p+".addMapLayer("+HtmlUtil.sqt(v.getId())+");"],HtmlUtil.image(ramaddaBaseUrl+"/icons/map.png",["border",0,ATTR_TITLE,"Add Map Layer"])))}var u=this.getPointUrl(v);if(u!=null){w.push(HtmlUtil.tag(TAG_A,["onclick",p+".createDisplay("+HtmlUtil.sqt(v.getFullId())+","+HtmlUtil.sqt("table")+","+HtmlUtil.sqt(u)+");"],HtmlUtil.image(ramaddaBaseUrl+"/icons/table.png",["border",0,ATTR_TITLE,"Create Tabular Display"])));var d;w.push(d=HtmlUtil.tag(TAG_A,["onclick",p+".createDisplay("+HtmlUtil.sqt(v.getFullId())+","+HtmlUtil.sqt("linechart")+","+HtmlUtil.sqt(u)+");"],HtmlUtil.image(ramaddaBaseUrl+"/icons/chart_line_add.png",["border",0,ATTR_TITLE,"Create Chart"])))}w.push(HtmlUtil.tag(TAG_A,["onclick",p+".createDisplay("+HtmlUtil.sqt(v.getFullId())+","+HtmlUtil.sqt("entrydisplay")+","+HtmlUtil.sqt(u)+");"],HtmlUtil.image(ramaddaBaseUrl+"/icons/layout_add.png",["border",0,ATTR_TITLE,"Show Entry"])));if(v.getFilesize()>0){w.push(HtmlUtil.tag(TAG_A,[ATTR_HREF,v.getResourceUrl()],HtmlUtil.image(ramaddaBaseUrl+"/icons/download.png",["border",0,ATTR_TITLE,"Download ("+v.getFormattedFilesize()+")"])))}var t=this.getEntryMenuButton(v);w.push(t);var s=[];for(var q=0;q<w.length;q++){s.push(HtmlUtil.div([ATTR_CLASS,"display-entry-toolbar-item"],w[q]))}w=s;return HtmlUtil.div([ATTR_CLASS,"display-entry-toolbar",ATTR_ID,this.getEntryToolbarId(v.getIdForDom())],HtmlUtil.join(w,""))},getEntryToolbarId:function(d){var p=d.replace(/:/g,"_");p=p.replace(/=/g,"_");return this.getDomId(ID_TOOLBAR+"_"+p)},hideEntryDetails:function(d){},entryHeaderClick:function(p,d,s){var q=p.target;if(q.outerHTML){if(q.outerHTML.indexOf("<div")!=0){return}}this.toggleEntryDetails(p,d)},toggleEntryDetails:function(p,s,D){var z=this.getEntry(s);if(D==null){D=""}var y=this.jq(ID_TREE_LINK+z.getIdForDom()+D);var q=ID_DETAILS+z.getIdForDom()+D;var d=this.jq(q);var w=this.jq(ID_DETAILS_INNER+z.getIdForDom()+D);if(p&&p.shiftKey){var q=Utils.cleanId(s);var E=this.jq(ID_DETAILS_MAIN+q);if(!this.selectedEntriesFromTree){this.selectedEntriesFromTree={}}var t=E.attr("ramadda-selected")=="true";if(t){E.removeClass("display-entrylist-entry-main-selected");E.attr("ramadda-selected","false");this.selectedEntriesFromTree[z.getId()]=null}else{E.addClass("display-entrylist-entry-main-selected");E.attr("ramadda-selected","true");this.selectedEntriesFromTree[z.getId()]=z}this.getDisplayManager().handleEventEntrySelection(this,{entry:z,selected:!t});return}var v=y.attr("tree-open")=="true";if(v){y.attr("src",icon_tree_closed)}else{y.attr("src",icon_tree_open)}y.attr("tree-open",v?"false":"true");var x=d.attr("has-content")!=null;d.attr("has-content","true");if(x){}else{if(z.getIsGroup()){w.html(HtmlUtil.image(icon_progress));var C=this;var B=function(F){C.displayChildren(z,F,D)};var u=z.getChildrenEntries(B)}else{w.html(this.getEntryHtml(z,{showHeader:false}))}}if(v){d.hide()}else{d.show()}if(p&&p.stopPropagation){p.stopPropagation()}},getSelectedEntriesFromTree:function(){var d=[];if(this.selectedEntriesFromTree){for(var q in this.selectedEntriesFromTree){var p=this.selectedEntriesFromTree[q];if(p!=null){d.push(p)}}}return d},displayChildren:function(t,d,u){if(!u){u=""}var p=this.jq(ID_DETAILS_INNER+t.getIdForDom()+u);var q=this.getEntryHtml(t,{showHeader:false});if(d.length==0){p.html(q)}else{var s="";if(this.showDetailsForGroup){s+=q}s+=this.getEntriesTree(d);p.html(s);this.addEntrySelect()}},getEntryMenuButton:function(p){var d=HtmlUtil.onClick(this.getGet()+".showEntryMenu(event, '"+p.getId()+"');",HtmlUtil.image(ramaddaBaseUrl+"/icons/menu.png",[ATTR_CLASS,"display-entry-toolbar-item",ATTR_ID,this.getDomId(ID_MENU_BUTTON+p.getIdForDom())]));return d},setRamadda:function(d){this.ramadda=d},getRamadda:function(){if(this.ramadda!=null){return this.ramadda}if(this.ramaddaBaseUrl!=null){this.ramadda=getRamadda(this.ramaddaBaseUrl);return this.ramadda}return getGlobalRamadda()},getEntry:function(d,t){if(this.entriesMap&&this.entriesMap[d]){return this.entriesMap[d]}var q=this.getRamadda();var s=d.split(",");if(s.length==2){d=s[1];q=getRamadda(s[0])}var p=null;if(this.entryList!=null){p=this.entryList.getEntry(d)}if(p==null){p=q.getEntry(d)}if(p==null){console.log("Display.getEntry: entry not found id="+d+" repository="+q.getRoot());p=this.getRamadda().getEntry(d,t)}return p},addMapLayer:function(d){var p=this.getEntry(d);if(p==null){console.log("No entry:"+d);return}this.getDisplayManager().addMapLayer(this,p)},createDisplay:function(s,d,q){var t=this.getEntry(s);console.log("createDisplay: "+s+" "+d+" "+q);if(t==null){console.log("No entry:"+s);return null}var p={showMenu:true,sourceEntry:t,entryId:t.getId(),showTitle:true,showDetails:true,title:t.getName()};if(d!=DISPLAY_ENTRYLIST){if(q==null){q=this.getPointUrl(t)}var u={entry:t,entryId:t.getId()};p.data=new PointData(t.getName(),null,null,q,u)}if(this.lastDisplay!=null){p.column=this.lastDisplay.getColumn();p.row=this.lastDisplay.getRow()}else{p.column=this.getProperty("newColumn",this.getColumn());p.row=this.getProperty("newRow",this.getRow())}this.lastDisplay=this.getDisplayManager().createDisplay(d,p)},getPointUrl:function(p){var d=p.getService("points.json");if(d!=null){return d.url}d=p.getService("grid.point.json");if(d!=null){return d.url}return null},getEntryMenu:function(s){var B=this.getEntry(s);if(B==null){return"null entry"}var q=this.getGet();var t=[];var u=[];var y=[];var d=[];y.push(HtmlUtil.tag(TAG_LI,[],HtmlUtil.tag(TAG_A,["href",B.getEntryUrl(),"target","_"],"View Entry")));if(B.getFilesize()>0){u.push(HtmlUtil.tag(TAG_LI,[],HtmlUtil.tag(TAG_A,["href",B.getResourceUrl()],"Download "+B.getFilename()+" ("+B.getFormattedFilesize()+")")))}if(this.jsonUrl!=null){u.push(HtmlUtil.tag(TAG_LI,[],"Data: "+HtmlUtil.onClick(q+".fetchUrl('json');","JSON")+HtmlUtil.onClick(q+".fetchUrl('csv');","CSV")))}d.push(HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(q+".createDisplay('"+B.getFullId()+"','entrydisplay');","New Entry Display")));var x=this.getPointUrl(B);console.log("entry:"+B.getName()+" url:"+x);if(x!=null){var z="";for(var v=0;v<this.getDisplayManager().displayTypes.length;v++){var w=this.getDisplayManager().displayTypes[v];if(!w.requiresData||!w.forUser){continue}d.push(HtmlUtil.tag(TAG_LI,[],HtmlUtil.tag(TAG_A,["onclick",q+".createDisplay("+HtmlUtil.sqt(B.getFullId())+","+HtmlUtil.sqt(w.type)+","+HtmlUtil.sqt(x)+");"],w.label)))}}if(u.length>0){t.push("<a>File</a>"+HtmlUtil.tag(TAG_UL,[],HtmlUtil.join(u)))}if(y.length>0){t.push("<a>View</a>"+HtmlUtil.tag(TAG_UL,[],HtmlUtil.join(y)))}if(d.length>0){t.push("<a>New</a>"+HtmlUtil.tag(TAG_UL,[],HtmlUtil.join(d)))}var C="";for(var v=0;v<t.length;v++){C+=HtmlUtil.tag(TAG_LI,[],t[v])}var p=HtmlUtil.tag(TAG_UL,[ATTR_ID,this.getDomId(ID_MENU_INNER+B.getIdForDom()),ATTR_CLASS,"sf-menu"],C);return p},showEntryMenu:function(p,d){var s=this.getEntryMenu(d);this.writeHtml(ID_MENU_OUTER,s);var q=this.getDomId(ID_MENU_BUTTON+Utils.cleanId(d));showPopup(p,q,this.getDomId(ID_MENU_OUTER),false,"right top","left bottom+9");$("#"+this.getDomId(ID_MENU_INNER+Utils.cleanId(d))).superfish({speed:"fast",delay:300})},fetchUrl:function(d,p){if(p==null){p=this.jsonUrl}p=this.getDisplayManager().getJsonUrl(p,this);if(p==null){return}if(d!=null&&d!="json"){p=p.replace("points.json","points."+d)}window.open(p,"_blank")},getMenuItems:function(d){},getDisplayMenuSettings:function(){var q="getRamaddaDisplay('"+this.getId()+"')";var t=HtmlUtil.onClick(q+".moveDisplayRight();","Right");var u=HtmlUtil.onClick(q+".moveDisplayLeft();","Left");var p=HtmlUtil.onClick(q+".moveDisplayTop();","Top");var d=HtmlUtil.onClick(q+".moveDisplayUp();","Up");var w=HtmlUtil.onClick(q+".moveDisplayDown();","Down");var v="<table class=formtable><tr><td align=right><b>Move:</b></td><td>"+p+" "+d+" "+w+" "+t+" "+u+"</td></tr><tr><td align=right><b>Row:</b></td><td> "+HtmlUtil.input("",this.getProperty("row",""),["size","7",ATTR_ID,this.getDomId("row")])+" &nbsp;&nbsp;<b>Col:</b> "+HtmlUtil.input("",this.getProperty("column",""),["size","7",ATTR_ID,this.getDomId("column")])+"</td></tr><tr><td align=right><b>Width:</b></td><td> "+HtmlUtil.input("",this.getProperty("width",""),["size","7",ATTR_ID,this.getDomId("width")])+"  <b>Height:</b> "+HtmlUtil.input("",this.getProperty("height",""),["size","7",ATTR_ID,this.getDomId("height")])+"</td></tr></table>";var s=HtmlUtil.checkbox(this.getDomId("showtitle"),[],this.showTitle)+" Title  "+HtmlUtil.checkbox(this.getDomId("showdetails"),[],this.showDetails)+" Details &nbsp;&nbsp;&nbsp;"+HtmlUtil.onClick(q+".askSetTitle();","Set Title");v+=HtmlUtil.formTable()+HtmlUtil.formEntry("Show:",s)+"</table>";return v},isLayoutHorizontal:function(){return this.orientation=="horizontal"},loadInitialData:function(){if(!this.needsData()||this.properties.data==null){return}if(this.properties.data.hasData()){this.addData(this.properties.data);return}this.properties.data.derived=this.derived;this.properties.data.loadData(this)},getData:function(){if(!this.hasData()){return null}var d=this.dataCollection.getList();return d[0]},hasData:function(){if(this.dataCollection==null){return false}return this.dataCollection.hasData()},getCreatedInteractively:function(){return this.createdInteractively==true},needsData:function(){return false},getShowMenu:function(){if(Utils.isDefined(this.showMenu)){return this.showMenu}return this.getProperty(PROP_SHOW_MENU,true)},askSetTitle:function(){var p=this.getTitle(false);var d=prompt("Title",p);if(d!=null){this.title=d;this.setProperty(ATTR_TITLE,d);this.setDisplayTitle(this.title)}},getShowDetails:function(){return this.getSelfProperty("showDetails",true)},setShowDetails:function(d){this.showDetails=d;if(this.showDetails){this.jq(ID_DETAILS).show()}else{this.jq(ID_DETAILS).hide()}},setShowTitle:function(d){this.showTitle=d;if(this.showTitle){this.jq(ID_TITLE).show()}else{this.jq(ID_TITLE).hide()}},getShowTitle:function(){return this.getSelfProperty("showTitle",true)},setDisplayProperty:function(d,p){this.setProperty(d,p);$("#"+this.getDomId(d)).val(p)},deltaColumn:function(p){var d=parseInt(this.getProperty("column",0));d+=p;if(d<0){d=0}this.setDisplayProperty("column",d);this.getLayoutManager().layoutChanged(this)},deltaRow:function(p){var d=parseInt(this.getProperty("row",0));d+=p;if(d<0){d=0}this.setDisplayProperty("row",d);this.getLayoutManager().layoutChanged(this)},moveDisplayRight:function(){if(this.getLayoutManager().isLayoutColumns()){this.deltaColumn(1)}else{this.getLayoutManager().moveDisplayDown(this)}},moveDisplayLeft:function(){if(this.getLayoutManager().isLayoutColumns()){this.deltaColumn(-1)}else{this.getLayoutManager().moveDisplayUp(this)}},moveDisplayUp:function(){if(this.getLayoutManager().isLayoutRows()){this.deltaRow(-1)}else{this.getLayoutManager().moveDisplayUp(this)}},moveDisplayDown:function(){if(this.getLayoutManager().isLayoutRows()){this.deltaRow(1)}else{this.getLayoutManager().moveDisplayDown(this)}},moveDisplayTop:function(){this.getLayoutManager().moveDisplayTop(this)},getDialogContents:function(p,u){var d=this.getGet();var s=[];this.getMenuItems(s);var t="<form>";t+=this.getDisplayMenuSettings();for(var q=0;q<s.length;q++){t+=HtmlUtil.div([ATTR_CLASS,"display-menu-item"],s[q])}t+="</form>";p.push("Display");u.push(t)},popup:function(u,s){var p=GuiUtils.getDomObject(s);var q=GuiUtils.getDomObject(u);if(!p||!q){return}var d="left top";var t="left bottom";showObject(p);jQuery("#"+s).position({of:jQuery("#"+u),my:d,at:t,collision:"none none"});jQuery("#"+s).position({of:jQuery("#"+u),my:d,at:t,collision:"none none"});$("#"+s).draggable()},checkLayout:function(){},initUI:function(){this.checkFixedLayout()},pageHasLoaded:function(){},initDisplay:function(){this.initUI();this.setContents("<p>default html<p>")},updateUI:function(){},getDoBs:function(){if(!(typeof this.dobs==="undefined")){return dobs}if(this.displayParent){return this.displayParent.getDoBs()}return false},cnt:0,getHtml:function(){var y=this.getDoBs();var u="";var d=this.getWidth();if(y){u+=HtmlUtil.openDiv(["class","minitron"])}if(d>0){u+=HtmlUtil.openDiv(["class","display-contents","style","width:"+d+"px;"])}else{u+=HtmlUtil.openDiv(["class","display-contents"])}u+=HtmlUtil.div([ATTR_CLASS,"ramadda-popup",ATTR_ID,this.getDomId(ID_MENU_OUTER)],"");var p=HtmlUtil.div([ATTR_CLASS,"display-dialog",ATTR_ID,this.getDomId(ID_DIALOG)],"");var s=this.getGet();var v="";if(this.getShowMenu()){v=HtmlUtil.onClick(s+".showDialog();",HtmlUtil.image(ramaddaBaseUrl+"/icons/downdart.png",[ATTR_CLASS,"display-dialog-button",ATTR_ID,this.getDomId(ID_DIALOG_BUTTON)]))}var x="";if(this.getShowTitle()){x=this.getTitle(false).trim()}if(v!=""||x!=""){this.cnt++;var q="";var w=x;if(x!=""&&this.entryId){w=HtmlUtil.href(this.getRamadda().getEntryUrl(this.entryId),x)}q=HtmlUtil.tag("span",[ATTR_CLASS,"display-title",ATTR_ID,this.getDomId(ID_TITLE)],this.getDisplayTitle(x));if(v==""){u+=q}else{u+="<div class=display-header>"+v+"&nbsp;"+q+"</div>"}}var t=this.getContentsDiv();u+=t;u+=p;u+=HtmlUtil.closeTag(TAG_DIV);if(y){u+=HtmlUtil.closeTag(TAG_DIV)}return u},makeToolbar:function(t){var v="";var p=this.getGet();var d=t.addLabel;var u=[];var x=[];var s=[];if(!this.getIsLayoutFixed()){x.push("removeRamaddaDisplay('"+this.getId()+"')");u.push(ramaddaBaseUrl+"/icons/page_delete.png");s.push("Delete display")}x.push(p+".copyDisplay();");u.push(ramaddaBaseUrl+"/icons/page_copy.png");s.push("Copy Display");if(this.jsonUrl!=null){x.push(p+".fetchUrl('json');");u.push(ramaddaBaseUrl+"/icons/json.png");s.push("Download JSON");x.push(p+".fetchUrl('csv');");u.push(ramaddaBaseUrl+"/icons/csv.png");s.push("Download CSV")}for(var q=0;q<x.length;q++){var w=HtmlUtil.image(u[q],[ATTR_TITLE,s[q],ATTR_CLASS,"display-dialog-header-icon"]);if(d){w+=" "+s[q]+"<br>"}v+=HtmlUtil.onClick(x[q],w)}return v},makeDialog:function(){var u="";u+=HtmlUtil.div([ATTR_ID,this.getDomId(ID_HEADER),ATTR_CLASS,"display-header"]);var z=HtmlUtil.onClick("$('#"+this.getDomId(ID_DIALOG)+"').hide();",HtmlUtil.image(ramaddaBaseUrl+"/icons/close.gif",[ATTR_CLASS,"display-dialog-close",ATTR_TITLE,"Close Dialog"]));var y=z;var q="";var t=HtmlUtil.div([ATTR_CLASS,"display-dialog-header"],HtmlUtil.leftRight(q,y));var w=[];var B=[];this.getDialogContents(w,B);w.push("Edit");B.push(this.makeToolbar({addLabel:true}));var v="<ul>";var x="";for(var s=0;s<w.length;s++){var d=this.getDomId("tabs")+s;v+=HtmlUtil.tag("li",[],HtmlUtil.tag("a",["href","#"+d],w[s]));v+="\n";var p=HtmlUtil.div([ATTR_CLASS,"display-dialog-tab"],B[s]);x+=HtmlUtil.div(["id",d],p);x+="\n"}v+="</ul>\n";var x=HtmlUtil.div(["id",this.getDomId(ID_DIALOG_TABS)],v+x);dialogContents=t+x;return dialogContents},initDialog:function(){var p=this;var d=function(q){if(q&&q.which!=13){return}p.column=p.jq("column").val();p.row=p.jq("row").val();p.getLayoutManager().doLayout()};this.jq("column").keypress(d);this.jq("row").keypress(d);this.jq("showtitle").change(function(){p.setShowTitle(p.jq("showtitle").is(":checked"))});this.jq("showdetails").change(function(){p.setShowDetails(p.jq("showdetails").is(":checked"))});this.jq(ID_DIALOG_TABS).tabs()},showDialog:function(){var d=this.getDomId(ID_DIALOG);this.writeHtml(ID_DIALOG,this.makeDialog());this.popup(this.getDomId(ID_DIALOG_BUTTON),d);this.initDialog()},getDimensionsStyle:function(){var d=this.getProperty("height",-1);if(d>0){return" height:"+d+"px;  max-height:"+d+"px; /*overflow-y: auto;*/"}return""},getContentsDiv:function(){var p="";var d=this.getWidth();if(d>0){p+="width:"+d+"px; /*overflow-x: auto;*/"}p+=this.getDimensionsStyle();return HtmlUtil.div([ATTR_CLASS,"display-contents-inner display-"+this.type,"style",p,ATTR_ID,this.getDomId(ID_DISPLAY_CONTENTS)],"")},copyDisplay:function(){var d={};$.extend(true,d,this);d.setId(d.getId()+this.getUniqueId("display"));addRamaddaDisplay(d);this.getDisplayManager().addDisplay(d)},removeDisplay:function(){this.getDisplayManager().removeDisplay(this)},prepareToLayout:function(){this.getColumn();this.getWidth();this.getHeight();this.getName();this.getEventSource()},getColumn:function(){return this.getFormValue("column",0)},getRow:function(){return this.getFormValue("row",0)},getWidth:function(){return this.getFormValue("width",0)},getHeight:function(){return this.getFormValue("height",0)},getDisplayTitle:function(q){if(!q){q=this.title!=null?this.title:""}var p=q;var d=this.lastSelectedFields;if(d&&d.length>0){p=p.replace("{field}",d[0].getLabel())}else{p=p.replace("{field}","")}return p},setDisplayTitle:function(p){if(!Utils.stringDefined(p)){p=this.getTitle(false).trim()}var d=this.getDisplayTitle(p);if(this.entryId){d=HtmlUtil.href(this.getRamadda().getEntryUrl(this.entryId),d)}if(this.getShowTitle()){this.jq(ID_TITLE).show()}else{this.jq(ID_TITLE).hide()}this.writeHtml(ID_TITLE,d)},getTitle:function(p){var s="";if(p&&this.hasEntries()){s=this.getEntryMenuButton(this.getEntries()[0])+" "}var u=this.getProperty(ATTR_TITLE);if(u!=null){return s+u}if(this.dataCollection==null){return s}var q=this.dataCollection.getList();u="";for(var t=0;t<q.length;t++){var d=q[t];if(t>0){u+="/"}u+=d.getName()}return s+u},getIsLayoutFixed:function(){return this.getProperty(PROP_LAYOUT_HERE,false)},doingQuickEntrySearch:false,doQuickEntrySearch:function(t,w){if(this.doingQuickEntrySearch){return}var u=t.term;if(u==null||u.length<=1){return}this.doingQuickEntrySearch=true;var d=new EntrySearchSettings({name:u,max:10});if(this.searchSettings){d.clearAndAddType(this.searchSettings.entryType)}var p=this;var s=this.getRamadda().getSearchUrl(d,OUTPUT_JSON);var q={entryListChanged:function(x){p.doneQuickEntrySearch(x,w)}};var v=new EntryList(this.getRamadda(),s,q,true)},doneQuickEntrySearch:function(t,s){var q=[];var d=t.getEntries();for(var p=0;p<d.length;p++){q.push(d[p].getName())}s(q);this.doingQuickEntrySearch=false},addData:function(d){var p=d.getRecords();if(p&&p.length>0){this.hasElevation=p[0].hasElevation()}else{this.hasElevation=false}this.dataCollection.addData(d);var q=d.entry;if(q==null){q=this.getRamadda().getEntry(d.entryId)}if(q){d.entry=q;this.addEntry(q)}},pointDataLoadFailed:function(d){this.inError=true;errorMessage=this.getProperty("errorMessage",null);if(errorMessage!=null){this.setContents(errorMessage);return}var p="";if(d&&d.errorcode&&d.errorcode=="warning"){p=d.error}else{p="<b>Sorry, but an error has occurred:</b>";if(!d){d="No data returned from server"}p+=HtmlUtil.tag("div",["style","background:#fff;margin:10px;padding:10px;border:1px #ccc solid;   border-radius: 0px;"],(d.error?d.error:d))}this.setContents(this.getMessage(p))},pointDataLoaded:function(d,p,q){if(!q){this.addData(d)}if(p!=null){this.jsonUrl=p}else{this.jsonUrl=null}if(!this.getDisplayReady()){return}this.updateUI();if(!q){this.lastPointData=d;this.getDisplayManager().handleEventPointDataLoaded(this,d)}},getDateFormatter:function(){var d=null;if(this.googleLoaded()){var p=this.getProperty("dateFormat",null);if(p){var q=0;this.timezone=this.getProperty("timezone");if(Utils.isDefined(this.timezone)){q=parseFloat(this.timezone)}d=new google.visualization.DateFormat({pattern:p,timeZone:q})}}return d},getHasDate:function(p){var s=null;this.hasDate=false;for(j=0;j<p.length;j++){var d=p[j];var q=d.getDate();if(q==null){continue}if(s!=null&&s.getTime()!=q.getTime()){this.hasDate=true;break}s=q}return this.hasDate},dateInRange:function(d){if(d!=null){if(this.minDateObj!=null&&d.getTime()<this.minDateObj.getTime()){return false}if(this.maxDateObj!=null&&d.getTime()>this.maxDateObj.getTime()){return false}}return true},getPointData:function(){if(this.dataCollection.getList().length==0){return null}return this.dataCollection.getList()[0]},getStandardData:function(p,L){var J=this.getPointData();var X=this.getProperty(PROP_EXCLUDE_ZERO,false);if(p==null){p=J.getRecordFields()}if(L==null){L={includeIndex:true,includeIndexIfDate:false,groupByIndex:-1,raw:false}}var ae=L.groupByIndex;var P=[];var S=[];var F=[];for(ab=0;ab<p.length;ab++){var w=p[ab];if(w.isFieldNumeric()&&w.isFieldDate()){}var C=w.getLabel();if(w.getUnit()!=null){C+=" ("+w.getUnit()+")"}C=C.replace(/!!/g," -- ");F.push(C)}S.push(F);P.push("");this.minDateObj=Utils.parseDate(this.minDate,false);this.maxDateObj=Utils.parseDate(this.maxDate,true,this.minDateObj);if(this.minDateObj==null&&this.maxDateObj!=null){this.minDateObj=Utils.parseDate(this.minDate,false,this.maxDateObj)}var v=(this.minDateObj!=null?this.minDateObj.getTime():-1);var B=(this.maxDateObj!=null?this.maxDateObj.getTime():-1);if(this.minDateObj!=null||this.maxDateObj!=null){}var U=0;if(Utils.isDefined(this.offset)){U=parseFloat(this.offset)}var aa=0;var Q=this.indexField;var Y=J.getRecords();var M=J.getRecordFields();this.hasDate=this.getHasDate(Y);var G=this.getDateFormatter();var H=-1;for(Z=0;Z<Y.length;Z++){var T=Y[Z];var ad=T.getDate();if(!this.dateInRange(ad)){continue}H++;var ag=[];if(L&&(L.includeIndex||L.includeIndexIfDate)){var q=null;if(Q>=0){var w=M[Q];ag.push(T.getValue(Q)+U);q=w.getLabel()}else{if(this.hasDate){ag.push(this.getDateValue(ad,G));q="Date"}else{if(!L.includeIndexIfDate){ag.push(Z);q="Index"}}}if(q!=null&&H==0){F.unshift(q)}}var K=true;var D=true;var R=false;for(var ab=0;ab<p.length;ab++){var w=p[ab];if(w.isFieldNumeric()&&w.isFieldDate()){}var V=T.getValue(w.getIndex());if(U!=0){V+=U}if(V!=null){K=false}if(typeof V=="number"){R=true;if(V!=0){D=false}}if(w.isFieldDate()){V=this.getDateValue(V,G)}ag.push(V)}if(R&&D&&X){continue}if(this.filters!=null){if(!this.applyFilters(T,ag)){console.log(" skipping due to filters");continue}}if(ae>=0){P.push(T.getValue(ae))}S.push(ag);if(!K){aa++}}if(aa==0){return[]}if(ae>=0){var x={};var y=[];var u=[];var O=[];O.push(L.groupByField.getLabel());for(var Z=0;Z<p.length;Z++){var w=p[Z];if(w.getIndex()==ae){continue}O.push(w.getLabel())}u.push(O);for(var ab=0;ab<S.length;ab++){var af=S[ab];if(ab==0){continue}var ah=P[ab];var I=false;var d=x[ah];if(d==null){y.push(ah);d=new Array();u.push(d);d.push(ah);for(var Z=0;Z<af.length;Z++){var w=p[Z];if(w.getIndex()==ae){continue}d.push(0)}x[ah]=d}else{}var N=0;for(var Z=0;Z<af.length;Z++){var w=p[Z];if(w.getIndex()==ae){continue}var t=af[Z];N++;if(Utils.isNumber(t)){if(typeof d[N]=="string"){d[N]=0}d[N]+=parseFloat(t)}else{if(d[N]==0){d[N]=""}var W=d[N];if(!Utils.isDefined(W)){W=""}if(W.length<150){if(!Utils.isDefined(t)){t=""}var z=(""+t);if(W.indexOf(z)<0){if(W!=""){W+=", "}W+=z;d[N]=W}}}}}for(var Z=0;Z<u.length;Z++){var E=u[Z];var W=null;for(var ac=0;ac<E.length;ac++){if(W){W+=","}W+=E[ac]}}return u}return S},googleLoaded:function(){if((typeof google==="undefined")||(typeof google.visualization==="undefined")||(typeof google.visualization.DateFormat==="undefined")){return false}return true},initDateFormats:function(){if(!this.googleLoaded()){return false}if(this.fmt_yyyy){return true}var d=0;this.timezone=this.getProperty("timezone");if(Utils.isDefined(this.timezone)){d=parseFloat(this.timezone)}this.fmt_yyyymmddhhmm=new google.visualization.DateFormat({pattern:"yyyy-MM-dd HH:mm'Z'",timeZone:d});this.fmt_yyyymmdd=new google.visualization.DateFormat({pattern:"yyyy-MM-dd",timeZone:d});this.fmt_yyyy=new google.visualization.DateFormat({pattern:"yyyy",timeZone:d});return true},getDateValue:function(d,p){if(!this.initDateFormats()){return d}if(!(typeof d=="object")){date=new Date(d)}else{date=d}if(!p){p=this.fmt_yyyymmddhhmm}var q=p.formatValue(date);date={v:date,f:q};return date},applyFilters:function(d,p){for(var q=0;q<this.filters.length;q++){if(!this.filters[q].recordOk(this,d,p)){return false}}return true}});var b=this.getProperty(PROP_DISPLAY_FILTER);if(b!=null){var c=b.split(";");for(var f=0;f<c.length;f++){b=c[f];var k=b.split(":");var n=k[0];if(n=="month"){this.filters.push(new MonthFilter(k[1]))}else{console.log("unknown filter:"+n)}}}}function DisplayGroup(c,g,d){var h=TAG_TABLE;var f="tabs";var e="columns";var k="rows";var b;RamaddaUtil.inherit(this,b=new RamaddaDisplay(c,g,"group",d));RamaddaUtil.defineMembers(this,{layout:this.getProperty(PROP_LAYOUT_TYPE,h)});RamaddaUtil.defineMembers(this,{displays:[],layout:this.getProperty(PROP_LAYOUT_TYPE,h),columns:this.getProperty(PROP_LAYOUT_COLUMNS,1),isLayoutColumns:function(){return this.layout==e},getDoBs:function(){return this.dobs},getWikiText:function(){var m=["layoutType",this.layout,"layoutColumns",this.columns,"showMenu","false","divid","$entryid_maindiv"];var l="";l+='<div id="{{entryid}}_maindiv"></div>\n\n';l+="{{group "+HtmlUtil.attrs(m)+"}}\n\n";return l},walkTree:function(m,n){for(var l=0;l<this.displays.length;l++){var o=this.displays[l];if(o.walkTree!=null){o.walkTree(m,n)}else{m.call(n,o)}}},collectEntries:function(l){if(l==null){l=[]}for(var m=0;m<this.displays.length;m++){var o=this.displays[m];if(o.collectEntries!=null){o.collectEntries(l)}else{var n=o.getEntries();if(n!=null&&n.length>0){l.push({source:o,entries:n})}}}return l},isLayoutRows:function(){return this.layout==k},getPosition:function(){for(var l=0;l<this.displays.length;l++){var m=this.displays[l];if(m.getPosition){return m.getPosition()}}},getDisplays:function(){return this.display},notifyEvent:function(n,q,p){var l=this.getDisplays();for(var m=0;m<this.displays.length;m++){var s=this.displays[m];if(s==q){continue}var o=s.getEventSource();if(o!=null&&o.length>0){if(o!=q.getId()&&o!=q.getName()){continue}}s.notifyEvent(n,q,p)}},getDisplaysToLayout:function(){var l=[];for(var m=0;m<this.displays.length;m++){if(this.displays[m].getIsLayoutFixed()){continue}l.push(this.displays[m])}return l},pageHasLoaded:function(m){for(var l=0;l<this.displays.length;l++){this.displays[l].setDisplayReady(true)}this.doLayout()},addDisplay:function(l){this.displays.push(l);if(Utils.getPageLoaded()){this.doLayout()}},layoutChanged:function(l){this.doLayout()},removeDisplay:function(m){var l=this.displays.indexOf(m);if(l>=0){this.displays.splice(l,1)}this.doLayout()},doLayout:function(){var v="";var y=100;var I=this.getDisplaysToLayout();var n=this.displays;for(var E=0;E<n.length;E++){var B=n[E];if(B.prepareToLayout!=null){B.prepareToLayout()}}var q=0;var G=null;if(typeof this.weights!="undefined"){G=this.weights.split(",")}if(this.layout==h){if(I.length==1){v+=HtmlUtil.div(["class"," display-wrapper"],I[0].getHtml())}else{var w=12/this.columns;var E=0;var J={};for(;E<I.length;E++){var H=I[E];if(Utils.isDefined(H.column)&&Utils.isDefined(H.row)&&H.columns>=0&&H.row>=0){var M=H.column+"_"+H.row;if(J[M]==null){J[M]=[]}J[M].push(H)}}E=0;for(;E<I.length;E++){y++;if(y>=this.columns){if(E>0){v+=HtmlUtil.closeTag(TAG_DIV)}v+=HtmlUtil.openTag("div",["class","row"]);y=0}var K=w;if(G!=null){if(q>=G.length){q=0}K=G[q];q++}v+=HtmlUtil.div(["class","col-md-"+K+" display-wrapper display-cell"],I[E].getHtml())}if(E>0){v+=HtmlUtil.closeTag(TAG_DIV)}}}else{if(this.layout==f){var L=HtmlUtil.getUniqueId("tabs_");v+=HtmlUtil.openTag(TAG_DIV,["id",L,"class","ui-tabs"]);v+=HtmlUtil.openTag(TAG_UL,[]);var D="";var C=0;for(var E=0;E<I.length;E++){var B=I[E];var s=B.getTitle(false);if(s.length>20){s=s.substring(0,19)+"..."}v+=HtmlUtil.tag(TAG_LI,[],HtmlUtil.tag(TAG_A,["href","#"+L+"-"+C],s));D+=HtmlUtil.div(["id",L+"-"+C,"class","ui-tabs-hide"],B.getHtml());C++}v+=HtmlUtil.closeTag(TAG_UL);v+=D;v+=HtmlUtil.closeTag(TAG_DIV)}else{if(this.layout==k){var t=[];for(var E=0;E<I.length;E++){var B=I[E];var p=B.getRow();if((""+p).length==0){p=0}while(t.length<=p){t.push([])}t[p].push(B.getHtml())}for(var E=0;E<t.length;E++){var u=t[E];var x=Math.round(100/u.length)+"%";v+=HtmlUtil.openTag(TAG_TABLE,["border","0","width","100%","cellpadding","0","cellspacing","0"]);v+=HtmlUtil.openTag(TAG_TR,["valign","top"]);for(var o=0;o<u.length;o++){var l=u[o];l=HtmlUtil.div(["class","display-cell"],l);v+=HtmlUtil.tag(TAG_TD,["width",x],l)}v+=HtmlUtil.closeTag(TAG_TR);v+=HtmlUtil.closeTag(TAG_TABLE)}}else{if(this.layout==e){var u=[];for(var E=0;E<I.length;E++){var B=I[E];var m=B.getColumn();if((""+m).length==0){m=0}while(u.length<=m){u.push([])}u[m].push(B.getHtml())}v+=HtmlUtil.openTag(TAG_DIV,["class","row"]);var x=Math.round(100/u.length)+"%";var w=12/u.length;for(var E=0;E<u.length;E++){var t=u[E];var F="";for(var z=0;z<t.length;z++){F+=t[z]}var K=w;if(G!=null){if(q>=G.length){q=0}K=G[q];q++}v+=HtmlUtil.div(["class","col-md-"+K],F)}v+=HtmlUtil.closeTag(TAG_DIV)}else{v+="Unknown layout:"+this.layout}}}}this.writeHtml(ID_DISPLAYS,v);if(this.layout==f){$("#"+L).tabs({})}this.initDisplays()},initDisplays:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].initDisplay()}},setLayout:function(m,l){this.layout=m;if(l){this.columns=l}this.doLayout()},askMinZAxis:function(){var l=prompt("Minimum axis value","0");if(l!=null){l=parseFloat(l);for(var m=0;m<this.displays.length;m++){var n=this.displays[m];if(n.setMinZAxis){n.setMinZAxis(l)}}}},askMaxZAxis:function(){var l=prompt("Maximum axis value","0");if(l!=null){l=parseFloat(l);for(var m=0;m<this.displays.length;m++){var n=this.displays[m];if(n.setMaxZAxis){n.setMaxZAxis(l)}}}},askMinDate:function(){var n=this.minDate;if(!n){n="1950-0-0"}this.minDate=prompt("Minimum date",n);if(this.minDate!=null){for(var l=0;l<this.displays.length;l++){var m=this.displays[l];if(m.setMinDate){m.setMinDate(this.minDate)}}}},askMaxDate:function(){var n=this.maxDate;if(!n){n="2020-0-0"}this.maxDate=prompt("Maximum date",n);if(this.maxDate!=null){for(var l=0;l<this.displays.length;l++){var m=this.displays[l];if(m.setMaxDate){m.setMaxDate(this.maxDate)}}}},titlesOff:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowTitle(false)}},titlesOn:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowTitle(true)}},detailsOff:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowDetails(false)}this.doLayout()},detailsOn:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowDetails(true)}this.doLayout()},deleteAllDisplays:function(){this.displays=[];this.doLayout()},moveDisplayUp:function(m){var l=this.displays.indexOf(m);if(l<=0){return}this.displays.splice(l,1);this.displays.splice(l-1,0,m);this.doLayout()},moveDisplayDown:function(m){var l=this.displays.indexOf(m);if(l>=this.displays.length){return}this.displays.splice(l,1);this.displays.splice(l+1,0,m);this.doLayout()},moveDisplayTop:function(m){var l=this.displays.indexOf(m);if(l>=this.displays.length){return}this.displays.splice(l,1);this.displays.splice(0,0,m);this.doLayout()}})}var pointDataCache={};function DataCollection(){RamaddaUtil.defineMembers(this,{data:[],hasData:function(){for(var b=0;b<this.data.length;b++){if(this.data[b].hasData()){return true}}return false},getList:function(){return this.data},addData:function(b){this.data.push(b)},handleEventMapClick:function(e,c,f,d){for(var b=0;b<this.data.length;b++){this.data[b].handleEventMapClick(e,c,f,d)}}})}function BasePointData(b,c){if(c==null){c={}}RamaddaUtil.defineMembers(this,{recordFields:null,records:null,entryId:null,entry:null});$.extend(this,c);RamaddaUtil.defineMembers(this,{name:b,properties:c,initWith:function(d){this.recordFields=d.recordFields;this.records=d.records},handleEventMapClick:function(f,d,g,e){},hasData:function(){return this.records!=null},clear:function(){this.records=null;this.recordFields=null},getProperties:function(){return this.properties},getProperty:function(d,f){var e=this.properties[d];if(e==null){return f}return e},getRecordFields:function(){return this.recordFields},addRecordField:function(d){this.recordFields.push(d)},getRecords:function(){return this.records},getNumericFields:function(){var e=this.getRecordFields();var d=[];for(var f=0;f<e.length;f++){var g=e[f];if(g.isNumeric){d.push(g)}}return d},getChartableFields:function(l){var f=this.getRecordFields();var e=[];var h=/(TIME|HOUR|MINUTE|SECOND|YEAR|MONTH|DAY|LATITUDE|LONGITUDE|^ELEVATION$)/g;var h=/(xxxnoskip)/g;for(var g=0;g<f.length;g++){var k=f[g];if(!k.isNumeric||!k.isChartable()){continue}var d=k.getId().toUpperCase();if(d.match(h)){continue}e.push(k)}return RecordUtil.sort(e)},getNonGeoFields:function(h){var e=this.getRecordFields();var d=[];for(var f=0;f<e.length;f++){var g=e[f];if(g.isFieldGeo()){continue}d.push(g)}return d},loadData:function(d){},getName:function(){return this.name},getTitle:function(){if(this.records!=null&&this.records.length>0){return this.name+" - "+this.records.length+" points"}return this.name}})}function PointData(e,d,b,c,f){RamaddaUtil.inherit(this,new BasePointData(e,f));RamaddaUtil.defineMembers(this,{recordFields:d,records:b,url:c,loadingCnt:0,equals:function(g){return this.url==g.url},getIsLoading:function(){return this.loadingCnt>0},handleEventMapClick:function(k,g,l,h){this.lon=l;this.lat=h;if(k.getDisplayManager().hasGeoMacro(this.url)){this.loadData(k,true)}},startLoading:function(){this.loadingCnt++},stopLoading:function(){this.loadingCnt--},loadData:function(l,k){if(this.url==null){console.log("No URL");return}var h={lat:this.lat,lon:this.lon};var g=l.displayManager.getJsonUrl(this.url,l,h);this.loadPointJson(g,l,k)},loadPointJson:function(h,m,k){var g=this;this.startLoading();var o=this;var l=pointDataCache[h];if(l==null){l={pointData:null,pending:[]};pointDataCache[h]=l}if(l.pointData!=null){m.pointDataLoaded(l.pointData,h,k);return}l.pending.push(m);if(l.pending.length>1){return}console.log("load data:"+h);var n=$.getJSON(h,function(t){if(GuiUtils.isJsonError(t)){m.pointDataLoadFailed(t);return}var s=makePointData(t,o.derived,m);l.pointData=g.initWith(s);var q=l.pending;l.pending=[];for(var p=0;p<q.length;p++){q[p].pointDataLoaded(g,h,k)}g.stopLoading()}).fail(function(s,t,p){var q=t+": "+p;console.log("JSON error:"+q);m.pointDataLoadFailed(q);g.stopLoading()})}})}function DerivedPointData(e,d,c,b){RamaddaUtil.inherit(this,new BasePointData(d));RamaddaUtil.defineMembers(this,{displayManager:e,operation:b,pointDataList:c,loadDataCalls:0,display:null,pointDataLoaded:function(f){this.loadDataCalls--;if(this.loadDataCalls<=0){this.initData()}},equals:function(g){if(g.pointDataList==null){return false}if(this.pointDataList.length!=g.pointDataList.length){return false}for(var f in this.pointDataList){if(!this.pointDataList[f].equals(g.pointDataList[f])){return false}}return true},initData:function(){var f=this.pointDataList[0];if(this.pointDataList.length==1){this.records=f.getRecords();this.recordFields=f.getRecordFields()}else{if(this.pointDataList.length>1){var g=this.combineData(f,this.pointDataList[1]);this.records=g.records;this.recordFields=g.recordFields}}this.display.pointDataLoaded(this)},combineData:function(o,n){var t=o.getRecords();var q=n.getRecords();var l=[];var u;if(t.length!=q.length){console.log("bad records:"+t.length+" "+q.length)}if(this.operation=="average"){for(var s=0;s<t.length;s++){var g=t[s];var f=q[s];if(g.getDate()!=f.getDate()){console.log("Bad record date:"+g.getDate()+" "+f.getDate());break}var p=$.extend(true,{},g);var k=p.getData();var h=f.getData();for(var m=0;m<k.length;m++){k[m]=(k[m]+h[m])/2}l.push(p)}u=o.getRecordFields()}else{if(this.operation=="other func"){}}if(u==null){l=t;u=o.getRecordFields()}return{records:l,recordFields:u}},loadData:function(h){this.display=h;this.loadDataCalls=0;for(var g in this.pointDataList){var f=this.pointDataList[g];if(!f.hasData()){this.loadDataCalls++;f.loadData(this)}if(this.loadDataCalls==0){this.initData()}}}})}function RecordField(b){$.extend(this,{isDate:b.type=="date",isLatitude:false,isLongitude:false,isElevation:false});$.extend(this,b);$.extend(this,{isNumeric:b.type=="double"||b.type=="integer",properties:b});RamaddaUtil.defineMembers(this,{getIndex:function(){return this.index},isFieldGeo:function(){return this.isFieldLatitude()||this.isFieldLongitude()||this.isFieldElevation()},isFieldLatitude:function(){return this.isLatitude||this.id.toLowerCase()=="latitude"},isFieldLongitude:function(){return this.isLongitude||this.id.toLowerCase()=="longitude"},isFieldElevation:function(){return this.isElevation||this.id.toLowerCase()=="elevation"||this.id.toLowerCase()=="altitude"},isFieldNumeric:function(){return this.isNumeric},isFieldDate:function(){return this.isDate},isChartable:function(){return this.chartable},getSortOrder:function(){return this.sortorder},getId:function(){return this.id},getLabel:function(){if(this.label==null||this.label.length==0){return this.id}return this.label},setLabel:function(c){this.label=c},getType:function(){return this.type},getMissing:function(){return this.missing},setUnit:function(c){this.unit=c},getUnit:function(){return this.unit}})}function PointRecord(e,f,b,d,c){RamaddaUtil.defineMembers(this,{latitude:e,longitude:f,elevation:b,recordTime:d,data:c,getData:function(){return this.data},allZeros:function(){var g=this.getData();var k=false;var m=0;var l=0;for(var h=0;h<g.length;h++){if(typeof g[h]=="number"){m++;if(!isNaN(g[h])&&g[h]!=0){l++;break}}}if(m>0&&l==0){return true}return false},getValue:function(g){return this.data[g]},push:function(g){this.data.push(g)},hasLocation:function(){return !isNaN(this.latitude)},hasElevation:function(){return !isNaN(this.elevation)},getLatitude:function(){return this.latitude},getLongitude:function(){return this.longitude},getTime:function(){return this.time},getElevation:function(){return this.elevation},getDate:function(){return this.recordTime}})}function makePointData(R,E,z){var c=[];var u=-1;var g=-1;var s=-1;var I=-1;var K=null;for(var U=0;U<R.fields.length;U++){var o=R.fields[U];var B=new RecordField(o);K=B;c.push(B);if(B.isFieldLatitude()){u=B.getIndex()}else{if(B.isFieldLongitude()){g=B.getIndex()}else{if(B.isFieldElevation()){s=B.getIndex()}else{if(B.isFieldDate()){I=B.getIndex()}}}}}if(!E){E=[]}if(E){var F=K.getIndex()+1;for(var J=0;J<E.length;J++){var Z=E[J];var S=Z.label;if(!S){S=Z.name}var B=new RecordField({type:"double",index:(F+J),chartable:true,id:Z.name,label:S});B.derived=Z;c.push(B)}}var t=[];var W=[];for(var U=0;U<R.data.length;U++){var b=R.data[U];var ab=b.values;var V=null;if((typeof b.date==="undefined")){if(I>=0){V=new Date(ab[I])}}else{if(b.date!=null&&b.date!=0){V=new Date(b.date)}}if((typeof b.latitude==="undefined")){if(u>=0){b.latitude=ab[u]}else{b.latitude=NaN}}if((typeof b.longitude==="undefined")){if(g>=0){b.longitude=ab[g]}else{b.longitude=NaN}}if((typeof b.elevation==="undefined")){if(s>=0){b.elevation=ab[s]}else{b.elevation=NaN}}if(E){for(var J=0;J<E.length;J++){var Z=E[J];if(!Z.isRow){continue}if(!Z.compiledFunction){var x=[];var h=(Z.columns.indexOf(";")>=0?Z.columns.split(";"):Z.columns.split(","));Z.fieldsToUse=[];for(var U=0;U<h.length;U++){var n=h[U].trim();x.push("v"+(U+1));var y=null;for(var C=0;C<c.length;C++){var X=c[C];if(X.getId()==n){y=X;break}}Z.fieldsToUse.push(y)}var k="";for(var U=0;U<x.length;U++){k+="var v"+(U+1)+"=args["+U+"];\n"}var Q=Z["function"];if(Q.indexOf("return")<0){Q="return "+Q}k+=Q+"\n";Z.compiledFunction=new Function("args",k)}var P=[];var T=false;for(var C=0;C<Z.fieldsToUse.length;C++){var X=Z.fieldsToUse[C];var N=NaN;if(X!=null){N=ab[X.getIndex()];if(N==null){N=NaN}}if(!isNaN(N)){T=true}else{}P.push(N)}try{var w=NaN;if(T){w=Z.compiledFunction(P);if(Z.decimals>=0){w=w.toFixed(Z.decimals)}w=parseFloat(w)}else{}ab.push(w)}catch(Y){console.log("Error evaluating function:"+Z["function"]+"\n"+Y);ab.push(NaN)}}}W.push(ab);var M=new PointRecord(b.latitude,b.longitude,b.elevation,V,ab);t.push(M)}for(var J=0;J<E.length;J++){var Z=E[J];if(!Z.isColumn){continue}var X=Z["function"];var x=[];var h=Z.columns.split(",");for(var U=0;U<h.length;U++){var F=-1;for(var C=0;C<c.length;C++){var X=c[C];if(X.getId()==h[U]||X.getLabel()==h[U]){F=X.getIndex();console.log("index:"+F+" f:"+X.getId());break}}if(F<0){console.log("Could not find column index for field: "+h[U]);continue}x.push("c"+(U+1))}var D=RecordUtil.slice(W,F);var p=new Function(x,Z["function"]);console.log("daFunk - "+p);var H=p(D);console.log("got new:"+H+" "+(typeof H));if((typeof H)=="number"){for(var aa=0;aa<t.length;aa++){var M=t[aa];M.push(H)}}else{if(Utils.isDefined(H.length)){console.log("newData.length:"+H.length+" records.length:"+t.length);for(var aa=0;aa<H.length;aa++){var M=t[aa];if(!M){console.log("bad record: "+aa);M.push(NaN)}else{var N=H[aa];if(Z.decimals>=0){N=parseFloat(N.toFixed(Z.decimals))}M.push(N)}}}}}if(z!=null){for(var U=0;U<c.length;U++){var o=c[U];var L="field."+o.getId()+".";if(Utils.isDefined(z[L+"unit"])){o.setUnit(z[L+"unit"])}if(Utils.isDefined(z[L+"label"])){o.setLabel(z[L+"label"])}if(Utils.isDefined(z[L+"scale"])||Utils.isDefined(z[L+"offset1"])||Utils.isDefined(z[L+"offset2"])){var m=Utils.isDefined(z[L+"offset1"])?parseFloat(z[L+"offset1"]):0;var l=Utils.isDefined(z[L+"offset2"])?parseFloat(z[L+"offset2"]):0;var G=Utils.isDefined(z[L+"scale"])?parseFloat(z[L+"scale"]):1;var F=o.getIndex();for(var aa=0;aa<t.length;aa++){var M=t[aa];var ab=M.getData();var O=ab[F];ab[F]=(O+m)*G+l}}}}var q=R.name;if((typeof q==="undefined")){q="Point Data"}t.sort(function(e,d){if(e.getDate()&&d.getDate()){if(e.getDate().getTime()<d.getDate().getTime()){return -1}if(e.getDate().getTime()>d.getDate().getTime()){return 1}return 0}});return new PointData(q,c,t)}function makeTestPointData(){var b={fields:[{index:0,id:"field1",label:"Field 1",type:"double",missing:"-999.0",unit:"m"},{index:1,id:"field2",label:"Field 2",type:"double",missing:"-999.0",unit:"c"}],data:[[-64.77,-64.06,45,null,[8,1000]],[-65.77,-64.06,45,null,[9,500]],[-65.77,-64.06,45,null,[10,250]]]};return makePointData(b)}function RecordFilter(b){if(b==null){b={}}RamaddaUtil.defineMembers(this,{properties:b,recordOk:function(e,c,d){return true}})}function MonthFilter(b){RamaddaUtil.inherit(this,new RecordFilter());RamaddaUtil.defineMembers(this,{months:b.split(","),recordOk:function(g,c,d){for(i in this.months){var f=this.months[i];var e=c.getDate();if(e==null){return false}if(e.getMonth==null){return false}if(e.getMonth()==f){return true}}return false}})}var A={add:function(c,b){if(isNaN(c)||isNaN(b)){return NaN}return c+b},average:function(b){var d=0;if(b.length==0){return 0}for(var c=0;c<b.length;c++){d+=b[c]}return d/b.length},percentIncrease:function(d){var b=[];var g=0;if(d.length==0){return 0}var e;for(var f=0;f<d.length;f++){var c=d[f];var h=NaN;if(f>0&&e!=0){h=(c-e)/e}e=c;b.push(h*100)}return b},movingAverage:function(k,f){if(!f){f={}}if(!f.step){f.step=5}var l=[];console.log("STEP:"+f.step);for(var e=f.step;e<k.length;e++){var g=0;var b=0;for(var d=e-f.step;d<e;d++){if(k[d]==k[d]){g+=k[d];b++}}var h=(b>0?g/b:NaN);if(l.length==0){for(var c=0;c<f.step;c++){l.push(h)}}l.push(h)}console.log("MovingAverage: values:"+k.length+" new:"+l.length);return l},expMovingAverage:function(l,g){if(!g){g={}}if(!g.step){g.step=5}var m=A.movingAverage(l,g);var e=(2/(g.step+1));var n=[];console.log("STEP:"+g.step);for(var f=g.step;f<l.length;f++){var h=0;var b=0;for(var d=f-g.step;d<f;d++){if(l[d]==l[d]){h+=l[d];b++}}var k=(b>0?h/b:NaN);if(n.length==0){for(var c=0;c<g.step;c++){n.push(k)}}n.push(k)}console.log("MovingAverage: values:"+l.length+" new:"+n.length);return n},max:function(c){var b=NaN;for(var d=0;d<c.length;d++){if(d==0||c[d]>b){b=c[d]}}return b},min:function(b){var d=NaN;for(var c=0;c<b.length;c++){if(c==0||b[c]<d){d=b[c]}}return d}};var RecordUtil={getRanges:function(g,e){var h=[];var c=[];for(var f=0;f<g.length;f++){h.push(NaN);c.push(NaN)}for(var l=0;l<e.length;l++){for(var d=0;d<g.length;d++){var k=e[l].getValue(d);if(isNaN(k)){continue}h[d]=(isNaN(h[d])?k:Math.max(k,h[d]));c[d]=(isNaN(c[d])?k:Math.min(k,c[d]))}}var b=[];for(var d=0;d<g.length;d++){b.push([c[d],h[d]])}return b},getElevationRange:function(b,c){var f=NaN;var e=NaN;for(var g=0;g<c.length;g++){if(c[g].hasElevation()){var d=c[g].getElevation();f=(isNaN(f)?d:Math.max(d,f));e=(isNaN(e)?d:Math.min(d,e))}}return[e,f]},slice:function(c,d){var b=[];for(var e=0;e<c.length;e++){var f=c[e];if(f.getValue){b.push(f.getValue(d))}else{b.push(f[d])}}return b},sort:function(b){b=b.slice(0);b.sort(function(d,c){var f=d.getSortOrder();var e=c.getSortOrder();return f<e});return b},getPoints:function(d,h){var g=[];var k=NaN,c=NaN,f=NaN,e=NaN;if(d!=null){for(j=0;j<d.length;j++){var b=d[j];if(!isNaN(b.getLatitude())&&!isNaN(b.getLongitude())){if(j==0){k=b.getLatitude();f=b.getLatitude();c=b.getLongitude();e=b.getLongitude()}else{k=Math.max(k,b.getLatitude());f=Math.min(f,b.getLatitude());c=Math.min(c,b.getLongitude());e=Math.max(e,b.getLongitude())}if(b.getLongitude()<-180||b.getLatitude()>90){console.log("Bad index="+j+" "+b.getLatitude()+" "+b.getLongitude())}g.push(new OpenLayers.Geometry.Point(b.getLongitude(),b.getLatitude()))}}}h.north=k;h.west=c;h.south=f;h.east=e;return g},findClosest:function(e,c,h,l){if(e==null){return null}var d=null;var k=1000000000;var g=-1;for(j=0;j<e.length;j++){var f=e[j];if(isNaN(f.getLatitude())){continue}var b=Math.sqrt((c-f.getLongitude())*(c-f.getLongitude())+(h-f.getLatitude())*(h-f.getLatitude()));if(b<k){k=b;d=f;g=j}}if(l!=null){l.index=g}return d},clonePoints:function(e){var c=[];for(var d=0;d<e.length;d++){var b=e[d];c.push(new OpenLayers.Geometry.Point(b.x,b.y))}return c}};var DISPLAY_FILTER="filter";var DISPLAY_ANIMATION="animation";var DISPLAY_LABEL="label";var DISPLAY_SHELL="shell";addGlobalDisplayType({type:DISPLAY_FILTER,label:"Filter",requiresData:false,category:"Controls"});addGlobalDisplayType({type:DISPLAY_ANIMATION,label:"Animation",requiresData:false,category:"Controls"});addGlobalDisplayType({type:DISPLAY_LABEL,label:"Text",requiresData:false,category:"Misc"});addGlobalDisplayType({type:DISPLAY_SHELL,label:"Analysis Shell",requiresData:false,category:"Misc"});function RamaddaFilterDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaDisplay(d,c,b));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{html:"<p>&nbsp;&nbsp;&nbsp;Nothing selected&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<p>",initDisplay:function(){this.initUI();this.setContents(this.html)}})}function RamaddaAnimationDisplay(g,f,d){var c="start";var b="stop";var e="time";RamaddaUtil.inherit(this,new RamaddaDisplay(g,f,DISPLAY_ANIMATION,d));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{running:false,timestamp:0,index:0,sleepTime:500,iconStart:ramaddaBaseUrl+"/icons/display/control.png",iconStop:ramaddaBaseUrl+"/icons/display/control-stop-square.png",iconBack:ramaddaBaseUrl+"/icons/display/control-stop-180.png",iconForward:ramaddaBaseUrl+"/icons/display/control-stop.png",iconFaster:ramaddaBaseUrl+"/icons/display/plus.png",iconSlower:ramaddaBaseUrl+"/icons/display/minus.png",iconBegin:ramaddaBaseUrl+"/icons/display/control-double-180.png",iconEnd:ramaddaBaseUrl+"/icons/display/control-double.png",deltaIndex:function(h){this.stop();this.setIndex(this.index+h)},setIndex:function(h){if(h<0){h=0}this.index=h;this.applyStep(true,!Utils.isDefined(h))},toggle:function(){if(this.running){this.stop()}else{this.start()}},tick:function(){if(!this.running){return}this.index++;this.applyStep();var h=this;setTimeout(function(){h.tick()},this.sleepTime)},applyStep:function(h,p){if(!Utils.isDefined(h)){h=true}var o=this.displayManager.getDefaultData();if(o==null){return}var l=o.getRecords();if(l==null){$("#"+this.getDomId(e)).html("no records");return}if(p){this.index=l.length-1}if(this.index>=l.length){this.index=0}var k=l[this.index];var m="";if(k.getDate()!=null){var n=this.formatDate(k.getDate(),{suffix:this.getTimeZone()});m+=HtmlUtil.b("Date:")+" "+n}else{m+=HtmlUtil.b("Index:")+" "+this.index}$("#"+this.getDomId(e)).html(m);if(h){this.displayManager.propagateEventRecordSelection(this,o,{index:this.index})}},handleEventRecordSelection:function(l,h){var k=this.displayManager.getDefaultData();if(k==null){return}if(k!=h.data){return}if(!k){return}this.index=h.index;this.applyStep(false)},faster:function(){this.sleepTime=this.sleepTime/2;if(this.sleepTime==0){this.sleepTime=100}},slower:function(){this.sleepTime=this.sleepTime*1.5},start:function(){if(this.running){return}this.running=true;this.timestamp++;$("#"+this.getDomId(c)).attr("src",this.iconStop);this.tick()},stop:function(){if(!this.running){return}this.running=false;this.timestamp++;$("#"+this.getDomId(c)).attr("src",this.iconStart)},initDisplay:function(){this.initUI();this.stop();var h=this.getGet();var k="";k+=HtmlUtil.onClick(h+".setIndex(0);",HtmlUtil.image(this.iconBegin,[ATTR_TITLE,"beginning",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtil.onClick(h+".deltaIndex(-1);",HtmlUtil.image(this.iconBack,[ATTR_TITLE,"back 1",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtil.onClick(h+".toggle();",HtmlUtil.image(this.iconStart,[ATTR_TITLE,"play/stop",ATTR_CLASS,"display-animation-button","xwidth","32",ATTR_ID,this.getDomId(c)]));k+=HtmlUtil.onClick(h+".deltaIndex(1);",HtmlUtil.image(this.iconForward,[ATTR_TITLE,"forward 1",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtil.onClick(h+".setIndex();",HtmlUtil.image(this.iconEnd,[ATTR_TITLE,"end",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtil.onClick(h+".faster();",HtmlUtil.image(this.iconFaster,[ATTR_CLASS,"display-animation-button",ATTR_TITLE,"faster","xwidth","32"]));k+=HtmlUtil.onClick(h+".slower();",HtmlUtil.image(this.iconSlower,[ATTR_CLASS,"display-animation-button",ATTR_TITLE,"slower","xwidth","32"]));k+=HtmlUtil.div(["style","display:inline-block; min-height:24px; margin-left:10px;",ATTR_ID,this.getDomId(e)],"&nbsp;");this.setDisplayTitle("Animation");this.setContents(k)}})}function RamaddaLabelDisplay(g,f,c){var e="text";var d="edit";var b;if(c&&!Utils.isDefined(c.showTitle)){c.showTitle=false}RamaddaUtil.inherit(this,b=new RamaddaDisplay(g,f,DISPLAY_LABEL,c));addRamaddaDisplay(this);this.text="";this.editMode=c.editMode;if(c.text){this.text=c.text}else{if(c.label){this.text=c.label}else{if(c.html){this.text=c.html}else{if(c.title){this.text=c.title}}}}if(c["class"]){this["class"]=c["class"]}else{this["class"]="display-text"}RamaddaUtil.defineMembers(this,{initDisplay:function(){var l=this;this.initUI();var h=this["class"];if(this.editMode){h+=" display-text-edit "}var m=HtmlUtil.div([ATTR_CLASS,h,ATTR_ID,this.getDomId(e)],this.text);if(this.editMode){m+=HtmlUtil.textarea(d,this.text,["rows",5,"cols",120,ATTR_SIZE,"120",ATTR_CLASS,"display-text-input",ATTR_ID,this.getDomId(d)])}this.setContents(m);if(this.editMode){var k=this.jq(d);k.blur(function(){l.text=k.val();k.hide();l.initDisplay()});this.jq(e).click(function(){var o=l.jq(e);var n=l.jq(d);n.show();n.css("z-index","9999");n.position({of:o,my:"left top",at:"left top",collision:"none none"});l.jq(e).html("hello there")})}},getWikiAttributes:function(h){b.getWikiAttributes(h);h.push("text");h.push(this.text)}})}function RamaddaShellDisplay(h,g,d){var f="input";var e="output";var c="message";var b;RamaddaUtil.inherit(this,b=new RamaddaDisplay(h,g,DISPLAY_SHELL,d));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{history:[],historyIndex:-1,rootEntry:null,currentEntry:null,currentEntries:[],currentOutput:null,currentInput:null,initDisplay:function(){var o=this;this.initUI();var n=HtmlUtil.div([ATTR_CLASS,"display-shell-message",ATTR_ID,this.getDomId(c)],"");var l=HtmlUtil.div([ATTR_CLASS,"display-shell-output",ATTR_ID,this.getDomId(e)],"");var k=HtmlUtil.tag(TAG_INPUT,["placeholder","Enter JS here",ATTR_CLASS,"display-shell-input",ATTR_ID,this.getDomId(f)]);var m=n+l+k;this.setContents(m);if(this.currentOutput){this.getOutput().html(this.currentOutput)}if(this.currentInput){this.getInput().val(this.currentInput)}this.jq(f).keypress(function(q){if(q.which==0){return}if(q.ctrlKey){o.handleControlKey(q);return}if(q.which!=13){return}if(q.preventDefault){q.preventDefault()}var p=o.jq(f).val();o.processInput(p)})},writeStatusMessage:function(k){var l=this.jq(c);if(!k){l.hide();l.html("")}else{l.show();l.position({of:this.getOutput(),my:"left top",at:"left+4 top+4",collision:"none none"});l.html(k)}},clearInput:function(){this.jq(f).val("")},clearOutput:function(){this.writeStatusMessage(null);this.jq(e).html("")},handleControlKey:function(p){var m=p.which;var o=this.history;if(o.length<=0){return}var n=this.historyIndex;var l=-1;if(n<0||n>=o.length){n=o.length}if(m==112){l=n-1}else{if(m==110){l=n+1}}if(l>=0&&l<o.length){this.historyIndex=l;this.writeInput(o[l])}},writeInput:function(l){var k=this.getInput();if(k.val()==l){return}k.val(l).focus();this.currentInput=this.getInput().val()},getOutput:function(){return this.jq(e)},getInput:function(){return this.jq(f)},writeResult:function(l){this.writeStatusMessage(null);l=HtmlUtil.div([ATTR_CLASS,"display-shell-result"],l);var k=this.jq(e);k.append(l);k.animate({scrollTop:k.prop("scrollHeight")},1000);this.currentOutput=k.html();this.currentInput=this.getInput().val()},addHistory:function(k){if(this.history.length>0&&this.history[this.history.length-1]==k){return}this.history.push(k);this.historyIndex=-1},writeError:function(k){this.writeStatusMessage(k)},header:function(k){return HtmlUtil.div([ATTR_CLASS,"display-shell-header"],k)},processCommand_help:function(k,n,m){var l="";if(m!=null){l+=m}l+=this.header("RAMADDA Data Explorer Shell Help");l+="Navigation commands:<pre>pwd, ls, cd</pre>";l+="UI commands:<pre>history: ctrl-p, ctrl-n, !!  \nUI: clear, taller, shorter</pre>";this.writeResult(l)},uniqueCnt:0,displayEntries:function(k){this.currentEntries=k;var l=this.getEntriesTree(k,{showIndex:true,suffix:"_shell_"+(this.uniqueCnt++)});this.writeResult(l)},getEntryFromArgs:function(m,o){var p=this.currentEntries;if(p==null){return o}for(var n=0;n<m.length;n++){var k=m[n];if(k.match("^\d+$")){var l=parseInt(k);break}if(k=="-entry"){n++;var l=parseInt(m[n])-1;if(l<0||l>=p){this.writeError("Bad entry index:"+l+" should be between 1 and "+p.length);return}return p[l]}}return o},getCurrentEntry:function(){if(this.currentEntry==null){this.rootEntry=new Entry({id:ramaddaBaseEntry,name:"Root",type:"group"});this.currentEntry=this.rootEntry}return this.currentEntry},processCommand_pwd:function(k,o){var n=this.getCurrentEntry();var m=n.getIconImage([ATTR_TITLE,"View entry"]);var l=this.getEntriesTree([n],{suffix:"_YYY"});this.writeResult("Current entry:<br>"+l)},createPointDisplay:function(k,o,l){var n=this.getEntryFromArgs(o,this.getCurrentEntry());console.log("createDisplay got:"+n.getName());var m=this.getPointUrl(n);if(m==null){this.writeError("Not a point type:"+n.getName());return}this.createDisplay(n.getId(),l,m)},processCommand_table:function(k,l){this.createPointDisplay(k,l,DISPLAY_TABLE)},processCommand_linechart:function(k,l){this.createPointDisplay(k,l,DISPLAY_LINECHART)},processCommand_barchart:function(k,l){this.createPointDisplay(k,l,DISPLAY_BARCHART)},processCommand_bartable:function(k,l){this.createPointDisplay(k,l,DISPLAY_BARTABLE)},processCommand_hello:function(k,l){this.writeResult("Hello, how are you?")},processCommand_scatterplot:function(k,l){this.createPointDisplay(k,l,DISPLAY_SCATTERPLOT)},processCommand_blog:function(k,l){this.getLayoutManager().publish("blogentry")},processCommand_cd:function(k,m){if(m.length==0){this.currentEntry=this.rootEntry;this.processCommand_pwd("pwd",[]);return}var l=parseInt(m[1])-1;if(l<0||l>=this.currentEntries.length){this.writeError("Out of bounds: between 1 and "+this.currentEntries.length);return}this.currentEntry=this.currentEntries[l];this.processCommand_pwd("pwd",[])},processCommand_ls:function(k,o){var n=this;var m=function(p){n.displayEntries(p)};var l=this.getCurrentEntry().getChildrenEntries(m,"");if(l!=null){this.displayEntries(l)}else{this.writeStatusMessage("Listing entries...")}},entryListChanged:function(l){var k=l.getEntries();if(k.length==0){this.writeStatusMessage("Sorry, nothing found")}else{this.displayEntries(k)}},processCommand_search:function(l,q){var p="";for(var m=1;m<q.length;m++){p+=q[m]+" "}p=p.trim();var k=new EntrySearchSettings({text:p});var o=this.getRamadda();this.writeStatusMessage("Searching...");var n=o.getSearchUrl(k,OUTPUT_JSON);this.entryList=new EntryList(o,n,this,true)},processCommand_taller:function(k,l){if(!this.outputHeight){this.outputHeight=300}this.outputHeight+=parseInt(this.outputHeight*0.3);this.jq(e).css("max-height",this.outputHeight);this.jq(e).css("height",this.outputHeight)},processCommand_shorter:function(k,l){if(!this.outputHeight){this.outputHeight=300}this.outputHeight-=parseInt(this.outputHeight*0.3);this.jq(e).css("max-height",this.outputHeight);this.jq(e).css("height",this.outputHeight)},processCommand_clear:function(k){this.clearOutput();this.clearInput()},processInput:function(o){o=o.trim();if(o==""){return}var m=this.jq(f);var l=this.jq(e);var k=o.split(";");for(var n=0;n<k.length;n++){o=k[n];if(o=="!!"){if(this.history.length==0){this.writeError("No commands in history");return}o=this.history[this.history.length-1]}var q=o.split(" ");var p=q[0].trim();if(this["processCommand_"+p]){this["processCommand_"+p](o,q);this.addHistory(o);this.clearInput()}else{this.processCommand_help(o,q,"Unknown command: <i>"+o+"</i>");return}}}})}var CHARTS_CATEGORY="Charts";var DISPLAY_LINECHART="linechart";var DISPLAY_AREACHART="areachart";var DISPLAY_BARCHART="barchart";var DISPLAY_BARTABLE="bartable";var DISPLAY_BARSTACK="barstack";var DISPLAY_PIECHART="piechart";var DISPLAY_SANKEY="sankey";var DISPLAY_CALENDAR="calendar";var DISPLAY_SCATTERPLOT="scatterplot";var DISPLAY_HISTOGRAM="histogram";var DISPLAY_BUBBLE="bubble";var DISPLAY_GAUGE="gauge";var DISPLAY_STATS="stats";var DISPLAY_TABLE="table";var DISPLAY_TEXT="text";var DISPLAY_CROSSTAB="crosstab";var DISPLAY_CORRELATION="correlation";var DISPLAY_HEATMAP="heatmap";var googleChartsLoaded=false;function googleChartsHaveLoaded(){googleChartsLoaded=true}google.charts.setOnLoadCallback(googleChartsHaveLoaded);function haveGoogleChartsLoaded(){if(!googleChartsLoaded){if(typeof google.visualization!=="undefined"){if(typeof google.visualization.Gauge!=="undefined"){googleChartsLoaded=true}}}return googleChartsLoaded}addGlobalDisplayType({type:DISPLAY_LINECHART,label:"Line Chart",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_BARCHART,label:"Bar Chart",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_BARSTACK,label:"Stacked Bar Chart",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_AREACHART,label:"Area Chart",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_BARTABLE,label:"Bar Table",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_SCATTERPLOT,label:"Scatter Plot",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_HISTOGRAM,label:"Histogram",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_BUBBLE,label:"Bubble Chart",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_GAUGE,label:"Gauge",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_PIECHART,label:"Pie Chart",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_SANKEY,label:"Sankey Chart",requiresData:true,forUser:true,category:CHARTS_CATEGORY});addGlobalDisplayType({type:DISPLAY_CALENDAR,label:"Calendar Chart",requiresData:true,forUser:true,category:"Misc"});addGlobalDisplayType({type:DISPLAY_STATS,label:"Stats Table",requiresData:false,forUser:true,category:"Misc"});addGlobalDisplayType({type:DISPLAY_TABLE,label:"Table",requiresData:true,forUser:true,category:"Misc"});addGlobalDisplayType({type:DISPLAY_TEXT,label:"Text Readout",requiresData:false,forUser:true,category:"Misc"});addGlobalDisplayType({type:DISPLAY_CORRELATION,label:"Correlation",requiresData:true,forUser:true,category:"Misc"});addGlobalDisplayType({type:DISPLAY_HEATMAP,label:"Heatmap",requiresData:true,forUser:true,category:"Misc"});var PROP_CHART_MIN="chartMin";var PROP_CHART_MAX="chartMax";var PROP_CHART_TYPE="chartType";var DFLT_WIDTH="600px";var DFLT_HEIGHT="200px";function RamaddaFieldsDisplay(g,f,d,c){var e=this;this.TYPE="RamaddaFieldsDisplay";var b;RamaddaUtil.inherit(this,this.RamaddaDisplay=b=new RamaddaDisplay(g,f,d,c));RamaddaUtil.defineMembers(this,{needsData:function(){return true},initDisplay:function(){this.initUI();this.updateUI()},updateUI:function(){this.addFieldsCheckboxes()},getWikiAttributes:function(k){b.getWikiAttributes.call(this,k);if(this.lastSelectedFields){k.push("fields");var h="";for(var l=0;l<this.lastSelectedFields.length;l++){h+=this.lastSelectedFields[l].getId();h+=","}k.push(h)}},initDialog:function(){b.initDialog.call(this);this.addFieldsCheckboxes()},getDialogContents:function(k,m){var h="600";var l=HtmlUtil.div([ATTR_ID,this.getDomId(ID_FIELDS),"style","overflow-y: auto;    max-height:"+h+"px;"]," FIELDS ");k.push("Fields");m.push(l);b.getDialogContents.call(this,k,m)},handleEventFieldsSelected:function(k,h){this.userHasSelectedAField=true;this.overrideFields=null;this.removeProperty(PROP_FIELDS);this.setSelectedFields(h);this.fieldSelectionChanged()},getFieldsToSelect:function(h){return h.getRecordFields()},canDoMultiFields:function(){return true}})}function RamaddaMultiChart(displayManager,id,properties){var ID_CHART="chart";var ID_TRENDS_CBX="trends_cbx";var ID_PERCENT_CBX="percent_cbx";var ID_COLORS="colors";var _this=this;_this.redisplayPending=false;_this.redisplayPendingCnt=0;$(window).resize(function(){var theDisplay=_this.getThis();if(!theDisplay.getDisplayReady()){return}if(theDisplay.redisplayPending){theDisplay.redisplayPendingCnt++;return}var timeoutFunc=function(myCnt){if(myCnt==theDisplay.redisplayPendingCnt){theDisplay.redisplayPending=false;theDisplay.redisplayPendingCnt=0;theDisplay.displayData()}else{setTimeout(timeoutFunc.bind(null,theDisplay.redisplayPendingCnt),1000)}};theDisplay.redisplayPending=true;setTimeout(timeoutFunc.bind(null,theDisplay.redisplayPendingCnt),1000)});$.extend(this,{indexField:-1,colorList:["blue","red","green","orange","fuchsia","teal","navy","silver"],curveType:"none",fontSize:0,vAxisMinValue:NaN,vAxisMaxValue:NaN,showTrendlines:false,showPercent:false,percentFields:null});if(properties.colors){this.colorList=(""+properties.colors).split(",")}var SUPER;RamaddaUtil.inherit(this,SUPER=new RamaddaFieldsDisplay(displayManager,id,properties.chartType,properties));RamaddaUtil.defineMembers(this,{getType:function(){return this.getProperty(PROP_CHART_TYPE,DISPLAY_LINECHART)},initDisplay:function(){this.initUI();this.updateUI()},clearCachedData:function(){SUPER.clearCachedData();this.computedData=null},updateUI:function(){SUPER.updateUI.call(this);if(!this.getDisplayReady()){return}this.displayData()},getWikiAttributes:function(attrs){this.defineWikiAttributes(["vAxisMinValue","vAxisMaxValue"]);SUPER.getWikiAttributes.call(this,attrs);if(this.colorList.join(",")!="blue,red,green"){attrs.push("colors");attrs.push(this.colorList.join(", "))}},initDialog:function(){SUPER.initDialog.call(this);var _this=this;var updateFunc=function(){_this.vAxisMinValue=Utils.toFloat(_this.jq("vaxismin").val());_this.vAxisMaxValue=Utils.toFloat(_this.jq("vaxismax").val());_this.minDate=_this.jq("mindate").val();_this.maxDate=_this.jq("maxdate").val();_this.displayData()};this.jq("vaxismin").blur(updateFunc);this.jq("vaxismax").blur(updateFunc);this.jq("mindate").blur(updateFunc);this.jq("maxdate").blur(updateFunc);this.jq(ID_COLORS).keypress(function(e){if(e.which!=13){return}var v=_this.jq(ID_COLORS).val();_this.colorList=v.split(",");_this.displayData();var pointData=_this.dataCollection.getList();_this.getDisplayManager().handleEventPointDataLoaded(_this,_this.lastPointData)});this.jq(ID_TRENDS_CBX).click(function(){_this.showTrendLines=_this.jq(ID_TRENDS_CBX).is(":checked");_this.displayData()});this.jq(ID_PERCENT_CBX).click(function(){_this.showPercent=_this.jq(ID_PERCENT_CBX).is(":checked");_this.displayData()})},setColor:function(){var v=prompt("Enter comma separated list of colors to use",this.colorList.join(","));if(v!=null){this.colorList=v.split(",");this.displayData();var pointData=this.dataCollection.getList();this.getDisplayManager().handleEventPointDataLoaded(this,this.lastPointData)}},getMenuItems:function(menuItems){SUPER.getMenuItems.call(this,menuItems);var get=this.getGet();var min="0";if(!isNaN(this.vAxisMinValue)){min=""+this.vAxisMinValue}var max="";if(!isNaN(this.vAxisMaxValue)){max=""+this.vAxisMaxValue}var tmp=HtmlUtil.formTable();tmp+=HtmlUtil.formEntry("Axis Range:",HtmlUtil.input("",min,["size","7",ATTR_ID,this.getDomId("vaxismin")])+" - "+HtmlUtil.input("",max,["size","7",ATTR_ID,this.getDomId("vaxismax")]));tmp+=HtmlUtil.formEntry("Date Range:",HtmlUtil.input("",this.minDate,["size","10",ATTR_ID,this.getDomId("mindate")])+" - "+HtmlUtil.input("",this.maxDate,["size","10",ATTR_ID,this.getDomId("maxdate")]));tmp+=HtmlUtil.formEntry("Colors:",HtmlUtil.input("",this.colorList.join(","),["size","35",ATTR_ID,this.getDomId(ID_COLORS)]));tmp+="</table>";menuItems.push(tmp)},getChartType:function(){return this.getProperty(PROP_CHART_TYPE,DISPLAY_LINECHART)},defaultSelectedToAll:function(){if(this.chartType==DISPLAY_TABLE||this.chartType==DISPLAY_SANKEY){return true}return SUPER.defaultSelectedToAll.call(this)},askMinZAxis:function(){this.setMinZAxis(prompt("Minimum axis value","0"))},setMinZAxis:function(v){if(v!=null){this.vAxisMinValue=parseFloat(v);this.displayData()}},askMaxZAxis:function(){this.setMaxZAxis(prompt("Maximum axis value","100"))},setMaxZAxis:function(v){if(v!=null){this.vAxisMaxValue=parseFloat(v);this.displayData()}},askMinDate:function(){var ex=this.minDate;if(ex==null||ex==""){ex="1800-01-01"}var v=prompt("Minimum date",ex);if(v==null){return}this.setMinDate(v)},setMinDate:function(v){this.minDate=v;this.displayData()},askMaxDate:function(){var ex=this.maxDate;if(ex==null||ex==""){ex="2100-01-01"}var v=prompt("Maximum date",ex);if(v==null){return}this.setMaxDate(v)},setMaxDate:function(v){this.maxDate=v;this.displayData()},trendLineEnabled:function(){var chartType=this.getProperty(PROP_CHART_TYPE,DISPLAY_LINECHART);if(chartType==DISPLAY_LINECHART||chartType==DISPLAY_AREACHART||chartType==DISPLAY_BARCHART){return true}return false},getDialogContents:function(tabTitles,tabContents){var height="600";var html=HtmlUtil.div([ATTR_ID,this.getDomId(ID_FIELDS),"style","overflow-y: auto;    max-height:"+height+"px;"]," FIELDS ");if(this.trendLineEnabled()){html+=HtmlUtil.div([ATTR_CLASS,"display-dialog-subheader"],"Other");html+=HtmlUtil.checkbox(this.getDomId(ID_TRENDS_CBX),[],this.showTrendLines)+"  Show trend line";html+=" ";html+=HtmlUtil.checkbox(this.getDomId(ID_PERCENT_CBX),[],this.showPercent)+"  Show percent of displayed total<br>";html+="<br>"}tabTitles.push("Fields");tabContents.push(html);SUPER.RamaddaDisplay.getDialogContents.call(this,tabTitles,tabContents)},handleEventMapClick:function(source,args){var pointData=this.dataCollection.getList();for(var i=0;i<pointData.length;i++){pointData[i].handleEventMapClick(this,source,args.lon,args.lat)}},okToHandleEventRecordSelection:function(){return true},handleEventRecordSelection:function(source,args){if(source==this){return}if(!this.okToHandleEventRecordSelection()){return}var data=this.dataCollection.getList()[0];if(data!=args.data){return}this.setChartSelection(args.index)},getFieldsToSelect:function(pointData){var chartType=this.getProperty(PROP_CHART_TYPE,DISPLAY_LINECHART);if(this.chartType==DISPLAY_TABLE||this.chartType==DISPLAY_BARTABLE||this.chartType==DISPLAY_BUBBLE||this.chartType==DISPLAY_SANKEY){return pointData.getNonGeoFields()}return pointData.getChartableFields()},canDoGroupBy:function(){return this.chartType==DISPLAY_PIECHART||this.chartType==DISPLAY_TABLE},xcnt:0,displayData:function(){var _this=this;if(!this.getDisplayReady()){return}if(this.inError){return}if(!haveGoogleChartsLoaded()){var func=function(){_this.displayData()};this.setContents(this.getLoadingMessage());setTimeout(func,1000);return}if(this.inError){return}if(!this.hasData()){this.clearChart();this.setContents(this.getLoadingMessage());return}this.setContents(HtmlUtil.div([ATTR_CLASS,"display-message"],"Building display..."));this.allFields=this.dataCollection.getList()[0].getRecordFields();var chartType=this.getProperty(PROP_CHART_TYPE,DISPLAY_LINECHART);var selectedFields=this.getSelectedFields([]);if(selectedFields.length==0&&this.lastSelectedFields!=null){selectedFields=this.lastSelectedFields}if(selectedFields==null||selectedFields.length==0){if(this.chartType==DISPLAY_TABLE){selectedFields=this.dataCollection.getList()[0].getNonGeoFields()}else{selectedFields=this.getSelectedFields()}}if(selectedFields.length==0){this.setContents("No fields selected");return}var tmpFields=[];for(var i=0;i<selectedFields.length;i++){if(!this.shouldSkipField(selectedFields[i])){tmpFields.push(selectedFields[i])}}selectedFields=tmpFields;this.lastSelectedFields=selectedFields;var props={includeIndex:true};if(this.chartType==DISPLAY_TABLE||this.chartType==DISPLAY_BARTABLE||chartType==DISPLAY_PIECHART||chartType==DISPLAY_SCATTERPLOT||chartType==DISPLAY_HISTOGRAM||chartType==DISPLAY_BUBBLE||chartType==DISPLAY_GAUGE||chartType==DISPLAY_SANKEY){props.includeIndex=false}props.groupByIndex=-1;if(chartType==DISPLAY_PIECHART){if(!this.groupBy&&this.groupBy!=""){for(var i=0;i<this.allFields.length;i++){var field=this.allFields[i];if(field.getType()=="string"){this.groupBy=field.getId();break}}}}if(this.groupBy){for(var i=0;i<this.allFields.length;i++){var field=this.allFields[i];if(field.getId()==this.groupBy){props.groupByIndex=field.getIndex();props.groupByField=field;this.groupByField=field;break}}}var fieldsToSelect=selectedFields;if(this.raw){fieldsToSelect=this.dataCollection.getList()[0].getRecordFields();props.raw=true}if(chartType==DISPLAY_BARTABLE){props.includeIndexIfDate=true}var dataHasIndex=props.includeIndex;var dataList=this.computedData;if(this["function"]&&this.computedData==null){var pointData=this.dataCollection.getList()[0];var allFields=pointData.getRecordFields();var records=pointData.getRecords();var indexField=this.indexField;var chartableFields=this.getFieldsToSelect(pointData);this.hasDate=this.getHasDate(records);var date_formatter=this.getDateFormatter();var setVars="";for(var i=0;i<chartableFields.length;i++){var field=chartableFields[i];setVars+="\tvar "+field.getId()+"=args."+field.getId()+";\n"}var code="function displayChartEval(args) {\n"+setVars+"\treturn  "+this["function"]+"\n}";eval(code);var newList=[];var fieldNames=null;var rowCnt=-1;var indexField=this.indexField;for(var rowIdx=0;rowIdx<records.length;rowIdx++){var record=records[rowIdx];var row=record.getData();var date=record.getDate();if(!this.dateInRange(date)){continue}rowCnt++;var values=[];var indexName=null;if(indexField>=0){var field=allFields[indexField];values.push(record.getValue(indexField)+offset);indexName=field.getLabel()}else{if(this.hasDate){values.push(this.getDateValue(date,date_formatter));indexName="Date"}else{values.push(rowIdx);indexName="Index"}}if(fieldNames==null){fieldNames=[indexName,this.functionName?this.functionName:"value"];newList.push(fieldNames)}var args={};for(var j=0;j<chartableFields.length;j++){var field=chartableFields[j];var value=row[field.getIndex()];args[field.getId()]=value}var value=displayChartEval(args);values.push(value);newList.push(values)}dataList=newList}if(dataList==null){dataList=this.getStandardData(fieldsToSelect,props)}this.computedData=dataList;if(this.rotateTable&&dataList.length){var header=dataList[0];var flipped=[];for(var rowIdx=1;rowIdx<dataList.length;rowIdx++){var row=dataList[rowIdx]}}if(dataList.length==0&&!this.userHasSelectedAField){var pointData=this.dataCollection.getList()[0];var chartableFields=this.getFieldsToSelect(pointData);for(var i=0;i<chartableFields.length;i++){var field=chartableFields[i];dataList=this.getStandardData([field],props);if(dataList.length>0){this.setSelectedFields([field]);break}}}if(dataList.length==0){this.setContents(HtmlUtil.div([ATTR_CLASS,"display-message"],"No data available"));return}if(this.showPercent){var newList=[];var isNumber=[];var isOk=[];var headerRow=null;var fields=null;if(this.percentFields!=null){fields=this.percentFields.split(",")}for(var i=0;i<dataList.length;i++){var row=dataList[i];if(i==0){headerRow=row;continue}if(i==1){var seenIndex=false;for(var j=0;j<row.length;j++){var valueIsNumber=(typeof row[j]=="number");var valueIsDate=(typeof row[j]=="object");if(valueIsNumber){if(dataHasIndex&&!seenIndex){valueIsNumber=false;seenIndex=true}}if(valueIsDate){seenIndex=true}if(valueIsNumber&&fields!=null){valueIsNumber=fields.indexOf(fieldsToSelect[j].getId())>=0||fields.indexOf("#"+(j+1))>=0}isNumber.push(valueIsNumber)}var newHeader=[];for(var j=0;j<headerRow.length;j++){var v=headerRow[j];if(!isNumber[j]){newHeader.push(v)}else{newHeader.push("% "+v)}}newList.push(newHeader)}var total=0;var cnt=0;for(var j=0;j<row.length;j++){if(isNumber[j]){total+=parseFloat(row[j]);cnt++}}var newRow=[];for(var j=0;j<row.length;j++){if(isNumber[j]){if(total!=0){var v=parseFloat(((row[j]/total)*100).toFixed(1));newRow.push(v)}else{newRow.push(NaN)}}else{newRow.push(row[j])}}newList.push(newRow)}dataList=newList}this.makeChart(chartType,dataList,props,selectedFields);var d=_this.jq(ID_CHART);this.lastWidth=d.width();if(d.width()==0){}},checkLayout:function(){var _this=this;var d=_this.jq(ID_CHART);if(this.lastWidth!=d.width()){_this.displayData()}if(true){return}if(d.width()==0){var cb=function(){_this.checkWidth(cnt+1)};setTimeout(cb,5000)}else{_this.displayData()}},printDataList:function(dataList){console.log("data list:"+dataList.length);for(var i=0;i<dataList.length;i++){var row=dataList[i];var s="";for(var j=0;j<row.length;j++){if(j>0){s+=", "}s+=row[j]}console.log("row: "+i+"  "+s)}},clearChart:function(){if(this.chart!=null){this.chart.clearChart()}},setChartSelection:function(index){if(this.chart!=null){if(this.chart.setSelection){this.chart.setSelection([{row:index,column:null}])}}},tableHeaderMouseover:function(i,tooltip){},makeDataTable:function(chartType,dataList,props,selectedFields){dataList=this.filterData(dataList,selectedFields);if(dataList.length==1||this.chartType==DISPLAY_TABLE||this.chartType==DISPLAY_SANKEY){return google.visualization.arrayToDataTable(dataList)}if(this.chartType==DISPLAY_GAUGE){return this.makeGaugeDataTable(dataList)}if(this.chartType==DISPLAY_HISTOGRAM){return google.visualization.arrayToDataTable(dataList)}if(this.chartType==DISPLAY_BUBBLE){return google.visualization.arrayToDataTable(dataList)}if(this.chartType==DISPLAY_CALENDAR){var dataTable=new google.visualization.DataTable();var header=dataList[0];dataTable.addColumn({type:"date",id:"Date"});dataTable.addColumn({type:"number",id:header[1]});dataTable.addColumn({type:"string",role:"tooltip",p:{html:true}});var haveMissing=false;var missing=this.getProperty("missingValue",null);if(missing){haveMissing=true;missing=parseFloat(missing)}var list=[];var cnt=0;var options={weekday:"long",year:"numeric",month:"long",day:"numeric"};for(var i=1;i<dataList.length;i++){var value=dataList[i][1];if(value==NaN){continue}if(haveMissing&&value==missing){continue}cnt++;var dttm=this.formatDate(dataList[i][0],{options:options});dttm=dttm.replace(/ /g,"&nbsp;");var tooltip="<center><b>"+dttm+"</b></center><b>"+header[1].replace(/ /g,"&nbsp;")+"</b>:&nbsp;"+this.formatNumber(value);tooltip=HtmlUtil.tag("div",["style","padding:5px;"],tooltip);list.push([dataList[i][0],value,tooltip])}dataTable.addRows(list);return dataTable}if(this.chartType==DISPLAY_PIECHART){var dataTable=new google.visualization.DataTable();var list=[];var groupBy=this.groupByField;var data=selectedFields[0];var header=dataList[0];dataTable.addColumn("string",header[0]);dataTable.addColumn("number",header[1]);if(this.getProperty("bins",null)){var bins=parseInt(this.getProperty("bins",null));var min=Number.MAX_VALUE;var max=Number.MIN_VALUE;var haveMin=false;var haveMax=false;if(this.getProperty("binMin")){min=parseFloat(this.getProperty("binMin"));haveMin=true}if(this.getProperty("binMax")){max=parseFloat(this.getProperty("binMax"));haveMax=true}var goodRows=[];for(var i=1;i<dataList.length;i++){var value=dataList[i][1];if(value==Number.POSITIVE_INFINITY||isNaN(value)||!Utils.isNumber(value)||!Utils.isDefined(value)||value==null){continue}if(!haveMin){min=Math.min(value,min)}if(!haveMax){max=Math.max(value,max)}goodRows.push(dataList[i])}var binList=[];var step=(max-min)/bins;for(var binIdx=0;binIdx<bins;binIdx++){binList.push({min:min+binIdx*step,max:min+(binIdx+1)*step,values:[]})}for(var rowIdx=1;rowIdx<goodRows.length;rowIdx++){var value=goodRows[rowIdx][1];var ok=false;for(var binIdx=0;binIdx<bins;binIdx++){if(value<binList[binIdx].min||(value>=binList[binIdx].min&&value<=binList[binIdx].max)){binList[binIdx].values.push(value);ok=true;break}}if(!ok){binList[binList.length-1].values.push(value)}}for(var binIdx=0;binIdx<bins;binIdx++){var bin=binList[binIdx];list.push(["Bin:"+this.formatNumber(bin.min)+"-"+this.formatNumber(bin.max),bin.values.length])}}else{for(var i=1;i<dataList.length;i++){list.push([dataList[i][0],dataList[i][1]])}}dataTable.addRows(list);return dataTable}var dataTable=new google.visualization.DataTable();var header=dataList[0];var sample=dataList[1];for(var j=0;j<header.length;j++){var value=sample[j];if(j==0&&props.includeIndex){if((typeof value)=="object"){dataTable.addColumn("date",header[j])}else{dataTable.addColumn((typeof value),header[j])}}else{dataTable.addColumn("number",header[j]);dataTable.addColumn({type:"string",role:"tooltip",p:{html:true}})}}var justData=[];var begin=props.includeIndex?1:0;for(var i=1;i<dataList.length;i++){var row=dataList[i];row=row.slice(0);var tooltip="<div style='padding:8px;'>";for(var j=0;j<row.length;j++){if(j>0){tooltip+="<br>"}label=header[j].replace(/ /g,"&nbsp;");value=row[j];if(!value){value="NA"}if(value&&(typeof value)=="object"){if(value.f){value=value.f}}if(Utils.isNumber(value)){value=this.formatNumber(value)}value=""+value;value=value.replace(/ /g,"&nbsp;");tooltip+="<b>"+label+"</b>:&nbsp;"+value}tooltip+="</div>";newRow=[];for(var j=0;j<row.length;j++){var value=row[j];newRow.push(value);if(j==0&&props.includeIndex){}else{newRow.push(tooltip)}}justData.push(newRow)}dataTable.addRows(justData);return dataTable},makeGoogleChart:function(chartType,dataList,props,selectedFields){if(typeof google=="undefined"){this.setContents("No google");return}if(chartType==DISPLAY_TABLE&&dataList.length>0){var header=dataList[0]}var dataTable=this.makeDataTable(chartType,dataList,props,selectedFields);var chartOptions={tooltip:{isHtml:true}};$.extend(chartOptions,{lineWidth:1,colors:this.colorList,curveType:this.curveType,vAxis:{}});if(this.lineWidth){chartOptions.lineWidth=this.lineWidth}if(this.fontSize>0){chartOptions.fontSize=this.fontSize}var defaultRange=this.getDisplayManager().getRange(selectedFields[0]);var range=[NaN,NaN];if(!isNaN(this.vAxisMinValue)){range[0]=parseFloat(this.vAxisMinValue)}else{if(defaultRange!=null){range[0]=defaultRange[0]}}if(!isNaN(this.vAxisMaxValue)){range[1]=parseFloat(this.vAxisMaxValue)}else{if(defaultRange!=null){range[1]=defaultRange[1]}}if(!isNaN(range[0])){chartOptions.vAxis.minValue=range[0]}if(!isNaN(range[1])){chartOptions.vAxis.maxValue=range[1]}var width="90%";var left="10%";useMultipleAxes=this.getProperty("useMultipleAxes",true);if((selectedFields.length>1&&useMultipleAxes)||this.getProperty("padRight",false)===true){width="80%"}var chartId=this.getDomId(ID_CHART);var divAttrs=[ATTR_ID,chartId];if(chartType==DISPLAY_PIECHART){divAttrs.push("style");var style="";if(this.chartWidth){style+="width:"+this.chartWidth+";"}else{style+="width:100%;"}if(this.chartHeight){style+="height:"+this.chartHeight+";"}else{style+="height:100%;"}divAttrs.push(style)}else{}divAttrs.push("style");divAttrs.push("height:100%;");this.setContents(HtmlUtil.div(divAttrs,""));if(chartType==DISPLAY_SANKEY){chartOptions.height=parseInt(this.getProperty("chartHeight",this.getProperty("height","400")));chartOptions.sankey={node:{colors:this.colors,width:5},link:{colorMode:"source",colors:this.colors,color:{}}}}if(chartType==DISPLAY_LINECHART||chartType==DISPLAY_AREACHART||chartType==DISPLAY_BARCHART||chartType==DISPLAY_BARSTACK){chartOptions.height=this.getProperty("chartHeight",this.getProperty("height","150"));$.extend(chartOptions,{legend:{position:"bottom"},chartArea:{left:left,top:10,height:"70%",width:width}});if(useMultipleAxes){$.extend(chartOptions,{series:[{targetAxisIndex:0},{targetAxisIndex:1}]})}if(this.showTrendLines){chartOptions.trendlines={0:{type:"linear",color:"green"}}}if(this.hAxis){if(chartOptions.hAxis){chartOptions.hAxis.title=this.hAxis}else{chartOptions.hAxis={title:this.hAxis}}}if(this.vAxis){if(chartOptions.vAxis){chartOptions.vAxis.title=this.vAxis}else{chartOptions.vAxis={title:this.vAxis}}}if(Utils.isDefined(this.chartHeight)){chartOptions.height=this.chartHeight}}if(chartType==DISPLAY_BARTABLE){var height="";if(Utils.isDefined(this.chartHeight)){height=this.chartHeight}else{if(dataList.length>1){var numBars=dataList.length;if(this.isStacked){height=numBars*22}else{height=numBars*22+numBars*14*(dataList[0].length-2)}}}$.extend(chartOptions,{title:"the title",bars:"horizontal",colors:this.colorList,width:(Utils.isDefined(this.chartWidth)?this.chartWidth:"100%"),chartArea:{left:"30%",top:0,width:"70%",height:"80%"},height:height,bars:"horizontal",tooltip:{showColorCode:true},legend:{position:"none"}});if(Utils.isDefined(this.isStacked)){chartOptions.isStacked=this.isStacked}if(this.hAxis){chartOptions.hAxis={title:this.hAxis}}if(this.vAxis){chartOptions.vAxis={title:this.vAxis}}this.chart=new google.charts.Bar(document.getElementById(chartId))}else{if(chartType==DISPLAY_BARCHART||chartType==DISPLAY_BARSTACK){if(chartType==DISPLAY_BARSTACK){chartOptions.isStacked=true}chartOptions.orientation="horizontal";this.chart=new google.visualization.BarChart(document.getElementById(chartId))}else{if(chartType==DISPLAY_SANKEY){this.chart=new google.visualization.Sankey(document.getElementById(chartId))}else{if(chartType==DISPLAY_SCATTERPLOT){var height=400;if(Utils.isDefined(this.chartHeight)){height=this.chartHeight}var width="100%";if(Utils.isDefined(this.chartWidth)){width=this.chartWidth}$("#"+chartId).css("width",width);$("#"+chartId).css("height",height);chartOptions={title:"",tooltip:{isHtml:true},legend:"none",chartArea:{left:"10%",top:10,height:"80%",width:"90%"}};if(this.getShowTitle()){chartOptions.title=this.getTitle(true)}if(dataList.length>0&&dataList[0].length>1){chartOptions.hAxis={title:dataList[0][0]};chartOptions.vAxis={title:dataList[0][1]};if(!isNaN(this.vAxisMinValue)){chartOptions.hAxis.minValue=this.vAxisMinValue;chartOptions.vAxis.minValue=this.vAxisMinValue}if(!isNaN(this.vAxisMaxValue)){chartOptions.hAxis.maxValue=this.vAxisMaxValue;chartOptions.vAxis.maxValue=this.vAxisMaxValue}}this.chart=new google.visualization.ScatterChart(document.getElementById(chartId))}else{if(chartType==DISPLAY_HISTOGRAM){if(this.legendPosition){chartOptions.legend={};chartOptions.legend.position=this.legendPosition}var isStacked=this.getProperty("isStacked",null);if(isStacked){chartOptions.isStacked=isStacked=="true"?true:isStacked=="false"?false:isStacked}chartOptions.vAxis={};chartOptions.vAxis.viewWindow={};if(Utils.isDefined(this.logScale)){chartOptions.vAxis.logScale=(""+this.logScale)==true}if(this.textPosition){chartOptions.vAxis.textPosition=this.textPosition}if(Utils.isDefined(this.minValue)){chartOptions.vAxis.viewWindow.min=parseFloat(this.minValue)}if(Utils.isDefined(this.maxValue)){chartOptions.vAxis.viewWindow.max=parseFloat(this.maxValue)}if(!isNaN(this.vAxisMaxValue)){chartOptions.vAxis.maxValue=parseFloat(this.vAxisMaxValue)}if(!isNaN(this.vAxisMinValue)){chartOptions.vAxis.minValue=parseFloat(this.vAxisMinValue)}this.chart=new google.visualization.Histogram(document.getElementById(chartId))}else{if(chartType==DISPLAY_GAUGE){this.dataList=dataList;this.chartOptions=chartOptions;var min=Number.MAX_VALUE;var max=Number.MIN_VALUE;var setMinMax=true;for(var row=1;row<dataList.length;row++){var tuple=dataList[row];for(var col=0;col<tuple.length;col++){if(!Utils.isNumber(tuple[col])){continue}var value=tuple[col];min=Math.min(min,value);max=Math.max(max,value)}}min=Utils.formatNumber(min,true);max=Utils.formatNumber(max,true);if(Utils.isDefined(this.gaugeMin)){setMinMax=true;min=parseFloat(this.gaugeMin)}if(Utils.isDefined(this.gaugeMax)){setMinMax=true;max=parseFloat(this.gaugeMax)}if(setMinMax){chartOptions.min=min;chartOptions.max=max}this.chart=new google.visualization.Gauge(document.getElementById(chartId))}else{if(chartType==DISPLAY_BUBBLE){var ct=this.getColorTable();if(ct){chartOptions.colors=ct}else{if(!this.colors){chartOptions.colors=this.colorList}}if(chartOptions.colors){chartOptions.colors=Utils.getColorTable("rainbow")}chartOptions.chartArea={left:100,top:10,width:"98%",height:"90%"};chartOptions.colorAxis={legend:{position:"in"}};chartOptions.bubble={textStyle:{auraColor:"none"},stroke:"#666"};chartOptions.hAxis={};chartOptions.vAxis={};header=dataList[0];chartOptions.hAxis.format=this.getProperty("hAxisFormat",null);chartOptions.vAxis.format=this.getProperty("vAxisFormat",null);chartOptions.hAxis.title=this.getProperty("hAxisTitle",header.length>1?header[1]:null);chartOptions.vAxis.title=this.getProperty("vAxisTitle",header.length>2?header[2]:null);this.chart=new google.visualization.BubbleChart(document.getElementById(chartId))}else{if(chartType==DISPLAY_CALENDAR){chartOptions.calendar={cellSize:parseInt(this.getProperty("cellSize",15))};if(this.jq(ID_CHART).width()==0){return}this.chart=new google.visualization.Calendar(document.getElementById(chartId))}else{if(chartType==DISPLAY_PIECHART){chartOptions.tooltip={textStyle:{color:"#000000"},showColorCode:true};if(this.getProperty("bins",null)){chartOptions.title="Bins: "+dataList[0][1]}else{chartOptions.title=dataList[0][0]+" - "+dataList[0][1]}if(this.is3D){chartOptions.is3D=true}if(this.pieHole){chartOptions.pieHole=this.pieHole}if(this.sliceVisibilityThreshold){chartOptions.sliceVisibilityThreshold=this.sliceVisibilityThreshold}this.chart=new google.visualization.PieChart(document.getElementById(chartId))}else{if(chartType==DISPLAY_TABLE){chartOptions.height=null;if(this.chartHeight){chartOptions.height=this.chartHeight}if(chartOptions.height==null){var height=this.getProperty("height",null);if(height){chartOptions.height=height}}if(chartOptions.height==null){chartOptions.height="300px"}chartOptions.allowHtml=true;if(dataList.length&&dataList[0].length>4){chartOptions.cssClassNames={headerCell:"display-table-header-max"}}else{chartOptions.cssClassNames={headerCell:"display-table-header"}}this.chart=new google.visualization.Table(document.getElementById(chartId))}else{if(chartType==DISPLAY_AREACHART){if(this.isStacked){chartOptions.isStacked=true}this.chart=new google.visualization.AreaChart(document.getElementById(chartId))}else{this.chart=new google.visualization.LineChart(document.getElementById(chartId))}}}}}}}}}}}if(this.chart!=null){if(!Utils.isDefined(chartOptions.height)){chartOptions.height="100%"}this.chart.draw(dataTable,chartOptions);var theDisplay=this;google.visualization.events.addListener(this.chart,"onmouseover",function(event){mapVar=theDisplay.getProperty("mapVar",null);if(!Utils.stringDefined(mapVar)){return}row=event.row;pointData=theDisplay.dataCollection.getList()[0];var fields=pointData.getRecordFields();var records=pointData.getRecords();var record=records[row];map=ramaddaMapMap[mapVar];if(map){if(theDisplay.mouseOverPoint){map.removePoint(theDisplay.mouseOverPoint)}}else{}if(record&&map){latField=null;lonField=null;for(i=0;i<fields.length;i++){if(fields[i].isFieldLatitude()){latField=fields[i]}else{if(fields[i].isFieldLongitude()){lonField=fields[i]}}}if(latField&&lonField){lat=record.getValue(latField.getIndex());lon=record.getValue(lonField.getIndex());theDisplay.mouseOverPoint=map.addPoint(chartId,new OpenLayers.LonLat(lon,lat))}}});google.visualization.events.addListener(this.chart,"select",function(event){if(theDisplay.chart.getSelection){var selected=theDisplay.chart.getSelection();if(selected&&selected.length>0){var index=selected[0].row;theDisplay.displayManager.propagateEventRecordSelection(theDisplay,theDisplay.dataCollection.getList()[0],{index:index})}}})}}});this.makeChart=this.makeGoogleChart}function LinechartDisplay(d,c,b){b=$.extend({chartType:DISPLAY_LINECHART},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function AreachartDisplay(d,c,b){b=$.extend({chartType:DISPLAY_AREACHART},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function BarchartDisplay(d,c,b){b=$.extend({chartType:DISPLAY_BARCHART},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function BarstackDisplay(d,c,b){b=$.extend({chartType:DISPLAY_BARSTACK,isStacked:true},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function PiechartDisplay(d,c,b){b=$.extend({chartType:DISPLAY_PIECHART},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function SankeyDisplay(d,c,b){b=$.extend({chartType:DISPLAY_SANKEY},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function CalendarDisplay(d,c,b){b=$.extend({chartType:DISPLAY_CALENDAR},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this);RamaddaUtil.inherit(this,{xgetDimensionsStyle:function(){var e=this.getProperty("height",200);if(e>0){return" height:"+e+"px;  max-height:"+e+"px; overflow-y: auto;"}return""},canDoMultiFields:function(){return false}})}function TableDisplay(d,c,b){b=$.extend({chartType:DISPLAY_TABLE},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function HistogramDisplay(d,c,b){b=$.extend({chartType:DISPLAY_HISTOGRAM},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this);RamaddaUtil.inherit(this,{okToHandleEventRecordSelection:function(){return false}})}function GaugeDisplay(d,c,b){b=$.extend({chartType:DISPLAY_GAUGE},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this);RamaddaUtil.inherit(this,{makeGaugeDataTable:function(g){if(!Utils.isDefined(this.index)){this.index=g.length-1}var e=this.index+1;var m=[];m.push(["Label","Value"]);var o=g[0];if(e>=g.length){e=g.length-1}var n=g[e];for(var f=0;f<n.length;f++){if(!Utils.isNumber(n[f])){continue}var k=o[f];if(k.length>20){var e=k.indexOf("(");if(e>0){k=k.substring(0,e)}}if(k.length>20){k=k.substring(0,19)+"..."}if(this.gaugeLabel){k=this.gaugeLabel}else{if(this["gaugeLabel"+(f+1)]){k=this["gaugeLabel"+(f+1)]}}var l=n[f];m.push([k,Utils.formatNumber(l,true)])}return google.visualization.arrayToDataTable(m)},setChartSelection:function(e){if(this.chart){this.index=e;var f=this.makeGaugeDataTable(this.dataList);this.chart.draw(f,this.chartOptions)}}})}function BubbleDisplay(d,c,b){b=$.extend({chartType:DISPLAY_BUBBLE},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));addRamaddaDisplay(this)}function BartableDisplay(d,c,b){b=$.extend({chartType:DISPLAY_BARTABLE},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));$.extend(this,{getDefaultSelectedFields:function(e,k){var g=[];for(i=0;i<e.length;i++){var h=e[i];if(!h.isNumeric){g.push(h);break}}for(i=0;i<e.length;i++){var h=e[i];if(h.isNumeric){g.push(h);break}}return g}});addRamaddaDisplay(this)}function ScatterplotDisplay(d,c,b){b=$.extend({chartType:DISPLAY_SCATTERPLOT},b);RamaddaUtil.inherit(this,new RamaddaMultiChart(d,c,b));$.extend(this,{getDefaultSelectedFields:function(e,k){var g=[];for(i=0;i<e.length;i++){var h=e[i];if(h.isNumeric){g.push(h);if(g.length>=2){break}}}return g}});addRamaddaDisplay(this)}function RamaddaTextDisplay(e,d,c){var b;$.extend(this,b=new RamaddaDisplay(e,d,DISPLAY_TEXT,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{lastHtml:"<p>&nbsp;<p>&nbsp;<p>",initDisplay:function(){this.initUI();this.setContents(this.lastHtml)},handleEventRecordSelection:function(g,f){this.lastHtml=f.html;this.setContents(f.html)}})}function RamaddaStatsDisplay(g,f,c,d){var b;var e=Utils.isDefined(c.showDefault)?c.showDefault:true;$.extend(this,{showMin:e,showMax:e,showAverage:e,showStd:e,showPercentile:e,showCount:e,showTotal:e,showPercentile:e,showMissing:e,showUnique:e,showType:e,showText:e});RamaddaUtil.inherit(this,b=new RamaddaFieldsDisplay(g,f,d||DISPLAY_STATS,c));if(!d){addRamaddaDisplay(this)}RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},handleEventPointDataLoaded:function(k,h){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=k.dataCollection;this.updateUI()}}},getDefaultSelectedFields:function(h,p){if(p!=null&&p.length>0){return p}var m=this.getStandardData(null,{includeIndex:false});var q=(m.length==2);var k=[];for(i=0;i<h.length;i++){var o=h[i];if(!q&&(!this.showText&&!o.isNumeric)){continue}var n=o.getLabel().toLowerCase();if(n.indexOf("latitude")>=0||n.indexOf("longitude")>=0){continue}k.push(o)}return k},getFieldsToSelect:function(h){return h.getRecordFields()},defaultSelectedToAll:function(){return true},fieldSelectionChanged:function(){b.fieldSelectionChanged.call(this);this.updateUI()},updateUI:function(){b.updateUI.call(this);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var M=this.getStandardData(null,{includeIndex:false});var H=this.dataCollection.getList()[0].getRecordFields();this.allFields=H;var E=this.getSelectedFields([]);var o={};var P=[];var K=(M.length==2);for(var k=1;k<M.length;k++){var C=M[k];if(k==1){for(var n=0;n<C.length;n++){P.push({isNumber:false,count:0,min:Number.MAX_SAFE_INTEGER,uniqueMap:{},unique:0,std:0,max:Number.MIN_SAFE_INTEGER,total:0,numMissing:0,numNotMissing:0,type:null,values:[]})}}for(var O=0;O<E.length;O++){var h=E[O];var n=h.getIndex();P[n].type=h.getType();var y=C[n];if(y){if(!Utils.isDefined(P[n].uniqueMap[y])){P[n].uniqueMap[y]=1;P[n].unique++}else{P[n].uniqueMap[y]++}}P[n].isNumber=h.isNumeric;P[n].count++;if(y==null){P[n].numMissing++}else{P[n].numNotMissing++}if(y&&(typeof y=="number")){var s=h.getLabel().toLowerCase();if(s.indexOf("latitude")>=0||s.indexOf("longitude")>=0){continue}P[n].total+=y;P[n].max=Math.max(P[n].max,y);P[n].min=Math.min(P[n].min,y);P[n].values.push(y)}}}if(this.showUnique){for(var O=0;O<E.length;O++){var h=E[O];var n=h.getIndex();P[n].uniqueMax=0;P[n].uniqueValue="";for(var y in P[n].uniqueMap){var q=P[n].uniqueMap[y];if(q>P[n].uniqueMax){P[n].uniqueMax=q;P[n].uniqueValue=y}}}}if(this.showStd){for(var O=0;O<E.length;O++){var h=E[O];var n=h.getIndex();var l=P[n].values;if(l.length>0){var m=P[n].total/l.length;var t=0;for(var J=0;J<l.length;J++){var z=l[J]-m;t+=z*z}var L=t/l.length;P[n].std=Math.sqrt(L)}}}var G=(K?"0":"1");var x=HtmlUtil.openTag("table",["border",G,"bordercolor","#ccc","class","display-stats","cellspacing","1","cellpadding","5"]);var Q=["&nbsp;"];if(!K){header=[""];if(this.showCount){header.push("Count");Q.push("&nbsp;")}if(this.showMin){header.push("Min");Q.push("&nbsp;")}if(this.showPercentile){header.push("25%");Q.push("&nbsp;");header.push("50%");Q.push("&nbsp;");header.push("75%");Q.push("&nbsp;")}if(this.showMax){header.push("Max");Q.push("&nbsp;")}if(this.showTotal){header.push("Total");Q.push("&nbsp;")}if(this.showAverage){header.push("Average");Q.push("&nbsp;")}if(this.showStd){header.push("Std");Q.push("&nbsp;")}if(this.showUnique){header.push("# Unique");Q.push("&nbsp;");header.push("Top");Q.push("&nbsp;");header.push("Freq.");Q.push("&nbsp;")}if(this.showMissing){header.push("Not&nbsp;Missing");Q.push("&nbsp;");header.push("Missing");Q.push("&nbsp;")}if(this.showType){header.push("Type");Q.push("&nbsp;")}x+=HtmlUtil.tr(["valign","bottom"],HtmlUtil.tds(["class","display-stats-header","align","center"],header))}var w=[];var u={};for(var O=0;O<E.length;O++){var h=E[O];var n=h.getIndex();var h=H[n];var N="";var S="&nbsp;";var s=h.getLabel().toLowerCase();var D=P[n].numNotMissing==0?"NA":this.formatNumber(P[n].total/P[n].numNotMissing);if(s.indexOf("%")<0&&s.indexOf("percent")<0&&s.indexOf("median")<0){S=this.formatNumber(P[n].total)}if(K){N=HtmlUtil.tds(["xalign","right"],[this.formatNumber(P[n].min)]);continue}var l=[];if(!P[n].isNumber&&this.showText){if(this.showCount){l.push(P[n].count)}if(this.showMin){l.push("-")}if(this.showPercentile){l.push("-");l.push("-");l.push("-")}if(this.showMax){l.push("-")}l.push("-");if(this.showAverage){l.push("-")}if(this.showStd){l.push("-")}if(this.showUnique){l.push(P[n].unique);l.push(P[n].uniqueValue);l.push(P[n].uniqueMax)}if(this.showMissing){l.push(P[n].numNotMissing);l.push(P[n].numMissing)}}else{if(this.showCount){l.push(P[n].count)}if(this.showMin){l.push(this.formatNumber(P[n].min))}if(this.showPercentile){var B=P[n].max-P[n].min;l.push(this.formatNumber(P[n].min+B*0.25));l.push(this.formatNumber(P[n].min+B*0.5));l.push(this.formatNumber(P[n].min+B*0.75))}if(this.showMax){l.push(this.formatNumber(P[n].max))}if(this.showTotal){l.push(S)}if(this.showAverage){l.push(D)}if(this.showStd){l.push(this.formatNumber(P[n].std))}if(this.showUnique){l.push(P[n].unique);if(Utils.isNumber(P[n].uniqueValue)){l.push(this.formatNumber(P[n].uniqueValue))}else{l.push(P[n].uniqueValue)}l.push(P[n].uniqueMax)}if(this.showMissing){l.push(P[n].numNotMissing);l.push(P[n].numMissing)}}if(this.showType){l.push(P[n].type)}N=HtmlUtil.tds(["align","right"],l);var I=(K?"right":"left");var s=h.getLabel();var F=s.split("!!");var R=h.getId();s=F[F.length-1];if(K){s+=":"}s=s.replace(/ /g,"&nbsp;");var p=HtmlUtil.tr([],HtmlUtil.td(["align",I],"<b>"+HtmlUtil.tag("div",["title",R],s)+"</b>")+N);if(K){x+=p}else{x+=p}}x+="</table>";this.setContents(x);this.initTooltip()},handleEventRecordSelection:function(k,h){}})}function RamaddaCrosstabDisplay(e,d,c){var b;RamaddaUtil.inherit(this,b=new RamaddaFieldsDisplay(e,d,DISPLAY_CROSSTAB,c));addRamaddaDisplay(this);this.columns=this.getProperty("columns","").split(",");this.rows=this.getProperty("rows","").split(",");RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},handleEventPointDataLoaded:function(g,f){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=g.dataCollection;this.updateUI()}}},fieldSelectionChanged:function(){this.updateUI()},updateUI:function(x){b.updateUI.call(this,x);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var q=this.getStandardData(null,{includeIndex:false});var u=this.dataCollection.getList()[0].getRecordFields();var m={};cols=[];rows=[];for(var n=0;n<this.columns.length;n++){var g=this.columns[n];for(var o=0;o<u.length;o++){field=u[o];if(g==field.getLabel()||g==("#"+(o+1))){cols.push(u[o]);break}}}for(var n=0;n<this.rows.length;n++){var g=this.rows[n];for(var o=0;o<u.length;o++){if(g==u[o].getLabel()||g==("#"+(o+1))){rows.push(u[o]);break}}}var p=HtmlUtil.openTag("table",["border","1px","bordercolor","#ccc","class","display-stats","cellspacing","1","cellpadding","5"]);var v={};var f={};for(var n=0;n<cols.length;n++){var l=cols[n];var w=l.getLabel();for(var k=1;k<q.length;k++){var t=q[k];var h=t[l.getIndex()];if(!(w in v)){v[w]=[]}var s=v[w];if(s.indexOf(h)<0){console.log(h);s.push(h)}}}for(w in v){v[w].sort();console.log(v[w])}for(var n=0;n<cols.length;n++){var l=cols[n];for(var k=1;k<q.length;k++){var t=q[k];for(var o=0;o<rows.length;o++){var y=rows[n]}}}p+="</table>";this.setContents(p);this.initTooltip()}})}function RamaddaCorrelationDisplay(f,e,c){var b;var d="bottom";$.extend(this,{colorTable:"red_white_blue",colorByMin:"-1",colorByMax:"1"});RamaddaUtil.inherit(this,b=new RamaddaFieldsDisplay(f,e,DISPLAY_CORRELATION,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},getMenuItems:function(m){b.getMenuItems.call(this,m);var h=this.getGet();var l=HtmlUtil.formTable();var g=this.getColorTableName();var k="<select id="+this.getDomId("colortable")+">";for(table in Utils.ColorTables){if(table==g){k+="<option selected>"+table+"</option>"}else{k+="<option>"+table+"</option>"}}k+="</select>";l+=HtmlUtil.formEntry("Color Bar:",k);l+=HtmlUtil.formEntry("Color By Range:",HtmlUtil.input("",this.colorByMin,["size","7",ATTR_ID,this.getDomId("colorbymin")])+" - "+HtmlUtil.input("",this.colorByMax,["size","7",ATTR_ID,this.getDomId("colorbymax")]));l+="</table>";m.push(l)},initDialog:function(){b.initDialog.call(this);var k=this;var h=function(){k.colorByMin=k.jq("colorbymin").val();k.colorByMax=k.jq("colorbymax").val();k.updateUI()};var g=function(){k.colorTable=k.jq("colortable").val();k.updateUI()};this.jq("colorbymin").blur(h);this.jq("colorbymax").blur(h);this.jq("colortable").change(g)},handleEventPointDataLoaded:function(h,g){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=h.dataCollection;this.updateUI()}}},fieldSelectionChanged:function(){this.updateUI()},updateUI:function(F){b.updateUI.call(this,F);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var G=this.getStandardData(null,{includeIndex:false});var z=this.dataCollection.getList()[0].getRecordFields();var x=this.getSelectedFields([]);if(x.length==0){x=z}var u=HtmlUtil.openTag("table",["border","0","class","display-correlation"]);u+="<tr valign=bottom><td class=display-heading>&nbsp;</td>";for(var L=0;L<x.length;L++){var h=x[L];if(!h.isFieldNumeric()||h.isFieldGeo()){continue}u+="<td align=center class=top-heading>"+HtmlUtil.tag("div",["class","top-heading"],h.getLabel())+"</td>"}u+="</tr>";var s=null;colorByMin=parseFloat(this.colorByMin);colorByMax=parseFloat(this.colorByMax);s=this.getColorTable();var y=0;for(var M=0;M<x.length;M++){var h=x[M];if(!h.isFieldNumeric()||h.isFieldGeo()){continue}y++;u+="<tr><td>"+HtmlUtil.tag("div",["class","side-heading"],h.getLabel().replace(/ /g,"&nbsp;"))+"</td>";var p=h.getLabel();for(var J=0;J<x.length;J++){var g=x[J];if(!g.isFieldNumeric()||g.isFieldGeo()){continue}var w=g.getLabel();var t=0;var q=0;var D=0;for(var l=1;l<G.length;l++){var v=G[l];var n=v[h.getIndex()];var m=v[g.getIndex()];t+=n;q+=m;D++}var C=t/D;var B=q/D;var K=0;var I=0;var H=0;for(var l=1;l<G.length;l++){var v=G[l];var n=v[h.getIndex()];var m=v[g.getIndex()];K+=(n-C)*(m-B);I+=(n-C)*(n-C);H+=(m-B)*(m-B)}r=K/Math.sqrt(I*H);var E="";if(s!=null){var k=(r-colorByMin)/(colorByMax-colorByMin);var o=parseInt(k*s.length);if(o>=s.length){o=s.length-1}else{if(o<0){o=0}}E="background-color:"+s[o]}u+='<td align=right style="'+E+'">'+HtmlUtil.tag("div",["class","display-correlation-element","title","&rho;("+p+","+w+")"],r.toFixed(3))+"</td>"}u+="</tr>"}u+="<tr><td></td><td colspan = "+y+">"+HtmlUtil.div(["id",this.getDomId(d)],"")+"</td></tr>";u+="</table>";this.setContents(u);this.displayColorTable(d,colorByMin,colorByMax);this.initTooltip()}})}function RamaddaHeatmapDisplay(e,d,c){var b;$.extend(this,{colorTable:"red_white_blue"});RamaddaUtil.inherit(this,b=new RamaddaFieldsDisplay(e,d,DISPLAY_HEATMAP,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},getMenuItems:function(l){b.getMenuItems.call(this,l);var g=this.getGet();var k=HtmlUtil.formTable();var f=this.getColorTableName();var h="<select id="+this.getDomId("colortable")+">";for(table in Utils.ColorTable){if(table==colorTabler){h+="<option selected>"+table+"</option>"}else{h+="<option>"+table+"</option>"}}h+="</select>";k+=HtmlUtil.formEntry("Color Table:",h);k+=HtmlUtil.formEntry("Color By Range:",HtmlUtil.input("",this.colorByMin,["size","7",ATTR_ID,this.getDomId("colorbymin")])+" - "+HtmlUtil.input("",this.colorByMax,["size","7",ATTR_ID,this.getDomId("colorbymax")]));k+="</table>";l.push(k)},initDialog:function(){b.initDialog.call(this);var h=this;var g=function(){h.colorByMin=h.jq("colorbymin").val();h.colorByMax=h.jq("colorbymax").val();h.updateUI()};var f=function(){h.colorTable=h.jq("colortable").val();h.updateUI()};this.jq("colorbymin").blur(g);this.jq("colorbymax").blur(g);this.jq("colortable").change(f)},handleEventPointDataLoaded:function(g,f){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=g.dataCollection;this.updateUI()}}},fieldSelectionChanged:function(){this.updateUI()},getDimensionsStyle:function(){var f=this.getProperty("height",-1);if(f>0){return" height:"+f+"px;  max-height:"+f+"px; overflow-y: auto;"}return""},updateUI:function(E){var h=this;if(!haveGoogleChartsLoaded()){var x=function(){h.updateUI()};this.setContents(this.getLoadingMessage());setTimeout(x,1000);return}b.updateUI.call(this,E);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var l=this.getStandardData(null,{includeIndex:true});var k=l[0];var s=this.getProperty("showIndex",true);var w=this.getProperty("showValue",true);var P=this.getProperty("textColor","black");var R=this.getProperty("cellHeight",null);var y="";if(this.getProperty("showBorder","false")=="true"){y="border-bottom:1px #666 solid;"}var t="";if(R){t+="height:"+R+"px; max-height:"+R+"px; min-height:"+R+"px;"}var G=this.dataCollection.getList()[0].getRecordFields();var f=this.getSelectedFields([]);if(f.length==0){f=G}var H="";var O=null;var L=null;var o=null;if(Utils.stringDefined(this.getProperty("colorByMins"))){L=[];var T=this.getProperty("colorByMins").split(",");for(var S=0;S<T.length;S++){L.push(parseFloat(T[S]))}}if(Utils.stringDefined(this.getProperty("colorByMaxes"))){o=[];var T=this.getProperty("colorByMaxes").split(",");for(var S=0;S<T.length;S++){o.push(parseFloat(T[S]))}}if(Utils.stringDefined(this.getProperty("colorTables"))){var T=this.getProperty("colorTables").split(",");O=[];for(var S=0;S<T.length;S++){var u=T[S];if(u=="none"){O.push(null);continue}var B=Utils.ColorTables[u];O.push(B)}}else{O=[this.getColorTable()]}var C=null;var m=null;for(var V=1;V<l.length;V++){var v=l[V];if(C==null){C=[];m=[];for(var M=1;M<v.length;M++){C.push(Number.MAX_VALUE);m.push(Number.MIN_VALUE)}}for(var M=0;M<f.length;M++){var p=f[M];var J=p.getIndex()+1;if(!p||!p.isFieldNumeric()||p.isFieldGeo()){continue}var N=v[J];if(N==Number.POSITIVE_INFINITY||isNaN(N)||!Utils.isNumber(N)||!Utils.isDefined(N)||N==null){continue}C[M]=Math.min(C[M],N);m[M]=Math.max(m[M],N)}}H+=HtmlUtil.openTag("table",["border","0","class","display-heatmap"]);H+="<tr valign=bottom>";if(s){H+="<td align=center class=top-heading>"+HtmlUtil.tag("div",["class","top-heading"],k[0])+"</td>"}for(var F=0;F<f.length;F++){var p=f[F];if((!p.isFieldNumeric()||p.isFieldGeo())){continue}H+="<td align=center class=top-heading>"+HtmlUtil.tag("div",["class","top-heading"],p.getLabel())+"</td>"}H+="</tr>\n";for(var V=1;V<l.length;V++){var v=l[V];var J=v[0];if(J.f){J=J.f}var q=J;H+="<tr valign='center'>\n";if(s){H+=HtmlUtil.td(["class","side-heading","style",t],q)}var n=0;for(var M=0;M<f.length;M++){var p=f[M];var J=p.getIndex()+1;if(!p||!p.isFieldNumeric()||p.isFieldGeo()){continue}var Q="";var N=v[J];var U=C[M];var z=m[M];if(L&&n<L.length){U=L[n]}if(o&&n<o.length){z=o[n]}var K=U!=z&&!(N==Number.POSITIVE_INFINITY||isNaN(N)||!Utils.isNumber(N)||!Utils.isDefined(N)||N==null);var I=k[0]+": "+q+" - "+p.getLabel()+": "+N;if(K&&O!=null){var B=O[Math.min(n,O.length-1)];if(B){var g=(N-U)/(z-U);var D=parseInt(g*B.length);if(D>=B.length){D=B.length-1}else{if(D<0){D=0}}Q="background-color:"+B[D]+";"}}var W;if(!K){W="-"}else{W=Utils.formatNumber(N)}if(!w){W=""}H+=HtmlUtil.td(["valign","center","align","right","style",Q+t+y,"class","display-heatmap-cell"],HtmlUtil.div(["title",I,"style",t+"color:"+P],W));n++}H+="</tr>"}H+="</table>";this.setContents(H);this.initTooltip()}})}var DISPLAY_D3_GLIDER_CROSS_SECTION="GliderCrossSection";var DISPLAY_D3_PROFILE="profile";var DISPLAY_D3_LINECHART="D3LineChart";addGlobalDisplayType({type:DISPLAY_D3_LINECHART,forUser:false,label:"D3 LineChart",requiresData:true,category:"Charts"});addGlobalDisplayType({type:DISPLAY_D3_PROFILE,forUser:false,label:"Profile",requiresData:true,category:"Charts"});addGlobalDisplayType({type:DISPLAY_D3_GLIDER_CROSS_SECTION,forUser:false,label:"Glider cross section",requiresData:true,category:"Charts"});var FIELD_TIME="time";var FIELD_DEPTH="depth";var FIELD_VALUE="value";var FIELD_SELECTEDFIELD="selectedfield";var TYPE_LATITUDE="latitude";var TYPE_LONGITUDE="longitude";var TYPE_TIME="time";var TYPE_VALUE="value";var TYPE_ELEVATION="elevation";var FUNC_MOVINGAVERAGE="movingAverage";var D3Util={foo:"bar",getAxis:function(b,c){var d;if(b==FIELD_TIME){d=d3.time.scale().range(c)}else{d=d3.scale.linear().range(c)}return d},getDataValue:function(d,b,c){var e;if(d.fieldIdx>=0){e=b.getData()[d.fieldIdx]}else{switch(d.type){case TYPE_TIME:e=new Date(b.getDate());break;case TYPE_ELEVATION:e=b.getElevation();break;case TYPE_LATITUDE:e=b.getLatitude();case TYPE_LONGITUDE:e=b.getLongitude();default:e=b.getData()[c]}}if(d.reverse==true){return -1*e}else{return e}},getColorFromColorBar:function(e,c){var b=["#00008B","#0000CD","#0000FF","#00FFFF","#7CFC00","#FFFF00","#FFA500","#FF4500","#FF0000","#8B0000"];var d=d3.scale.linear().domain([0,b.length-1]).range(c);var f=d3.scale.linear().range(b).domain(d3.range(0,b.length).map(d));color=f(e);return color},addColorBar:function(e,c,f,d){var b=e.append("g").attr({id:"colorBarG",transform:"translate("+(d-40)+",0)"});b.append("g").append("defs").append("linearGradient").attr({id:"colorBarGradient",x1:"0%",y1:"100%",x2:"0%",y2:"0%"}).selectAll("stop").data(c).enter().append("stop").attr({offset:function(h,g){return f*(g)+"%"},"stop-color":function(h,g){return c[g]},"stop-opacity":1});return b}};function RamaddaD3Display(f,e,c){testProperties=c;var d="svg";var b;RamaddaUtil.inherit(this,b=new RamaddaDisplay(f,e,"d3",c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){this.initUI();this.setDisplayTitle(c.graph.title);var k=this.getProperty("innerWidth",600);var q=this.getProperty("innerHeight",300);var m={top:20,right:50,bottom:30,left:50};var l="height:"+q+"px;width:"+k+"px;";var n=HtmlUtil.div([ATTR_ID,this.getDomId(d),ATTR_STYLE,l],"");this.setContents(n);this.displayHeight=parseInt((d3.select("#"+this.getDomId(d)).style("height")).split("px")[0])-m.top-m.bottom;this.displayWidth=parseInt((d3.select("#"+this.getDomId(d)).style("width")).split("px")[0])-m.left-m.right;var h=this;var s=d3.behavior.zoom().on("zoom",function(){h.zoomBehaviour()});this.zoom=s;this.svg=d3.select("#"+this.getDomId(d)).append("svg").attr("width",this.displayWidth+m.left+m.right).attr("height",this.displayHeight+m.top+m.bottom).attr(ATTR_CLASS,"D3graph").call(s).on("click",function(){h.click(d3.event)}).on("dblclick",function(){h.dbclick(d3.event)}).append("g").attr("transform","translate("+m.left+","+m.top+")");this.x=D3Util.getAxis(c.graph.axis.x.type,[0,this.displayWidth-100]);this.y=D3Util.getAxis(c.graph.axis.y.type,[this.displayHeight,0]);this.xAxis=d3.svg.axis().scale(this.x).orient("bottom");this.yAxis=d3.svg.axis().scale(this.y).orient("left");this.svg.append("g").attr(ATTR_CLASS,"x axis").attr("transform","translate(0,"+this.displayHeight+")").call(this.xAxis);this.svg.append("g").attr(ATTR_CLASS,"y axis").call(this.yAxis);var g=["#00008B","#0000CD","#0000FF","#00FFFF","#7CFC00","#FFFF00","#FFA500","#FF4500","#FF0000","#8B0000"];var p=100/(g.length-1);var o=D3Util.addColorBar(this.svg,g,p,this.displayWidth);this.color=d3.scale.category10();this.updateUI()},needsData:function(){return true},initDialog:function(){this.addFieldsCheckboxes()},getDialogContents:function(){var g=this.getProperty(PROP_HEIGHT,"400");var h=HtmlUtil.div([ATTR_ID,this.getDomId(ID_FIELDS),ATTR_CLASS,"display-fields"]);h+=b.getDialogContents.apply(this);return h},fieldSelectionChanged:function(){this.updateUI()},updateUI:function(){var D=false;if(!this.hasData()){return}test=this;var u=this.getSelectedFields();if(u.length==0){return}this.addFieldsCheckboxes();pointData=this.getData();if(pointData==null){console.log("no data");return}var w=pointData.getNumericFields();var B=pointData.getRecords();var k=RecordUtil.getRanges(w,B);var n=RecordUtil.getElevationRange(w,B);var m=(n[1]-n[0])*0.05;var q=this.x;var p=this.y;var z=this.color;var h=c.graph.axis;if(D){this.zoom.x(this.x);this.zoom.y(this.y)}else{this.x.domain(d3.extent(B,function(x){return D3Util.getDataValue(h.x,x,u[0].getIndex())}));this.y.domain(d3.extent(B,function(x){return D3Util.getDataValue(h.y,x,u[0].getIndex())}));this.zoom.x(this.x);this.zoom.y(this.y)}this.svg.selectAll(".y.axis").call(this.yAxis);this.svg.selectAll(".x.axis").call(this.xAxis);this.svg.selectAll(".line").remove();this.svg.selectAll(".legendElement").remove();var o=this;for(var C=0;C<u.length;C++){var E=u[C].getIndex();var v=k[E];var s=d3.svg.line().x(function(x){return q(D3Util.getDataValue(h.x,x,u[C].getIndex()))}).y(function(x){return p(D3Util.getDataValue(h.y,x,u[C].getIndex()))});displayLine=this.svg.append("path").datum(B).attr(ATTR_CLASS,"line").attr("d",s).on("mousemove",function(){o.mouseover(d3.event)}).attr("fill","none").attr("stroke",function(x){return z(C)}).attr("stroke-width","0.5px");if(c.graph.axis.z==FIELD_SELECTEDFIELD){displayLine.attr("stroke","url(#colorBarGradient)")}if(c.graph.derived!=null){var t=c.graph.derived.split(",");for(funcIdx=0;funcIdx<t.length;funcIdx++){var l=t[funcIdx];if(l==FUNC_MOVINGAVERAGE){var g=d3.svg.line().x(function(x){return q(D3Util.getDataValue(h.x,x,u[C].getIndex()))}).y(function(y,x){if(x==0){return _movingSum=D3Util.getDataValue(h.y,y,u[C].getIndex())}else{_movingSum+=D3Util.getDataValue(h.y,y,u[C].getIndex())}return p(_movingSum/x)}).interpolate("basis");this.svg.append("path").attr(ATTR_CLASS,"line").attr("d",g(B)).attr("fill","none").attr("stroke",function(x){return z(C)}).attr("stroke-width","1.5px").attr("viewBox","50 50 100 100 ").style("stroke-dasharray",("3, 3"))}else{console.log("Error: Unknown derived function:"+l)}}}this.svg.append("svg:rect").attr(ATTR_CLASS,"legendElement").attr("x",this.displayWidth-100).attr("y",(50+50*C)).attr("stroke",function(x){return z(C)}).attr("height",2).attr("width",40);this.svg.append("svg:text").attr(ATTR_CLASS,"legendElement").attr("x",this.displayWidth-100+40+10).attr("y",(55+55*C)).attr("stroke",function(x){return z(C)}).attr("style","font-size:50%").text(u[C].getLabel())}},zoomBehaviour:function(){this.updateUI(true)},handleEventRecordSelection:function(h,g){},mouseover:function(){testing=d3.event;console.log("mouseover")},click:function(g){console.log("click:"+g)},dbclick:function(g){this.zoom();this.updateUI()},getSVG:function(){return this.svg}})}function RamaddaD3LineChartDisplay(e,d,b){var c={};c.graph={title:"Line chart",derived:FUNC_MOVINGAVERAGE,axis:{y:{type:TYPE_VALUE,fieldname:FIELD_SELECTEDFIELD},x:{type:TYPE_TIME,fieldname:FIELD_TIME}}};b=$.extend(c,b);return new RamaddaD3Display(e,d,b)}function RamaddaProfileDisplay(e,d,b){var c={};c.graph={title:"Profile chart",derived:null,axis:{y:{type:TYPE_ELEVATION,fieldname:FIELD_DEPTH,fieldIdx:3,reverse:true},x:{type:TYPE_VALUE,fieldname:FIELD_VALUE}}};b=$.extend(c,b);return new RamaddaD3Display(e,d,b)}function RamaddaGliderCrossSectionDisplay(e,d,b){var c={};c.graph={title:"Glider cross section",derived:null,axis:{y:{type:TYPE_ELEVATION,fieldname:FIELD_DEPTH,reverse:true},x:{type:TYPE_TIME,fieldname:FIELD_TIME},z:FIELD_SELECTEDFIELD}};b=$.extend(c,b);return new RamaddaD3Display(e,d,b)}var DISPLAY_ENTRYLIST="entrylist";var DISPLAY_TESTLIST="testlist";var DISPLAY_ENTRYDISPLAY="entrydisplay";var DISPLAY_ENTRY_GALLERY="entrygallery";var DISPLAY_ENTRY_GRID="entrygrid";var DISPLAY_OPERANDS="operands";var DISPLAY_METADATA="metadata";var DISPLAY_TIMELINE="timeline";var DISPLAY_REPOSITORIES="repositories";var ID_RESULTS="results";var ID_ENTRIES="entries";var ID_DETAILS="details";var ID_DETAILS_INNER="detailsinner";var ID_PROVIDERS="providers";var ID_SEARCH_SETTINGS="searchsettings";var ATTR_ENTRYID="entryid";var ID_TREE_LINK="treelink";addGlobalDisplayType({type:DISPLAY_ENTRYLIST,label:"Entry List",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_TESTLIST,label:"Test  List",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_ENTRYDISPLAY,label:"Entry Display",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_ENTRY_GALLERY,label:"Entry Gallery",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_ENTRY_GRID,label:"Entry Date Grid",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_METADATA,label:"Metadata Table",requiresData:false,category:"Entry Displays"});function RamaddaEntryDisplay(l,c,k,h){var e;RamaddaUtil.inherit(this,e=new RamaddaDisplay(l,c,k,h));this.ramaddas=new Array();var f=this.getProperty("repositories",this.getProperty("repos",null));if(f!=null){var g=f.split(",");for(var d=0;d<g.length;d++){var m=g[d];m=m.trim();this.ramaddas.push(getRamadda(m))}if(this.ramaddas.length>0){var b=new RepositoryContainer("all","All entries");addRepository(b);for(var d=0;d<this.ramaddas.length;d++){b.addRepository(this.ramaddas[d])}this.ramaddas.push(b);this.setRamadda(this.ramaddas[0])}}RamaddaUtil.defineMembers(this,{searchSettings:new EntrySearchSettings({parent:h.entryParent,provider:h.provider,text:h.entryText,entryType:h.entryType,orderBy:h.orderBy}),entryList:h.entryList,entryMap:{},getSearchSettings:function(){if(this.providers!=null){var o=this.searchSettings.provider;var n=this.jq(ID_PROVIDERS).val();if(n!=null){o=n}this.searchSettings.provider=o}return this.searchSettings},getEntries:function(){if(this.entryList==null){return[]}return this.entryList.getEntries()}});if(h.entryType!=null){this.searchSettings.addType(h.entryType)}}function RamaddaSearcher(w,n,d,f){var h="-- None --";var l="textfield";var b="typefield";var m="typediv";var o="typefields";var s="metadatafield";var v="search";var k="form";var c="column";RamaddaUtil.initMembers(this,{showForm:true,showSearchSettings:true,showEntries:true,showType:true,doSearch:true,formOpen:true,fullForm:true,showMetadata:true,showToggle:true,showArea:true,showText:true,showDate:true,fields:null,formWidth:0,entriesWidth:0,types:null,entryTypes:null,metadataTypeList:[],showDetailsForGroup:false});var x;RamaddaUtil.inherit(this,x=new RamaddaEntryDisplay(w,n,d,f));if(this.showMetadata&&this.showSearchSettings){var t=this.getProperty("metadataTypes","enum_tag:Tag");var p=t.split(",");for(var u=0;u<p.length;u++){var d=p[u];var g=d;var q=null;var e=d.split(":");if(e.length>1){d=e[0];if(e.length>=3){q=e[1];g=e[2]}else{g=e[1]}}this.metadataTypeList.push(new MetadataType(d,g,q))}}RamaddaUtil.defineMembers(this,{haveSearched:false,haveTypes:false,metadata:{},metadataLoading:{},getDefaultHtml:function(){var D="";var z=this.isLayoutHorizontal();var G=this.getFooter();if(!this.getProperty("showFooter",true)){G=""}displayDebug=false;var B=[ATTR_ID,this.getDomId(ID_ENTRIES),ATTR_CLASS,this.getClass("content")];var y=this.getProperty("innerHeight",null);if(y==null){y=this.getProperty("entriesHeight",null)}if(y!=null){B.push(ATTR_STYLE);B.push("margin: 0px; padding: 0px;  min-height:"+y+"px; max-height:"+y+"px; overflow-y: auto;")}var E="";if(this.getProperty("showHeader",true)){E=HtmlUtil.div([ATTR_CLASS,"display-entries-results",ATTR_ID,this.getDomId(ID_RESULTS)],"&nbsp;")}var F=E+HtmlUtil.div(B,this.getLoadingMessage());if(z){D+=HtmlUtil.openTag(TAG_DIV,["class","row"]);var C=["class","col-md-12"];if(this.showForm){var H=[];if(this.formWidth===""){H=[]}else{if(this.formWidth!=0){H=[ATTR_WIDTH,this.formWidth]}}D+=HtmlUtil.tag(TAG_DIV,["class","col-md-4"],this.makeSearchForm());C=["class","col-md-8"]}if(this.showEntries){var H=[ATTR_WIDTH,"75%"];if(this.entriesWidth===""){H=[]}else{if(this.entriesWidth!=0){H=[ATTR_WIDTH,this.entriesWidth]}}D+=HtmlUtil.tag(TAG_DIV,C,F)}D+=HtmlUtil.closeTag("row");D+=HtmlUtil.openTag(TAG_DIV,["class","row"]);if(this.showForm){D+=HtmlUtil.tag(TAG_DIV,["class","col-md-6"],"")}if(this.showEntries){if(this.getProperty("showFooter",true)){D+=HtmlUtil.tag(TAG_DIV,["class","col-md-6"],G)}}D+=HtmlUtil.closeTag(TAG_DIV)}else{if(this.showForm){D+=this.makeSearchForm()}if(this.showEntries){D+=F;D+=G}}D+=HtmlUtil.div([ATTR_CLASS,"display-entry-popup",ATTR_ID,this.getDomId(ID_DETAILS)],"&nbsp;");return D},initDisplay:function(){var y=this;this.jq(v).button().click(function(C){y.submitSearchForm();C.preventDefault()});this.jq(l).autocomplete({source:function(C,D){}});this.jq(ID_REPOSITORY).selectBoxIt({});this.jq(ID_REPOSITORY).change(function(){var C=y.jq(ID_REPOSITORY).val();var D=getRamadda(C);y.setRamadda(D);y.addTypes(null);y.typeChanged()});this.jq(k).submit(function(C){y.submitSearchForm();C.preventDefault()});this.addTypes(this.entryTypes);for(var z=0;z<this.metadataTypeList.length;z++){var B=this.metadataTypeList[z];this.addMetadata(B,null)}if(!this.haveSearched){if(this.doSearch){this.submitSearchForm()}}},showEntryDetails:function(z,D,y,G){if(true){return}var F=this.getEntry(D);var B="#"+this.getDomId(ID_DETAILS+D);if(this.currentPopupEntry==F){this.hideEntryDetails(D);return}var E="right top";var H="right bottom";if(G){E="left top";H="left bottom"}this.currentPopupEntry=F;if(y==null){y=this.getDomId("entry_"+F.getIdForDom())}var I=HtmlUtil.onClick(this.getGet()+".hideEntryDetails('"+D+"');",HtmlUtil.image(ramaddaBaseUrl+"/icons/close.gif"));var C=this.getEntryHtml(F,{headerRight:I});$(B).html(C);$(B).show()},getResultsHeader:function(z){var F="Showing "+(this.searchSettings.skip+1)+"-"+(this.searchSettings.skip+Math.min(this.searchSettings.max,z.length));var y=[];var E=[];if(this.searchSettings.skip>0){y.push(HtmlUtil.onClick(this.getGet()+".loadPrevUrl();","Previous",[ATTR_CLASS,"display-link"]))}var D=false;if(z.length==this.searchSettings.getMax()){y.push(HtmlUtil.onClick(this.getGet()+".loadNextUrl();","Next",[ATTR_CLASS,"display-link"]));D=true}E.push(HtmlUtil.onClick(this.getGet()+".loadLess();",HtmlUtil.image(ramaddaBaseUrl+"/icons/minus-small-white.png",[ATTR_ALT,"View less",ATTR_TITLE,"View less","border","0"]),[ATTR_CLASS,"display-link"]));if(D){E.push(HtmlUtil.onClick(this.getGet()+".loadMore();",HtmlUtil.image(ramaddaBaseUrl+"/icons/plus-small-white.png",[ATTR_ALT,"View more",ATTR_TITLE,"View more","border","0"]),[ATTR_CLASS,"display-link"]))}var C="";var B="&nbsp;&nbsp;&nbsp;";C=F+B+HtmlUtil.join(y,"&nbsp;")+B+HtmlUtil.join(E,"&nbsp;");return C},submitSearchForm:function(){if(this.fixedEntries){return}this.haveSearched=true;var C=this.getSearchSettings();C.text=this.getFieldValue(this.getDomId(l),C.text);if(this.textRequired&&(C.text==null||C.text.trim().length==0)){this.writeHtml(ID_ENTRIES,"");return}if(this.haveTypes){C.entryType=this.getFieldValue(this.getDomId(b),C.entryType)}C.clearAndAddType(C.entryType);if(this.areaWidget){this.areaWidget.setSearchSettings(C)}if(this.dateRangeWidget){this.dateRangeWidget.setSearchSettings(C)}C.metadata=[];for(var z=0;z<this.metadataTypeList.length;z++){var y=this.metadataTypeList[z];var F=y.getValue();if(F==null){F=this.getFieldValue(this.getMetadataFieldId(y),null)}if(F!=null){C.metadata.push({type:y.getType(),value:F})}}var E=this.getRamadda();if(E.children){console.log("Searching  multiple ramaddas");this.entryList=new EntryListHolder(E,this);this.multiSearch={count:0};for(var z=0;z<E.children.length;z++){var D=E.children[z];var B=this.makeSearchUrl(D);this.updateForSearching(B);this.entryList.addEntryList(new EntryList(D,B,null,false));this.multiSearch.count++}this.entryList.doSearch(this)}else{this.multiSearch=null;var B=this.makeSearchUrl(this.getRamadda());console.log(B);this.entryList=new EntryList(this.getRamadda(),B,this,true);this.updateForSearching(B)}},handleSearchError:function(y,z){this.writeHtml(ID_ENTRIES,"");this.writeHtml(ID_RESULTS,"");console.log("Error performing search:"+z)},updateForSearching:function(y){var C=this.getRamadda().getSearchLinks(this.getSearchSettings());this.footerRight=C==null?"":"Links: "+HtmlUtil.join(C," - ");this.writeHtml(ID_FOOTER_RIGHT,this.footerRight);var B=this.searchMessage;if(B==null){B=this.getRamadda().getSearchMessage()}var z=this.getSearchSettings().provider;if(z!=null){B=null;if(this.providerMap!=null){B=this.providerMap[z]}if(B==null){B=z}B="Searching "+B}this.showMessage(B,HtmlUtil.div([ATTR_STYLE,"margin:20px;"],this.getWaitImage()));this.hideEntryDetails()},showMessage:function(z,y){this.writeHtml(ID_RESULTS,z);this.writeHtml(ID_ENTRIES,y)},prepareToLayout:function(){x.prepareToLayout.apply(this);this.savedValues={};var C=this.getSearchableColumns();for(var z=0;z<C.length;z++){var y=C[z];var D=this.getDomId(c+y.getName());var B=$("#"+D).val();if(B==null||B.length==0){continue}this.savedValues[D]=B}},makeSearchUrl:function(D){var y="";var F=this.getSearchableColumns();for(var B=0;B<F.length;B++){var z=F[B];var E=this.jq(c+z.getName()).val();if(E==null||E.length==0){continue}y+="&"+z.getSearchArg()+"="+encodeURI(E)}this.getSearchSettings().setExtra(y);var C=D.getSearchUrl(this.getSearchSettings(),OUTPUT_JSON);return C},makeSearchForm:function(){var B=HtmlUtil.openTag("form",[ATTR_ID,this.getDomId(k),"action","#"]);var C="";var M=this.getSearchSettings().text;if(M==null){var D=Utils.getUrlArgs(document.location.search);M=D.text}if(M==null){M=""}var G="search text";if(this.eg){G=this.eg}var O=HtmlUtil.input("",M,["placeholder",G,ATTR_CLASS,"display-search-input",ATTR_SIZE,"30",ATTR_ID,this.getDomId(l)]);var L=HtmlUtil.image(ramaddaBaseUrl+"/icons/magnifier.png",[ATTR_BORDER,"0",ATTR_TITLE,"Search"]);var I=[];var C="";C+=HtmlUtil.formTable();if(this.showArea){this.areaWidget=new AreaWidget(this);C+=HtmlUtil.formEntry("Area:",this.areaWidget.getHtml())}var ad=HtmlUtil.div([ATTR_ID,this.getDomId(v),ATTR_CLASS,"display-button"],L);if(this.ramaddas.length>0){var Q=HtmlUtil.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(ID_REPOSITORY),ATTR_CLASS,"display-repositories-select"]);var Z=ramaddaBaseUrl+"/icons/favicon.png";for(var W=0;W<this.ramaddas.length;W++){var ae=this.ramaddas[W];var T=[ATTR_TITLE,"",ATTR_VALUE,ae.getId(),"data-iconurl",Z];if(this.getRamadda().getId()==ae.getId()){T.push("selected");T.push(null)}var J=Q+=HtmlUtil.tag(TAG_OPTION,T,ae.getName())}Q+=HtmlUtil.closeTag(TAG_SELECT);I.push(Q)}this.providerMap={};if(this.providers!=null){var F="";var R=Utils.getUrlArgs(document.location.search).provider;var S=this.providers.split(",");var H=null;var Y={};var K=[];for(var W=0;W<S.length;W++){var N=S[W].split(":");var P=N[0];P=P.replace(/_COLON_/g,":");var J=N.length>1?N[1]:P;if(J.length>40){J=J.substring(0,39)+"..."}this.providerMap[P]=J;var X="";if(P==R){X+=" selected "}var V="";if(N.length>3){V=N[3]}var ab=Y[V];if(ab==null){K.push(V);Y[V]="";ab=""}if(N.length>2){var af=N[2];af=af.replace(/\${urlroot}/g,ramaddaBaseUrl);af=af.replace(/\${root}/g,ramaddaBaseUrl);X+=' data-iconurl="'+af+'" '}ab+="<option "+X+' value="'+P+'">'+J+"</option>\n";Y[V]=ab}for(var z=0;z<K.length;z++){var V=K[z];if(V!=""){F+='<optgroup label="'+V+'">\n'}F+=Y[V];if(V!=""){F+="</optgroup>"}}I.push(HtmlUtil.tag("select",["id",this.getDomId(ID_PROVIDERS),ATTR_CLASS,"display-search-providers"],F))}if(this.showType){I.push(HtmlUtil.span([ATTR_ID,this.getDomId(m)],HtmlUtil.span([ATTR_CLASS,"display-loading"],"Loading types...")))}if(this.showText){I.push(O)}var aa=this.isLayoutHorizontal();if(aa){var ac=HtmlUtil.join(I,"<br>");B+="<table><tr valign=top><td>"+ad+"</td><td>"+ac+"</td></tr></table>"}else{B+=ad+" "+HtmlUtil.join(I," ")}if(this.showDate){this.dateRangeWidget=new DateRangeWidget(this);C+=HtmlUtil.formEntry("Date Range:",this.dateRangeWidget.getHtml())}if(this.showMetadata){for(var W=0;W<this.metadataTypeList.length;W++){var E=this.metadataTypeList[W];var U=E.getValue();var y;if(U!=null){y=U}else{y=HtmlUtil.tag(TAG_SELECT,[ATTR_ID,this.getMetadataFieldId(E),ATTR_CLASS,"display-metadatalist"],HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],h))}C+=HtmlUtil.formEntry(E.getLabel()+":",y)}}C+=HtmlUtil.closeTag(TAG_TABLE);C+=HtmlUtil.div([ATTR_ID,this.getDomId(o)],"");if(this.showSearchSettings){var P=this.getDomId(ID_SEARCH_SETTINGS);if(this.showToggle){B+=HtmlUtil.div([ATTR_CLASS,"display-search-extra",ATTR_ID,P],HtmlUtil.toggleBlock("Search Settings",HtmlUtil.div([ATTR_CLASS,"display-search-extra-inner"],C),this.formOpen))}else{B+=HtmlUtil.div([ATTR_CLASS,"display-search-extra",ATTR_ID,P],HtmlUtil.div([ATTR_CLASS,"display-search-extra-inner"],C))}}B+='<input type="submit" style="position:absolute;left:-9999px;width:1px;height:1px;"/>';B+=HtmlUtil.closeTag("form");return B},handleEventMapBoundsChanged:function(z,y){if(this.areaWidget){this.areaWidget.handleEventMapBoundsChanged(z,y)}},typeChanged:function(){var y=this.getSearchSettings();y.skip=0;y.max=50;y.entryType=this.getFieldValue(this.getDomId(b),y.entryType);y.clearAndAddType(y.entryType);this.addExtraForm();this.submitSearchForm()},addMetadata:function(B,D){if(D==null){D=this.metadata[B.getType()]}if(D==null){var I=this;if(!this.metadataLoading[B.getType()]){this.metadataLoading[B.getType()]=true;D=this.getRamadda().getMetadataCount(B,function(J,K){I.addMetadata(J,K)})}}if(D==null){return}this.metadata[B.getType()]=D;var F=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],h);for(var z=0;z<D.length;z++){var C=D[z].count;var H=D[z].value;var E=D[z].label;var G=[ATTR_VALUE,H,ATTR_CLASS,"display-metadatalist-item"];var y=false;if(y){G.push("selected");G.push(null)}F+=HtmlUtil.tag(TAG_OPTION,G,E+" ("+C+")")}$("#"+this.getMetadataFieldId(B)).html(F)},getMetadataFieldId:function(y){var z=y.getType();z=z.replace(".","_");return this.getDomId(s+z)},findEntryType:function(y){if(this.entryTypes==null){return null}for(var z=0;z<this.entryTypes.length;z++){var B=this.entryTypes[z];if(B.getId()==y){return B}}return null},addTypes:function(L){if(!this.showType){return}if(L==null){var M=this;L=this.getRamadda().getEntryTypes(function(P,O){M.addTypes(O)})}if(L==null){return}this.entryTypes=L;if(this.types){var C={};var z=this.types.split(",");for(var D=0;D<z.length;D++){var G=z[D];C[G]=true}var E=[];for(var D=0;D<this.entryTypes.length;D++){var G=this.entryTypes[D];if(C[G.getId()]){E.push(G)}else{if(G.getCategory()!=null&&C[G.getCategory()]){E.push(G)}}}this.entryTypes=E}this.haveTypes=true;var N=[];var K={};var I=HtmlUtil.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(b),ATTR_CLASS,"display-typelist","onchange",this.getGet()+".typeChanged();"]);I+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],"Any Type");for(var D=0;D<this.entryTypes.length;D++){var G=this.entryTypes[D];var H=G.getIcon();var J=[ATTR_TITLE,G.getLabel(),ATTR_VALUE,G.getId(),ATTR_CLASS,"display-typelist-type","data-iconurl",H];var B=this.getSearchSettings().hasType(G.getId());if(B){J.push("selected");J.push(null)}var F=HtmlUtil.tag(TAG_OPTION,J,G.getLabel()+" ("+G.getEntryCount()+")");var y=K[G.getCategory()];if(y==null){K[G.getCategory()]=HtmlUtil.tag(TAG_OPTION,[ATTR_CLASS,"display-typelist-category",ATTR_TITLE,"",ATTR_VALUE,""],G.getCategory());N.push(G.getCategory())}K[G.getCategory()]+=F}for(var D in N){I+=K[N[D]]}I+=HtmlUtil.closeTag(TAG_SELECT);this.writeHtml(m,I);this.jq(b).selectBoxIt({});this.addExtraForm()},getSelectedType:function(){if(this.entryTypes==null){return null}for(var y=0;y<this.entryTypes.length;y++){var z=this.entryTypes[y];if(z.getId){if(this.getSearchSettings().hasType(z.getId())){return z}}}return null},getSearchableColumns:function(){var B=[];var C=this.getSelectedType();if(C==null){return B}var D=C.getColumns();if(D==null){return B}for(var z=0;z<D.length;z++){var y=D[z];if(!y.getCanSearch()){continue}B.push(y)}return B},addExtraForm:function(){if(this.savedValues==null){this.savedValues={}}var D="";var G=this.getSearchableColumns();for(var E=0;E<G.length;E++){var C=G[E];if(this.fields!=null&&this.fields.indexOf(C.getName())<0){continue}if(D.length==0){D+=HtmlUtil.formTable()}var I="";var B=this.getDomId(c+C.getName());var z=this.savedValues[B];if(z==null){z=this.jq(c+C.getName()).val()}if(z==null){z=""}if(C.isEnumeration()){I=HtmlUtil.openTag(TAG_SELECT,[ATTR_ID,B,ATTR_CLASS,"display-menu"]);I+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],"-- Select --");var K=C.getValues();for(var y in K){var J=K[y].value;var H=K[y].label;var F="";if(J==z){F=" selected "}I+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,H,ATTR_VALUE,J,F,null],H)}I+=HtmlUtil.closeTag(TAG_SELECT)}else{I=HtmlUtil.input("",z,[ATTR_CLASS,"input",ATTR_SIZE,"15",ATTR_ID,B])}D+=HtmlUtil.formEntry(C.getLabel()+":",I+" "+C.getSuffix())}if(D.length>0){D+=HtmlUtil.closeTag(TAG_TABLE)}this.writeHtml(o,D);$(".display-menu").selectBoxIt({})},getEntries:function(){if(this.entryList==null){return[]}return this.entryList.getEntries()},loadNextUrl:function(){this.getSearchSettings().skip+=this.getSearchSettings().max;this.submitSearchForm()},loadMore:function(){this.getSearchSettings().max=this.getSearchSettings().max+=50;this.submitSearchForm()},loadLess:function(){var y=this.getSearchSettings().max;y=parseInt(0.75*y);this.getSearchSettings().max=Math.max(1,y);this.submitSearchForm()},loadPrevUrl:function(){this.getSearchSettings().skip=Math.max(0,this.getSearchSettings().skip-this.getSearchSettings().max);this.submitSearchForm()},entryListChanged:function(y){this.entryList=y}})}function RamaddaEntrylistDisplay(f,e,c,d){var b;if(d==null){d=DISPLAY_ENTRYLIST}RamaddaUtil.inherit(this,b=new RamaddaSearcher(f,e,DISPLAY_ENTRYLIST,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{haveDisplayed:false,selectedEntries:[],getSelectedEntries:function(){return this.selectedEntries},initDisplay:function(){var g=this;if(this.getIsLayoutFixed()&&this.haveDisplayed){return}this.haveDisplayed=true;this.initUI();this.setContents(this.getDefaultHtml());if(this.dateRangeWidget){this.dateRangeWidget.initHtml()}b.initDisplay.apply(this);if(this.entryList!=null&&this.entryList.haveLoaded){this.entryListChanged(this.entryList)}this.jq(ID_PROVIDERS).selectBoxIt({});this.jq(ID_PROVIDERS).change(function(){g.providerChanged()})},providerChanged:function(){var g=this.jq(ID_PROVIDERS).val();if(g!="this"){this.jq(ID_SEARCH_SETTINGS).hide()}else{this.jq(ID_SEARCH_SETTINGS).show()}},getMenuItems:function(h){b.getMenuItems.apply(this,h);if(this.getSelectedEntriesFromTree().length>0){var g=this.getGet();h.push(HtmlUtil.onClick(g+".makeDisplayList();","Make List"));h.push(HtmlUtil.onClick(g+".makeDisplayGallery();","Make Gallery"))}},makeDisplayList:function(){var g=this.getSelectedEntriesFromTree();if(g.length==0){return}var h={selectedEntries:g,showForm:false,showMenu:true,fixedEntries:true};h.entryList=new EntryList(this.getRamadda(),"",this,false);h.entryList.setEntries(g);this.getDisplayManager().createDisplay(DISPLAY_ENTRYLIST,h)},makeDisplayGallery:function(){var g=this.getSelectedEntriesFromTree();if(g.length==0){return}var h={selectedEntries:g};this.getDisplayManager().createDisplay(DISPLAY_ENTRY_GALLERY,h)},handleEventEntrySelection:function(h,g){this.selectEntry(g.entry,g.selected)},selectEntry:function(k,h){var l=false;if(h){this.jq("entry_"+k.getIdForDom()).addClass("ui-selected");var g=this.selectedEntries.indexOf(k);if(g<0){this.selectedEntries.push(k);l=true}}else{this.jq("entry_"+k.getIdForDom()).removeClass("ui-selected");var g=this.selectedEntries.indexOf(k);if(g>=0){this.selectedEntries.splice(g,1);l=true}}},makeEntriesDisplay:function(g){return this.getEntriesTree(g)},entryListChanged:function(n){if(this.multiSearch){this.multiSearch.count--}b.entryListChanged.apply(this,[n]);var g=this.entryList.getEntries();if(g.length==0){this.getSearchSettings().skip=0;this.getSearchSettings().max=50;var m="Nothing found";if(this.multiSearch){if(this.multiSearch.count>0){m="Nothing found so far. Still searching "+this.multiSearch.count+" repositories"}else{}}this.writeHtml(ID_ENTRIES,this.getMessage(m));this.writeHtml(ID_FOOTER_LEFT,"");this.writeHtml(ID_RESULTS,"&nbsp;");this.getDisplayManager().handleEventEntriesChanged(this,[]);return}this.writeHtml(ID_RESULTS,this.getResultsHeader(g));var h=this.getGet();this.writeHtml(ID_FOOTER_LEFT,"");if(this.footerRight!=null){this.writeHtml(ID_FOOTER_RIGHT,this.footerRight)}var l=this.makeEntriesDisplay(g);var k="";k+=HtmlUtil.openTag(TAG_OL,[ATTR_CLASS,this.getClass("list"),ATTR_ID,this.getDomId(ID_LIST)]);k+=l;k+=HtmlUtil.closeTag(TAG_OL);this.writeHtml(ID_ENTRIES,k);this.addEntrySelect();this.getDisplayManager().handleEventEntriesChanged(this,g)}})}function RamaddaTestlistDisplay(e,d,c){var b;RamaddaUtil.inherit(this,b=new RamaddaEntrylistDisplay(e,d,c,DISPLAY_TESTLIST));RamaddaUtil.defineMembers(this,{makeEntriesDisplay:function(f){return"Overridden display<br>"+this.getEntriesTree(f)}})}var RamaddaListDisplay=RamaddaEntrylistDisplay;function RamaddaEntrygalleryDisplay(f,e,c){var d="gallery";var b;RamaddaUtil.inherit(this,b=new RamaddaEntryDisplay(f,e,DISPLAY_ENTRY_GALLERY,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{entries:c.entries,initDisplay:function(){var o=this;this.initUI();var h=HtmlUtil.div([ATTR_ID,this.getDomId(d)],"Gallery");this.setContents(h);if(this.selectedEntries!=null){this.jq(d).html(this.getEntriesGallery(this.selectedEntries));return}if(this.entries){var l={entries:this.entries};var g=new EntrySearchSettings(l);var k=this.getRamadda().getSearchUrl(g,OUTPUT_JSON,"BAR");console.log(k);var m={entryListChanged:function(q){var p=q.getEntries();o.jq(d).html(o.getEntriesGallery(p));$("a.popup_image").fancybox({titleShow:false})}};var n=new EntryList(this.getRamadda(),k,m,true)}if(this.entryList!=null&&this.entryList.haveLoaded){this.entryListChanged(this.entryList)}},getEntriesGallery:function(n){var u="";var m="";var v=0;var s=[];for(var l=0;l<n.length;l++){var t=n[l];if(t.isImage()){s.push(t);var q=HtmlUtil.tag(TAG_A,[ATTR_HREF,t.getEntryUrl()],t.getName());v++;m+=HtmlUtil.tag(TAG_IMG,["src",t.getResourceUrl(),ATTR_WIDTH,"500",ATTR_ID,this.getDomId("entry_"+t.getIdForDom()),ATTR_ENTRYID,t.getId(),ATTR_CLASS,"display-entrygallery-entry"])+"<br>"+q+"<p>"}else{var p=t.getIconImage([ATTR_TITLE,"View entry"]);var q=HtmlUtil.tag(TAG_A,[ATTR_HREF,t.getEntryUrl()],p+" "+t.getName());u+=q+"<br>"}}if(v>1){var g="";g+='<div class="row">\n';var h=parseInt(this.getProperty("columns","3"));var o="col-md-"+(12/h);for(var l=0;l<s.length;l++){if(l>=h){g+='</div><div class="row">\n'}g+="<div class="+o+">\n";var t=s[l];var q=HtmlUtil.tag(TAG_A,[ATTR_HREF,t.getEntryUrl()],t.getName());var k=HtmlUtil.image(t.getResourceUrl(),[ATTR_WIDTH,"100%",ATTR_ID,this.getDomId("entry_"+t.getIdForDom()),ATTR_ENTRYID,t.getId(),ATTR_CLASS,"display-entrygallery-entry"]);k=HtmlUtil.href(t.getResourceUrl(),k,["class","popup_image"]);g+=HtmlUtil.div(["class","image-outer"],HtmlUtil.div(["class","image-inner"],k)+HtmlUtil.div(["class","image-caption"],q));g+="</div>\n"}g+="</div>\n";m=g}if(u!=""){if(v>0){m+="<hr>"}m+=u}return m}})}function RamaddaEntrygridDisplay(u,m,h){var w;var n="contents";var k="grid";var e="axis_left";var o="axis_bottom";var d="canvas";var l="top";var c="right";var s="gridsettings";var t="yAxisAscending";var y="scaleHeight";var p="xAxisAscending";var v="xAxisType";var g="yAxisType";var q="scaleWidth";var b="showIcon";var f="showName";var x="boxColor";RamaddaUtil.inherit(this,w=new RamaddaEntryDisplay(u,m,DISPLAY_ENTRY_GRID,h));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{entries:h.entries,initDisplay:function(){var G=this;this.initUI();var B=HtmlUtil.div([ATTR_ID,this.getDomId(n)],this.getLoadingMessage("Loading entries..."));this.setContents(B);if(!this.entryIds){G.jq(n).html(this.getLoadingMessage("No entries specified"));return}var D={entries:this.entryIds};var z=new EntrySearchSettings(D);var C=this.getRamadda().getSearchUrl(z,OUTPUT_JSON,"BAR");var E={entryListChanged:function(R){G.entries=R.getEntries();if(G.entries.length==0){G.jq(n).html(G.getLoadingMessage("No entries selected"));return}G.drag=null;G.jq(n).html(G.makeFramework());G.canvas=$("#"+G.getDomId(d));G.gridPopup=$("#"+G.getDomId(k)+" .display-grid-popup");var T=false;var L=G.jq(o);var H=G.jq(e);var K=function(X){if(T){console.log("mouse down")}G.handledClick=false;G.drag={dragging:false,x:GuiUtils.getEventX(X),y:GuiUtils.getEventY(X),X:{minDate:G.axis.X.minDate?G.axis.X.minDate:G.minDate,maxDate:G.axis.X.maxDate?G.axis.X.maxDate:G.maxDate},Y:{minDate:G.axis.Y.minDate?G.axis.Y.minDate:G.minDate,maxDate:G.axis.Y.maxDate?G.axis.Y.maxDate:G.maxDate}}};var I=function(X){if(T){console.log("mouse leave")}G.drag=null;G.handledClick=false};var O=function(X){if(T){console.log("mouse up")}if(G.drag){if(G.drag.dragging){if(T){console.log("mouse up-was dragging")}G.handledClick=true}G.drag=null}};var Q=function(al,Z,Y){if(T){console.log("mouse move")}var af=G.drag;if(!af){return}af.dragging=true;var ak=GuiUtils.getEventX(al);var ac=af.x-ak;var ai=GuiUtils.getEventY(al);var aa=af.y-ai;var X=$(this).width();var am=$(this).height();var ag=(ak-af.x)/X;var ae=(ai-af.y)/am;var ad=G.getXAxisAscending();var ab=G.getXAxisAscending();var aj=(af.X.maxDate.getTime()-af.X.minDate.getTime())*ag;var ah=(af.Y.maxDate.getTime()-af.Y.minDate.getTime())*ae;if(Z){G.axis.X.minDate=new Date(af.X.minDate.getTime()+((ad?-1:1)*aj));G.axis.X.maxDate=new Date(af.X.maxDate.getTime()+((ad?-1:1)*aj))}if(Y){G.axis.Y.minDate=new Date(af.Y.minDate.getTime()+((ab?1:-1)*ah));G.axis.Y.maxDate=new Date(af.Y.maxDate.getTime()+((ab?1:-1)*ah))}G.makeGrid(G.entries)};var J=function(Y,ab,aa){if(G.handledClick){if(T){console.log("mouse click-other click")}G.handledClick=false;return}if(G.drag&&G.drag.dragging){if(T){console.log("mouse click-was dragging")}G.drag=null;return}if(T){console.log("mouse click")}G.drag=null;var Z;if(Y.metaKey||Y.ctrlKey){Z="reset"}else{var X=Y.shiftKey;if(X){Z="zoomout"}else{Z="zoomin"}}G.doZoom(Z,ab,aa)};var S=function(X){Q(X,true,true)};var P=function(X){Q(X,true,false)};var N=function(X){Q(X,false,true)};var M=function(X){J(X,true,true)};var V=function(X){J(X,true,false)};var U=function(X){J(X,false,true)};G.canvas.mousedown(K);G.canvas.mouseleave(I);G.canvas.mouseup(O);G.canvas.mousemove(S);G.canvas.click(M);L.mousedown(K);L.mouseleave(I);L.mouseup(O);L.mousemove(P);L.click(V);H.mousedown(K);H.mouseleave(I);H.mouseup(O);H.mousemove(N);H.click(U);var W=HtmlUtil.image(icon_zoom,["class","display-grid-action","title","reset zoom","action","reset"])+HtmlUtil.image(icon_zoom_in,["class","display-grid-action","title","zoom in","action","zoomin"])+HtmlUtil.image(icon_zoom_out,["class","display-grid-action","title","zoom out","action","zoomout"]);G.jq(l).html(W);$("#"+G.getDomId(k)+" .display-grid-action").click(function(){var X=$(this).attr("action");G.doZoom(X)});G.jq(e).html("");G.jq(o).html("");G.makeGrid(G.entries)}};var F=new EntryList(this.getRamadda(),C,E,true)},initDialog:function(){w.initDialog.call(this);var C=this;var B=this.jq(s+" :checkbox");console.log(B.size());B.click(function(){C.setProperty($(this).attr("attr"),$(this).is(":checked"));C.makeGrid(C.entries)});var z=this.jq(s+" :input");z.blur(function(){C.setProperty($(this).attr("attr"),$(this).val());C.makeGrid(C.entries)});z.keypress(function(E){var D=(E.keyCode?E.keyCode:E.which);if(D==13){C.setProperty($(this).attr("attr"),$(this).val());C.makeGrid(C.entries)}})},getDialogContents:function(B,D){var z="600";var C="";C+=HtmlUtil.openTag("div",["id",this.getDomId(s)]);C+=HtmlUtil.formTable();C+=HtmlUtil.formEntry("",HtmlUtil.checkbox(this.getDomId(b),["attr",b],this.getProperty(b,"true"))+" Show Icon&nbsp;&nbsp;"+HtmlUtil.checkbox(this.getDomId(f),["attr",f],this.getProperty(f,"true"))+" Show Name");C+=HtmlUtil.formEntry("X-Axis:",HtmlUtil.checkbox(this.getDomId(p),["attr",p],this.getXAxisAscending())+" Ascending&nbsp;&nbsp;"+HtmlUtil.checkbox(this.getDomId(q),["attr",q],this.getXAxisScale())+" Scale Width");C+=HtmlUtil.formEntry("Y-Axis:",HtmlUtil.checkbox(this.getDomId(t),["attr",t],this.getYAxisAscending())+" Ascending&nbsp;&nbsp;"+HtmlUtil.checkbox(this.getDomId(y),["attr",y],this.getYAxisScale())+" Scale Height");C+=HtmlUtil.formEntry("Box Color:",HtmlUtil.input(this.getDomId(x),this.getProperty(x,"lightblue"),["attr",x]));C+=HtmlUtil.formTableClose();C+=HtmlUtil.closeTag("div");B.push("Entry Grid");D.push(C);w.getDialogContents.call(this,B,D)},doZoom:function(E,G,D){if(!Utils.isDefined(G)){G=true}if(!Utils.isDefined(D)){D=true}if(E=="reset"){this.axis.Y.minDate=null;this.axis.Y.maxDate=null;this.axis.X.minDate=null;this.axis.X.maxDate=null}else{var z=(E=="zoomout");if(G){var C=this.axis.X.minDate.getTime();var B=this.axis.X.maxDate.getTime();var H=B-C;var F=(z?1:-1)*H*0.1;this.axis.X.minDate=new Date(C-F);this.axis.X.maxDate=new Date(B+F)}if(D){var C=this.axis.Y.minDate.getTime();var B=this.axis.Y.maxDate.getTime();var H=B-C;var F=(z?1:-1)*H*0.1;this.axis.Y.minDate=new Date(C-F);this.axis.Y.maxDate=new Date(B+F)}}this.makeGrid(this.entries)},initGrid:function(z){var C=this;var B=this.canvas.find(".display-grid-entry");B.click(function(D){var F=parseInt($(this).attr("index"));entry=z[F];var E=entry.getEntryUrl();if(C.urlTemplate){E=C.urlTemplate.replace("{url}",E).replace(/{entryid}/g,entry.getId()).replace(/{resource}/g,entry.getResourceUrl())}C.handledClick=true;C.drag=null;window.open(E,"_entry")});B.mouseout(function(){var E=$(this).attr("entryid");if(E){var D=C.canvas.find("[entryid='"+E+"']");D.each(function(){if($(this).attr("itemtype")=="box"){$(this).attr("prevcolor",$(this).css("background"));$(this).css("background",$(this).attr("prevcolor"))}})}C.gridPopup.hide()});B.mouseover(function(L){var E=$(this).attr("entryid");if(E){var J=C.canvas.find("[entryid='"+E+"']");J.each(function(){if($(this).attr("itemtype")=="box"){$(this).attr("prevcolor",$(this).css("background"));$(this).css("background","rgba(0,0,255,0.5)")}})}var K=GuiUtils.getEventX(L);var I=parseInt($(this).attr("index"));entry=z[I];var D=entry.getThumbnail();var H="";if(D){H=HtmlUtil.image(D,["width","300;"])+"<br>"}else{if(entry.isImage()){H+=HtmlUtil.image(entry.getResourceUrl(),["width","300"])+"<br>"}}H+=entry.getIconImage()+" "+entry.getName()+"<br>";var F=entry.getStartDate().getUTCFullYear()+"-"+Utils.padLeft(entry.getStartDate().getUTCMonth()+1,2,"0")+"-"+Utils.padLeft(entry.getStartDate().getUTCDate(),2,"0");var G=entry.getEndDate().getUTCFullYear()+"-"+Utils.padLeft(entry.getEndDate().getUTCMonth()+1,2,"0")+"-"+Utils.padLeft(entry.getEndDate().getUTCDate(),2,"0");H+="Date: "+F+" - "+G+" UTC";C.gridPopup.html(H);C.gridPopup.show();C.gridPopup.position({of:$(this),at:"left bottom",my:"left top",collision:"none none"});C.gridPopup.position({of:$(this),my:"left top",at:"left bottom",collision:"none none"})})},makeFramework:function(z){var B="";var C="click:zoom in;shift-click:zoom out;command/ctrl click: reset";B+=HtmlUtil.openDiv(["class","display-grid","id",this.getDomId(k)]);B+=HtmlUtil.div(["class","display-grid-popup ramadda-popup"],"");B+=HtmlUtil.openTag("table",["border","0","class","","cellspacing","0","cellspacing","0","width","100%","style","height:100%;"]);B+=HtmlUtil.openTag("tr",["valign","bottom"]);B+=HtmlUtil.tag("td");B+=HtmlUtil.tag("td",[],HtmlUtil.div(["id",this.getDomId(l)],""));B+=HtmlUtil.closeTag("tr");B+=HtmlUtil.openTag("tr",["style","height:100%;"]);B+=HtmlUtil.openTag("td",["style","height:100%;"]);B+=HtmlUtil.openDiv(["class","display-grid-axis-left ramadda-noselect","id",this.getDomId(e)]);B+=HtmlUtil.closeDiv();B+=HtmlUtil.closeDiv();B+=HtmlUtil.closeTag("td");B+=HtmlUtil.openTag("td",["style","height:"+this.getProperty("height","400")+"px"]);B+=HtmlUtil.openDiv(["class","display-grid-canvas ramadda-noselect","id",this.getDomId(d)]);B+=HtmlUtil.closeDiv();B+=HtmlUtil.closeDiv();B+=HtmlUtil.closeTag("td");B+=HtmlUtil.closeTag("tr");B+=HtmlUtil.openTag("tr",[]);B+=HtmlUtil.tag("td",["width","100"],"&nbsp;");B+=HtmlUtil.openTag("td",[]);B+=HtmlUtil.div(["class","display-grid-axis-bottom ramadda-noselect","title",C,"id",this.getDomId(o)],"");B+=HtmlUtil.closeTag("table");B+=HtmlUtil.closeTag("td");return B},getXAxisType:function(){return this.getProperty(v,"date")},getYAxisType:function(){return this.getProperty(g,"month")},getXAxisAscending:function(){return this.getProperty(p,true)},getYAxisAscending:function(){return this.getProperty(t,true)},getXAxisScale:function(){return this.getProperty(q,true)},getYAxisScale:function(){return this.getProperty(y,false)},makeGrid:function(K){var H=this.getProperty(b,true);var J=this.getProperty(f,true);if(!this.minDate){var G=null;var I=null;for(var N=0;N<K.length;N++){var B=K[N];G=G==null?B.getStartDate():(G.getTime()>B.getStartDate().getTime()?B.getStartDate():G);I=I==null?B.getEndDate():(I.getTime()<B.getEndDate().getTime()?B.getEndDate():I)}this.minDate=new Date(Date.UTC(G.getUTCFullYear(),0,1));this.maxDate=new Date(Date.UTC(I.getUTCFullYear()+1,0,1))}var C={width:this.canvas.width(),height:this.canvas.height(),Y:{vertical:true,axisType:this.getYAxisType(),ascending:this.getYAxisAscending(),scale:this.getYAxisScale(),skip:1,maxTicks:Math.ceil(this.canvas.height()/80),minDate:this.minDate,maxDate:this.maxDate,ticks:[],lines:"",html:"",minDate:this.minDate,maxDate:this.maxDate},X:{vertical:false,axisType:this.getXAxisType(),ascending:this.getXAxisAscending(),scale:this.getXAxisScale(),skip:1,maxTicks:Math.ceil(this.canvas.width()/80),minDate:this.minDate,maxDate:this.maxDate,ticks:[],lines:"",html:""}};if(!this.axis){this.axis=C}else{if(this.axis.X.minDate){C.X.minDate=this.axis.X.minDate;C.X.maxDate=this.axis.X.maxDate}else{this.axis.X.minDate=C.X.minDate;this.axis.X.maxDate=C.X.maxDate}if(this.axis.Y.minDate){C.Y.minDate=this.axis.Y.minDate;C.Y.maxDate=this.axis.Y.maxDate}else{this.axis.Y.minDate=C.Y.minDate;this.axis.Y.maxDate=C.Y.maxDate}}if(C.Y.axisType=="size"){this.calculateSizeAxis(C.Y)}else{if(C.Y.axisType=="date"){this.calculateDateAxis(C.Y)}else{this.calculateMonthAxis(C.Y)}}for(var N=0;N<C.Y.ticks.length;N++){var O=C.Y.ticks[N];var P=(C.Y.ascending?"bottom:":"top:")+O.percent+"%;";var P="bottom:"+O.percent+"%;";var Q=O.major?"display-grid-hline-major":"display-grid-hline";C.Y.lines+=HtmlUtil.div(["style",P,"class",Q]," ");C.Y.html+=HtmlUtil.div(["style",P,"class","display-grid-axis-left-tick"],O.label+" "+HtmlUtil.div(["class","display-grid-htick"],""))}if(C.X.axisType=="size"){this.calculateSizeAxis(C.X)}else{if(C.X.axisType=="date"){this.calculateDateAxis(C.X)}else{this.calculateMonthAxis(C.X)}}for(var N=0;N<C.X.ticks.length;N++){var O=C.X.ticks[N];if(O.percent>0){var Q=O.major?"display-grid-vline-major":"display-grid-vline";C.X.lines+=HtmlUtil.div(["style","left:"+O.percent+"%;","class",Q]," ")}C.X.html+=HtmlUtil.div(["style","left:"+O.percent+"%;","class","display-grid-axis-bottom-tick"],HtmlUtil.div(["class","display-grid-vtick"],"")+" "+O.label)}var M="";var z={};for(var N=0;N<K.length;N++){var B=K[N];var R=this[C.Y.calculatePercent].call(this,B,C.Y);var D=this[C.X.calculatePercent].call(this,B,C.X);if(R.p1<0){R.p2=R.p2+R.p1;R.p1=0}if(R.p1+R.p2>100){R.p2=100-R.p1}var P="";var F="";if(C.X.ascending){P+="left:"+D.p1+"%;";F+="left:"+D.p1+"%;"}else{P+="right:"+D.p1+"%;";F+="left:"+(100-D.p2)+"%;"}if(C.X.scale){if(D.delta>1){P+="width:"+D.delta+"%;"}else{P+="width:"+this.getProperty("fixedWidth","5")+"px;"}}var E=F;if(C.Y.ascending){P+=" bottom:"+R.p2+"%;";F+=" bottom:"+R.p2+"%;";E+=" bottom:"+R.p2+"%;"}else{P+=" top:"+R.p2+"%;";F+=" top:"+R.p2+"%;";E+=" top:"+R.p2+"%;";E+="margin-top:-15px;"}if(C.Y.scale){if(R.p2>1){P+="height:"+R.delta+"%;"}else{P+="height:"+this.getProperty("fixedHeight","5")+"px;"}}if(B.getName().includes("rilsd")){console.log("pos:"+E)}if(H){M+=HtmlUtil.div(["class","display-grid-entry-icon display-grid-entry","entryid",B.getId(),"index",N,"style",F],B.getIconImage())}var T=Math.round(D.p1)+"---"+Math.round(R.p1);if(J&&!z[T]){z[T]=true;var S=B.getName().replace(/ /g,"&nbsp;");M+=HtmlUtil.div(["class","display-grid-entry-text display-grid-entry","entryid",B.getId(),"index",N,"style",E],S)}var L=P+"background:"+this.getProperty(x,"lightblue");M+=HtmlUtil.div(["class","display-grid-entry-box display-grid-entry","itemtype","box","entryid",B.getId(),"style",L,"index",N],"")}this.jq(e).html(C.Y.html);this.jq(d).html(C.Y.lines+C.X.lines+M);this.jq(o).html(C.X.html);this.initGrid(K)},calculateSizeAxis:function(B){var D=Number.MAX_VALUE;var z=Number.MIN_VALUE;for(var C=0;C<this.entries.length;C++){var E=this.entries[C];D=Math.min(D,E.getSize());z=Math.max(z,E.getSize())}},checkOrder:function(B,z){return{p1:z.p1,p2:z.p2,delta:Math.abs(z.p2-z.p1)}},calculateDatePercent:function(B,z){var D=100*(B.getStartDate().getTime()-z.min)/z.range;var C=100*(B.getEndDate().getTime()-z.min)/z.range;return this.checkOrder(z,{p1:D,p2:C,delta:Math.abs(C-D)})},calculateMonthPercent:function(E,z){var F=E.getStartDate();var D=E.getEndDate();var C=new Date(Date.UTC(1,F.getUTCMonth(),F.getUTCDate()));var B=new Date(Date.UTC(1,D.getUTCMonth(),D.getUTCDate()));var H=100*((C.getTime()-z.min)/z.range);var G=100*((B.getTime()-z.min)/z.range);if(E.getName().includes("rilsd")){console.log("t1:"+C);console.log("t2:"+B);console.log("before:"+H+" "+G)}return this.checkOrder(z,{p1:H,p2:G,delta:Math.abs(G-H)})},calculateMonthAxis:function(B){B.calculatePercent="calculateMonthPercent";B.minDate=new Date(Date.UTC(0,11,15));B.maxDate=new Date(Date.UTC(1,11,31));B.min=B.minDate.getTime();B.max=B.maxDate.getTime();B.range=B.max-B.min;var z=Utils.getMonthShortNames();for(var E=0;E<z.length;E++){var D=new Date(Date.UTC(1,E));var C=(B.maxDate.getTime()-D.getTime())/B.range;if(B.ascending){C=1-C}B.ticks.push({percent:100*C,label:z[E],major:false})}},calculateDateAxis:function(B){B.calculatePercent="calculateDatePercent";var J=B.maxDate.getUTCFullYear()-B.minDate.getUTCFullYear();var G=J;B.type="year";B.skip=Math.max(1,Math.floor(J/B.maxTicks));if((J/B.skip)<=(B.maxTicks/2)){var O=0;var C=new Date(B.minDate.getTime());while(C.getTime()<B.maxDate.getTime()){Utils.incrementMonth(C);O++}B.skip=Math.max(1,Math.floor(O/B.maxTicks));B.type="month";if((O/B.skip)<=(B.maxTicks/2)){var C=new Date(B.minDate.getTime());var D=0;while(C.getTime()<B.maxDate.getTime()){Utils.incrementDay(C);D++}B.skip=Math.max(1,Math.floor(D/B.maxTicks));B.type="day"}}B.min=B.minDate.getTime();B.max=B.maxDate.getTime();B.range=B.max-B.min;var z=Utils.getMonthShortNames();var E=null;var F=null;var M;if(B.type=="year"){M=new Date(Date.UTC(B.minDate.getUTCFullYear()))}else{if(B.type=="month"){M=new Date(Date.UTC(B.minDate.getUTCFullYear(),B.minDate.getUTCMonth()))}else{M=new Date(Date.UTC(B.minDate.getUTCFullYear(),B.minDate.getUTCMonth(),B.minDate.getUTCDate()))}}while(M.getTime()<B.maxDate.getTime()){var I=(M.getTime()-B.minDate.getTime())/B.range;if(!B.ascending){I=(1-I)}I=100*I;if(I>=0&&I<100){var N="";var L=M.getUTCFullYear();var H=M.getUTCMonth();var K=false;if(B.type=="year"){N=L}else{if(B.type=="month"){N=z[M.getUTCMonth()];if(E!=L){N=N+"<br>"+L;E=L;K=true}}else{N=M.getUTCDate();if(E!=L||F!=H){N=N+"<br>"+z[H]+" "+L;E=L;F=H;K=true}}}B.ticks.push({percent:I,label:N,major:K})}if(B.type=="year"){Utils.incrementYear(M,B.skip)}else{if(B.type=="month"){Utils.incrementMonth(M,B.skip)}else{Utils.incrementDay(M,B.skip)}}}}})}function RamaddaMetadataDisplay(e,d,c){if(c.formOpen==null){c.formOpen=false}var b;RamaddaUtil.inherit(this,b=new RamaddaSearcher(e,d,DISPLAY_METADATA,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{haveDisplayed:false,initDisplay:function(){this.initUI();this.setContents(this.getDefaultHtml());b.initDisplay.apply(this);if(this.haveDisplayed&&this.entryList){this.entryListChanged(this.entryList)}this.haveDisplayed=true},entryListChanged:function(s){this.entryList=s;var C=this.entryList.getEntries();if(C.length==0){this.writeHtml(ID_ENTRIES,"Nothing found");this.writeHtml(ID_RESULTS,"&nbsp;");return}var l=[];var q={};var Q={};for(var M=0;M<C.length;M++){var g=C[M];var B=g.getMetadata();for(var L=0;L<B.length;L++){var I=B[L];if(Q[I.type]==null){Q[I.type]="";l.push(I.type)}q[B[L].type]=B[L].label}}var z="";z+=HtmlUtil.openTag(TAG_TABLE,[ATTR_CLASS,"display-metadata-table",ATTR_WIDTH,"100%","cellpadding","5","cellspacing","0"]);var k=this.findEntryType(this.searchSettings.entryType);var y="Entry";if(k!=null){y=k.getLabel()}this.writeHtml(ID_RESULTS,this.getResultsHeader(C));var E=null;var h=this.getProperty("metadataTypes",null);if(h!=null){E=h.split(",")}else{E=l;E.sort()}var H={"content.pagestyle":true,"content.pagetemplate":true,"content.sort":true,"spatial.polygon":true};var p=[];p.push(HtmlUtil.th([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtil.b(y)));for(var M=0;M<E.length;M++){var k=E[M];if(H[k]){continue}var x=q[E[M]];if(x==null){x=E[M]}p.push(HtmlUtil.th([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtil.b(x)))}var N=HtmlUtil.tr(["valign","bottom"],HtmlUtil.join(p,""));z+=N;var F="<div class=display-metadata-divider></div>";var K=this.missingMessage;if(K=null){K="&nbsp;"}for(var t=0;t<C.length;t++){var g=C[t];var B=g.getMetadata();var v=[];var u=this.getDomId("entrylink"+g.getIdForDom());var w=g.getLink(g.getIconImage()+" "+g.getName());v.push(HtmlUtil.td([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtil.div([ATTR_CLASS,"display-metadata-entrylink"],w)));for(var n=0;n<E.length;n++){var P=E[n];if(H[P]){continue}var f=null;for(var L=0;L<B.length;L++){var I=B[L];if(I.type==P){var O=null;if(I.type=="content.thumbnail"||I.type=="content.logo"){var o=this.getRamadda().getRoot()+"/metadata/view/"+I.value.attr1+"?element=1&entryid="+g.getId()+"&metadata.id="+I.id;O=HtmlUtil.image(o,[ATTR_WIDTH,"100"])}else{if(I.type=="content.url"||I.type=="dif.related_url"){var x=I.value.attr2;if(x==null||x==""){x=I.value.attr1}O=HtmlUtil.href(I.value.attr1,x)}else{if(I.type=="content.attachment"){var G=I.value.attr1.split("_file_");var J=G[1];var o=this.getRamadda().getRoot()+"/metadata/view/"+I.value.attr1+"?element=1&entryid="+g.getId()+"&metadata.id="+I.id;O=HtmlUtil.href(o,J)}else{O=I.value.attr1;if(I.value.attr2&&I.value.attr2.trim().length>0){O+=" - "+I.value.attr2}}}}if(O!=null){if(f==null){f=""}else{f+=F}f+=HtmlUtil.div([ATTR_CLASS,"display-metadata-item"],O)}}}if(f==null){f=K}if(f==null){f=""}var D=HtmlUtil.tag(TAG_A,[ATTR_STYLE,"color:#000;",ATTR_HREF,this.getRamadda().getRoot()+"/metadata/addform?entryid="+g.getId()+"&metadata.type="+P,"target","_blank","alt","Add metadata",ATTR_TITLE,"Add metadata"],"+");D=HtmlUtil.div(["class","display-metadata-table-add"],D);var R=D+F;if(f.length>0){R+=f}v.push(HtmlUtil.td([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtil.div([ATTR_CLASS,"display-metadata-table-cell-contents"],R)))}z+=HtmlUtil.tr(["valign","top"],HtmlUtil.join(v,""));if(((t+1)%10)==0){z+=N}}z+=HtmlUtil.closeTag(TAG_TABLE);this.jq(ID_ENTRIES).html(z)}})}function RamaddaTimelineDisplay(e,d,c){if(c.formOpen==null){c.formOpen=false}var b;RamaddaUtil.inherit(this,b=new RamaddaSearcher(e,d,DISPLAY_TIMELINE,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){this.initUI();this.setContents(this.getDefaultHtml());b.initDisplay.apply(this)},entryListChanged:function(m){this.entryList=m;var f=this.entryList.getEntries();var h="";if(f.length==0){this.writeHtml(ID_ENTRIES,"Nothing found");this.writeHtml(ID_RESULTS,"&nbsp;");return}var l={timeline:{headline:"The Main Timeline Headline Goes here",type:"default",text:"<p>Intro body text goes here, some HTML is ok</p>",asset:{media:"http://yourdomain_or_socialmedialink_goes_here.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"},date:[{startDate:"2011,12,10",endDate:"2011,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional",classname:"optionaluniqueclassnamecanbeaddedhere",asset:{media:"http://twitter.com/ArjunaSoriano/status/164181156147900416",thumbnail:"optional-32x32px.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"}},{startDate:"2012,12,10",endDate:"2012,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional",classname:"optionaluniqueclassnamecanbeaddedhere",asset:{media:"http://twitter.com/ArjunaSoriano/status/164181156147900416",thumbnail:"optional-32x32px.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"}},{startDate:"2013,12,10",endDate:"2013,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional",classname:"optionaluniqueclassnamecanbeaddedhere",asset:{media:"http://twitter.com/ArjunaSoriano/status/164181156147900416",thumbnail:"optional-32x32px.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"}}],era:[{startDate:"2011,12,10",endDate:"2011,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional"}]}};for(var g=0;g<f.length;g++){var k=f[g]}createStoryJS({type:"timeline",width:"800",height:"600",source:l,embed_id:this.getDomId(ID_ENTRIES)})}})}function RamaddaEntrydisplayDisplay(g,f,c){var b;$.extend(this,{sourceEntry:c.sourceEntry});RamaddaUtil.inherit(this,b=new RamaddaDisplay(g,f,DISPLAY_ENTRYDISPLAY,c));if(c.sourceEntry==null&&c.entryId!=null){var e=this;var d=function(h){var k=h[0];e.sourceEntry=k;e.initDisplay()};c.sourceEntry=this.getEntry(c.entryId,d)}addRamaddaDisplay(this);$.extend(this,{selectedEntry:null,initDisplay:function(){this.initUI();var k=this.title;if(this.sourceEntry!=null){this.addEntryHtml(this.sourceEntry);var h=this.sourceEntry.getEntryUrl();if(k==null){k=this.sourceEntry.getName()}k=HtmlUtil.tag("a",["href",h,"title",this.sourceEntry.getName(),"alt",this.sourceEntry.getName()],k)}else{this.addEntryHtml(this.selectedEntry);if(k==null){k="Entry Display"}}this.setDisplayTitle(k)},handleEventEntrySelection:function(m,h){if(this.sourceEntry!=null){return}var k=h.selected;var l=h.entry;if(!k){if(this.selectedEntry!=l){return}this.selectedEntry=null;this.setContents("");return}this.selectedEntry=l;this.addEntryHtml(this.selectedEntry)},getEntries:function(){return[this.sourceEntry]},addEntryHtml:function(k){if(k==null){this.setContents("&nbsp;");return}var h=this.getEntryHtml(k,{showHeader:false});this.setContents(h);this.entryHtmlHasBeenDisplayed(k)}})}function RamaddaOperandsDisplay(h,g,d){var e=TAG_SELECT;var c="select1";var b="select2";var f="newdisplay";$.extend(this,new RamaddaEntryDisplay(h,g,DISPLAY_OPERANDS,d));addRamaddaDisplay(this);$.extend(this,{baseUrl:null,initDisplay:function(){this.initUI();this.baseUrl=this.getRamadda().getSearchUrl(this.searchSettings,OUTPUT_JSON);if(this.entryList==null){this.entryList=new EntryList(this.getRamadda(),jsonUrl,this)}var k="";k+=HtmlUtil.div([ATTR_ID,this.getDomId(ID_ENTRIES),ATTR_CLASS,this.getClass("entries")],"");this.setContents(k)},entryListChanged:function(k){var o="<form>";o+="<p>";o+=HtmlUtil.openTag(TAG_TABLE,[ATTR_CLASS,"formtable","cellspacing","0","cellspacing","0"]);var p=this.entryList.getEntries();var l=this.getGet();for(var m=1;m<=2;m++){var s=HtmlUtil.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(e+m)]);s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],"-- Select --");for(var n=0;n<p.length;n++){var t=p[n];var q=t.getIconImage()+" "+t.getName();s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,t.getName(),ATTR_VALUE,t.getId()],t.getName())}s+=HtmlUtil.closeTag(TAG_SELECT);o+=HtmlUtil.formEntry("Data:",s)}var s=HtmlUtil.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(ID_CHARTTYPE)]);s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"linechart"],"Line chart");s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"barchart"],"Bar chart");s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"barstack"],"Stacked bars");s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"bartable"],"Bar table");s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"piechart"],"Pie chart");s+=HtmlUtil.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"scatterplot"],"Scatter Plot");s+=HtmlUtil.closeTag(TAG_SELECT);o+=HtmlUtil.formEntry("Chart Type:",s);o+=HtmlUtil.closeTag(TAG_TABLE);o+="<p>";o+=HtmlUtil.tag(TAG_DIV,[ATTR_CLASS,"display-button",ATTR_ID,this.getDomId(f)],"New Chart");o+="<p>";o+="</form>";this.writeHtml(ID_ENTRIES,o);var u=this;this.jq(f).button().click(function(v){u.createDisplay()})},createDisplay:function(){var p=this.getEntry(this.jq(c).val());var o=this.getEntry(this.jq(b).val());if(p==null){alert("No data selected");return}var n=[];n.push(new PointData(p.getName(),null,null,ramaddaBaseUrl+"/entry/show?&output=points.product&product=points.json&numpoints=1000&entryid="+p.getId()));if(o!=null){n.push(new PointData(o.getName(),null,null,ramaddaBaseUrl+"/entry/show?&output=points.product&product=points.json&numpoints=1000&entryid="+o.getId()))}var l="average";var m=new DerivedPointData(this.displayManager,"Derived Data",n,l);var k=m;var q=this.jq(ID_CHARTTYPE).val();h.createDisplay(q,{layoutFixed:false,data:k})}})}function RamaddaRepositoriesDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaEntryDisplay(d,c,DISPLAY_REPOSITORIES,b));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){var e=this;this.initUI();var h="";if(this.ramaddas.length==0){h+=this.getMessage("No repositories specified")}else{h+=this.getMessage("Loading repository listing")}this.numberWithTypes=0;this.finishedInitDisplay=false;if(this.ramaddas.length>1){if(this.ramaddas[this.ramaddas.length-1].getRoot()=="all"){this.ramaddas.splice(this.ramaddas.length-1,1)}}for(var g=0;g<this.ramaddas.length;g++){if(g==0){}var k=this.ramaddas[g];var f=k.getEntryTypes(function(m,l){e.gotTypes(m,l)});if(f!=null){this.numberWithTypes++}}this.setDisplayTitle("Repositories");this.setContents(h);this.finishedInitDisplay=true;this.displayRepositories()},displayRepositories:function(){if(!this.finishedInitDisplay||this.numberWithTypes!=this.ramaddas.length){return}var B={};var v=[];var w="";w+=HtmlUtil.openTag(TAG_TABLE,[ATTR_CLASS,"display-repositories-table",ATTR_WIDTH,"100%",ATTR_BORDER,"1","cellspacing","0","cellpadding","5"]);for(var z=0;z<this.ramaddas.length;z++){var C=this.ramaddas[z];var x=C.getEntryTypes();for(var q=0;q<x.length;q++){var g=x[q];if(B[g.getId()]==null){B[g.getId()]=g;v.push(g)}}}w+=HtmlUtil.openTag(TAG_TR,["valign","bottom"]);w+=HtmlUtil.th([ATTR_CLASS,"display-repositories-table-header"],"Type");for(var z=0;z<this.ramaddas.length;z++){var C=this.ramaddas[z];var m=HtmlUtil.href(C.getRoot(),C.getName());w+=HtmlUtil.th([ATTR_CLASS,"display-repositories-table-header"],m)}w+="</tr>";var p=[];if(this.categories!=null){p=this.categories.split(",")}var u={};var t=[];for(var q=0;q<v.length;q++){var g=v[q];var l="";l+="<tr>";l+=HtmlUtil.td([],HtmlUtil.image(g.getIcon())+" "+g.getLabel());for(var z=0;z<this.ramaddas.length;z++){var C=this.ramaddas[z];var e=C.getEntryType(g.getId());var h="";if(e==null){l+=HtmlUtil.td([ATTR_CLASS,"display-repositories-table-type-hasnot"],"")}else{var o=HtmlUtil.tag(TAG_A,["href",C.getRoot()+"/search/type/"+e.getId(),"target","_blank"],e.getEntryCount());l+=HtmlUtil.td([ATTR_ALIGN,"right",ATTR_CLASS,"display-repositories-table-type-has"],o)}}l+="</tr>";var f=u[g.getCategory()];if(f==null){f=[];u[g.getCategory()]=f;t.push(g.getCategory())}f.push(l)}for(var z=0;z<t.length;z++){var k=t[z];if(p.length>0){var y=false;for(var n=0;n<p.length;n++){if(k==p[n]){y=true;break}if(k.match(p[n])){y=true;break}}if(!y){continue}}var s=u[k];w+="<tr>";w+=HtmlUtil.th(["colspan",""+(1+this.ramaddas.length)],k);w+="</tr>";for(var l=0;l<s.length;l++){w+=s[l]}}w+=HtmlUtil.closeTag(HtmlUtil.TAG_TABLE);this.setContents(w)},gotTypes:function(f,e){this.numberWithTypes++;this.displayRepositories()}})}var RamaddaGalleryDisplay=RamaddaEntrygalleryDisplay;function RamaddaExampleDisplay(f,e,c){var b="click";var d="data";RamaddaUtil.inherit(this,new RamaddaDisplay(f,e,"example",c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){this.initUI();var g=this.getGet();var h="<p>";h+=HtmlUtil.onClick(g+".click();",HtmlUtil.div([ATTR_ID,this.getDomId(b)],"Click me"));h+="<p>";h+=HtmlUtil.div([ATTR_ID,this.getDomId(d)],"");this.setContents(h);this.updateUI()},needsData:function(){return true},updateUI:function(){var g=this.getData();if(g==null){return}var k=g.getRecordFields();var h=g.getRecords();var l="";l+="#records:"+h.length;this.jq(d).html(l)},handleEventRecordSelection:function(h,g){},click:function(){this.jq(b).html("Click again")}})}var PROP_LAYOUT_TYPE="layoutType";var PROP_LAYOUT_COLUMNS="layoutColumns";var PROP_SHOW_MAP="showMap";var PROP_SHOW_MENU="showMenu";var PROP_FROMDATE="fromDate";var PROP_TODATE="toDate";function addDisplayManager(b){if(window.globalDisplayManagers==null){window.globalDisplayManagers={}}window.globalDisplayManagers[b.getId()]=b;window.globalDisplayManager=b}function addGlobalDisplayType(b){if(window.globalDisplayTypes==null){window.globalDisplayTypes=[]}window.globalDisplayTypes.push(b)}function getOrCreateDisplayManager(e,b,c){if(!c){var d=getDisplayManager(e);if(d!=null){return d}if(window.globalDisplayManager!=null){return window.globalDisplayManager}}var d=new DisplayManager(e,b);if(window.globalDisplayManager==null){window.globalDisplayManager=d}return d}function getDisplayManager(c){if(window.globalDisplayManagers==null){return null}var b=window.globalDisplayManagers[c];return b}var ID_DISPLAYS="displays";function DisplayManager(argId,argProperties){var ID_MENU_BUTTON="menu_button";var ID_MENU_OUTER="menu_outer";var ID_MENU_INNER="menu_inner";RamaddaUtil.inherit(this,this.SUPER=new DisplayThing(argId,argProperties));addRamaddaDisplay(this);RamaddaUtil.initMembers(this,{dataList:[],displayTypes:[],initMapBounds:null});if(window.globalDisplayTypes!=null){for(var i=0;i<window.globalDisplayTypes.length;i++){this.displayTypes.push(window.globalDisplayTypes[i])}}RamaddaUtil.defineMembers(this,{group:new DisplayGroup(this,argId,argProperties),showmap:this.getProperty(PROP_SHOW_MAP,null),setDisplayReady:function(){SUPER.setDisplayReadyCall(this);console.log("displaymanager.displayReady");this.getLayoutManager().setDisplayReady()},addDisplayType:function(type,label){this.displayTypes.push({type:label})},getLayoutManager:function(){return this.group},collectEntries:function(){var entries=this.getLayoutManager().collectEntries();return entries},getData:function(){return this.dataList},handleEventFieldsSelected:function(source,fields){this.notifyEvent("handleEventFieldsSelected",source,fields)},handleEventEntriesChanged:function(source,entries){this.notifyEvent("handleEventEntriesChanged",source,entries)},handleEventMapBoundsChanged:function(source,bounds,forceSet){var args={bounds:bounds,force:forceSet};this.notifyEvent("handleEventMapBoundsChanged",source,args)},addMapLayer:function(source,entry){this.notifyEvent("addMapLayer",source,{entry:entry})},handleEventMapClick:function(mapDisplay,lon,lat){var indexObj=[];var records=null;for(var i=0;i<this.dataList.length;i++){var pointData=this.dataList[i];records=pointData.getRecords();if(records!=null){break}}var indexObj=[];var closest=RecordUtil.findClosest(records,lon,lat,indexObj);if(closest!=null){this.propagateEventRecordSelection(mapDisplay,pointData,{index:indexObj.index})}this.notifyEvent("handleEventMapClick",mapDisplay,{mapDisplay:mapDisplay,lon:lon,lat:lat})},propagateEventRecordSelection:function(source,pointData,args){var index=args.index;if(pointData==null&&this.dataList.length>0){pointData=this.dataList[0]}var fields=pointData.getRecordFields();var records=pointData.getRecords();if(records==null){return}if(index<0||index>=records.length){console.log("propagateEventRecordSelection: bad index= "+index);return}var record=records[index];if(record==null){return}var values=this.getRecordHtml(record,fields);if(source.recordSelectionCallback){var func=source.recordSelectionCallback;if((typeof func)=="string"){func=window[func]}func({display:source,pointData:pointData,index:index,pointRecord:record})}var params={index:index,record:record,html:values,data:pointData};this.notifyEvent("handleEventRecordSelection",source,params);var entries=source.getEntries();if(entries!=null&&entries.length>0){this.handleEventEntrySelection(source,{entry:entries[0],selected:true})}},handleEventEntrySelection:function(source,props){this.notifyEvent("handleEventEntrySelection",source,props)},handleEventEntryMouseover:function(source,props){this.notifyEvent("handleEventEntryMouseover",source,props)},handleEventEntryMouseout:function(source,props){this.notifyEvent("handleEventEntryMouseout",source,props)},handleEventPointDataLoaded:function(source,pointData){this.notifyEvent("handleEventPointDataLoaded",source,pointData)},ranges:{},setRange:function(field,range){if(this.ranges[field.getId()]==null){this.ranges[field.getId()]=range}},getRange:function(field){return this.ranges[field.getId()]},makeMainMenu:function(){if(!this.getProperty(PROP_SHOW_MENU,true)){return""}var get="getDisplayManager('"+this.getId()+"')";var layout="getDisplayManager('"+this.getId()+"').getLayoutManager()";var html="";var newMenus={};var cats=[];var chartMenu="";for(var i=0;i<this.displayTypes.length;i++){var type=this.displayTypes[i];if(Utils.isDefined(type.forUser)&&!type.forUser){continue}var category=type.category;if(category==null){category="Misc"}if(newMenus[category]==null){newMenus[category]="";cats.push(category)}newMenus[category]+=HtmlUtil.tag(TAG_LI,[],HtmlUtil.tag(TAG_A,["onclick",get+".userCreateDisplay('"+type.type+"');"],type.label))}var newMenu="";for(var i=0;i<cats.length;i++){var cat=cats[i];if(cat=="Charts"){chartMenu=newMenus[cat]}var subMenu=HtmlUtil.tag("ul",[],newMenus[cat]);var catLabel=HtmlUtil.tag(TAG_A,[],cat);newMenu+=HtmlUtil.tag(TAG_LI,[],catLabel+subMenu)}var publishMenu=HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".publish('media_photoalbum');","New Photo Album"))+"\n"+HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".publish('wikipage');","New Wiki Page"))+"\n"+HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".publish('blogentry');","New Blog Post"))+"\n";var fileMenu=HtmlUtil.tag(TAG_LI,[],"<a>Publish</a>"+HtmlUtil.tag("ul",[],publishMenu))+"\n"+HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".copyDisplayedEntries();","Save entries"))+"\n";var titles=HtmlUtil.tag(TAG_DIV,["class","ramadda-menu-block"],"Titles: "+HtmlUtil.onClick(layout+".titlesOn();","On")+"/"+HtmlUtil.onClick(layout+".titlesOff();","Off"));var dates=HtmlUtil.tag(TAG_DIV,["class","ramadda-menu-block"],"Set date range: "+HtmlUtil.onClick(layout+".askMinDate();","Min")+"/"+HtmlUtil.onClick(layout+".askMaxDate();","Max"));var editMenu=HtmlUtil.tag(TAG_LI,[],HtmlUtil.tag(TAG_DIV,["class","ramadda-menu-block"],"Set axis range :"+HtmlUtil.onClick(layout+".askMinZAxis();","Min")+"/"+HtmlUtil.onClick(layout+".askMaxZAxis();","Max")))+HtmlUtil.tag(TAG_LI,[],dates)+HtmlUtil.tag(TAG_LI,[],titles)+"\n"+HtmlUtil.tag(TAG_LI,[],HtmlUtil.tag(TAG_DIV,["class","ramadda-menu-block"],"Details: "+HtmlUtil.onClick(layout+".detailsOn();","On",[])+"/"+HtmlUtil.onClick(layout+".detailsOff();","Off",[])))+HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".deleteAllDisplays();","Delete all displays"))+"\n";var table=HtmlUtil.tag(TAG_DIV,["class","ramadda-menu-block"],"Table: "+HtmlUtil.onClick(layout+".setLayout('table',1);","1 column")+" / "+HtmlUtil.onClick(layout+".setLayout('table',2);","2 column")+" / "+HtmlUtil.onClick(layout+".setLayout('table',3);","3 column")+" / "+HtmlUtil.onClick(layout+".setLayout('table',4);","4 column"));var layoutMenu=HtmlUtil.tag(TAG_LI,[],table)+HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".setLayout('rows');","Rows"))+"\n"+HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".setLayout('columns');","Columns"))+"\n"+HtmlUtil.tag(TAG_LI,[],HtmlUtil.onClick(layout+".setLayout('tabs');","Tabs"));var menuBar=HtmlUtil.tag(TAG_LI,[],"<a>File</a>"+HtmlUtil.tag("ul",[],fileMenu));if(chartMenu!=""){menuBar+=HtmlUtil.tag(TAG_LI,[],"<a>Charts</a>"+HtmlUtil.tag("ul",[],chartMenu))}menuBar+=HtmlUtil.tag(TAG_LI,[],"<a>Edit</a>"+HtmlUtil.tag("ul",[],editMenu))+HtmlUtil.tag(TAG_LI,[],"<a>New</a>"+HtmlUtil.tag("ul",[],newMenu))+HtmlUtil.tag(TAG_LI,[],"<a>Layout</a>"+HtmlUtil.tag("ul",[],layoutMenu));var menu=HtmlUtil.div([ATTR_CLASS,"ramadda-popup",ATTR_ID,this.getDomId(ID_MENU_OUTER)],HtmlUtil.tag("ul",[ATTR_ID,this.getDomId(ID_MENU_INNER),ATTR_CLASS,"sf-menu"],menuBar));html+=menu;html+=HtmlUtil.tag(TAG_A,[ATTR_CLASS,"display-menu-button",ATTR_ID,this.getDomId(ID_MENU_BUTTON)],"&nbsp;");return html},hasGeoMacro:function(jsonUrl){return jsonUrl.match(/(\${latitude})/g)!=null},getJsonUrl:function(jsonUrl,display,props){var fromDate=display.getProperty(PROP_FROMDATE);if(fromDate!=null){jsonUrl+="&fromdate="+fromDate}var toDate=display.getProperty(PROP_TODATE);if(toDate!=null){jsonUrl+="&todate="+toDate}if(this.hasGeoMacro(jsonUrl)){var lon=props.lon;var lat=props.lat;if((lon==null||lat==null)&&this.map!=null){var tuple=this.getPosition();if(tuple!=null){lat=tuple[0];lon=tuple[1]}}if(lon!=null&&lat!=null){jsonUrl=jsonUrl.replace("${latitude}",lat.toString());jsonUrl=jsonUrl.replace("${longitude}",lon.toString())}}jsonUrl=jsonUrl.replace("${numpoints}",1000);return jsonUrl},getDefaultData:function(){for(var i in this.dataList){var data=this.dataList[i];var records=data.getRecords();if(records!=null){return data}}if(this.dataList.length>0){return this.dataList[0]}return null},writeDisplay:function(){if(this.originalLocation==null){this.originalLocation=document.location}var url=this.originalLocation+"#";url+="&display0=linechart";for(var attr in document){}document.location=url},userCreateDisplay:function(type,props){if(props==null){props={}}props.editMode=true;if(type==DISPLAY_LABEL&&props.text==null){var text=prompt("Text");if(text==null){return}props.text=text}return this.createDisplay(type,props)},createDisplay:function(type,props){if(props==null){props={}}if(props.data!=null){var haveItAlready=false;for(var i=0;i<this.dataList.length;i++){var existingData=this.dataList[i];if(existingData.equals(props.data)){props.data=existingData;haveItAlready=true;break}}if(!haveItAlready){this.dataList.push(props.data)}}var proc=type.substring(0,1).toUpperCase()+type.substring(1);var classname=null;var names=["Ramadda"+proc+"Display",proc+"Display",proc];var func=null;var funcName=null;var msg="";for(var i=0;i<names.length;i++){msg+=("trying:"+names[i]+"\n");if(window[names[i]]!=null){funcName=names[i];func=window[names[i]];break}}if(func==null){console.log("Error: could not find display function:"+type);alert("Error: could not find display function:"+type+" msg: "+msg);return}var displayId=this.getUniqueId("display");if(props.data==null&&this.dataList.length>0){props.data=this.dataList[0]}props.createdInteractively=true;if(!props.entryId){props.entryId=this.group.entryId}var display=eval(" new "+funcName+"(this,'"+displayId+"', props);");if(display==null){console.log("Error: could not create display using:"+funcName);alert("Error: could not create display using:"+funcName);return}this.addDisplay(display);return display},pageHasLoaded:function(display){this.getLayoutManager().pageHasLoaded()},addDisplay:function(display){display.setDisplayManager(this);display.loadInitialData();this.getLayoutManager().addDisplay(display)},notifyEvent:function(func,source,data){this.getLayoutManager().notifyEvent(func,source,data)},removeDisplay:function(display){this.getLayoutManager().removeDisplay(display);this.notifyEvent("handleEventRemoveDisplay",this,display)}});addDisplayManager(this);var displaysHtml=HtmlUtil.div([ATTR_ID,this.getDomId(ID_DISPLAYS),ATTR_CLASS,"display-container"]);var html=HtmlUtil.openTag(TAG_DIV);html+=this.makeMainMenu();var targetDiv=this.getProperty("target");var _this=this;if(targetDiv!=null){$(document).ready(function(){$("#"+targetDiv).html(displaysHtml);_this.getLayoutManager().doLayout()})}else{html+=displaysHtml}html+=HtmlUtil.closeTag(TAG_DIV);$("#"+this.getId()).html(html);if(this.showmap){this.createDisplay("map")}var theDisplayManager=this;$("#"+this.getDomId(ID_MENU_BUTTON)).button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-s"}}).click(function(event){var id=theDisplayManager.getDomId(ID_MENU_OUTER);showPopup(event,theDisplayManager.getDomId(ID_MENU_BUTTON),id,false,null,"left bottom");$("#"+theDisplayManager.getDomId(ID_MENU_INNER)).superfish({speed:"fast",delay:300})})}var DISPLAY_MAP="map";var displayMapMarkers=["marker.png","marker-blue.png","marker-gold.png","marker-green.png"];var displayMapCurrentMarker=-1;var displayMapUrlToVectorListeners={};var displayMapMarkerIcons={};function displayMapGetMarkerIcon(){displayMapCurrentMarker++;if(displayMapCurrentMarker>=displayMapMarkers.length){displayMapCurrentMarker=0}return ramaddaBaseUrl+"/lib/openlayers/v2/img/"+displayMapMarkers[displayMapCurrentMarker]}addGlobalDisplayType({type:DISPLAY_MAP,label:"Map"});function MapFeature(c,b){RamaddaUtil.defineMembers(this,{source:c,points:b})}function RamaddaMapDisplay(k,h,d){var f="latfield";var g="lonfield";var c="map";var e="bottom";var b;RamaddaUtil.defineMembers(this,{showLocationReadout:false,showBoxes:true,showPercent:false,percentFields:null,kmlLayer:null,kmlLayerName:"",geojsonLayer:null,geojsonLayerName:"",theMap:null});RamaddaUtil.inherit(this,b=new RamaddaDisplay(k,h,DISPLAY_MAP,d));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initBounds:k.initMapBounds,mapBoundsSet:false,features:[],myMarkers:{},mapEntryInfos:{},sourceToLine:{},sourceToPoints:{},snarf:true,initDisplay:function(){this.initUI();var q=this;var m="";var o="min-height:200px;";var n=this.getWidth();if(Utils.isDefined(n)){if(n>0){o+="width:"+n+"px; "}else{if(n!=""){o+="width:"+n+";"}}}var l=this.getProperty("height",300);if(l>0){o+=" height:"+l+"px; "}m+=HtmlUtil.div([ATTR_CLASS,"display-map-map","style",o,ATTR_ID,this.getDomId(c)]);m+=HtmlUtil.div([ATTR_CLASS,"",ATTR_ID,this.getDomId(e)]);if(this.showLocationReadout){m+=HtmlUtil.openTag(TAG_DIV,[ATTR_CLASS,"display-map-latlon"]);m+=HtmlUtil.openTag("form");m+="Latitude: "+HtmlUtil.input(this.getDomId(f),"",["size","7",ATTR_ID,this.getDomId(f)]);m+="  ";m+="Longitude: "+HtmlUtil.input(this.getDomId(g),"",["size","7",ATTR_ID,this.getDomId(g)]);m+=HtmlUtil.closeTag("form");m+=HtmlUtil.closeTag(TAG_DIV)}this.setContents(m);if(!this.map){this.createMap()}else{this.map.setMapDiv(this.getDomId(c))}if(!this.haveCalledUpdateUI){var p=function(){q.updateUI()};setTimeout(p,1)}},createMap:function(){var x=this;var n={defaultMapLayer:this.getProperty("defaultMapLayer",map_default_layer)};var w=this.getProperty("displayDiv",null);if(w){n.displayDiv=w}var m=this.getProperty("mapLayers",null);if(m){n.mapLayers=[m]}this.map=this.getProperty("theMap",null);if(this.map){this.map.setMapDiv(this.getDomId(c))}else{this.map=new RepositoryMap(this.getDomId(c),n)}if(this.doDisplayMap()){this.map.setDefaultCanSelect(false)}this.map.initMap(false);this.map.addRegionSelectorControl(function(B){x.getDisplayManager().handleEventMapBoundsChanged(this,B,true)});this.map.addClickHandler(this.getDomId(g),this.getDomId(f),null,this);this.map.map.events.register("zoomend","",function(){x.mapBoundsChanged()});this.map.map.events.register("moveend","",function(){x.mapBoundsChanged()});if(this.initBounds!=null){var v=this.initBounds;this.setInitMapBounds(v.north,v.west,v.south,v.east)}var z=this.features;this.features=[];for(var p=0;p<z.length;p++){this.addFeature(z[p])}var s=this.getDisplayManager().collectEntries();for(var p=0;p<s.length;p++){var o=s[p];this.handleEventEntriesChanged(o.source,o.entries)}if(this.layerEntries){var q=function(B){_this.handleLayerSelect(B)};var u=function(B){_this.handleLayerUnselect(B)};var t=this.layerEntries.split(",");for(var p=0;p<t.length;p++){var y=t[p];var l=ramaddaBaseUrl+"/entry/show?output=shapefile.kml&entryid="+y;this.map.addKMLLayer("layer",l,true,q,u)}}if(x.kmlLayer!=null){var l=ramaddaBaseUrl+"/entry/show?output=shapefile.kml&entryid="+x.kmlLayer;x.addBaseMapLayer(l,true)}if(x.geojsonLayer!=null){l=x.getRamadda().getEntryDownloadUrl(x.geojsonLayer);x.addBaseMapLayer(l,false)}},addBaseMapLayer:function(m,n){var l=this;mapLoadInfo=displayMapUrlToVectorListeners[m];if(mapLoadInfo==null){mapLoadInfo={otherMaps:[],layer:null};selectFunc=function(o){l.mapFeatureSelected(o)};if(n){this.map.addKMLLayer(this.kmlLayerName,m,this.doDisplayMap(),selectFunc,null,null,function(p,o){l.baseMapLoaded(o,m)})}else{this.map.addGeoJsonLayer(this.geojsonLayerName,m,this.doDisplayMap(),selectFunc,null,null,function(p,o){l.baseMapLoaded(o,m)})}}else{if(mapLoadInfo.layer){this.cloneLayer(mapLoadInfo.layer)}else{this.map.showLoadingImage();mapLoadInfo.otherMaps.push(this)}}},mapFeatureSelected:function(l){if(!this.getPointData()){return}this.map.onFeatureSelect(l);if(!Utils.isDefined(l.feature.dataIndex)){return}this.getDisplayManager().propagateEventRecordSelection(this,this.getPointData(),{index:l.feature.dataIndex})},doDisplayMap:function(){var l=(this.kmlLayer!=null||this.geojsonLayer!=null)&&((""+this.getProperty("displayAsMap",""))=="true");return l},cloneLayer:function(o){var n=this;this.map.hideLoadingImage();o=o.clone();var p=o.features;var q=[];for(var m=0;m<p.length;m++){feature=p[m];feature=feature.clone();if(feature.style){oldStyle=feature.style;feature.style={};for(var l in oldStyle){feature.style[l]=oldStyle[l]}}feature.layer=o;q.push(feature)}o.removeAllFeatures();this.map.map.addLayer(o);o.addFeatures(q);this.vectorLayer=o;this.applyVectorMap();this.map.addSelectCallback(o,this.doDisplayMap(),function(s){n.mapFeatureSelected(s)})},baseMapLoaded:function(n,l){this.vectorLayer=n;this.applyVectorMap();mapLoadInfo=displayMapUrlToVectorListeners[l];if(mapLoadInfo){mapLoadInfo.layer=n;for(var m=0;m<mapLoadInfo.otherMaps.length;m++){mapLoadInfo.otherMaps[m].cloneLayer(n)}mapLoadInfo.otherMaps=[]}},handleLayerSelect:function(u){var x=this.layerSelectArgs;if(!this.layerSelectPath){if(!x){this.map.onFeatureSelect(u);return}this.layerSelectPath="/search/do"}var l=ramaddaBaseUrl+this.layerSelectPath;if(x){var w=x.split(",");for(var s=0;s<w.length;s++){var D=w[s];var q=D.split(":");var z=q[0];var B=q[1];var C=u.feature.attributes;var m=null;for(var v in C){var y=""+v;if(y==B){var t=null;if(typeof C[v]=="object"||typeof C[v]=="Object"){var n=C[v];t=n.value}else{t=C[v]}l=HtmlUtil.appendArg(l,z,t);l=l.replace("${"+z+"}",t)}}}}l=HtmlUtil.appendArg(l,"output","json");console.log("Doing search: "+l);var p=new EntryList(this.getRamadda(),l,null,false);p.doSearch(this);this.getEntryList().showMessage("Searching",HtmlUtil.div([ATTR_STYLE,"margin:20px;"],this.getWaitImage()))},getEntryList:function(){if(!this.entryListDisplay){var l={showMenu:true,showTitle:true,showDetails:true,layoutHere:false,showForm:false,doSearch:false};var m=this.getUniqueId("display");this.entryListDisplay=new RamaddaEntrylistDisplay(this.getDisplayManager(),m,l);this.getDisplayManager().addDisplay(this.entryListDisplay)}return this.entryListDisplay},entryListChanged:function(m){var l=m.getEntries();this.getEntryList().entryListChanged(m)},handleLayerUnselect:function(l){this.map.onFeatureUnselect(l)},addMapLayer:function(l,u){var q=this;var v=u.entry;if(!this.addedLayers){this.addedLayers={}}if(this.addedLayers[v.getId()]){var p=this.addedLayers[v.getId()];if(p){this.map.removeKMLLayer(p);this.addedLayers[v.getId()]=null}return}if(v.getType().getId()=="geo_shapefile"){var m=createBounds(v.getWest(),v.getSouth(),v.getEast(),v.getNorth());if(m.left<-180||m.right>180||m.bottom<-90||m.top>90){console.log("entry has bad bounds:"+v.getName()+" "+m);return}var o=function(w){q.handleLayerSelect(w)};var t=function(w){q.handleLayerUnselect(w)};var n=ramaddaBaseUrl+"/entry/show?output=shapefile.kml&entryid="+v.getId();var p=this.map.addKMLLayer(v.getName(),n,true,o,t);this.addedLayers[v.getId()]=p;m=this.map.transformLLBounds(m);this.map.map.zoomToExtent(m,true);return}var s=v.getAttributeValue("base_url");if(!Utils.stringDefined(s)){console.log("No base url:"+v.getId());return}var p=v.getAttributeValue("layer_name");if(p==null){p=v.getName()}console.log("layer:"+p);this.map.addWMSLayer(v.getName(),s,p,false)},mapBoundsChanged:function(){var l=this.map.map.calculateBounds();l=l.transform(this.map.sourceProjection,this.map.displayProjection);this.getDisplayManager().handleEventMapBoundsChanged(this,l)},addFeature:function(l){this.features.push(l);l.line=this.map.addPolygon("lines_"+l.source.getId(),RecordUtil.clonePoints(l.points),null)},xloadInitialData:function(){if(this.getDisplayManager().getData().length>0){this.handleEventPointDataLoaded(this,this.getDisplayManager().getData()[0])}},getContentsDiv:function(){return HtmlUtil.div([ATTR_CLASS,"display-contents",ATTR_ID,this.getDomId(ID_DISPLAY_CONTENTS)],"")},handleEventEntryMouseover:function(m,l){h=l.entry.getId()+"_mouseover";attrs={lineColor:"red",fillColor:"red",fillOpacity:0.5,lineOpacity:0.5,doCircle:true,lineWidth:1,fill:true,circle:{lineColor:"black"},polygon:{lineWidth:4}};this.addOrRemoveEntryMarker(h,l.entry,true,attrs)},handleEventEntryMouseout:function(m,l){h=l.entry.getId()+"_mouseover";this.addOrRemoveEntryMarker(h,l.entry,false)},handleEventAreaClear:function(){this.map.clearRegionSelector()},handleClick:function(l,n,m){if(this.doDisplayMap()){return}this.getDisplayManager().handleEventMapClick(this,n,m)},getPosition:function(){var l=$("#"+this.getDomId(f)).val();var m=$("#"+this.getDomId(g)).val();if(l==null){return null}return[l,m]},setInitMapBounds:function(o,l,n,m){if(!this.map){return}this.map.centerOnMarkers(new OpenLayers.Bounds(l,n,m,o))},sourceToEntries:{},handleEventEntriesChanged:function(m,t){if(m==this.lastSource){this.map.clearSelectionMarker()}if((typeof m.forMap)!="undefined"&&!m.forMap){return}var u=this.sourceToEntries[m.getId()];if(u!=null){for(var s=0;s<u.length;s++){var o=m.getId()+"_"+u[s].getId();this.addOrRemoveEntryMarker(o,u[s],false)}}this.sourceToEntries[m.getId()]=t;var p=new OpenLayers.Layer.Markers("Markers");var B=new OpenLayers.Layer.Vector("Lines",{});var q=-90,y=180,v=90,w=-180;var z=false;for(var s=0;s<t.length;s++){var x=t[s];var o=m.getId()+"_"+x.getId();var n=this.addOrRemoveEntryMarker(o,t[s],true);if(x.hasBounds()){if(x.getNorth()>90||x.getSouth()<-90||x.getEast()>180||x.getWest()<-180){console.log("bad bounds on entry:"+x.getName()+" "+x.getNorth()+" "+x.getSouth()+" "+x.getEast()+" "+x.getWest());continue}q=Math.max(q,x.getNorth());v=Math.min(v,x.getSouth());w=Math.max(w,x.getEast());y=Math.min(y,x.getWest());z=true}}var l=(z?createBounds(y,v,w,q):null);this.map.centerOnMarkers(l,true)},handleEventEntrySelection:function(o,l){var p=this;var n=l.entry;if(n==null){this.map.clearSelectionMarker();return}var m=l.selected;if(!n.hasLocation()){return}},addOrRemoveEntryMarker:function(n,u,y,q){if(!q){q={}}var p={lineColor:u.lineColor,fillColor:u.lineColor,lineWidth:u.lineWidth,doCircle:false,doRectangle:this.showBoxes,fill:false,fillOpacity:0.75,pointRadius:12,polygon:{},circle:{}};dfltPolygon={};dfltCircle={};$.extend(p,q);if(!p.lineColor){p.lineColor="blue"}$.extend(dfltPolygon,p);if(q.polygon){$.extend(dfltPolygon,q.polygon)}$.extend(dfltCircle,p);if(q.circle){$.extend(dfltCircle,q.circle)}var m=this.mapEntryInfos[n];if(!y){if(m!=null){m.removeFromMap(this.map);this.mapEntryInfos[n]=null}}else{if(m==null){m=new MapEntryInfo(u);this.mapEntryInfos[n]=m;if(u.hasBounds()&&p.doRectangle){var w={};m.rectangle=this.map.addRectangle(n,u.getNorth(),u.getWest(),u.getSouth(),u.getEast(),w)}var s=u.getLatitude();var l=u.getLongitude();if(s<-90||s>90||l<-180||l>180){return}var t=new OpenLayers.LonLat(l,s);if(p.doCircle){w={pointRadius:dfltCircle.pointRadius,stroke:true,strokeColor:dfltCircle.lineColor,strokeWidth:dfltCircle.lineWidth,fillColor:dfltCircle.fillColor,fillOpacity:dfltCircle.fillOpacity,fill:dfltCircle.fill};m.circle=this.map.addPoint(n,t,w)}else{m.marker=this.map.addMarker(n,t,u.getIconUrl(),"",this.getEntryHtml(u))}if(u.polygon){var v=[];for(var o=0;o<u.polygon.length;o+=2){v.push(new OpenLayers.Geometry.Point(u.polygon[o+1],u.polygon[o]))}var w={strokeColor:dfltPolygon.lineColor,strokeWidth:Utils.isDefined(dfltPolygon.lineWidth)?dfltPolygon.lineWidth:2};m.polygon=this.map.addPolygon(n,u.getName(),v,w,m.marker)}var x=this;if(m.marker){m.marker.entry=u;m.marker.ramaddaClickHandler=function(z){x.handleMapClick(z)};if(this.handledMarkers==null){this.map.centerToMarkers();this.handledMarkers=true}}}return m}},handleMapClick:function(l){if(this.selectedMarker!=null){this.getDisplayManager().handleEventEntrySelection(this,{entry:this.selectedMarker.entry,selected:false})}this.getDisplayManager().handleEventEntrySelection(this,{entry:l.entry,selected:true});this.selectedMarker=l},getDisplayProp:function(m,n,l){if(Utils.isDefined(this[n])){return this[n]}n="map-"+n;if(Utils.isDefined(m[n])){return m[n]}return m.getProperty(n,l)},applyVectorMap:function(){if(this.vectorMapApplied){return}if(!this.doDisplayMap()){return}if(!this.vectorLayer){return}if(!this.points){return}this.vectorMapApplied=true;var p=this.vectorLayer.features.slice();var u=this.points;for(var s=0;s<u.length;s++){var o=u[s];var n=o.center;var t=null;var v=-1;for(var q=0;q<p.length;q++){var x=p[q];var w=x.geometry;if(!w){break}bounds=w.getBounds();if(!bounds.contains(n.x,n.y)){continue}if(w.components){for(var m=0;m<w.components.length;m++){comp=w.components[m];bounds=comp.getBounds();if(!bounds.contains(n.x,n.y)){continue}if(comp.containsPoint&&comp.containsPoint(n)){t=x;v=q;break}}if(t){break}continue}if(!w.containsPoint){console.log("unknown geometry:"+w.CLASS_NAME);continue}if(w.containsPoint(n)){t=x;v=q;break}}if(t){p.splice(v,1);style=t.style;if(!style){style={stylename:"from display"}}$.extend(style,o.style);t.style=style;t.popupText=o.text;t.dataIndex=s}}if((""+this.getProperty("pruneFeatures",""))=="true"){this.vectorLayer.removeFeatures(p);var l=this.vectorLayer.getDataExtent();bounds=this.map.transformProjBounds(l);this.map.centerOnMarkers(bounds,true)}this.vectorLayer.redraw()},needsData:function(){return true},updateUI:function(){this.haveCalledUpdateUI=true;b.updateUI.call(this);if(!this.getDisplayReady()){console.log("not ready");return}if(!this.hasData()){return}var R=this.getPointData();var P=R.getRecords();if(P==null){err=new Error();console.log("null records:"+err.stack);return}var I=R.getRecordFields();var w={};var N=RecordUtil.getPoints(P,w);if(isNaN(w.north)){console.log("no bounds:"+w);return}this.initBounds=w;this.setInitMapBounds(w.north,w.west,w.south,w.east);if(this.map==null){return}if(N.length==0){console.log("points.legnth==0");return}source=this;var q=parseFloat(this.getDisplayProp(source,"radius",8));var H=parseFloat(this.getDisplayProp(source,"strokeWidth","1"));var K=this.getDisplayProp(source,"strokeColor","#000");var E=this.getDisplayProp(source,"colorBy",null);var y=this.getColorTable();var z=this.getDisplayProp(source,"sizeBy",null);var p=this.getDisplayProp(source,"isTrajectory",false);if(p){this.map.addPolygon("id",N,null,null);return}if(!y&&source.colors&&source.colors.length>0){y=source.colors;if(y.length==1&&Utils.ColorTables[y[0]]){y=Utils.ColorTables[y[0]]}}if(y==null){y=Utils.ColorTables.grayscale}var P=R.getRecords();var S={id:E,minValue:0,maxValue:0,field:null,index:-1};var T={id:this.getDisplayProp(source,"sizeBy",null),minValue:0,maxValue:0,field:null,index:-1};for(var O=0;O<I.length;O++){var n=I[O];if(n.getId()==S.id||("#"+(O+1))==S.id){S.field=n}if(n.getId()==T.id||("#"+(O+1))==T.id){T.field=n}}T.index=T.field!=null?T.field.getIndex():-1;S.index=S.field!=null?S.field.getIndex():-1;var u=this.getProperty(PROP_EXCLUDE_ZERO,false);for(var O=0;O<N.length;O++){var U=P[O];var G=U.getData();var D=G[S.index];if(u&&D==0){continue}if(O==0||D>S.maxValue){S.maxValue=D}if(O==0||D<S.minValue){S.minValue=D}D=G[T.index];if(O==0||D>T.maxValue){T.maxValue=D}if(O==0||D<T.minValue){T.minValue=D}}if(this.showPercent){S.minValue=0;S.maxValue=100}S.minValue=this.getDisplayProp(source,"colorByMin",S.minValue);S.maxValue=this.getDisplayProp(source,"colorByMax",S.maxValue);var C=this.doDisplayMap();var Q=false;for(var O=0;O<N.length;O++){var U=P[O];var L=N[O];var o={pointRadius:q,strokeWidth:H,strokeColor:K};if(T.index>=0){var J=U.getData()[T.index];var m=(T.maxValue-T.minValue);var l=(m==0?NaN:(J-T.minValue)/m);o.pointRadius=6+parseInt(15*l)}if(S.index>=0){var J=U.getData()[S.index];var l=0;var s="";var x=null;if(this.percentFields!=null){x=this.percentFields.split(",")}if(this.showPercent){var W=0;var V=U.getData();var s="";for(var M=0;M<V.length;M++){var F=I[M].isNumeric&&!I[M].isFieldGeo();if(F&&x!=null){F=x.indexOf(I[M].getId())>=0||x.indexOf("#"+(M+1))>=0}if(F){W+=V[M];s+=" "+V[M]}}if(W!=0){percent0=l=J/W*100;l=(l-S.minValue)/(S.maxValue-S.minValue)}}else{l=(J-S.minValue)/(S.maxValue-S.minValue)}var t=parseInt(l*y.length);if(t>=y.length){t=y.length-1}else{if(t<0){t=0}}o.fillOpacity=0.8;o.fillColor=y[t];Q=true}var B=this.getRecordHtml(U,I);L=this.map.addPoint("pt-"+O,L,o,B,C);if(!this.points){this.points=[]}this.points.push(L)}if(Q){this.displayColorTable(e,S.minValue,S.maxValue)}this.applyVectorMap()},handleEventRemoveDisplay:function(n,o){var m=this.mapEntryInfos[o];if(m!=null){m.removeFromMap(this.map)}var l=this.findFeature(o,true);if(l!=null){if(l.line!=null){this.map.removePolygon(l.line)}}},findFeature:function(o,n){for(var m in this.features){var l=this.features[m];if(l.source==o){if(n){this.features.splice(m,1)}return l}}return null},handleEventRecordSelection:function(s,o){var n=o.record;if(n.hasLocation()){var t=n.getLatitude();var q=n.getLongitude();if(t<-90||t>90||q<-180||q>180){return}var l=new OpenLayers.LonLat(q,t);var m=this.myMarkers[s];if(m!=null){this.map.removeMarker(m)}var p=displayMapMarkerIcons[s];if(p==null){p=displayMapGetMarkerIcon();displayMapMarkerIcons[s]=p}this.myMarkers[s]=this.map.addMarker(s.getId(),l,p,"",o.html,null,24)}}})}function MapEntryInfo(b){RamaddaUtil.defineMembers(this,{entry:b,marker:null,rectangle:null,removeFromMap:function(c){if(this.marker!=null){c.removeMarker(this.marker)}if(this.rectangle!=null){c.removePolygon(this.rectangle)}if(this.polygon!=null){c.removePolygon(this.polygon)}if(this.circle!=null){c.removePoint(this.circle)}}})}function RamaddaXlsDisplay(x,o,k){var t="xaxis";var s="yaxis";var e="group";var w="search";var g="table";var l="searchextra";var h="searchheader";var p="results";var v="downloadurl";var q="tablecontents";var f="searchdiv";var m="searchform";var b="searchtext";var n="tableholder";var c="table";var d="charttoolbar";var u="chart";RamaddaUtil.inherit(this,new RamaddaDisplay(x,o,"xls",k));addRamaddaDisplay(this);this.url=k.url;this.tableProps={fixedRowsTop:0,fixedColumnsLeft:0,rowHeaders:true,colHeaders:true,headers:null,skipRows:0,skipColumns:0};if(k!=null){$.extend(this.tableProps,k)}RamaddaUtil.defineMembers(this,{initDisplay:function(){this.initUI();this.setDisplayTitle("Table Data");var y=HtmlUtil.div(["id",this.getDomId(h)])+HtmlUtil.div(["id",this.getDomId(n)])+HtmlUtil.div(["id",this.getDomId(d)])+HtmlUtil.div(["id",this.getDomId(u)]);this.setContents(y);this.loadTableData(this.url)}});RamaddaUtil.defineMembers(this,{currentSheet:0,currentData:null,columnLabels:null,startRow:0,groupIndex:-1,xAxisIndex:-1,yAxisIndex:-1,header:null,cellSelected:function(D,z){this.startRow=D;if(this.jq("params-xaxis-select").attr("checked")){this.xAxisIndex=z}else{if(this.jq("params-group-select").attr("checked")){this.groupIndex=z}else{this.yAxisIndex=z}}var y="";var C="";var B="";this.setAxisLabel(t,this.getHeading(this.xAxisIndex,true));this.setAxisLabel(e,this.getHeading(this.groupIndex,true));this.setAxisLabel(s,this.getHeading(this.yAxisIndex,true))},getAxisLabelId:function(y){return"params-"+y+"-label"},setAxisLabel:function(y,z){y=this.getAxisLabelId(y);var B=HtmlUtil.getUniqueId();if(z.length>25){z=z.substring(0,25)+"..."}if(z.trim()!=""){z=HtmlUtil.span(["id",B,"class","ramadda-tag-box"],"&nbsp;&nbsp;"+z+"&nbsp;&nbsp;")}this.jq(y).html(z)},loadSheet:function(D){var H=$("[id^="+this.getDomId("sheet_")+"]");var y=$("#"+this.getDomId("sheet_")+D);H.css("font-weight","normal");y.css("font-weight","bold");H.css("border","1px #ccc solid");y.css("border","1px #666 solid");this.currentSheet=D;var F=this.sheets[D];if(F){var I=F.rows.slice(0);if(I.length>0){this.header=I[0]}}var C="";var E=this;var G={contextMenu:true,stretchH:"all",colHeaders:true,rowHeaders:true,minSpareRows:1,afterSelection:function(){if(arguments.length>2){for(var K=0;K<arguments.length;K++){}var L=arguments[0];var J=arguments[1];E.cellSelected(L,J)}}};$.extend(G,this.tableProps);if(this.tableProps.useFirstRowAsHeader){var z=I[0];G.colHeaders=z;I=I.splice(1)}for(var B=0;B<this.tableProps.skipRows;B++){I=I.splice(1)}if(I.length==0){this.displayMessage("No data found");this.jq(p).html("");return}this.jq(p).html("Found: "+I.length);G.data=I;this.currentData=I;if(this.tableProps.headers!=null){G.colHeaders=this.tableProps.headers}if(this.getProperty("showTable",true)){this.jq(c).handsontable(G)}},getDataForSheet:function(E,y){var B=this.sheets[E];var C=B.rows.slice(0);if(C.length>0){this.header=C[0]}if(this.tableProps.useFirstRowAsHeader){var D=C[0];if(y){y.colHeaders=D}C=C.splice(1)}for(var z=0;z<this.tableProps.skipRows;z++){C=C.splice(1)}return C},makeChart:function(G,E){if(typeof google=="undefined"){this.jq(u).html("No google chart available");return}if(E==null){E={}}var F=Utils.getDefined(E.xAxisIndex,this.xAxisIndex);var D=Utils.getDefined(E.groupIndex,this.groupIndex);var P=Utils.getDefined(E.yAxisIndex,this.yAxisIndex);if(P<0){alert("You must select a y-axis field.\n\nSelect the desired axis with the radio button.\n\nClick the column in the table to chart.");return}var z=this.currentSheet;if(!(typeof E.sheet=="undefined")){z=E.sheet}var I=this.getDataForSheet(z);if(I==null){this.jq(u).html("There is no data");return}var I=I.slice(1);for(var T=0;T<this.startRow-1;T++){I=I.slice(1)}var J=[];console.log("x:"+F+"  y:"+P+" group:"+D);for(var C=0;C<I.length;C++){var H=[];var O=0;if(F>=0){H.push(I[C][F])}else{H.push(C)}if(P>=0){H.push(I[C][P])}J.push(H);if(C<2){console.log("row:"+H)}}I=J;for(var C=0;C<I.length;C++){var L=I[C];for(var N=0;N<L.length;N++){var R=L[N]+"";L[N]=parseFloat(R.trim())}}var y=this.getHeading(F,true);var W=this.getHeading(P,true);var V=this.getHeading(D,true);this.columnLabels=[y,W];var U=this.columnLabels!=null?this.columnLabels:["Field 1","Field 2"];I.splice(0,0,U);var M=google.visualization.arrayToDataTable(I);var S={};var Q="95%";$.extend(S,{legend:{position:"top"}});if(this.header!=null){if(F>=0){S.hAxis={title:this.header[F]}}if(P>=0){S.vAxis={title:this.header[P]}}}var K=HtmlUtil.getUniqueId();var B=["id",K];if(G=="scatterplot"){B.push("style");B.push("width: 450px; height: 450px;")}this.jq(u).append(HtmlUtil.div(B));if(G=="barchart"){S.chartArea={left:75,top:10,height:"60%",width:Q};S.orientation="horizontal";this.chart=new google.visualization.BarChart(document.getElementById(K))}else{if(G=="table"){this.chart=new google.visualization.Table(document.getElementById(K))}else{if(G=="motion"){this.chart=new google.visualization.MotionChart(document.getElementById(K))}else{if(G=="scatterplot"){S.chartArea={left:50,top:30,height:400,width:400};S.legend="none";S.axisTitlesPosition="in";this.chart=new google.visualization.ScatterChart(document.getElementById(K))}else{$.extend(S,{lineWidth:1});S.chartArea={left:75,top:10,height:"60%",width:Q};this.chart=new google.visualization.LineChart(document.getElementById(K))}}}}if(this.chart!=null){this.chart.draw(M,S)}},addNewChartListener:function(z,y){var B=this;$("#"+z+"-"+y).button().click(function(C){console.log("make chart:"+y);B.makeChart(y)})},makeSheetButton:function(B,y){var z=this;$("#"+B).button().click(function(C){z.loadSheet(y)})},clear:function(){this.jq(u).html("");this.startRow=0;this.groupIndex=-1;this.xAxisIndex=-1;this.yAxisIndex=-1;this.setAxisLabel(e,"");this.setAxisLabel(t,"");this.setAxisLabel(s,"")},getHeading:function(B,y){if(B<0){return""}if(this.header!=null&&B>=0&&B<this.header.length){var z=this.header[B];z=z.trim();if(z.length>0){return z}}if(y){return"Field "+(B+1)}return""},showTableData:function(V){var Q=this;this.data=V;this.sheets=this.data.sheets;this.columns=V.columns;var S="";for(var z=0;z<this.sheets.length;z++){var M=this.getDomId("sheet_"+z);S+=HtmlUtil.div(["id",M,"class","ramadda-xls-button-sheet"],this.sheets[z].name);S+="\n"}var J="12";var N='<table width=100% style="max-width:1000px;" > ';if(this.sheets.length>1){J="10"}N+="<tr valign=top>";if(this.sheets.length>1){N+=HtmlUtil.td(["width","110"],HtmlUtil.div(["class","ramadda-xls-buttons"],S));J="10"}var O=HtmlUtil.getUniqueId();var U=this.getProperty("tableWidth","");var W=this.getProperty("tableHeight","300px");var T="";if(U!=""){T+=" width:"+U+";"}T+=" height: "+W+";";T+=" overflow: auto;";N+=HtmlUtil.td([],HtmlUtil.div(["id",this.getDomId(c),"class","ramadda-xls-table","style",T]));N+="</tr>";N+="</table>";var B="";var L=["barchart","linechart","scatterplot"];for(var R=0;R<L.length;R++){B+=HtmlUtil.div(["id",O+"-"+L[R],"class","ramadda-xls-button"],"Make "+L[R]);B+="&nbsp;"}B+="&nbsp;";B+=HtmlUtil.div(["id",this.getDomId("removechart"),"class","ramadda-xls-button"],"Clear Charts");B+="<p>";B+="<form>Fields: ";B+='<input type=radio checked name="param" id="'+this.getDomId("params-yaxis-select")+'"> y-axis:&nbsp;'+HtmlUtil.div(["id",this.getDomId("params-yaxis-label"),"style","border-bottom:1px #ccc dotted;min-width:10em;display:inline-block;"],"");B+="&nbsp;&nbsp;&nbsp;";B+='<input type=radio  name="param" id="'+this.getDomId("params-xaxis-select")+'"> x-axis:&nbsp;'+HtmlUtil.div(["id",this.getDomId("params-xaxis-label"),"style","border-bottom:1px #ccc dotted;min-width:10em;display:inline-block;"],"");B+="&nbsp;&nbsp;&nbsp;";B+='<input type=radio  name="param" id="'+this.getDomId("params-group-select")+'"> group:&nbsp;'+HtmlUtil.div(["id",this.getDomId("params-group-label"),"style","border-bottom:1px #ccc dotted;min-width:10em;display:inline-block;"],"");B+="</form>";if(this.getProperty("showSearch",true)){var P=HtmlUtil.div(["style","display:inline-block;","id",this.getDomId(p)],"");var D=HtmlUtil.div(["style","display:inline-block;","id",this.getDomId(v)]);var H=HtmlUtil.div(["id",this.getDomId(f),"class","ramadda-xls-search-form"]);var I="";I+=HtmlUtil.openTag("form",["action","#","id",this.getDomId(m)]);I+=HtmlUtil.image(icon_tree_closed,["id",this.getDomId(w+"_open")]);I+="\n";I+=HtmlUtil.input(b,this.jq(b).val(),["size","60","id",this.getDomId(b),"placeholder","Search"]);I+="<input type=submit name='' style='display:none;'>";I+=HtmlUtil.openTag("div",["id",this.getDomId(l),"class","ramadda-xls-search-extra"],"");if(this.columns){var C=HtmlUtil.openTag("table",["class","formtable"]);for(var R=0;R<this.columns.length;R++){var G=this.columns[R];var M=g+"_"+G.name;var E=HtmlUtil.input(M,this.jq(M).val(),["id",this.getDomId(M),"placeholder","Search"]);C+=HtmlUtil.formEntry(G.name.replace("_"," ")+":",E)}C+=HtmlUtil.closeTag("table");I+=C}if(this.searchFields){var C=HtmlUtil.openTag("table",["class","formtable"]);for(var R=0;R<this.searchFields.length;R++){var G=this.searchFields[R];var M=g+"_"+G.name;var E=HtmlUtil.input(M,this.jq(M).val(),["id",this.getDomId(M),"placeholder","Search"]);C+=HtmlUtil.formEntry(G.label+":",E)}C+=HtmlUtil.closeTag("table");I+=C}I+="\n";I+=HtmlUtil.closeTag("div");I+="\n";I+=HtmlUtil.closeTag("form");this.jq(h).html(HtmlUtil.leftRight(H,P+" "+D));this.jq(f).html(I);if(!this.extraOpen){this.jq(l).hide()}this.jq(w+"_open").button().click(function(X){Q.jq(l).toggle();Q.extraOpen=!Q.extraOpen;if(Q.extraOpen){Q.jq(w+"_open").attr("src",icon_tree_open)}else{Q.jq(w+"_open").attr("src",icon_tree_closed)}})}if(this.getProperty("showTable",true)){this.jq(n).html(N);B+="<br>";if(this.getProperty("showChart",true)){this.jq(d).html(B)}}if(this.getProperty("showSearch",true)){this.jq(m).submit(function(X){X.preventDefault();Q.loadTableData(Q.url,"Searching...")});this.jq(b).focus();this.jq(b).select()}for(var R=0;R<L.length;R++){this.addNewChartListener(O,L[R])}this.jq("removechart").button().click(function(X){Q.clear()});for(var z=0;z<this.sheets.length;z++){var M=this.getDomId("sheet_"+z);this.makeSheetButton(M,z)}var z=0;var F=/sheet=([^&]+)/g;var y=F.exec(window.location.search);if(y){z=y[1]}this.loadSheet(z);if(this.defaultCharts){for(var R=0;R<this.defaultCharts.length;R++){var K=this.defaultCharts[R];this.makeChart(K.type,K)}}this.setAxisLabel("params-yaxis-label",this.getHeading(this.yAxisIndex,true));this.displayDownloadUrl()},displayMessage:function(B,z){if(!z){z=icon_information}var y=HtmlUtil.hbox(HtmlUtil.image(z,["align","left"]),HtmlUtil.inset(B,10,10,5,10));y=HtmlUtil.div(["class","note"],y);this.jq(n).html(y)},displayDownloadUrl:function(){var z=this.lastUrl;if(z==null){this.jq(v).html("");return}z=z.replace("xls_json","media_tabular_extractsheet");z+="&execute=true";var y=HtmlUtil.image(ramaddaBaseUrl+"/icons/xls.png",["title","Download XLSX"]);this.jq(v).html(HtmlUtil.href(z,y))},loadTableData:function(z,C){this.url=z;if(!C){C=this.getLoadingMessage()}this.displayMessage(C,icon_progress);var G=this;var E=this.jq(b).val();if(E&&E!=""){z=z+"&table.text="+encodeURIComponent(E)}if(this.columns){for(var B=0;B<this.columns.length;B++){var y=this.columns[B];var F=g+"_"+y.name;var E=this.jq(F).val();if(E){z=z+"&table."+y.name+"="+encodeURIComponent(E)}}}if(this.searchFields){for(var B=0;B<this.searchFields.length;B++){var y=this.searchFields[B];var F=g+"_"+y.name;var E=this.jq(F).val();if(E){z=z+"&table."+y.name+"="+encodeURIComponent(E)}}}console.log("url:"+z);this.lastUrl=z;var D=$.getJSON(z,function(H){if(GuiUtils.isJsonError(H)){G.displayMessage("Error: "+H.error);return}G.showTableData(H)}).fail(function(J,K,H){var I=K+", "+H;G.displayMessage("An error occurred: "+H);console.log("JSON error:"+I)})}})};