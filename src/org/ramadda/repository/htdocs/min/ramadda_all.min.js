var build_date="RAMADDA build date: Tue Jul 25 20:54:04 MDT 2023",root=ramaddaBaseUrl,urlroot=ramaddaBaseUrl,icon_close="fas fa-window-close",icon_pin="fas fa-thumbtack",icon_help="fas fa-question-circle",icon_command=ramaddaCdn+"/icons/command.png",icon_rightarrow=ramaddaCdn+"/icons/grayrightarrow.gif",icon_downdart=ramaddaCdn+"/icons/downdart.gif",icon_rightdart=ramaddaCdn+"/icons/rightdart.gif",icon_progress=ramaddaCdn+"/icons/progress.gif",icon_wait=ramaddaCdn+"/icons/wait.gif",icon_information=ramaddaCdn+"/icons/information.png",icon_folderclosed=ramaddaCdn+"/icons/folderclosed.png",icon_folderopen=ramaddaCdn+"/icons/togglearrowdown.gif",icon_folderclosed="fas fa-caret-right",icon_folderopen="fas fa-caret-down",icon_tree_open=ramaddaCdn+"/icons/togglearrowdown.gif",icon_tree_closed=ramaddaCdn+"/icons/togglearrowright.gif",icon_zoom=ramaddaCdn+"/icons/magnifier.png",icon_zoom_in=ramaddaCdn+"/icons/magnifier_zoom_in.png",icon_zoom_out=ramaddaCdn+"/icons/magnifier_zoom_out.png",icon_menuarrow=ramaddaCdn+"/icons/downdart.gif",icon_blank16=ramaddaCdn+"/icons/blank16.png",icon_blank=ramaddaCdn+"/icons/blank.gif",icon_menu=ramaddaCdn+"/icons/menu.png",icon_trash="fas fa-trash-alt",UNIT_FT="ft",UNIT_MILES="mi",UNIT_KM="km",UNIT_M="m",UNIT_NM="nm";function noop(){}function addHandler(t,e){return null==window.globalHandlers&&(window.globalHandlers={}),e||(e=HtmlUtils.getUniqueId()),window.globalHandlers[e]=t,e}function getHandler(t){return t&&null!=window.globalHandlers?window.globalHandlers[t]:null}var Utils={me:"Utils",pageLoaded:!1,loadFunctions:[],mouseMoveCnt:0,mouseIsDown:!1,entryGroups:new Array,groupList:new Array,tooltipObject:null,entryDragInfo:null,globalEntryRows:{},defineGlobal:function(t,e){Utils.isDefined(window[t])||(window[t]=e)},clone:function(){if(0==arguments.length)return{};let t=arguments[0]?$.extend({},arguments[0]):{};for(let e=1;e<arguments.length;e++)arguments[e]&&(t=$.extend(t,arguments[e]));return t},throttle:function(t,e){let n=0;return function(...i){clearTimeout(n),n=setTimeout((()=>{t.apply(this,i)}),e)}},initPage:function(){this.initContent(),this.pageLoaded=!0,this.initDisplays(),document.onmousemove=Utils.handleMouseMove,document.onmousedown=Utils.handleMouseDown,document.onmouseup=Utils.handleMouseUp,document.onkeypress=Utils.handleKeyPress,$(document).delegate("textarea","keydown",(function(t){if(9==(t.keyCode||t.which)){t.preventDefault();var e=this.selectionStart,n=this.selectionEnd;$(this).val($(this).val().substring(0,e)+"\t"+$(this).val().substring(n)),this.selectionStart=this.selectionEnd=e+1}})),Utils.loadFunctions.forEach((t=>{t()}))},addLoadFunction:function(t){Utils.loadFunctions.push(t)},getLocalStorage:function(t,e){try{let n=localStorage.getItem(ramaddaBaseEntry+"."+t);return null!==n&&e?JSON.parse(n):n}catch(e){return console.log("Error getting local storage. key="+t),null}},setLocalStorage:function(t,e,n){e&&n&&(e=JSON.stringify(e)),localStorage.setItem(ramaddaBaseEntry+"."+t,e),console.log("writing"+e)},getFileTail:function(t){try{return new URL(t).pathname.replace(/.*\/([^\/]+)$/g,"$1")}catch(t){return null}},isImage:function(t){return!!t&&t.search(/(\.png|\.jpg|\.jpeg|\.gif|\.webp|\.heic)/i)>=0},initDragAndDrop:function(t,e,n,i,a,r){t.attr("contenteditable",!0),t.on("dragover",(n=>{n.stopPropagation(),n.preventDefault(),t.addClass("ramadda-drop-active"),e&&e(n)})),t.on("dragleave",(t=>{n&&n(t)})),t.on("drop",(e=>{t.removeClass("ramadda-drop-active"),e.stopPropagation(),e.preventDefault();let n=e.originalEvent.target.files||e.originalEvent.dataTransfer.files;for(let t=0;t<n.length;t++){let e=n[t];if(!e)continue;if(a)if("string"==typeof a){if(!e.type.match(a))continue}else if(!a(e))continue;let r=new FileReader;r.onload=t=>{i&&i(t,e,t.target.result,!0)},r.readAsDataURL(e)}})),t.on("paste",(t=>{let e=(t.clipboardData||t.originalEvent.clipboardData).items;for(let n=0;n<e.length;n++){let a=e[n];if("string"==a.kind){if(!r)continue;if("text/plain"!=a.type)continue;a.getAsString((e=>{i&&i(t,a,e,!1)}));continue}if("file"!=a.kind)continue;t.stopPropagation(),t.preventDefault();let l=new FileReader;l.onload=t=>{i&&i(t,a,t.target.result,!1)};let s=a.getAsFile();l.readAsDataURL(s);break}}))},isPost:function(){let t=$("#request-method");return 0!=t.length&&"POST"==t.attr("content")},max:function(t,e){return isNaN(t)?e:isNaN(e)?t:Math.max(t,e)},min:function(t,e){return isNaN(t)?e:isNaN(e)?t:Math.min(t,e)},toRadians:function(t){return t*Math.PI/180},toDegrees:function(t){return 180*t/Math.PI},distance:function(t,e,n,i){return Math.hypot(n-t,i-e)},reverseBearing:function(t,e,n){n/=6371,e=Utils.toRadians(e);var i=Utils.toRadians(t.lat),a=Utils.toRadians(t.lon),r=Math.asin(Math.sin(i)*Math.cos(n)+Math.cos(i)*Math.sin(n)*Math.cos(e)),l=a+Math.atan2(Math.sin(e)*Math.sin(n)*Math.cos(i),Math.cos(n)-Math.sin(i)*Math.sin(r));return isNaN(r)||isNaN(l)?null:MapUtils.createLonLat(Utils.toDegrees(l),Utils.toDegrees(r))},getBearing:function(t,e){let n=Utils.toRadians(t.lat),i=Utils.toRadians(t.lon),a=Utils.toRadians(e.lat),r=Utils.toRadians(e.lon),l=Math.cos(a)*Math.sin(r-i),s=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(r-i),o=Math.atan2(l,s);return o=Utils.toDegrees(o),o=(o+360)%360,o},isReturnKey:function(t){return 13==(t.keyCode||t.which)},getBounds:function(t){if(!t)return null;let e=null,n=null,i=null,a=null;return t.forEach((t=>{e=null===e?t[0]:Math.min(e,t[0]),n=null===n?t[0]:Math.max(n,t[0]),i=null===i?t[1]:Math.min(i,t[1]),a=null===a?t[1]:Math.max(a,t[1])})),{getWidth:function(){return this.maxx-this.minx},getHeight:function(){return this.maxy-this.miny},getCenter:function(){return{x:this.minx+(this.maxx-this.minx)/2,y:this.miny+(this.maxy-this.miny)/2}},minx:e,maxx:n,miny:i,maxy:a}},mergeBounds(t,e){if(null==t)return e;if(null==e)return t;let n={};return n=$.extend(n,t),$.extend(n,{minx:Math.min(t.minx,e.minx),maxx:Math.max(t.maxx,e.maxx),miny:Math.min(t.miny,e.miny),maxy:Math.max(t.maxy,e.maxy)}),n},addCopyLink:function(t){let e=jqid(t).html();e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");let n=jqid(t);n.css("position","relative");let i=t+"_copy",a=t+"_download",r=10;if("true"==n.attr("add-copy")){let e=HU.div(["id",i,TITLE,"Copy to clipboard",CLASS,"ramadda-clickable",STYLE,HU.css("position","absolute","right",r+"px","top","5px")],HU.getIconImage("fas fa-clipboard"));r+=20,jqid(t).append(e)}if("true"==n.attr("add-download")){let e=HU.div(["id",a,TITLE,"Download",CLASS,"ramadda-clickable",STYLE,HU.css("position","absolute","right",r+"px","top","5px")],HU.getIconImage("fas fa-download"));jqid(t).append(e)}jqid(i).click((()=>{Utils.copyToClipboard(e),alert("OK, result is copied")})),jqid(a).click((()=>{Utils.makeDownloadFile(n.attr("download-file")??"download.txt",e)}))},copyToClipboardOld:function(t){let e=$("<textarea></textarea>");$("body").append(e),e.val(t).select(),document.execCommand("copy")||console.error("Copy to clipboard failed"),e.remove()},copyToClipboard:function(t){navigator.clipboard.writeText(t).then((()=>{})).catch((e=>{console.error("Unable to write to clipboard with navigator.clipboard.writeText:"+e),Utils.copyToClipboardOld(t)}))},isAnonymous:function(){return"anonymous"==ramaddaUser},getIcon:function(t){return ramaddaCdn+"/icons/"+t},imports:{},get:function(t,e,n){return t&&e<t.length?t[e]:n},getRotation:function(t){if(t[0].x){let e=[];t.forEach((t=>{e.push(t.x,t.y)})),t=e}var e=[(t[0]+t[4])/2,(t[1]+t[5])/2],n=[t[0]-t[6],t[1]-t[7]],i=180*Math.atan(n[0]/n[1])/Math.PI;return n[1]<0?i+=180:n[0]<0&&(i+=360),{center:e,angle:i}},rotate:function(t,e,n,i,a,r){if(0==a)return{x:parseFloat(n),y:parseFloat(i)};if(r)var l=Math.PI/180*a;else l=Math.PI/-180*a;var s=Math.cos(l),o=Math.sin(l);return{x:s*(n-t)+o*(i-e)+t,y:s*(i-e)-o*(n-t)+e}},splitFirst:function(t,e){let n=t.indexOf(e);return n<0?[t]:[t.substring(0,n),t.substring(n+1)]},debug:!1,split:function(t,e,n,i,a){if(!Utils.isDefined(t))return a;let r=[];e=e??",";let l=new RegExp("\\\\"+e,"g");return t=t.replace(l,"_HIDEDELIM_"),this.debug&&console.log(t),t.split(e).forEach((t=>{t=(t=t.replace(/_comma_/g,",")).replace(/_HIDEDELIM_/g,e),n&&(t=t.trim()),i&&""==t||r.push(t)})),r},sortNumbers:function(t){return t.sort(((t,e)=>+t-+e)),t},sortDates:function(t){return t.sort(((t,e)=>t.getTime()-e.getTime())),t},decodeText:function(t){return t?(t=String(t)).replace(/_leftbracket_/g,"[").replace(/_rightbracket_/g,"]").replace(/_dq_/g,'""').replace(/&quote;/gi,'"').replace(/_quote_/gi,'"').replace(/_qt_/gi,'"').replace(/_newline_/gi,"\n").replace(/newline/gi,"\n").replace(/_nl_/g,"\n"):null},handleActionResults:function(t,e){setTimeout((()=>{$.getJSON(e,(n=>{let i="";n.message&&(i=n.message.replace(/\n/g,"<br>")),$("#"+t).html(i),"running"==n.status&&Utils.handleActionResults(t,e)})).fail((e=>{$("#"+t).html("Error:"+e)}))}),1e3)},sumList:function(t){let e=0;return t.forEach((t=>{isNaN(t)||(e+=t)})),e},moveBefore:function(t,e,n){const i=(t=this.removeItem(t,n)).indexOf(e);return t.splice(i,0,n),t},toFront:function(t,e,n){const i=t.indexOf(n?e[0]:e);return i>-1&&(t.splice(i,1),n?t.push(...e):t.push(e)),t},toBack:function(t,e,n){const i=t.indexOf(n?e[0]:e);return i>-1&&(t.splice(i,1),n?t.unshift(...e):t.unshift(e)),t},makeKeyValueList:function(t){return Object.keys(t).map((e=>({key:e,value:t[e]})))},mergeLists:function(t,e,n,i,a){let r=[];return t&&t.map((t=>r.push(t))),e&&e.map((t=>r.push(t))),n&&n.map((t=>r.push(t))),i&&i.map((t=>r.push(t))),a&&a.map((t=>r.push(t))),r},getNameValue:function(t,e){if(!t)return null;for(var n={},i=t.split(","),a=0;a<i.length;a++){var r=i[a].split(":"),l=r[1].trim();e&&""==l||(l=l.replace(/_colon_/g,":"),n[r[0].trim()]=l)}return n},translatePoint:function(t,e,n,i,a,r){let l={x:t=+t,y:e=+e};if("nw"==a)l.x=t,l.y=e;else if("w"==a)l.x=t,l.y=e-i/2;else if("sw"==a)l.x=t,l.y=e-i;else if("s"==a)l.x=t-n/2,l.y=e-i;else if("se"==a)l.x=t-n,l.y=e-i;else if("e"==a)l.x=t-n,l.y=e-i/2;else if("ne"==a)l.x=t-n,l.y=e;else if("n"==a)l.x=t-n/2,l.y=e;else{if("c"!=a)throw new Error("Unknown point"+a);l.x=t-n/2,l.y=e-i/2}return null!=r&&(l.x+=+r.dx,l.y+=+r.dy),l},displayTimes:function(t,e,n,i){let a="",r=n?" ":"\n",l=n?" ":"\t";a+=t+r;for(var s=0;s<e.length-1;s++){let t=null;i&&s<i.length&&(t=i[s]),t||(t="time"+(s+1)),a+=l+t+": "+(e[s+1].getTime()-e[s].getTime())/1e3+r}console.log(a)},cloneList:function(t){return t?t.slice(0):null},removeElement:function(t,e){t||(t=[]);let n=t.indexOf(e);return n>=0&&t.splice(n,1),t},addUnique:function(t,e){return null==t&&(t=[]),t.includes(e)||t.push(e),t},replaceAll:function(t,e,n){let i=t.indexOf(e);return i<0?t:t.substring(0,i)+n+t.substring(i+e.length)},parseAttributes:function(t){let e,n={};for(;null!=(e=t.match(/([^ ]+) *= *"([^"]*)"/));)n[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+) *= *'([^']*)'/));)n[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+) *= *([^ ]*)( |$)/));)n[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+)( |$)/));)n[e[1].trim()]="true",t=Utils.replaceAll(t,e[0],"");return n},parseAttributesAsList:function(t){let e=[],n=!1,i=!1,a="";for(let r=0;r<t.length;r++){let l=t[r],s='"'==l;i?(a+=l,i=!1):"\\"!=l?i?(a+=l,i=!1):s?n?(n=!1,e.push(a),a=""):n=!0:n||" "!=l&&"\n"!=l?a+=l:a.length>0&&(e.push(a),a=""):i?(a+=l,i=!1):i=!0}""!=a&&e.push(a);let r=[];return e.forEach((t=>{let e=t.indexOf("="),n=t,i="";e>=0&&(n=t.substring(0,e),i=t.substring(e+1)),r.push(n),r.push(i)})),r},hideMore:function(t){var e=GuiUtils.getDomObject("morelink_"+t);hideObject(GuiUtils.getDomObject("morediv_"+t)),showObject(e)},showMore:function(t){var e=GuiUtils.getDomObject("morelink_"+t),n=GuiUtils.getDomObject("morediv_"+t);hideObject(e),showObject(n)},ramaddaUpdateMaps:function(){if("undefined"!=typeof ramaddaMaps)for(i=0;i<ramaddaMaps.length;i++){var t=ramaddaMaps[i];t.map&&t.map.updateSize()}},formDialogId:"",submitEntryForm:function(t){return Utils.popupFormLoadingDialog(t),!0},closeFormLoadingDialog:function(){$(Utils.formDialogId).dialog("close")},popupFormLoadingDialog:function(t){Utils.formDialogId=t,$(t).dialog({resizable:!1,height:100,modal:!0})},replaceRoot:function(t){var e=new RegExp("\\${root}");return t=t.replace(e,ramaddaBaseUrl)},loadScriptInfo:{},loadScript:function(t,e,n){let i="js:"+t,a=Utils.loadScriptInfo[i];if(a||(a=Utils.loadScriptInfo[i]={loaded:!1,loading:!1,callbacks:[]}),!n&&a.loaded)return e&&e(),!0;if(e&&a.callbacks.push(e),a.loading)return!1;a.loading=!0;let r=document.createElement("script");r.type="text/javascript",r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,a.loaded=!0,a.callbacks.forEach((t=>t())))}:r.onload=function(){a.loaded=!0,a.callbacks.forEach((t=>t()))},a.callback=[],r.src=t,document.getElementsByTagName("head")[0].appendChild(r)},importJS:async function(t,e,n,i){t=this.replaceRoot(t);let a=this;var r="js:"+t;if(!i&&this.imports[r])return Utils.call(e);try{await $.ajax({url:t,dataType:"script",cache:!0,success:function(t){a.imports[r]=!0,Utils.call(e)}}).fail(((e,n,i)=>{console.log("initial importJS failed: "+t),console.log("error:"+i)}))}catch(i){try{await $.ajax({url:t,dataType:"text",success:function(n){console.log("got script as text -  "+t);var i=document.createElement("script");i.innerHTML=n,document.body.appendChild(i),Utils.call(e),a.imports[r]=!0}}).fail(((e,i,a)=>{n?n(e,i,a):console.log("importJS failed:"+t)}))}catch(t){}}},waitOn:async function(t,e){window[t]},importCSS:async function(t,e,n,i){var a="css:"+(t=this.replaceRoot(t));if(!i&&this.imports[a])return Utils.call(e);try{await $.ajax({url:t,dataType:"text",success:t=>{i||(this.imports[a]=!0),$('<style type="text/css">\n'+t+"</style>").appendTo("head"),Utils.call(e)}}).fail(n)}catch(t){}},doFetch:async function(t,e,n,i){t=this.replaceRoot(t);let a=!1;try{let r={url:t,success:function(t){Utils.call(e,t)}};i||(i="text/plain",r.beforeSend=function(t){t.overrideMimeType("text/plain;")}),r.xhrFields={responseType:i},await $.ajax(r).fail(((t,e,i)=>{a=!0,n&&n(t,e,i)}))}catch(t){a||Utils.call(n,t)}},formatXml:function(t,e){e&&$.extend({},e);let n,i=(new DOMParser).parseFromString(t,"text/xml"),a="";return n=function(t,e,i){let r="";for(let t=0;t<i;t++)r+="  ";if(i>5)a+=r+"...\n";else{if("#text"==t.nodeName){let e=t.nodeValue||"";return e=e.trim(),void(Utils.stringDefined(e)&&(a+=r+"text:"+e+"\n"))}if("#cdata-section"==t.nodeName)return a+=r+t.wholeText,void(a+="\n");""!=e&&(e+="."),e+=t.nodeName,a+=r+"&lt;"+HU.span(["data-path",e,TITLE,"Add path selector",STYLE,HU.css("cursor","pointer","text-decoration","underline"),CLASS,"ramadda-xmlnode"],t.nodeName)+"&gt;\n",t.childNodes.forEach((t=>{n(t,e,i+1)})),a+=r+"&lt;/"+t.nodeName+"&gt;\n"}},i.childNodes.forEach((t=>{if("parsererror"==t.nodeName)throw new Error("Parse error:"+t)})),i.childNodes.forEach((t=>{n(t,"",0)})),a},formatJson:function(t,e){var n=this.formatJsonInner(t,0,e);return this.formatJsonBlob(n,null,0,e)},formatJsonClick:function(t,e){var n=$("#"+e),i=$("#"+t);n.is(":visible")?(n.hide(),i.attr("src",icon_tree_closed)):(n.show(),i.attr("src",icon_tree_open))},formatJsonBlob:function(t,e,n,i){var a="";if(null!=e&&(a=e+": "),a+=t.value,t.inner){var r=HtmlUtils.getUniqueId(),l=HtmlUtils.image(icon_tree_closed,["id",r]),s=HtmlUtils.getUniqueId(),o="Utils.formatJsonClick('"+r+"','"+s+"')";a=HtmlUtils.div(["onclick",o,"class","json-label"],l+" "+a);var d=n<i?"block":"none";a+=HtmlUtils.div(["style","display:"+d+";","class","json-inner","id",s],t.inner)}return a},formatJsonInner:function(t,e,n){if(null==t)return{value:"null"};var i=typeof t;if("string"==i){var a="json-string";return t.match("^http")&&(a="json-url",t=HtmlUtils.href(t,t,["class",a])),{value:HtmlUtils.span(["class",a],'"'+t+'"')}}if("number"==i||"boolean"==i)return{value:HtmlUtils.span(["class","json-"+i],t)};if(t.toISOString)return{value:HtmlUtils.span(["class","json-date"],'"'+t.toISOString()+'"')};if("function"==i){var r=(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"");return r=(r=r.replace(/[/][*][^\/*]*[*][/]/g,"")).split("){",1)[0].replace(/^[^\(]*[\(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean),{value:HtmlUtils.span(["class","json-function"],t.name+"("+r+") {...}")}}var l=Array.isArray(t),s=l?HtmlUtils.span(["class","json-number"],"["+t.length+"]"):"",o=HtmlUtils.openTag("div"),d=[],c=[];if(l){for(var u=0;u<t.length;u++)d.push(u),c.push(u);0==c.length&&(o+=this.formatJsonBlob({value:HtmlUtils.span(["class","json-none"],"[]")},null,e+1,n))}else{for(var h in t)d.push(h),c.push(h);0==c.length&&(o+=this.formatJsonBlob({value:HtmlUtils.span(["class","json-none"],"No properties")},null,e+1,n))}for(u=0;u<c.length;u++){o+="<div>";var f=Utils.formatJsonInner(t[c[u]],e+1,n);o+=this.formatJsonBlob(f,d[u],e+1,n),o+="</div>"}return{value:s,inner:o+="</div>"}},padLeft:function(t,e,n){for(t=""+t,n||(n=" ");t.length<e;)t=n+t;return t},reverseArray:function(t){for(var e=[],n=t.length-1;n>=0;n--)e.push(t[n]);return e},makeArray:function(t){return Array.isArray(t)?t:[t]},getUniqueId:function(t){return HtmlUtils.getUniqueId(t)},uuidv4:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))},splitList:function(t,e){let n=[];if(t.length<e)n.push(t);else{let i=Math.ceil(t.length/e),a=Math.ceil(t.length/i),r=[];n.push(r),t.forEach((t=>{r.length>=a&&(r=[],n.push(r)),r.push(t)}))}return n},removeItem:function(t,e){for(var n=t.length-1;n>=0;n--)t[n]==e&&t.splice(n,1);return t},getStack:function(t){Utils.isDefined(t)||(t=100);let e="",n=new Error;if(!n.stack)return"no stack available";let i=Utils.split(n.stack,"\n",!0,!0);for(let n=1;n<t&&n<i.length;n++){let t=i[n];t=Utils.split(t,"@");let a=t[1].match(/\/([^/]+)$/);e=e+"  "+t[0]+":"+a[1].replace(/:[^:]+$/,"")+"\n"}return e},normalize:function(t){let e=Math.min(...t.filter((t=>!isNaN(t)))),n=Math.max(...t.filter((t=>!isNaN(t))))-e;return t.map((t=>0==n?0:(t-e)/n))},getBoolean:function(t){return!!Utils.isDefined(t)&&Utils.getProperty(t)},getProperty:function(t){if(Utils.isDefined(t)){if("string"!=typeof t)return t;let e=String(t).trim();return"true"===e||"false"!==e&&t}return null},join:function(t,e,n){void 0===n&&(n=0);for(var i="",a=n;a<t.length;a++)a>n&&(i+=e),i+=t[a];return i},wrap:function(t,e,n){if(!t)return null;let i="";return t.forEach((t=>{i+=e+t+n})),i},parseMap:function(t,e,n){if(null==t)return null;for(var i=t.split(e??","),a={},r=0;r<i.length;r++){var l=i[r].split(n??":");l.length>1&&(a[l[0].trim()]=l[1].trim())}return a},getUniqueValues:function(t){for(var e=[],n={},i=0;i<t.length;i++){var a=t[i];this.isDefined(n[a])||(n[a]=!0,e.push(a))}return e},getMacro:function(t){return"${states}"==t?"Alabama,Alaska,Arizona,Arkansas,California,Colorado,Connecticut,Delaware,District of Columbia,Florida,Georgia,Hawaii,Idaho,Illinois,Indiana,Iowa,Kansas,Kentucky,Louisiana,Maine,Maryland,Massachusetts,Michigan,Minnesota,Mississippi,Missouri,Montana,Nebraska,Nevada,New Hampshire,New Jersey,New Mexico,New York,North Carolina,North Dakota,Ohio,Oklahoma,Oregon,Origin State,Pennsylvania,Rhode Island,South Carolina,South Dakota,Tennessee,Texas,Utah,Vermont,Virginia,Washington,West Virginia,Wisconsin,Wyoming":t},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesShortShort:["S","M","T","W","Th","F","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],createDate:function(t,e){let n=Utils.createDateInner(t);return n&&e&&(n=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours()-e,n.getUTCMinutes(),n.getUTCSeconds()))),n},createDateInner:function(t){if(!t)return t;if(t.getTime)return t;t=t.trim();let e=new RegExp("^(\\+|-)?([0-9]+) *(minute|hour|day|week|month|year)$"),n=t.match(e);if(n){let t=parseFloat(n[1]+n[2]),e=n[3],i=(new Date).getTime();return"minute"==e?new Date(i+1e3*t*60):"hour"==e?new Date(i+1e3*t*60*60):"day"==e?new Date(i+1e3*t*60*60*24):"week"==e?new Date(i+1e3*t*60*60*24*7):"month"==e?new Date(i+1e3*t*60*60*24*7*31):new Date(i+1e3*t*60*60*24*365)}if(t.match(/^[0-9,-]+$/)){let e=t.split(","),i=t.split("-");n=i.length>e.length?i:e;let a=0,r=t=>t>=n.length?null:1==t?+n[t]-1:+n[t];return new Date(Date.UTC(r(a++),r(a++),r(a++),r(a++),r(a++),r(a++)))}return new Date(t)},minutesSince:function(t){return Math.round(this.toMinutes((new Date).getTime()-t))},toMinutes:function(t){return t/1e3/60},formatHour:function(t,e){let n=e?"":"&nbsp;";return 0==t?"12"+n+"AM":12==t?"12"+n+"PM":t>12?t-12+n+"PM":t+n+"AM"},formatDateMonthDayYear:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date";var i=this.monthNames[t.getUTCMonth()],a=t.getUTCDate();return a<10&&(a="0"+a),i+" "+a+", "+t.getUTCFullYear()},formatDateYearMonth:function(t,e,n){return isNaN(t.getUTCMonth())?"Unknown date":this.monthNames[t.getUTCMonth()]+", "+t.getUTCFullYear()},formatDateMonthDay:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date";var i=this.monthNames[t.getUTCMonth()],a=t.getUTCDate();return a<10&&(a="0"+a),i+" "+a},formatDateMonDay:function(t,e,n){if(isNaN(t.getUTCMonth()))return"NA";var i=this.monthNamesShort[t.getUTCMonth()],a=t.getUTCDate();return a<10&&(a="0"+a),i+"-"+a},formatDateMDY:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var i=this.monthNamesShort[t.getUTCMonth()],a=t.getUTCDate();return a<10&&(a="0"+a),i+" "+a+", "+t.getUTCFullYear()},formatDateYYYYMMDD:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var i=t.getUTCMonth()+1;i<10&&(i="0"+i);var a=t.getUTCDate();return a<10&&(a="0"+a),t.getUTCFullYear()+"-"+i+"-"+a},formatDateYYYYMMDDHHMM:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;let i=t.getUTCMonth()+1;i<10&&(i="0"+i);let a=t.getUTCDate();a<10&&(a="0"+a);let r=t.getUTCHours();r<10&&(r="0"+r);let l=t.getUTCMinutes();l<10&&(l="0"+l);let s=r+":"+l;return t.getUTCFullYear()+"-"+i+"-"+a+" "+s},formatDateYYYYMMDDHHMMSS:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var i=t.getUTCMonth()+1;i<10&&(i="0"+i);var a=t.getUTCDate();a<10&&(a="0"+a);var r=t.getUTCHours()+1;r<10&&(r="0"+r);var l=t.getUTCMinutes();l<10&&(l="0"+l);var s=t.getUTCSeconds();s<10&&(s="0"+s);let o=r+":"+l+":"+s;return t.getUTCFullYear()+"-"+i+"-"+a+" "+o},formatDateYYYYMMDDHH:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var i=t.getUTCMonth()+1;i<10&&(i="0"+i);var a=t.getUTCDate();a<10&&(a="0"+a);var r=Utils.formatHour(t.getUTCHours(),!0);return t.getUTCFullYear()+"-"+i+"-"+a+" "+r},formatDateYYYYMM:function(t,e,n){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var i=t.getUTCMonth()+1;return i<10&&(i="0"+i),t.getUTCFullYear()+"-"+i},formatDateMMDD:function(t,e){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;let n=t.getUTCMonth()+1;n<10&&(n="0"+n);let i=t.getUTCDate();return i<10&&(i="0"+i),n+(e||"-")+i},formatDateHHMM:function(t,e){let n=t.getUTCHours();n<10&&(n="0"+n);let i=t.getUTCMinutes();return i<10&&(i="0"+i),n+":"+i},formatDateYYYY:function(t,e,n){return t.getUTCFullYear()},formatDateYYYYWeek:function(t,e,n){return t.getUTCFullYear()+" week:"+this.formatDateWeek(t)},formatDateWeek:function(t){var e=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-e)/864e5+1)/7)},formatDateWithFormat(t,e,n){if(null==e){if(n)return null;e="yyyymmdd"}let i=e.toLowerCase();return"yyyymmdd"==i?Utils.formatDateYYYYMMDD(t):"yyyymmddhh"==i?Utils.formatDateYYYYMMDDHH(t):"yyyymmddhhmm"==i?Utils.formatDateYYYYMMDDHHMM(t):"yyyymmddhhmmss"==i?Utils.formatDateYYYYMMDDHHMMSS(t):"yyyymm"==i?Utils.formatDateYYYYMM(t):"yearmonth"==i?Utils.formatDateYearMonth(t):"monthdayyear"==i?Utils.formatDateMonthDayYear(t):"monthday"==i?Utils.formatDateMonthDay(t):"mon_day"==i?Utils.formatDateMonDay(t):"mdy"==i?Utils.formatDateMDY(t):"hhmm"==i?Utils.formatDateHHMM(t):String(t.format(e,"UTC:",!0))},dateOptions:{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},formatDate:function(t,e,n){return this.formatDateWithFormat(t,"yyyy-mm-dd HH:MM")},incrementYear:function(t,e){return null==e&&(e=1),t.setUTCFullYear(t.getUTCFullYear()+e),t},incrementMonth:function(t,e){for(null==e&&(e=1);e>0;)11==t.getUTCMonth()?(t.setUTCFullYear(t.getUTCFullYear()+1),t.setUTCMonth(0)):t.setUTCMonth(t.getUTCMonth()+1),e--;return t},incrementDay:function(t,e){return null==e&&(e=1),t.setTime(t.getTime()+1e3*e*3600*24),t},getDayInYear:function(t){return(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())-Date.UTC(t.getUTCFullYear(),0,0))/24/60/60/1e3},monthShortNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthLongNames:["January","February","March","April","May","June","July","August","September","October","November","December"],getMonthShortNames:function(){return this.monthShortNames},xparseDate:function(t){return t=t.replaceAll(/\+0000$/,""),new Date(t)},dateRegex:new RegExp("(rel|now|today)(\\+|-)(.*)","i"),parseDate:function(t,e,n){if(null==t)return null;if("number"==typeof t)return new Date(t);if(""==(t=t.trim()))return null;var i=t.match(this.dateRegex),a=0;null!=i&&(a=parseFloat(i[3]),"-"==i[2]&&(a=-a),t=i[1]);var r=null;if("now"==t);else if("rel"==t){if(null==n)return null;r=new Date(n.getTime())}else{if("today"!=t){let e=Date.parse(t);if(isNaN(e)){let e=t.split(/[^0-9]/).map((t=>parseInt(t,10)));return new Date(e[0],e[1]-1||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0)}return new Date(e)}(r=new Date(Date.now())).setMilliseconds(0),r.setSeconds(0),r.setMinutes(0),e&&r.setHours(24)}return 0!=a&&r.setDate(r.getDate()+a),r},makeDownloadFile:function(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},later:function(t){t&&setTimeout(t,1)},call:function(t,e,n,i,a){if(t){var r=[];Utils.isDefined(e)&&r.push(e),Utils.isDefined(n)&&r.push(n),Utils.isDefined(i)&&r.push(i),Utils.isDefined(a)&&r.push(a),t.apply(this,r)}return e},isDefined:function(t){let e=!0;Array.from(arguments).every((t=>(null==t&&(e=!1),e)));return e},makeLabel:function(t,e){return t=String(t).trim(),e||(t=t.replace(/([a-z]+)([A-Z])/g,"$1 $2")),t=t.replace(/_/g," "),t=(t=this.camelCase(t)).replace(/  +/g," ")},makeId:function(t){return t=(t=(t=(t=(t=(t=(t=String(t)).replace(/[^\x00-\x7F]/g,"_")).replace(/&/g,"_")).replace(/\./g,"_")).replace(/[:\//]+/g,"_")).replace(/_+$/,"")).trim().toLowerCase().replace(/ /g,"_")},camelCase:function(t,e){if(!t)return t;let n="",i=t.split(" ");for(let t=0;t<i.length;t++){let a=i[t],r=a.substring(0,1);(t>>0||!e)&&(r=r.toUpperCase()),a.length>1&&(r+=a.substring(1).toLowerCase()),""!=n&&(n+=" "),n+=r}return n},stripTags:function(t){return t.replace(/(<([^>]+)>)/gi," ")},articles:"that,this,they,those,with,them,their,have,than,there,when,more,much,many,will,were".split(","),stopWords:["not","no","will","must","just","a","about","above","after","again","against","all","am","an","and","any","are","as","at","be","because","been","before","being","below","between","both","but","by","could","did","do","does","doing","down","during","each","few","for","from","further","had","has","have","having","he","he'd","he'll","he's","her","here","here's","hers","herself","him","himself","his","how","how's","i","i'd","i'll","i'm","i've","if","in","into","is","it","it's","its","itself","let's","me","more","most","my","myself","nor","of","on","once","only","or","other","ought","our","ours","ourselves","out","over","own","same","she","she'd","she'll","she's","should","so","some","such","than","that","that's","the","their","theirs","them","themselves","then","there","there's","these","they","they'd","they'll","they're","they've","this","those","through","to","too","under","until","up","very","was","we","we'd","we'll","we're","we've","were","what","what's","when","when's","where","where's","which","while","who","who's","whom","why","why's","with","would","you","you'd","you'll","you're","you've","your","yours","yourself","yourselves"],tokenizeWords:function(t,e,n,i){e||(e=this.stopWords);for(var a=[],r=(t=t.replace(/https?:\/\/[^ ]+/g," ")).split(/[ ,\(\)\.:\;\n\?\-!\*]/),l=0;l<r.length;l++){var s=r[l].trim();if(""!=s){var o=s.toLowerCase();e.includes(o)||n&&n.includes(o)||i&&this.articles.includes(o)||s.match(/^[0-9]+$/)||a.push(s)}}return a},stringEquals:function(t,e){return null===t&&null===e||null!==t&&null!==e&&new String(t).valueOf()===new String(e).valueOf()},stringDefined:function(){for(let t=0;t<arguments.length;t++){let e=arguments[t];if(!Utils.isDefined(e))return!1;if(null==e||""==e)return!1}return!0},tokenizeMacros:function(s,args,debug){let opts={};args&&$.extend(opts,args);let hook=opts.hook,tokens=[],tokenMap={},cnt=0;for(;s.length>0;){let t=s.indexOf("${");if(t<0)break;let e=s.substring(0,t);""!=e&&tokens.push({type:"string",s:e}),s=s.substring(t);let n="",i=0,a=!1;for(;i<s.length;){let t=s.charAt(i++);if('"'!=t&&"'"!=t){if("}"==t&&!a)break;n+=t}else a=!a,n+=t}if(i>s.length)break;s=s.substring(i);let r=n.substring(2),l={};t=r.indexOf(" ");let o="";if(t<0)o=r;else{o=r.substring(0,t).trim();let e=r.substring(t).trim();l=Utils.parseAttributes(e),debug&&console.dir(l)}let d={id:String(cnt++),attrs:l,tag:o,macro:r};tokens.push(d),tokenMap[o]=d}return""!=s&&tokens.push({type:"string",s:s}),{tokens:tokens,tokenMap:tokenMap,getAttributes:function(t){let e=this.tokenMap[t];return e?e.attrs:null},apply:function(source,debug,handler){let cnt=0,tokenFunc=t=>{let value=source[t.tag];if(!value){let e=Object.keys(source);e.every((e=>e.match(t.tag)?(value=source[e],!1):(t.tag.indexOf("|")&&t.tag.split("|").every((t=>t!=e&&!e.match(t)||(value=source[e],!1))),!value)))}let s="";if("func"==t.tag){let f=t.attrs.f;if(!f)return"&lt;no function defined&gt;";let code="function macroFunc() {\n";for(a in source){if("default"==a)continue;let t=source[a];"number"!=typeof t&&(t='"'+t+'"'),code+=a+"="+t+";\n"}code+="return "+f+";\n}\n",code+="macroFunc()";try{value=eval(code)}catch(t){return console.log("Error applying macro function:"+code+"\n"+t),"&lt;Error:"+t+"&gt;"}}if(t.attrs.nonblank&&0==String(value).length)return"";if(!Utils.isDefined(value))return"${"+t.macro+"}";if(value.getTime){let e=t.attrs.offset??opts.timezoneOffset,n="";if(t.attrs.localTime){let t=60*(new Date).getTimezoneOffset()*1e3;value=new Date(value.getTime()-t)}return Utils.formatDateWithFormat(value,t.attrs.format||opts.dateFormat)+n}if(t.attrs.display&&handler){let e=handler(t,value);if(!1!==e)return e}if(t.attrs.missing&&(""==value||isNaN(value)))return t.attrs.missing;if(t.attrs.bar){let e=t.attrs.min||0,n=t.attrs.max;if(""==value||isNaN(value))return t.attrs.missing||value;if(Utils.isDefined(e,n)){let i=t.attrs.color||"#4E79A7",a=t.attrs.width||"100%",r=parseFloat(t.attrs.height||12),l=100-100*(value-e)/(n-e)+"%",s=t.attrs.border||"1px solid #ccc",o=t.attrs.includeValue||!0,d=HU.div([TITLE,value+"/"+n,STYLE,HU.css("display","inline-block","position","relative","height",r+2+"px","width",a,"border",s,"border-left","none")],HU.div([STYLE,HU.css("position","absolute","left","0px","right",l,"height",r+"px","background",i)]));return o?HU.row([["width","1%"],value],d):d}}if(t.attrs.stars){if(""==value||isNaN(value))return t.attrs.missing||value;let e=t.attrs.count||5,n=t.attrs.min||0,i=t.attrs.max;if(Utils.isDefined(n,i)){let a=t.attrs.color||"#F9CF03",r="",l="";for(let t=0;t<e;t++)r+=HU.getIconImage("far fa-star",null,[STYLE,HU.css("font-size","10pt","color","#000")]),l+=HU.getIconImage("fas fa-star",null,[STYLE,HU.css("font-size","10pt","color",a)]);let s=100-100*(value-n)/(i-n)+"%",o=t.attrs.includeValue||!0,d=HU.div([TITLE,value+"/"+i,STYLE,HU.css("display","inline-block","position","relative")],r+HU.div([STYLE,HU.css("white-space","nowrap","overflow-x","hidden","position","absolute","left","0px","right",s,"top","0px","bottom","0px")],l));return o?HU.row([["width","1%"],value],d):d}}if(Utils.isDefined(t.attrs.nan)&&isNaN(value)&&(value=t.attrs.nan),(t.attrs.positiveTemplate||t.attrs.negativeTemplate)&&(value=+value,value>=0?t.attrs.negativeTemplate&&(value=t.attrs.positiveTemplate.replace("${value}",value)):t.attrs.negativeTemplate&&(t.attrs.doAbsolute&&(value=-value),value=t.attrs.negativeTemplate.replace("${value}",value))),t.attrs.youtube)return 0==value.trim().length?null:(s+=Utils.embedYoutube(value,t.attrs),s);if(t.attrs.list)return value=String(value),s+="<ul>",value.split("\n").forEach((t=>{""!=(t=t.trim())&&(s+="<li> "+t)})),s+="</ul>",s;if(t.attrs.pre)return value=String(value),""!=value.trim()&&(value="<pre class=thin_pre>"+value.trim()+"</pre>"),value;if(t.attrs.showUrl){let e=t.attrs.label||value;value=HU.href(value,e,["target","_other","style",t.attrs.style||""])}if(t.attrs.delimiter&&t.attrs.fields){let e=[];Utils.stringDefined(value)&&e.push(value),t.attrs.fields.split(",").forEach((t=>{let n=source[t];Utils.stringDefined(n)&&e.push(n)})),value=Utils.join(e,t.attrs.delimiter)}if(t.attrs.urlField){let e=source[t.attrs.urlField];Utils.stringDefined(e)&&(value=HU.href(e,value))}if(t.attrs.offset1&&(value+=parseFloat(t.attrs.offset1)),t.attrs.scale&&(value*=parseFloat(t.attrs.scale)),t.attrs.offset2&&(value+=parseFloat(t.attrs.offset2)),t.attrs.decimals){value=parseFloat(value);let e=Math.pow(10,t.attrs.decimals);value=Math.floor(value*e)/e}if(t.attrs.format){let e=t.attrs.format;"comma"==e&&(isNaN(value)?value=0:0!=value&&(value=Utils.formatNumberComma(value)))}if(t.attrs.lowercase&&(value=String(value).toLowerCase()),t.attrs.uppercase&&(value=String(value).toUpperCase()),t.attrs.camelcase&&(value=Utils.camelCase(String(value),!0)),t.attrs.trim&&value.length>t.attrs.trim&&(value=value.substring(0,t.attrs.trim),t.attrs.ellipsis&&(value+="...")),t.attrs.replace){let e=t.attrs.replace;"_space_"==e&&(e=" ");let n=t.attrs.with??" ";("_nl_"==n||"\\n"==n)&&(n="\n");let i=new RegExp(e,"g");value=value.replace(i,n)}if(t.attrs.suffix&&(value+=t.attrs.suffix),t.attrs.prefix&&(value=t.attrs.prefix+value),t.attrs.toggle,t.attrs.image&&(Utils.stringDefined(value)&&t.attrs.urlPrefix&&(value=t.attrs.urlPrefix+value),!Utils.stringDefined(value)&&t.attrs.defaultUrl&&(value=t.attrs.defaultUrl),""!=value)){let e="";if(t.attrs.title)for(a in e=t.attrs.title,source)e=e.replace("{"+a+"}",source[a]);let n=["title",e,"data-caption",e];t.attrs.height?(n.push("height"),n.push(t.attrs.height)):(n.push("width"),n.push(t.attrs.width||"100%")),n.push("loading"),n.push("lazy");let i=value;if(value=HtmlUtils.image(i,n),t.attrs.doPopup){t.attrs.popupBase||(t.attrs.popupBase="gallery"+Utils.getUniqueId());let n=t.attrs.popupBase;value=HU.href(i,value,[CLASS,"popup_image","data-fancybox","fancybox","data-caption",e,"title",e])}}if(t.attrs.images&&""!=value){let e;value=value.trim(),e=value.startsWith("[")?JSON.parse(value):t.attrs.delimiter?value.split(t.attrs.delimiter):value.split(";");let n="";if(t.attrs.title)for(a in n=t.attrs.title,source)n=n.replace("{"+a+"}",source[a]);let i=["title",n];t.attrs.height?(i.push("height"),i.push(t.attrs.height)):(i.push("width"),i.push(t.attrs.width||"100%")),console.log("VALUE:"+value),value="",e.forEach((t=>{value+=HtmlUtils.image(t,i)})),console.log(value)}if(t.attrs.convertDegrees){let t=[["NNE",11.25,33.75],["NE",33.75,56.25],["ENE",56.25,78.75],["E",78.75,101.25],["ESE",101.25,123.75],["SE",123.75,146.25],["SSE",146.25,168.75],["S",168.75,191.25],["SSW",191.25,213.75],["SW",213.75,236.25],["WSW",236.25,258.75],["W",258.75,281.25],["WNW",281.25,303.75],["NW",303.75,326.25],["NNW",326.25,348.75]],e="N";return value=+value,t.every((t=>!(value>=t[1]&&value<=t[2])||(e=t[0],!1))),e}if(t.attrs.template&&(value=t.attrs.template.replace("{value}",value)),t.attrs.templateif){let e=t.attrs.templateif.split(":"),n=e[0],i=e.slice(1).join(":");value=String(value),value.match(n)&&(value=i.replace("{value}",value))}if(t.attrs.cropLength&&value.length>+t.attrs.cropLength){let e=+t.attrs.cropLength;for(;e>=0&&" "!=value[e]&&"\n"!=value[e]&&"\t"!=value[e];)e--;if(0==e)for(;e<value.length&&" "!=value[e]&&"\n"!=value[e]&&"\t"!=value[e];)e++;let n=Utils.getUniqueId(),i=value.substring(0,e)+HU.span([ID,n+"_ellipsis"],"..."),a=HU.span([ID,n+"_post",STYLE,HU.css("display","none")],value.substring(e)),r=HU.div(["onclick","Utils.toggleShowMore('"+n+"')",ID,n,CLASS,"ramadda-showmore ramadda-clickable"],"Show More "+HU.getIconImage("fas fa-sort-down"));value=i+a+r}if(t.attrs.tableRow&&(value="<tr><td align=right>"+t.attrs.label+":</td><td>"+value+"</td></tr>"),t.attrs.prefixLabel&&(value=t.attrs.label+": "+value),t.attrs.maxwidth){let e=t.attrs.maxwidth;value=HU.div([STYLE,HU.css("display","inline-block","white-space","nowrap","max-width",HU.getDimension(e),"overflow-x","auto")],value)}return s+=value,s},s="";return this.tokens.forEach((t=>{if("string"==t.type)s+=t.s;else{let e=null;if(hook&&(e=hook(t,source[t.tag])),e||(e=tokenFunc(t)),!e)return;e.trim().length>0&&t.attrs.toggle&&(e=HU.toggleBlock(t.attrs.label||"More",e)),s+=e}})),s},getText:function(){let t=0,e="";return this.tokens.map((n=>{"string"==n.type?e+=n.s:(e+="${macro"+t+"}",t++)})),e}}},embedAudio:function(t){return HU.tag("audio",["controls",null],HU.tag("source",["src",t,"type","audio/mpeg"],"Your browser does not support the audio tag."))},embedYoutube:function(t,e){e=e||{};let n=t.match(/.*watch\?v=(.*)$/);if(n&&2==n.length||(n=t.match(/.*youtu.be\/(.*)$/)),!n||2!=n.length)return HU.href(t,t);let i="//www.youtube.com/embed/"+n[1]+"?enablejsapi=1&autoplay="+("true"==(e.autoplay||"false")?"1":"0")+"&playerapiid=video_1",a="";return e.includeLink&&(a+=HU.href(t,"Link")+"<br>"),a+=HU.tag("iframe",[ID,"ytplayer","allow","autoplay; fullscreen","type","text/html","frameborder","0",WIDTH,e.width||640,HEIGHT,e.height||360,SRC,i]),a},toggleShowMore:function(t){let e=$("#"+t),n=e.attr("open");n=!n,e.attr("open",n),n?($("#"+t+"_ellipsis").hide(),$("#"+t+"_post").show(),e.html("Show Less "+HU.getIconImage("fas fa-sort-up"))):($("#"+t+"_ellipsis").show(),$("#"+t+"_post").hide(),e.html("Show More "+HU.getIconImage("fas fa-sort-down")))},formatNumberComma:function(t,e,n){if(!Utils.isDefined(t))return"NA";let i=Math.floor(t),a=t-i,r=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");if(0==a)return r;{let i=Math.abs(t);Utils.isDefined(e)||(e=i>=9999?0:i>=999?1:i>=99?2:i>=9?3:4);let a=number_format(t,e);return n&&console.log(t,e,a),a}},formatFileLength:function(t){return t<0?"":t<5e3?Math.round(t)+" bytes":t<1e6?(t=Math.round(100*t/1e3)/100,Math.round(t)+" KB"):(t=Math.round(100*t/1e6)/100)+" MB"},numberToString:null,trimDecimals:function(t,e){if(0==e)return parseInt(t);return t=parseFloat(t),parseInt(t*Math.pow(10,e))/Math.pow(10,e)},roundDecimals:function(t,e,n){null==this.numberToString&&(this.numberToString=new Intl.NumberFormat("fullwide",{useGrouping:!1}));let i=this.numberToString.format(t),a=Number(Math.round(i+"e"+e)+"e-"+e);return n&&console.log("decimals:"+i+" "+Math.round(i+"e"+e)),a},formatNumber:function(t,e,n){let i=this.formatNumberInner(t,n);return e?parseFloat(i):i},formatNumberInner:function(t,e){var n=Math.abs(t);if(n==Math.floor(n))return String(t);if(n>1e3)return number_format(t,0);if(n>100)return number_format(t,1);if(n>10)return number_format(t,2);if(n>1)return number_format(t,3);{let n=""+(t-Math.floor(t));return number_format(t,Math.min(n.length-2,5),e)}},isRealNumber:function(t){return!(t==Number.POSITIVE_INFINITY||isNaN(t)||!Utils.isNumber(t)||!Utils.isDefined(t)||null==t)},isNumber:function(t){return null!=t&&("number"==typeof t||!isNaN(t-0))},isType:function(t,e){return!(!t||typeof t!=e)},getStringDefined:function(){for(let t=0;t<arguments.length;t++)if(Utils.stringDefined(arguments[t]))return arguments[t];return null},getDefined:function(){for(let t=0;t<arguments.length;t++){let e=arguments[t];if(Utils.isDefined(e))return e}return null},cleanId:function(t){return t=(t=t.replace(/:/g,"_").replace(/\./g,"_").replace(/=/g,"_").replace(/\//g,"_").replace(/[\(\)]/g,"_")).replace(/[^a-zA-Z0-9_]/g,"_")},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isFalse:function(t){return void 0!==t&&0==t},toFloat:function(t,e){return null==t||""==t.trim()?void 0!==e?e:NaN:parseFloat(t)},getUrlArgs:function(t){t=t.split("+").join(" ");for(var e,n={},i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);)n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return n},checkTabs:function(t){for(;;){var e=new RegExp('id="(tabId[^"]+)"').exec(t);if(!e)break;var n=e[1];n.indexOf("-")<0&&jQuery((function(){jQuery("#"+n).tabs()}));var i=t.indexOf('id="tabId');if(i<0)break;t=t.substring(i+20)}},initRangeSelect:function(){let t=$(".ramadda-range-select"),e=function(){let t=$(this).attr("to-id");"between"==$(this).val()?$("#"+t).show():$("#"+t).hide()};t.each(e),t.change(e)},initPageReload:function(t,e,n){let i=$("#"+e),a=$("#"+e+"_label");i.length>0&&i.change((()=>{let r="Reload"+HtmlUtils.span([STYLE,"color:transparent"]," in 00  seconds");a.html(r),i.is(":checked")&&Utils.checkPageReload(t,e,n)})),(0==i.length||i.is(":checked"))&&Utils.checkPageReload(t,e,n)},checkPageReloadPending:!1,checkPageReload:function(t,e,n){let i=$("#"+e),a=$("#"+e+"_label");if(!(i.length>0)||i.is(":checked"))if(t<=0)location.reload();else{if(n){let e="Reload in "+t+" seconds";a.html(e)}t<=5?a.css("background","#eee"):a.css("background","transparent"),Utils.checkPageReloadPending||(Utils.checkPageReloadPending=!0,setTimeout((()=>{Utils.checkPageReloadPending=!1,Utils.checkPageReload(t-1,e,n)}),1e3))}},areDisplaysReady:function(){if(!Utils.getPageLoaded())return 0;if(0==Utils.displaysList.length)return 1;let t=!0;return Utils.displaysList.forEach((e=>{e.isDisplayFinished&&(e.isDisplayFinished()||(t=!1))})),t?1:0},checkForResize:function(){$(window).resize((()=>{this.pendingResizeTimeout&&(clearTimeout(this.pendingResizeTimeout),this.pendingResizeTimeout=null);this.pendingResizeTimeout=setTimeout((()=>{for(let t=0;t<Utils.displaysList.length;t++){let e=Utils.displaysList[t];e.handleWindowResize&&e.handleWindowResize()}this.pendingResizeTimeout=null}),1e3)}))},displaysList:[],displaysMap:[],addDisplay:function(t){this.displaysList.push(t),t.getId&&(this.displaysMap[t.getId()]=t),t.displayId&&(this.displaysMap[t.displayId]=t)},removeDisplay:function(t){let e=this.displaysList.indexOf(t);e>=0&&this.displaysList.splice(e,1),t.getId&&delete this.displaysMap[t.getId()],t.displayId&&delete this.displaysMap[t.displayId]},initDisplays:function(){this.displaysList.forEach((t=>{if(t.pageHasLoaded){new Date;t.pageHasLoaded();new Date}}))},getPageLoaded:function(){return this.pageLoaded},initContent:function(t){t?t+=" ":t="";try{let e=$(t+".ramadda-table");e.length&&HtmlUtils.formatTable(e)}catch(t){console.log("Error formatting table:"+t),console.log(t.stack)}$(t+".ramadda-snippet-hover").each((function(){let t=$(this),e=t.html(),n="ramadda-snippet-popup";e.length>200&&(n+=" ramadda-snippet-popup-large"),t.parent().attr("title",""),t.parent().tooltip({content:()=>e,position:{my:"left+15 top",at:"left bottom-50"},classes:{"ui-tooltip":n},show:{effect:"slideDown",delay:600,duration:600}})}));let e=$(t+".ramadda-page-title"),n=$(t+".ramadda-header-center");e.length&&n.length&&(e=e.first(),n=n.first(),$(window).scroll((()=>{e.offset().top<n.offset().top+n.height()+10?this.showingHeaderCenter||(this.showingHeaderCenter=!0,n.html(e.html()),e.html("&nbsp;")):this.showingHeaderCenter&&(this.showingHeaderCenter=!1,e.html(n.html()),n.html("&nbsp;"))}))),$(t+":submit").button().click((function(t){})),$(t+".ramadda-button").button().click((function(t){}));let i=$(t+".ramadda-linkable");i.mouseenter((function(){let t=$(this).attr("id");t&&($("#"+t+"-hover").html(HtmlUtils.getIconImage("fa-link",null,[STYLE,"font-size:10pt;"])),$("#"+t+"-hover").show())})),i.click((function(){let t=$(this).attr("id");t&&HU.scrollToAnchor(t,-50)})),i.mouseleave((function(){let t=$(this).attr("id");t&&$("#"+t+"-hover").hide()})),$(t+".ramadda-pulldown-with-icons").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons ramadda-select-icon")},searchLastInput:"",searchAscending:!1,searchCnt:0,searchSuggestInit:function(t,e,n,i,a){let r=$("#"+t),l=$("#"+e);Utils.isDefined(i)||(i=!0);let s=!1;if(!a){s=!0,a=HU.getUniqueId();let t=r.width(),e=HU.div([ID,a,STYLE,HU.css("border","0px","width",t+"px","position","absolute"),CLASS,"ramadda-popup ramadda-search-popup"],"");r.parent().append(e)}let o=$("#"+a),d=()=>{o.slideUp(250)},c=()=>{let t=r.val()||"";this.searchCnt++,this.pendingSearch&&(clearTimeout(this.pendingSearch),this.pendingSearch=null),0!=t.length?this.pendingSearch=setTimeout((()=>{this.pendingSearch=null,Utils.doSearchSuggest(this.searchCnt,r,l,o,n,s)}),200):d()};l.length&&l.change(c),Utils.searchLastInput=r.val(),r.keyup((t=>{let e=t.keyCode||t.which;27!=e&&13!=e?(t.stopPropagation(),c()):d()}))},doSearchSuggest:function(t,e,n,i,a,r){let l=this,s=e.val()||"";Utils.searchLastInput=s;let o=RamaddaUtil.getUrl("/search/suggest?text="+encodeURIComponent(s));a&&(o+="&type="+a),n.length>0&&n.is(":checked")&&ramaddaThisEntry&&(o+="&ancestor="+ramaddaThisEntry),o+="&ascending="+Utils.searchAscending,o+="&orderby=createdate";$.getJSON(o,(function(n){if(t!=l.searchCnt)return;let a=()=>{i.slideDown(400)};if(0==n.values.length)return i.html(HtmlUtils.div([CLASS,"ramadda-search-suggestion "],"No results")),void a();let s="",o=!0;if(n.values.forEach(((t,e)=>{let n,i=t.name,a=t.id,l=i.replace(/\"/g,"_quote_"),d=HU.href(RamaddaUtil.getUrl("/entry/show?entryid="+a),HU.getIconImage(t.icon||icon_blank16)+SPACE+i,[TITLE,"View entry",STYLE,HU.css("display","inline-block","width","100%"),CLASS,"ramadda-highlightable"]);n=r?HU.span([CLASS,"ramadda-highlightable ramadda-search-input","index",e,TITLE,"Search for"],HtmlUtils.getIconImage("fa-search")):HU.href(RamaddaUtil.getUrl("/search/do?text="+encodeURIComponent(l)),HtmlUtils.getIconImage("fa-search"),[TITLE,"Search for"]);let c=n+SPACE+d;s+=HtmlUtils.div([CLASS,"ramadda-search-suggestion "],c),s+="\n",o=!o})),i.html(s),r){let t=i.find(".ramadda-search-input");t.css("cursor","pointer"),t.click((function(t){t.stopPropagation();let i=n.values[$(this).attr("index")].name;e.val(i),e.closest("form").submit()}))}a()})).fail((function(t,e,n){console.log("fail:"+e)}))},searchLink:function(){let t=$("#popup_search_input").val().trim(),e=$(this).attr("url");""!=t&&(e+="?text="+encodeURIComponent(t)),window.location=e},searchPopup:function(t,e){e=t;let n=Utils.searchLastInput||"",i="<form action='"+RamaddaUtil.getUrl("/search/do")+"'>";i+=HU.open("input",["value",n,"placeholder","Search text","autocomplete","off","autofocus","true","id","popup_search_input","class","ramadda-search-input",STYLE,HU.css("margin-left","4px","padding","2px","width","250px","border","0px"),"name","text"]),ramaddaThisEntry&&(i+=HU.checkbox("popup_search_here",["name","ancestor","value",ramaddaThisEntry,TITLE,"Search under this entry"],!1)+HU.tag("label",[CLASS,"ramadda-clickable","for","popup_search_here"]," here"+SPACE)),i+="</form>";let a=HU.getUniqueId(),r=HU.link(RamaddaUtil.getUrl("/search/form"),"Search Form",[TITLE,"Go to search form",STYLE,HU.css("color","#888","font-size","13px")]),l=HU.div(["id",a,STYLE,HU.css("text-align","right","color","#888","font-size","13px")],r),s=HU.getUniqueId("searchresults"),o=HU.div([ID,s,CLASS,"ramadda-search-popup-results"]),d=HU.div([CLASS,"ramadda-search-popup"],i+o),c=($("#"+t),this.dialog=HU.makeDialog({content:d,my:"right top",at:"right bottom",title:l,anchor:e,draggable:!0,header:!0,inPlace:!1}));$("#"+a).find(".ramadda-link").click(Utils.searchLink);let u=$("#popup_search_input");u.mousedown((function(t){t.stopPropagation()})),u.keydown((function(t){"Escape"==t.key&&c.remove()})),Utils.searchSuggestInit("popup_search_input","popup_search_here",null,!0,s),u.focus()},handleKeyPress:function(t){HtmlUtils.getTooltip().hide()},handleMouseDown:function(t){return(HtmlUtils.hasPopupObject()||Utils.tooltipObject)&&setTimeout((()=>{if(Utils.tooltipObject&&(Utils.tooltipObject.hide(),Utils.tooltipObject=null),HtmlUtils.hasPopupObject()){let t=HtmlUtils.getPopupObject().attr("id");HtmlUtils.checkToHidePopup()&&t==HtmlUtils.getPopupObject().attr("id")&&HtmlUtils.hidePopupObject()}}),250),Utils.mouseIsDown=!0,Utils.mouseMoveCnt=0,!0},handleMouseUp:function(t){t=GuiUtils.getEvent(t),Utils.mouseIsDown=!1,GuiUtils.setCursor("default");let e=$("#ramadda-floatdiv");if(e.length){let t=Utils.entryDragInfo?GuiUtils.getDomObject(Utils.entryDragInfo.dragSource):null;if(t){let n=GuiUtils.getLeft(t.obj),i=GuiUtils.getTop(t.obj),a=parseInt(e.css("left")),r=parseInt(e.css("top")),l=10,s=(n-a)/l,o=(i-r)/l;Utils.flyBackAndHide("ramadda-floatdiv",0,l,a,r,s,o)}else e.hide();Utils.entryDragInfo=null}return!0},flyBackAndHide:function(t,e,n,i,a,r,l){var s=GuiUtils.getDomObject(t);if(s){e+=1,s.style.left=i+r*e+"px",s.style.top=a+l*e+"px";if(e<n){setTimeout((()=>{Utils.flyBackAndHide(t,e,n,i,a,r,l)}),30)}else setTimeout((()=>{Utils.finalHide(t)}),150)}},handleMouseMove:function(t){if(t=GuiUtils.getEvent(t),Utils.entryDragInfo&&Utils.mouseIsDown){Utils.mouseMoveCnt++;var e=$("#ramadda-floatdiv");6==Utils.mouseMoveCnt&&GuiUtils.setCursor("move"),Utils.mouseMoveCnt>=6&&e.length&&Utils.moveFloatDiv(GuiUtils.getEventX(t),GuiUtils.getEventY(t))}return!0},finalHide:function(t){var e=GuiUtils.getDomObject(t);e&&(hideObject(e),e.style.filter="alpha(opacity=80)",e.style.opacity="0.8")},centerDiv:function(t){return this.div(["style","text-align:center;"],this.div(["style","display:inline-block;text-align:left;"],t))},moveFloatDiv:function(t,e){let n=$("#ramadda-floatdiv");if(n.length){if(!("none"!=n.css("display"))){n.show();let t="";Utils.entryDragInfo&&(t=Utils.entryDragInfo.getHtml()),n.html(t+"<br>Drag to a group to copy/move/associate")}n.css("top",e).css("left",t+10)}},treeViewClick:function(t,e,n,i,a){let r=HU.href(n,HU.getIconImage("fa-solid fa-link")+" "+i,["class","ramadda-clickable"]);jqid(t+"_header").html(r),a&&(n=n+"&template="+a),$.ajax({url:n,dataType:"text",success:e=>{jqid(t).attr("src",n)}})},copyText:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},foregroundColors:{purple:"white"},getContrastYIQ:function(t){return t=t.replace("#",""),(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"black":"white"},getForegroundColor:function(t){return t?(t.match("rgb")&&(t=Utils.rgbToHex(t)),t?!this.foregroundColors[t]&&t.startsWith("#")?this.getContrastYIQ(t):this.foregroundColors[t]||"#000":"#000"):null},darkerColor:function(t,e){return t?this.pSBC(e||-.5,t):t},brighterColor:function(t,e){return t?this.pSBC(e||.5,t):t},pSBC:function(t,e,n,i){e=this.colorToRgb[e]||e,n=this.colorToRgb[n]||n;let a,r,l,s,o,d,c,u=parseInt,h=Math.round,f="string"==typeof n;return"number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||n&&!f?null:(this.pSBCr||(this.pSBCr=t=>{let e=t.length,n={};if(e>9){if([a,r,l,f]=t=t.split(","),e=t.length,e<3||e>4)return null;n.r=u("a"==a[3]?a.slice(5):a.slice(4)),n.g=u(r),n.b=u(l),n.a=f?parseFloat(f):-1}else{if(8==e||6==e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=u(t.slice(1),16),9==e||5==e?(n.r=t>>24&255,n.g=t>>16&255,n.b=t>>8&255,n.a=h((255&t)/.255)/1e3):(n.r=t>>16,n.g=t>>8&255,n.b=255&t,n.a=-1)}return n}),c=e.length>9,c=f?n.length>9||"c"==n&&!c:c,o=this.pSBCr(e),s=t<0,d=n&&"c"!=n?this.pSBCr(n):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(t=s?-1*t:t),o&&d?(i?(a=h(s*o.r+t*d.r),r=h(s*o.g+t*d.g),l=h(s*o.b+t*d.b)):(a=h((s*o.r**2+t*d.r**2)**.5),r=h((s*o.g**2+t*d.g**2)**.5),l=h((s*o.b**2+t*d.b**2)**.5)),f=o.a,d=d.a,o=f>=0||d>=0,f=o?f<0?d:d<0?f:f*s+d*t:0,c?"rgb"+(o?"a(":"(")+a+","+r+","+l+(o?","+h(1e3*f)/1e3:"")+")":"#"+(4294967296+16777216*a+65536*r+256*l+(o?h(255*f):0)).toString(16).slice(1,o?void 0:-2)):null)},colorToRgb:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},addAlphaToColor:function(t,e){if(t=this.colorToRgb[t]||t,Utils.isDefined(e)||(e="0.5"),0==t.indexOf("#")){let n=Utils.hexToRgb(t);return n&&(t="rgba("+n.r+","+n.g+","+n.b+","+e+")"),t}return t.replace(/rgba? *\(([^,]+),([^,]+),([^,\)]+).*/,"rgba($1,$2,$3,"+e+")")},enumTypeCount:-1,enumColorPalette:["rgb(141, 211, 199)","rgb(255, 255, 179)","rgb(190, 186, 218)","rgb(251, 128, 114)","rgb(128, 177, 211)","rgb(253, 180, 98)","rgb(179, 222, 105)","rgb(252, 205, 229)","rgb(217, 217, 217)","rgb(188, 128, 189)","rgb(204, 235, 197)","rgb(255, 237, 111)"],enumColors:{},getEnumColor:function(t){return t.color?t.color:(this.enumColors[t]||(this.enumTypeCount++,this.enumTypeCount>=this.enumColorPalette.length&&(this.enumTypeCount=0),this.enumColors[t]=this.enumColorPalette[this.enumTypeCount]),this.enumColors[t])},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},componentToHex:function(t){"string"==typeof t&&(t=+t);var e=t.toString(16);return 1==e.length?"0"+e:e},rgbToHex:function(t,e,n){if(null==e){var i=/^rgb *([0-9]+) *, *([0-9]+) *, *([0-9]+)(,|\)).*/i.exec(t);if(!(i=/^rgb *\( *([0-9]+) *,([0-9]+) *, *([0-9]+).*/i.exec(t)))return null;t=i[1],e=i[2],n=i[3]}return t&&e&&n?"#"+Utils.componentToHex(t)+Utils.componentToHex(e)+Utils.componentToHex(n):null},hexStringToInt:function(t){return hex=parseInt(t.replace(/^#/,""),16)}},GuiUtils={getProxyUrl:function(t){return RamaddaUtil.getUrl("/proxy?trim=true&url=")+encodeURIComponent(t)},showingError:!1,pageUnloading:!1,handleError:function(t,e,n){this.pageUnloading||(console.log(t),console.trace(),e&&console.log(e),this.showingError||(n&&(this.showingError=!0,this.showingError=!1),Utils.closeFormLoadingDialog()))},isJsonError:function(t){if(null==t)return this.handleError("Null JSON data",null,!1),!0;if(null!=t.error){var e=t.errorcode;return null==e&&(e="error"),this.handleError("Error in Utils.isJsonError:"+t.error,null,!1),!0}return!1},loadXML:function(t,e,n){var i=!1;if(window.XMLHttpRequest)try{i=new XMLHttpRequest}catch(t){i=!1}else if(window.ActiveXObject)try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){i=!1}}i&&(i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(i,n)},i.open("GET",t,!0),i.send(""))},loadHtml:async function(t,e){await $.get(t,(function(t){e(t)})).done((function(){})).fail((function(){console.log("Failed to load url: "+t)}))},loadUrl:function(t,e,n){var i=!1;if(window.XMLHttpRequest)try{i=new XMLHttpRequest}catch(t){i=!1}else if(window.ActiveXObject)try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){i=!1}}i&&(i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(i,n)},i.open("GET",t,!0),i.send(""))},getUrlArg:function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==n||""==n?e:n[1]},setCursor:function(t){var e=document.cursor;!e&&document.getElementById&&(e=document.getElementById("cursor")),e||(document.body.style.cursor=t)},getDomObject:function(t){let e=new DomObject(t);return e.obj?e:null},getEvent:function(t){return t||window.event},getEventX:function(t){return t.pageX?t.pageX:t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft},getEventY:function(t){return t.pageY?t.pageY:t.clientY+document.body.scrollTop+document.documentElement.scrollTop},getTop:function(t){return t?t.offsetTop+this.getTop(t.offsetParent):0},getBottom:function(t){return t?this.getTop(t)+t.offsetHeight:0},setPosition:function(t,e,n){t.style.top=n,t.style.left=e},getLeft:function(t){return t?t.offsetLeft+this.getLeft(t.offsetParent):0},getRight:function(t){return t?t.offsetRight+this.getRight(t.offsetParent):0},getStyle:function(t){return t.style?t.style:document.layers?document.layers[t.name]:null},size_format:function(t){return t=t>=1073741824?number_format(t/1073741824,2)+" GB":t>=1048576?number_format(t/1048576,2)+" MB":t>=1024?number_format(t/1024,0)+" KB":number_format(t,0)+" bytes"},inputLengthOk:function(t,e,n){var i=$("#"+t).val();if(null==i)return!0;if(n){if(i.length<e)return Utils.closeFormLoadingDialog(),!1}else if(i.length>e)return Utils.closeFormLoadingDialog(),!1;return!0},inputValueOk:function(t,e,n){var i=$("#"+t).val();return null==i||(n&&i<e?(Utils.closeFormLoadingDialog(),!1):!(!n&&i>e)||(Utils.closeFormLoadingDialog(),!1))},inputIsRequired:function(t,e,n){var i=$("#"+t).val();return null!=i&&0!=i.trim().length||(Utils.closeFormLoadingDialog(),!1)}},ID="id",BACKGROUND="background",CLASS="class",DIV="div",POSITION="position",WIDTH="width",ALIGN="align",VALIGN="valign",HEIGHT="height",SRC="src",STYLE="style",TABLE="table",TITLE="title",THEAD="thead",TBODY="tbody",TFOOT="tfoot",TR="tr",TD="td",BR="br",PRE="pre",TAG_A="a",TAG_B="b",TAG_DIV="div",SELECT="select",OPTION="option",VALUE="value",TAG_IMG="img",TAG_INPUT="input",TAG_LI="li",TAG_SELECT="select",TAG_OPTION="option",TAG_TABLE="table",TAG_TR="tr",TAG_TD="td",TAG_UL="ul",TAG_OL="ol",ATTR_WIDTH="width",ATTR_HREF="href",ATTR_BORDER="border",ATTR_VALUE="value",ATTR_TITLE="title",ATTR_ALT="alt",ATTR_ID="id",ATTR_CLASS="class",ATTR_SIZE="size",ATTR_STYLE="style",ATTR_ALIGN="align",ATTR_VALIGN="valign",SPACE="&nbsp;",SPACE1="&nbsp;",SPACE2="&nbsp;&nbsp;",SPACE3="&nbsp;&nbsp;&nbsp;",SPACE4="&nbsp;&nbsp;&nbsp;&nbsp;",HU=HtmlUtils=window.HtmlUtils=window.HtmlUtil={me:"HtmlUtils",loaded:{},getTitleBr:function(){return"&#10;"},initPageSearch:function(t,e,n,i,a){a=a??{};let r=HU.getUniqueId("search_"),l=HU.input("","",["id",r,"placeholder",n??"Search","size","15"]);a.target?$(a.target).html(l):document.write(l),jqid(r).focus(),jqid(r).keyup((function(){HU.doPageSearch($(this).val(),t,e,i)}))},doPageSearch(t,e,n,i){let a=$(e);i&&(Utils.stringDefined(t)?$(i).hide():$(i).show()),a.each((function(){let e=!0;if(Utils.stringDefined(t)){t=t.toLowerCase(),e=!1,Utils.stripTags($(this).html()).toLowerCase().indexOf(t)>=0&&(e=!0)}e?($(this).attr("isvisible","true"),$(this).show()):($(this).attr("isvisible","false"),$(this).fadeOut())})),n&&$(n).each((function(){let t=!1;$(this).find(e).each((function(){"true"===$(this).attr("isvisible")&&(t=!0)})),t?$(this).show():$(this).fadeOut()}))},initScreenshot:function(t){t.width/=2,$(t).css("display","inline-block").css("max-width","90vw")},insertIntoTextarea:function(t,e){"string"==typeof t&&(t=document.getElementById(t)),e=Utils.decodeText(e);var n=t.scrollTop;if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e;else if(t.selectionStart||"0"==t.selectionStart){var i=t.selectionStart,a=t.selectionEnd;t.value=t.value.substring(0,i)+e+t.value.substring(a,t.value.length);let n=i+e.length;t.selectionEnd=n}else t.value+=e;t.scrollTop=n},initLoadingImage:function(t){setTimeout((()=>{$(t).removeClass("ramadda-image-loading")}),2e3)},initRadioToggle(t,e){$(t).find("input[type=radio]").change((function(){for(a in e)a==$(this).attr("value")?$(e[a]).show():$(e[a]).hide()}))},initToggleAll:function(t,e){jqid(t).change((function(){let t=$(this).is(":checked");$(e).prop("checked",t),$(e).trigger("change")}))},getEmojis:function(t){this.emojis?t(this.emojis):$.getJSON(RamaddaUtil.getCdnUrl("/emojis/emojis.json"),(e=>{let n,i=[],a={};this.emojis=[],e.forEach((t=>{let e=t.category??n;e&&(n=e);let r=a[e];r||(r={name:e,images:[]},a[e]=r,i.push(r));let l=t.image;l.startsWith("/")||(l="/emojis/"+l),r.images.push({name:t.name,image:RamaddaUtil.getCdnUrl(l)})})),this.emojis=i,t(this.emojis)})).fail((t=>{console.log("Failed to load json:")}))},loadJqueryLib:function(t,e,n,i,a){let r=!1;HtmlUtils.loaded[t]||(e.forEach((t=>{$("<link rel='stylesheet' href='"+t+"' crossorigin='anonymous'>").appendTo("head")})),n.forEach((t=>{$("<script src='"+t+"'  type=text/JavaScript><\/script>").appendTo("head")})),HtmlUtils.loaded[t]=!0),$(i)[t]?a():setTimeout((()=>{HtmlUtils.loadJqueryLib(t,e,n,i,a)}),50)},createFancyBox:function(t,e){e=e||{},HtmlUtils.loadJqueryLib("fancybox",[ramaddaCdn+"/lib/fancybox-3/jquery.fancybox.min.css"],[ramaddaCdn+"/lib/fancybox-3/jquery.fancybox.min.js"],t,(()=>{$(t).fancybox(e)}))},checkToHidePopup:function(){if(this.popupTime){var t=new Date;return timeDiff=t-this.popupTime,timeDiff>1e3}return!0},jqid:function(t){return $("#"+t)},initInteractiveInput:function(t,e){HU.jqid(t).keyup((function(t){HtmlUtils.hidePopupObject();let n=$(this).val();if(!Utils.stringDefined(n))return;let i=$(this);$.getJSON(e+"?text="+n,(t=>{if(0==t.length)return;let e="";t.forEach((t=>{e+=HU.div([CLASS,"ramadda-clickable ramadda-suggest","suggest",t],t)}));let n=HU.div([CLASS,"ramadda-search-popup",STYLE,HU.css("max-width","200px","padding","4px")],e);HU.makeDialog({content:n,my:"left top",at:"left bottom",anchor:i}).find(".ramadda-suggest").click((function(){HtmlUtils.hidePopupObject(),i.val($(this).attr("suggest"))}))})).fail((t=>{console.log("suggest call failed:"+e+"\n"+t),console.dir(t)}))}))},getTooltip:function(){return $("#ramadda-popupdiv")},getPopupObject:function(){return this.popupObject},hasPopupObject:function(){return null!=this.popupObject},clearPopupObject:function(){this.popupObject=null},isPopupObject:function(t){return!(!this.popupObject||!t)&&this.popupObject.attr("id")==t.attr("id")},setPopupObject:function(t){return this.isPopupObject(t)||(this.popupObject&&this.hidePopupObject(null,!0),this.popupObject=t,this.popupObject.attr("addedMouseListener")||(this.popupObject.attr("addedMouseListener","true"),this.popupObject.mousedown((function(t){t.stopPropagation()}))),this.popupObjectTime=new Date),t},hidePopupObject:function(t,e){if(!e&&this.popupObjectTime){if((new Date).getTime()-this.popupObjectTime.getTime()<500)return}this.popupObjectTime=null,this.popupObject&&(this.popupObject.hide(),"true"==this.popupObject.attr("removeonclose")&&this.popupObject.remove(),this.popupObject=null),this.popupTime=new Date,t&&t.stopPropagation()},lastCbxClicked:null,lastCbxIdClicked:null,checkboxClicked:function(t,e,n){if(!t)return;let a=GuiUtils.getDomObject(n);if(!a)return;a=a.obj;let r=new Array;if(!a.form)return;let l=a.form.elements;for(i=0;i<l.length;i++)(l[i].name.indexOf(e)>=0||l[i].id.indexOf(e)>=0)&&r.push(l[i]);let s=a.checked;if(t.ctrlKey)for(i=0;i<r.length;i++)r[i].checked=s;if(t.shiftKey){if(HtmlUtils.lastCbxClicked){let t=GuiUtils.getTop(a),e=GuiUtils.getTop(HtmlUtils.lastCbxClicked),l=$("#"+HtmlUtils.lastCbxIdClicked),o=$("#"+n);if(l.position()&&(e=l.offset().top),o.position()&&(t=o.offset().top),t>e){let n=t;t=e,e=n}for(i=0;i<r.length;i++){let n=$("#"+r[i].id).offset().top;n>=t&&n<=e&&(r[i].checked=s)}}}else HtmlUtils.lastCbxClicked=a,HtmlUtils.lastCbxIdClicked=n},tabLoaded:function(t,e){window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout(),window.ramaddaMapCheckLayout&&ramaddaMapCheckLayout()},elementScrolled:function(t){var e=$(window).scrollTop(),n=e+$(window).height(),i=$(t).offset().top,a=i+$(t).outerHeight(!0);return i<=n&&i>=e||(a<=n&&a>=e||a>=n&&i<=e)},initOdometer:function(t,e,n,i){Utils.isDefined(n)||(n=0),$(document).ready((function(){i?$("#"+t).html(e):setTimeout((function(){HtmlUtils.elementScrolled("#"+t)?setTimeout((function(){$("#"+t).html(e)}),n):$(window).scroll((function(){HtmlUtils.elementScrolled("#"+t)&&setTimeout((function(){$("#"+t).html(e)}),n)}))}),1e3)}))},callWhenScrolled:function(t,e,n){Utils.isDefined(n)||(n=0),$(document).ready((function(){setTimeout((function(){HtmlUtils.elementScrolled("#"+t)?setTimeout(e,n):$(window).scroll((function(){HtmlUtils.elementScrolled("#"+t)&&setTimeout(e,n)}))}),1e3)}))},waitForIt:function(t,e,n,i){window[t]?e():(Utils.isDefined(i)||(i=500),0!==i?setTimeout((()=>{HtmlUtils.waitForIt(t,e,n,i-1)}),50):n&&n())},loadAndWait:function(t,e,n,i){if(!window[t]){$(e).appendTo("head")}HtmlUtils.waitForIt(t,n,i)},makeMessage:function(t,e){return"<div class='ramadda-message ramadda-message-plain ' id='messageblock'><table width='100%'><tbody><tr valign='top'><td width='5%'><div class='ramadda-message-icon'><span><i class='"+t+"' style='font-size:32pt;'></i></span></div></td><td><div class='ramadda-message-inner'><p>"+e+"</p></div></td></tr></tbody></table></div>"},makeErrorMessage:function(t){return HtmlUtils.makeMessage("fas fa-exclamation-triangle text-danger",t)},makeInfoMessage:function(t){return HtmlUtils.makeMessage("fas fa-info",t)},makeRunningMessage:function(t){return HtmlUtils.makeMessage("fas fa-spinner fa-spin",t)},makeSlides:async function(t,e,n){Utils.isDefined(n)||(n=0),await HtmlUtils.loadSlides();let i={dots:!0};e&&$.extend(i,e),$("#"+t).slick(i),HtmlUtils.swapHtml("#"+t+"_headercontents","#"+t+"_header"),setTimeout((()=>{let e=$("#"+t+"_header"),n=e.find(".ramadda-slides-header-item");n.click((function(){let e=+$(this).attr("slideindex");$("#"+t).slick("slickGoTo",e)})),$("#"+t).on("afterChange",(function(t,i,a){n.removeClass("ramadda-slides-header-item-selected"),e.find(HtmlUtils.attrSelect("slideindex",a)).addClass("ramadda-slides-header-item-selected")}))}))},loadSlides:async function(){return!!HtmlUtils.slidesLoaded||($("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:RamaddaUtil.getCdnUrl("/lib/slick/slick.css")}),$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:RamaddaUtil.getCdnUrl("/lib/slick/slick-theme.css")}),await Utils.importJS(RamaddaUtil.getCdnUrl("/lib/slick/slick.min.js")),HtmlUtils.slidesLoaded=!0,!1)},loadKatex:function(t,e){if(!window.katex){$("<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Main-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Math-Italic.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Size2-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Size4-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'/>\n<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Lato:300,400,700,700i'>\n<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css' crossorigin='anonymous'>\n<script defer src='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js' crossorigin='anonymous'><\/script>").appendTo("head")}HtmlUtils.waitForIt("katex",t,e)},applyMarkdown:function(t,e){let n="<script src='"+ramaddaCdn+"/lib/showdown.min.js'/>";HtmlUtils.loadAndWait("showdown",n,(()=>{let n=$("#"+t).html();try{var i=(new showdown.Converter).makeHtml(n);$("#"+e).html(i)}catch(t){$("#"+e).html("Error processing markdown:"+t)}}),(()=>{$("#"+e).html("Error loading showdown")}))},applyLatex:function(t,e){HtmlUtils.loadKatex((()=>{let n=$("#"+t).html();try{var i=katex.renderToString(n,{throwOnError:!0});$("#"+e).html(i)}catch(t){$("#"+e).html("Error processing markdown:"+t)}}),(()=>{$("#"+e).html("Error loading katex")}))},isFontAwesome:function(t){return t.startsWith("fa-")||t.startsWith("fas ")||t.startsWith("far ")||t.startsWith("fab ")},getIconImage:function(t,e,n){if(HtmlUtils.isFontAwesome(t)){let i;return i=t.startsWith("fa-thin")||t.startsWith("fa-light")||t.startsWith("fa-regular")||t.startsWith("fa-solid")||t.startsWith("fas ")||t.startsWith("fab ")||t.startsWith("far")?["class",t]:["class","fas "+t],n&&(i=Utils.mergeLists(i,n)),HtmlUtils.span(e,HtmlUtils.tag("i",i))}return HtmlUtils.image(t,e)},getObjectURL:function(t){return(window.URL||window.webkitURL).createObjectURL(t)},getErrorDialog:function(t){return'<div class="ramadda-message"><table><tr valign=top><td><div class="ramadda-message-link"><img border="0"  src="/repository/icons/error.png"  /></div></td><td><div class="ramadda-message-inner">'+t+"</div></td></tr></table></div>"},makeBreadcrumbsInit:function(t){if(Utils.getPageLoaded())HtmlUtils.makeBreadcrumbs(t);else{let e=t;Utils.addLoadFunction((()=>{HtmlUtils.makeBreadcrumbs(e)}))}},makeBreadcrumbs:function(t){let e=jQuery("#"+t),n=4;e.find("li").length>5&&(n=0),e.jBreadCrumb({previewWidth:0,easing:"easeOutQuad",beginingElementsToLeaveOpen:0,endElementsToLeaveOpen:n})},tooltipInit:function(t,e){$("#"+e).dialog({autoOpen:!1,minWidth:650,hide:{effect:"blind",duration:250}}),$("#"+t).click((function(){$("#"+e).dialog("open")}))},join:function(t,e){t.forEach||(t=[t]);let n="";return t.forEach(((t,i)=>{i>0&null!=e&&(n+=e),n+=t})),n},qt:function(t){return'"'+t+'"'},sqt:function(t){return"'"+t+"'"},getUniqueId:function(t){return window.uniqueCnt||(window.uniqueCnt=(new Date).getTime()),(t||"id_")+window.uniqueCnt++},inset:function(t,e,n,i,a){var r="";return e&&(r+="padding-top: "+e+"px; "),n&&(r+="padding-left: "+n+"px; "),i&&(r+="padding-bottom: "+i+"px; "),a&&(r+="padding-right: "+a+"px; "),HtmlUtils.div(["style",r],t)},makeTabs(t,e){let n={};e&&$.extend(n,e);let i=HU.getUniqueId("tabs_"),a=HU.open("div",["id",i]);return a+="\n",a+="<ul>\n",t.forEach(((t,e)=>{a+=HU.tag("li",[],HU.href("#"+i+"-"+(e+1),t.label??t.header)),a+="\n"})),a+="</ul>\n",t.forEach(((t,e)=>{let r=t.contents;n.contentsStyle&&(r=HU.div(["style",n.contentsStyle],r)),a+=HU.div(["id",i+"-"+(e+1)],r),a+="\n"})),a+="</div>",{contents:a,init:()=>{$("#"+i).tabs()}}},makeAccordionHtml(t){let e=HU.getUniqueId("accordion_"),n=HU.open("div",["class","ui-accordion ui-widget ui-helper-reset","id",e]);return t.forEach((t=>{n+=HU.tag("h3",["class","ui-accordion-header ui-helper-reset ui-corner-top","style","border:0px;background:none;"],HU.href("#",HU.span(["class","ramadda-clickable"],t.header??t.label))),n+=HU.div(["id",HU.getUniqueId("accordion_"),"class","ramadda-accordion-contents"],t.contents)})),n+="</div>",{id:e,contents:n,init:()=>{HU.makeAccordion("#"+e)}}},makeAccordion:function(t,e){null==e&&(e={heightStyle:"content",collapsible:!0,active:0,decorate:!1,animate:200});var n={header:"iconClosed",activeHeader:"iconOpen"};$((function(){$(t+" .ramadda-accordion-contents").css("display","block");var i={animate:200,icons:n,collapsible:!0,heightStyle:"content",active:0,decorate:!0,activate:function(){window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout()}};($.extend(i,e),i.decorate)||$(t+" .ui-accordion-header").css("padding","0em 0em 0em 0em");i.active<0&&(i.active="none");let a=$(t).accordion(i),r=function(t,e){e.stopPropagation();let n=t.closest(".ui-accordion-header");n.find(":checkbox").is(":checked")?n.css("background","#fffeec"):n.css("background","transparent")},l=function(t){r($(this),t)};a.find(".accordion-toolbar").find(":checkbox").click(l),a.find(".accordion-toolbar").find("label").click(l),a.find(".accordion-toolbar").find(":checkbox").change((function(t){r($(this),t)}))}))},buttons:function(t,e,n){let i=Utils.wrap(t,"<div style='display:inline-block;margin-right:6px;'>","</div>");return HU.div(["class",e??"ramadda-button-bar","style",n??""],i)},hbox:function(t,e){let n=HtmlUtils.openTag("tr",["valign","top"]);return n+=Utils.wrap(t,"<td align=left>"+HU.open("div",["style",e??""]),"</div></td>"),n+="</tr>",this.tag("table",["border","0","cellspacing","0","cellpadding","0"],n)},vbox:function(t){let e=HtmlUtils.join(t,"<br>");return this.div([STYLE,HU.css("display","inline-block")],e)},makeOkCancelDialog:function(t,e,n,i,a){let r=[HU.div(["action","ok","class","ramadda-button ramadda-clickable"],"OK"),HU.div(["class","ramadda-button ramadda-clickable"],"Cancel")];a&&r.push(a);let l=e+"<br>"+HU.buttons(r);l=HU.div(["class","ramadda-popup-dialog ramadda-nowrap"],l);let s=HU.makeDialog({content:l,header:!1,anchor:t,my:"left top",at:"left bottom"});s.find(".ramadda-clickable").button().click((function(){"ok"==$(this).attr("action")?n():i&&i(),s.remove()}))},leftRight:function(t,e,n,i){return null==n&&(n="6"),null==i&&(i="6"),this.div(["class","row"],this.div(["class","col-md-"+n],t)+this.div(["class","col-md-"+i,"style","text-align:right;"],e))},leftCenterRight:function(t,e,n,i,a,r,l,s){return l||(l={}),l.valign||(l.valign="top"),s||(s=""),this.tag("table",["border",0,"width","100%","cellspacing","0","cellpadding","0"],this.tr(["valign",l.valign],this.td(["align","left","width",i,STYLE,s],t)+this.td(["align","center","width",a,STYLE,s],e)+this.td(["align","right","width",r,STYLE,s],n)))},row:function(){let t="<table cellpadding=0 cellspacing=0 border=0 width=100%><tr valign=center>";return Array.from(arguments).forEach((e=>{Array.isArray(e)?t+=HtmlUtils.tag("td",e[0],e[1]):t+=HtmlUtils.tag("td",[],e)})),t+="</tr></table>",t},hrow:function(){let t="";return Array.from(arguments).forEach((e=>{t+=HtmlUtils.div(["style","display:inline-block"],e)})),t},leftRightTable:function(t,e,n,i,a){a||(a={}),a.valign||(a.valign="top");var r=["align","left"],l=["align","right"];return n&&(r.push("width"),r.push(n)),i&&(l.push("width"),l.push(i)),this.tag("table",["border","0","width","100%","cellspacing","0","cellpadding","0"],this.tr(["valign",a.valign],this.td(r,t)+this.td(l,e)))},heading:function(t){return this.tag("h3",[],t)},bootstrapClasses:["col-md-12","col-md-6","col-md-4","col-md-4","col-md-4","col-md-2"],getBootstrapClass:function(t){return t-=1,(t=Math.max(t,0))<this.bootstrapClasses.length?this.bootstrapClasses[t]:"col-md-1"},toggleDialogs:{},makeDialog:function(args){HtmlUtils.hidePopupObject(null,!0);let opts={modal:!1,modalContentsCss:"",sticky:!1,content:null,contentId:null,anchor:null,draggable:!1,resizable:!1,decorate:!0,header:!1,headerRight:null,remove:!0,my:"left top",at:"left bottom",animate:!1,animateSpeed:300,title:"",inPlace:!0,fit:!0},parentId,html;if(args&&(""==args.at&&delete args.at,""==args.my&&delete args.my,$.extend(opts,args)),opts.toggleid&&this.toggleDialogs[opts.toggleid]){let t=this.toggleDialogs[opts.toggleid];if(t.is(":visible"))return t.hide(),void(this.toggleDialogs[opts.toggleid]=null)}opts.anchor&&"string"==typeof opts.anchor&&(opts.anchor=$("#"+opts.anchor)),opts.anchor&&0==opts.anchor.length&&(console.log("Utils.makeDialog: Invalid anchor"),console.trace(),opts.anchor=null),opts.content&&(opts.inPlace=!1),opts.inPlace?(opts.remove=!1,parentId=HtmlUtils.getUniqueId(),html=HU.div([ID,parentId,STYLE,HU.css()],HU.SPACE)):(html=opts.content,null==html&&(html=opts.contentId?$("#"+opts.contentId).html():"No html provided"));let id=HtmlUtils.getUniqueId();if(opts.header&&(html=HU.div([CLASS,"ramadda-popup-inner"],html)),opts.header){let t=HtmlUtils.div([TITLE,"Close",CLASS,"ramadda-popup-close"],HU.jsLink("",HtmlUtils.getIconImage(icon_close),[ID,id+"_close",STYLE,HU.css("cursor","pointer")])),e=HU.div([CLASS,"ramadda-popup-title"],opts.title),n=t+e;opts.headerRight&&(n+=HU.div(["style",HU.css("position","absolute","top","0px","right","0px")],opts.headerRight));let i=HtmlUtils.div([STYLE,HU.css("position","relative","text-align","left"),"class","ramadda-popup-header"],n);html=i+html}(opts.decorate||opts.header)&&(html=HU.div([CLASS,"ramadda-popup"],html));let innerId=HU.getUniqueId("model_inner");opts.modal&&(html=HU.div([ID,innerId,STYLE,opts.modalContentsCss,CLASS,"ramadda-modal-contents"],html),html=HU.div([CLASS,"ramadda-modal"],html));let popup=$(html).appendTo("body");if(opts.remove&&popup.attr("removeonclose","true"),opts.inPlace){let t=$("#"+opts.contentId),e=$("#"+parentId);e.css("display","block").css("width","fit-content").css("height","fit-content"),t.appendTo(e),t.show()}if(opts.anchor&&(opts.width&&popup.css("width",opts.width),popup.position({of:opts.anchor,my:opts.my,at:opts.at,collision:opts.fit?"fit fit":null})),opts.animate&&"false"!==opts.animate)if(opts.animateSpeed=+opts.animateSpeed,popup.hide(),opts.slideLeft){let t="right bottom";popup.position({of:opts.anchor,my:opts.my,at:t,collision:opts.fit?"fit fit":null}),popup.show("slide",{direction:"right"},+opts.animateSpeed)}else popup.show(opts.animateSpeed);else popup.show();return opts.resizable&&(opts.modal?$("#"+innerId).resizable():popup.resizable()),opts.draggable?opts.modal?$("#"+innerId).draggable():popup.draggable():opts.sticky||opts.toggleid||HtmlUtils.setPopupObject(popup),opts.header&&$("#"+id+"_close").click((function(){popup.hide(),opts.callback&&opts.callback(popup),opts.remove&&popup.remove()})),opts.initCall&&("string"==typeof opts.initCall?eval(opts.initCall):opts.initCall()),opts.toggleid&&(this.toggleDialogs[opts.toggleid]=popup),popup},addToDocumentUrl:function(t,e,n){if(Utils.isPost())return;let i=String(window.location);n?(i.includes("?")||(i+="?"),i+="&"+HtmlUtils.urlArg(t,e)):(i=new URL(i),null===e?i.searchParams.delete(t):i.searchParams.set(t,e));try{window.history.replaceState&&window.history.replaceState("","",i)}catch(t){console.log("err:"+t),console.trace()}return i},removeFromDocumentUrl:function(t){try{let e=String(window.location);e=e.replace("&?"+t+"=[^&]+&?",""),window.history.replaceState&&window.history.replaceState("","",e)}catch(t){console.log("err:"+t)}},getUrlArgument:function(t){return new URLSearchParams(window.location.search).get(t)},pre:function(t,e){return this.tag("pre",t,e)},div:function(t,e){return this.tag("div",t,e)},center:function(t,e){return this.tag("center",e,t)},span:function(t,e){return this.tag("span",t,e)},movie:function(t,e){let n="";return e&&(n=HU.attrs(e)),"<video src='"+t+"' "+n+" controls='controls'></video>"},image:function(t,e){return"<img "+this.attrs(["src",t,"border","0"])+" "+this.attrs(e)+"/>"},swapHtml:function(t,e){$(document).ready((function(){let n=$(t),i=$(e);n.appendTo(i)}))},table:function(t,e){return HU.tag("table",t,e)},tr:function(t,e){return this.tag("tr",t,e)},css:function(...t){1==t.length&&Array.isArray(t[0])&&(t=t[0]);let e="";for(let n=0;n<t.length;n+=2)e+=t[n]+":"+t[n+1]+";";return e},h2:function(t){return HU.tag("h2",[],t)},h3:function(t){return HU.tag("h3",[],t)},cssTag:function(t){return'<style type="text/css">\n'+t+"</style>"},cssLink:function(t){return"<link href='"+t+"'  rel='stylesheet'  type='text/css' />"},javascriptLink:function(t){return"<script type='text/javascript' src='"+t+"'><\/script>"},BR_ENTITY:"&#10;",makeMultiline:function(t){return Utils.join(t,HtmlUtils.BR_ENTITY)},getDimension:t=>t?((t=String(t).trim()).match("calc")&&(t=(t=t.replace(/calc *\(/,"calc(").replace(/-/," - ").replace(/\+/," + ")).replace(/([0-9]) *\)/,"$1px)")),t.endsWith(")")||t.endsWith("%")||t.endsWith("px")||t.endsWith("vh")?t:t+"px"):null,td:function(t,e){return this.tag("td",t,e)},tds:function(t,e){if(!e)return"";Array.isArray(e)||(e=[e]);let n="";for(let i=0;i<e.length;i++)n+=this.td(t,e[i]);return n},ths:function(t,e){let n="";for(let i=0;i<e.length;i++)n+=this.th(t,e[i]);return n},onReturnEvent:function(t,e){"string"==typeof t&&(t=$(t)),t.keyup((function(t){13==(t.keyCode?t.keyCode:t.which)&&e($(this),t)}))},formatTable:function(t,e,n){HtmlUtils.loadJqueryLib("DataTable",[ramaddaCdn+"/lib/datatables-1.13.1/datatables.min.css"],[ramaddaCdn+"/lib/datatables-1.13.1/datatables.min.js"],t,(()=>{$(t).each((function(){if($.fn.dataTable.isDataTable(this))return;let t=HtmlUtils.formatTableInner($(this),e);n&&n($(this),t)}))}))},formatTableInner:function(t,e){let n={paging:!1,ordering:!1,info:!1,searching:!1,scrollCollapse:!0,retrieve:!0,fixedHeader:!1};e&&$.extend(n,e);let i=n.height||t.attr("table-height");i&&(n.scrollY=i);let a=t.attr("table-ordering");a&&(n.ordering="true"==a);let r=t.attr("table-searching");r&&(n.searching="true"==r);let l=t.attr("table-paging");if(l&&(n.paging="true"==l),Utils.isDefined(n.scrollY)){(""+n.scrollY).endsWith("px")||(n.scrollY+="px")}return t.DataTable(n),t},th:function(t,e){return this.tag("th",t,e)},attrSelect:function(t,e){return"["+t+'="'+e+'"]'},scrollToAnchor:function(t,e,n){Utils.isDefined(e)||(e=-50);let i=$("a[name='"+t+"']");if(e||(e=0),e=+e,Utils.scrollToAnchorTime=new Date,n){let t=jqid(n),e=i;t.animate({scrollTop:e.offset().top-t.offset().top+t.scrollTop()},1e3)}else $("html,body").animate({scrollTop:i.offset().top+e},"slow"),location.hash=t},scrollVisible:function(t,e,n){if(0==e.length||0==t.length)return;let i=e.offset().top-t.offset().top;Utils.isDefined(n)||(n=1e3),t.animate({scrollTop:i+t.scrollTop()},n)},initNavPopup:function(t,e){let n={align:"left"};e&&$.extend(n,e),$("#"+t).click((function(){let e,i,a=HtmlUtils.setPopupObject($("#"+t+"-popup"));"right"==n.align?(e="right top",i="right top"):(e="left top",i="right+5 top"),a.show(),a.position({of:a.parent(),my:e,at:i,collision:"fit fit"})}))},navLinkClicked:function(t,e){$(".ramadda-nav-left-link").removeClass("ramadda-nav-link-active"),$("#"+t+"_href").parent().addClass("ramadda-nav-link-active"),HtmlUtils.scrollToAnchor(t,e)},initNavLinks:function(t){let e={leftOpen:!0,showToggle:!0,leftWidth:"250px"};t&&$.extend(e,t);let n=$(".ramadda-nav-left"),i=$(".ramadda-nav-right");if(e.showToggle){let t=HU.div(["toggle-state",e.leftOpen?"open":"closed",TITLE,"Toggle left",ID,"ramadda-nav-left-toggle",CLASS,"ramadda-nav-left-toggle"],HtmlUtils.getIconImage("fa-bars"));$(t).appendTo(i),$("#ramadda-nav-left-toggle").click((function(){let t="closed"===$(this).attr("toggle-state");t?(n.show(),i.animate({"margin-left":e.leftWidth})):(n.hide(),i.animate({"margin-left":"0px"})),$(this).attr("toggle-state",t?"open":"closed")}))}let a=$(".ramadda-nav-left-links");a.mouseenter((function(){Utils.linksMouseIn=!0})),a.mouseleave((function(){Utils.linksMouseIn=!1}));let r=$(".ramadda-nav-anchor"),l=$(".ramadda-nav-left-link"),s=null;$(window).scroll((function(){if(Utils.linksMouseIn)return;let t=!1;if(Utils.scrollToAnchorTime){t=(new Date).getTime()-Utils.scrollToAnchorTime.getTime()<2e3}let e=$(window).scrollTop(),n=e+$(window).height(),i=null,a=null;if(r.each((function(){let t=$(this).offset().top,r=t+$(this).outerHeight(!0);(t<=n&&t>=e||r<=n&&r>=e||r>=n&&t<=e)&&(null==a||t<a)&&(a=t,i=$(this))})),!i)return;if(s&&s.attr("name")==i.attr("name"))return;s=i,l.removeClass("ramadda-nav-link-active");let o=null;l.each((function(){$(this).attr("navlink")==i.attr("name")&&($(this).addClass("ramadda-nav-link-active"),o=$(this))})),!t&&o&&HtmlUtils.scrollVisible(o.parent(),o,100)}))},setFormValue:function(t,e){$("#"+t).val(e)},setHtml:function(t,e){$("#"+t).html(e)},formTable:function(){return this.openTag("table",["class","formtable","cellspacing","0","cellspacing","0"])},formTableClose:function(){return this.closeTag("table")},formEntryTop:function(t,e,n){return n?HU.tag("tr",["valign","top"],HU.tag("td",["class","formlabel","align","right"],t)+HU.tag("td",[],e)+HU.tag("td",[],n)):this.tag("tr",["valign","top"],this.tag("td",["class","formlabel","align","right"],t)+this.tag("td",[],e))},formEntry:function(t,e){return this.tag("tr",[],this.tag("td",["class","formlabel","align","right"],t)+this.tag("td",[],e))},appendArg:function(t,e,n){return t.indexOf("?")<0?t+="?":t+="&",t+=HtmlUtils.urlArg(e,n)},getUrl:function(t,e){e.length>0&&(t+="?");for(let n=0;n<e.length;n+=2)n>0&&(t+="&"),t+=this.urlArg(e[n],e[n+1]);return t},b:function(t){return this.tag("b",[],t)},td:function(t,e){return this.tag("td",t,e)},th:function(t,e){return this.tag("th",t,e)},tag:function(t,e,n){n||"string"!=typeof e||(n=e,e=null);let i="<"+t+" "+this.attrs(e)+">";return null!=n&&(i+=n),i+="</"+t+">",i},openTag:function(t,e,n){let i="<"+t+" "+this.attrs(e)+">";return null!=n&&(i+=n),i},open:function(t,e,n){let i="<"+t+" "+this.attrs(e)+">";return n&&(i+=n),i},openRow:function(){return this.openTag("div",["class","row"])},closeRow:function(){return this.closeTag("div")},openDiv:function(t){return this.openTag("div",t)},closeDiv:function(){return this.closeTag("div")},closeTag:function(t){return"</"+t+">\n"},close:function(...t){let e="";return t.forEach((t=>{e+="</"+t+">\n"})),e},urlArg:function(t,e){return t+"="+encodeURIComponent(e)},attrSelect:function(t,e){return Utils.isDefined(e)?"["+t+"='"+e+"']":"["+t+"]"},space:function(t){let e="";for(let n=0;n<t;n++)e+="&nbsp;";return e},attr:function(t,e){return null==e?" "+t+" ":" "+t+"="+this.qt(e)+" "},attrs:function(t){if(!t)return"";if("string"==typeof t)return t;let e="";if(null==t)return e;if(1==t.length)return t[0];for(let n=0;n<t.length;n+=2){let i=t[n];if(!i)continue;let a=t[n+1];e+=null==a?" "+i+" ":this.attr(i,a)}return e},styleAttr:function(t){return this.attr("style",t)},classAttr:function(t){return this.attr("class",t)},makeFullScreen:function(t){if(null==t)return console.log("HtmlUtils.makeFullScreen: null elem argument"),void console.trace();t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():console.err("No full screen")},makeExpandable:function(t,e){let n=HtmlUtils.getIconImage("fas fa-expand-arrows-alt",["class","ramaddda-clickable"],[]),i=HtmlUtils.getUniqueId(),a=HtmlUtils.div(["id",i,"title","Expand","class","ramadda-expandable-link","style","display:none;cursor:pointer;text-align:right;position:absolute;right:0px;top:0px;margin-top:0px;"],n);$(t).append(a);let r=$("#"+i),l=$(t).hasClass("ramadda-expand-now");r.attr("data-expanded",l);let s=$(t).css("background");$(t).mouseenter((function(){r.css("display","block")})),$(t).mouseleave((function(){r.css("display","none")}));let o=function(){let n,i="true"==$(this).attr("data-expanded");if(i)n=HtmlUtils.getIconImage("fa-expand-arrows-alt"),$(this).attr("title","Expand"),$(t).css("left","").css("right","").css("top","").css("bottom","").css("position","relative").css("height","").css("z-index","").css("background",s||""),r.css("display","none"),$(t).find(".ramadda-expandable-target").each((function(){$(this).attr("isexpanded","false"),$(this).attr("style",$(this).attr("original-style"))}));else{let i=$(window).height();n=HtmlUtils.getIconImage("fa-compress-arrows-alt");$(t).offset().top;if($(this).attr("title","Contract"),e){let e=$(t).find(".ramadda-expandable");return e.css("background","#fff"),void HtmlUtils.makeFullScreen(e.get(0))}$(t).css("left","50px").css("right","5px").css("top","5px").css("position","fixed").css("z-index","2000").css("background","#fff").css("height",i+"px"),$(t).find(".ramadda-expandable-target").each((function(){$(this).attr("original-style",$(this).attr("style")),$(this).attr("isexpanded","true");let t=$(this).attr("expandable-height");(t||-1!=t)&&$(this).css("height",t||"95vh")})),r.css("display","block")}$(this).attr("data-expanded",!i+""),$(this).html(n),window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout(),window.ramaddaMapCheckLayout&&ramaddaMapCheckLayout()};$("#"+i).click(o),l&&o()},makeDraggable:function(t){$(t).draggable({zIndex:1e3,drag:function(t,e){},start:function(t,e){if(!$(this).attr("started")){$(this).attr("started",!0);let t=$(this).offset();$(this).attr("oleft",t.left),$(this).attr("otop",t.top),$(this).css("position","absolute").css("left",t.left+"px").css("top",t.top+"px"),console.log("start:"+t.left+" "+t.top)}}})},idAttr:function(t){return this.attr("id",t)},link:function(t,e,n){null==n&&(n=[]);let a=[];for(i in n)a.push(n[i]);return(n=a).push("url"),n.push(t),n.push("class"),n.push("ramadda-link"),n.style?n.style+="display:inline-block;":n.style="style='display:inline-block;'",this.div(n,e)},getEntryImage:function(t,e){if(e.indexOf("::")>=0){var n=e.split("::");n[0].trim().length>0&&(t=n[0].trim());var i=n[1].trim();return RamaddaUtil.getUrl("/metadata/view/"+i+"?entryid="+t)}return e},jsLink:function(t,e,n){return n=n||[],HU.href("javascript:noop();",e,n)},url:function(t,e){let n=t;for(let t=0;t<e.length;t+=2){0==t&&n.indexOf("?")<0?n+="?":n+="&";let i=e[t],a=e[t+1];n+=encodeURIComponent(i)+"="+encodeURIComponent(a)}return n},href:function(t,e,n){null==n&&(n=[]);let i=[];for(let t in n)i.push(n[t]);return(n=i).push("href"),n.push(t),Utils.isDefined(e)&&""!=e||(e=t),this.tag("a",n,e)},onClick:function(t,e,n){let i=["onclick",t,"style","color:black;   cursor:pointer;"];if(null!=n)for(let t=0;t<n.length;t++)i.push(n[t]);return this.tag("a",i,e)},checkbox:function(t,e,n,i){(e=e||[]).push("id"),e.push(t),e.push("type"),e.push("checkbox"),e.includes("value")||(e.push("value"),e.push("true")),n&&(e.push("checked"),e.push(null));let a=this.tag("input",e);if(i){let n="";for(let t=0;t<e.length;t+=2)if("title"==e[t]){n=e[t+1];break}a+="&nbsp;"+HU.tag("label",["for",t,"title",n],i)}return a},radio:function(t,e,n,i,a,r){r||(r="");var l="<input id='"+t+"'  class='"+n+"' name='"+e+"' type=radio value='"+i+"' ";return a&&(l+=" checked "),l+=" "+r,l+="/>"},handleFormChangeShowUrl:function(t,e,n,i,r,l){let s={showInputField:!0,includeCopyArgs:!1};l&&$.extend(s,l),null==i&&(i=[".*OpenLayers_Control.*","authtoken"]);let o=$("#"+e).attr("action")+"?",d=$("#"+e+" :input"),c=0,u=[],h="",f={},m=(t,e)=>{let n=t+"---"+e;return!!f[n]||(f[n]=!0,!1)};d.each((function(t,e){if(""==e.name||null==e.value||""==e.value)return;if("-all-"==e.value)return;if("submit"==e.type&&"Cancel"==e.value)return;if("checkbox"==e.type&&!e.checked)return;if("radio"==e.type&&!e.checked)return;if(e.attributes&&e.attributes.default&&e.attributes.default.value==e.value)return;if(null!=i)for(t=0;t<i.length;t++){let n=i[t];if(e.name.match(n))return}if("formurl"==e.id)return;let n=e.attributes["default-value"]?.value;e.name;var r=[];if("select-multiple"==e.type&&e.selectedOptions)for(a in e.selectedOptions)option=e.selectedOptions[a],Utils.isDefined(option.value)&&n!=option.value&&r.push(option.value);else n!=e.value&&r.push(e.value);for(v in 1==r.length&&r.forEach((t=>{"entryid"!=e.name&&"submit"!=e.name&&"output"!=e.name&&(h+=e.name+"="+t+"\n")})),r)value=r[v],u.push({item:e,value:value}),m(e.name,value)||(c>0&&(o+="&"),c++,o+=encodeURIComponent(e.name)+"="+encodeURIComponent(value))}));let p=window.location.protocol+"//"+window.location.host;o=p+o;let g=s.showInputField?HtmlUtils.input("formurl",o,["size","80","id","formurl"]):HtmlUtils.hidden("formurl",o,["size","80","id","formurl"]),y="<p>"+HtmlUtils.div(["class","ramadda-form-url"],g+SPACE2+(s.includeCopyArgs?HU.span(["id","argscopy","class","ramadda-clickable","title","Copy json for subset action"],HtmlUtils.getIconImage("fas fa-earth-americas"))+SPACE2:"")+HU.span(["id","clipboard","class","ramadda-clickable","title","Copy URL to clipboard"],HtmlUtils.getIconImage("fas fa-clipboard"))+SPACE2+HU.href(o,HtmlUtils.getIconImage("fas fa-link"),["title","Form URL"]));r&&(y+=r({entryId:t,formId:e,inputs:d,itemValuePairs:u})),$("#"+n).html(y),jqid("argscopy").click((()=>{Utils.copyToClipboard(h),alert("args for subset are copied to clipboard")})),jqid("clipboard").click((()=>{Utils.copyToClipboard(jqid("formurl").val()),alert("URL copied to clipboard")}))},makeUrlShowingForm:function(t,e,n,i,a,r){$("#"+e+" :input").change((function(){HtmlUtils.handleFormChangeShowUrl(t,e,n,i,a,r)})),HtmlUtils.handleFormChangeShowUrl(t,e,n,i,a,r)},select:function(t,e,n,i,a,r){var l=this.openTag("select",e);return l+=HU.makeOptions(n,i,a,r),l+=this.closeTag("select")},makeOptions:function(t,e,n,i){let a="";return t.forEach((t=>{let i=t;Array.isArray(t)?(i=t[1],t=t[0]):Utils.isDefined(t.value)&&(i=t.label??t.value,t=t.value);let r=i;n&&i.length>n&&(i=i.substring(0,n)+"...");var l="";e&&Array.isArray(e)?e.indexOf(t)>=0&&(l=" selected "):e==t&&(l=" selected ");let s=r;t!=s&&(s=s+HU.getTitleBr()+t),a+=HU.tag("option",["title",s,l,null,"value",t],i)})),a},datePicker:function(t,e,n){return n.push("size"),n.push("8"),HtmlUtils.input(t,e,n)},datePickerInit:function(t){$("#"+t).datepicker({onSelect:function(t,e){t!==e.lastVal&&$(this).change()},dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,constrainInput:!1,yearRange:"1900:2100"})},rangeInput:function(t,e){var n='<form><div><input type="text" class="ramadda-slider-value sliderValue" data-index="0" value="10" /> <input type="text" class="ramadda-slider-value  sliderValue" data-index="1" value="90" /></div>'+HtmlUtils.div(["id",e])+"</form>";return console.log(n),n},rangeInputInit:function(t){$("#"+t).slider({min:0,max:100,step:1,values:[10,90],slide:function(t,e){for(var n=0;n<e.values.length;++n)$("input.sliderValue[data-index="+n+"]").val(e.values[n])}}),$("input.sliderValue").change((function(){var t=$(this);$("#slider").slider("values",t.data("index"),t.val())}))},input:function(t,e,n){return"<input "+HtmlUtils.attrs(n)+HtmlUtils.attrs(["name",t,"value",e])+">"},hidden:function(t,e,n){return"<input type=hidden "+HtmlUtils.attrs(n)+HtmlUtils.attrs(["name",t,"value",e])+">"},textarea:function(t,e,n){return"<textarea "+HtmlUtils.attrs(n)+HtmlUtils.attrs(["name",t])+">"+e+"</textarea>"},initSelect:function(t,e){if(0==t.length)return;let n={showEffect:"fadeIn",showEffectSpeed:400,hideEffect:"fadeOut",hideEffectSpeed:400,autoWidth:!1};e&&$.extend(n,e),$(document).ready((function(){HtmlUtils.loadJqueryLib("selectBoxIt",[ramaddaCdn+"/lib/selectboxit/stylesheets/jquery.selectBoxIt.css"],[ramaddaCdn+"/lib/selectboxit/javascripts/jquery.selectBoxIt.min.js"],t,(()=>{setTimeout((()=>{$(t).selectBoxIt(n)}),2)}))}))},valueDefined:function(t){return""!=t&&0!=t.indexOf("--")},squote:function(t){return"'"+t+"'"},makeToggle:function(t,e,n){null===n&&(n=!0);let i=ramaddaCdn+"/icons/togglearrowdown.gif",a=ramaddaCdn+"/icons/togglearrowright.gif";$("#"+t).attr("state","open"),$("#"+t).attr("src",i),$("#"+t).css("cursor","pointer");let r=t=>{t.attr("state","close"),t.attr("src",a),$("#"+e).hide()};$("#"+t).click((function(t){var n;"open"==$(this).attr("state")?r($(this)):((n=$(this)).attr("state","open"),n.attr("src",i),$("#"+e).show()),t.preventDefault()})),n||r($("#"+t))},makeSplash:function(t,e){let n={width:"50%",style:"",showOk:!0};if(e&&$.extend(n,e),n.src&&(t=$("#"+n.src).html()),null==t||""==t.trim())return;t=HU.div([STYLE,"margin:10px;"],t);let i=Utils.getUniqueId("close_"),a=HU.div([ID,i,CLASS,"ramadda-clickable",STYLE,HU.css("position","absolute","right","10px","top","10px")],HU.getIconImage("far fa-window-close"))+t;n.showOk&&(a+=HU.center(HU.div([ID,i+"_button"],"OK"))),a=HU.div([CLASS,"ramadda-shadow-box ramadda-splash",STYLE,HU.css("width",n.width)+n.style],a);let r=$(HU.div([CLASS,"ramadda-splash-container"],a)).appendTo($("body"));$("body").addClass("ramadda-splash-body");let l=()=>{$("body").removeClass("ramadda-splash-body"),r.remove()};r.click((t=>{})),$("#"+i).click((()=>{l()})),$("#"+i+"_button").button().click((()=>{l()}))},makeToggleImage:function(t,e){return e=e||"",HU.div([STYLE,HU.css("display","inline-block","min-width","10px")],HtmlUtils.getIconImage(t,["align","bottom"],[STYLE,e]))},toggleBlockListeners:{},toggleBlockVisibility:function(t,e,n,i,a){let r=!0;toggleVisibility(t,"block",a)?HU.isFontAwesome(n)?$("#"+e).html(HU.makeToggleImage(n)):$("#"+e).attr("src",n):(r=!1,HU.isFontAwesome(n)?$("#"+e).html(HU.makeToggleImage(i)):$("#"+e).attr("src",i)),Utils.ramaddaUpdateMaps(),HtmlUtils.toggleBlockListeners[t]&&HtmlUtils.toggleBlockListeners[t](t,r)},toggleBlock:function(t,e,n,i,a){let r={headerClass:"ramadda-noselect entry-toggleblock-label ramadda-hoverable ramadda-clickable",headerStyle:"",orientation:"h",imgopen:"fas fa-caret-down",imgclosed:"fas fa-caret-right"};i&&$.extend(r,i);let l="horizontal"==r.orientation;l&&(r.headerStyle+="line-height:1px;");let s=Utils.getUniqueId("block_"),o=s+"_img";a&&(a.id=s,a.imgid=o);let d=r.imgopen,c=r.imgclosed,u="HtmlUtils.toggleBlockVisibility("+HtmlUtils.join([HtmlUtils.squote(s),HtmlUtils.squote(o),HtmlUtils.squote(d),HtmlUtils.squote(c),r.animated],",")+");",h=HU.span([ID,o],HU.makeToggleImage(n?d:c)),f=HtmlUtils.div([STYLE,r.headerStyle,"class",r.headerClass,"onClick",u],h+" "+t),m=n?"display:block;visibility:visible":"display:none;",p=HtmlUtils.div(["class","hideshowblock","id",s,"style",m],e);return r.listener&&(HtmlUtils.toggleBlockListeners[s]=r.listener),r.separate?{header:f,body:p,id:s}:l?HU.hbox([f,p]):f+p},toggleBlockNew:function(t,e,n,i){Utils.isDefined(n)||(n=!1);let a={headerClass:"ramadda-noselect ramadda-toggleblock-label ramadda-clickable",headerStyle:""};i&&$.extend(a,i);let r=Utils.getUniqueId("block_"),l=r+"_img",s=HU.span([ID,l],HU.makeToggleImage(n?"fas fa-caret-down":"fas fa-caret-right")),o=["toggle-block-id",r,"toggle-block-visible",n,STYLE,a.headerStyle,"class",a.headerClass];a.extraAttributes&&(o=Utils.mergeLists(o,a.extraAttributes));let d=HtmlUtils.div(o,s+" "+t),c=n?"display:block;visibility:visible":"display:none;",u=HtmlUtils.div(["class","hideshowblock","id",r,"style",c],e);return a.separate?{header:d,body:u,id:r}:d+u},initToggleBlock:function(t,e){t.find("[toggle-block-id]").click((function(){let t=$(this).attr("toggle-block-id"),n=t+"_img",i="true"===$(this).attr("toggle-block-visible");i=!i,$(this).attr("toggle-block-visible",""+i),$("#"+n).html(HU.makeToggleImage(i?"fas fa-caret-down":"fas fa-caret-right")),i?$("#"+t).show():$("#"+t).hide(),e&&e(t,i,$(this))}))}},StringUtil={endsWith:function(t,e){return t.length>=e.length&&t.lastIndexOf(e)+e.length==t.length},startsWith:function(t,e){return t.length>=e.length&&0===t.lastIndexOf(e,0)}},blockCnt=0,SU;function DomObject(t){this.obj=null,document.getElementById?(this.obj=document.getElementById(t),this.obj&&(this.style=this.obj.style)):document.all?(this.obj=document.all[t],this.obj&&(this.style=this.obj.style)):document.layers&&(this.obj=document.layers[t],this.style=document.layers[t]),this.obj&&(this.id=this.obj.id,this.id||(this.id="obj"+blockCnt++))}function pageIsUnloading(){GuiUtils.pageUnloading=!0,window.onbeforeunload=confirmExit}function confirmExit(){return null}function Div(t,e){this.id=HtmlUtils.getUniqueId(),this.contents=t||"",this.extra="",this.clazz=e,this.setHidden=function(){},this.toString=function(){return HtmlUtils.div(["class",e||"","id",this.id],this.contents)},this.getId=function(){return this.id},this.jq=function(){return $("#"+this.id)},this.set=function(t,e){return e&&(this.extra=HtmlUtils.attrs(e)),this.contents=t,this.jq().html(t),this},this.append=function(t){this.content?this.content+=t:this.content=t,$("#"+this.id).append(t)},this.msg=function(t){return this.set(HtmlUtils.div([ATTR_CLASS,"display-message"],t))}}function TextMatcher(t){this.regexps=[],t&&(t=t.trim()),t&&t.length>0&&((t=t.replace(/\./g,"\\.")).startsWith('"')&&t.endsWith('"')?(t=(t=t.replace(/^"/,"")).replace(/"$/,""),this.regexps.push(new RegExp("("+t+")","ig"))):t.split(" ").map((t=>{t=t.trim(),this.regexps.push(new RegExp("("+t+")","ig"))}))),$.extend(this,{pattern:t,hasPattern:function(){return this.regexps.length>0},highlight:function(t){for(var e=0;e<this.regexps.length;e++)t=t.replace(this.regexps[e],"<span style=background:yellow;>$1</span>");return t},matches:function(t){if(0==this.regexps.length)return!0;t=t.toLowerCase();for(var e=0;e<this.regexps.length;e++)if(!t.match(this.regexps[e]))return!1;return!0}})}function number_format(t,e,n){let i,a=t<0,r=Utils.roundDecimals(t,e,!1);a?(i=Math.ceil(r),i=Math.abs(i)):i=Math.floor(r);let l=String(r).match(/\.(.*)/),s=l?l[1]:"",o=String(i).replace(/(.)(?=(\d{3})+$)/g,"$1,");return""!=s&&(o+="."+s),n&&console.log("number:"+t+" n:"+r+" i:"+i+" s:"+o),a&&0==i||a?"-"+o:o}$.widget("custom.iconselectmenu",$.ui.selectmenu,{_renderItem:function(t,e){var n=$("<li>"),i=$("<span>");e.disabled&&n.addClass("ui-state-disabled");let a=e.label,r=e.element.attr("img-src");r?(r=r.startsWith("fa")?HU.getIconImage(r):HU.image(r,[STYLE,e.element.attr("data-style")||"","width",64,"class","ui-icon "+e.element.attr("data-class")]),$(r).appendTo(i)):e.element.attr("isheader")||(a=HU.span([STYLE,HU.css("margin-left","36px")],a));let l=e.element.attr("label-class");return l&&(a=HU.div([STYLE,HU.css("width","100%"),"class",l],a)),i.append(a),n.append(i).appendTo(t)}}),window.onbeforeunload=pageIsUnloading,function(t,e){t.fn.getCursorPosition=function(){var e=t(this).get(0),n=0;if("selectionStart"in e)n=e.selectionStart;else if("selection"in document){e.focus();var i=document.selection.createRange(),a=document.selection.createRange().text.length;i.moveStart("character",-e.value.length),n=i.text.length-a}return n}}(jQuery);var SvgUtils=SU={translate:function(t,e){return" translate("+t+","+e+") "},scale:function(t){return" scale("+t+") "},rotate:function(t){return" rotate("+t+") "},skewX:function(t){return" skewX("+t+") "},transform:function(t,...e){return t.attr("transform",e.join(" ")),t},makeBlur:function(t,e,n){return t.append("defs").append("filter").attr("id",e).append("feGaussianBlur").attr("stdDeviation",n)}},dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(a,r,l){var s=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(a)||/\d/.test(a)||(r=a,a=void 0),a=a?new Date(a):new Date,isNaN(a))throw SyntaxError("invalid date");"UTC:"==(r=String(s.masks[r]||r||s.masks.default)).slice(0,4)&&(r=r.slice(4),l=!0);var o=l?"getUTC":"get",d=a[o+"Date"](),c=a[o+"Day"](),u=a[o+"Month"](),h=a[o+"FullYear"](),f=a[o+"Hours"](),m=a[o+"Minutes"](),p=a[o+"Seconds"](),g=a[o+"Milliseconds"](),y=l?0:a.getTimezoneOffset(),U={d:d,dd:i(d),ddd:s.i18n.dayNames[c],dddd:s.i18n.dayNames[c+7],m:u+1,mm:i(u+1),mmm:s.i18n.monthNames[u],mmmm:s.i18n.monthNames[u+12],yy:String(h).slice(2),yyyy:h,h:f%12||12,hh:i(f%12||12),H:f,HH:i(f),M:m,MM:i(m),s:p,ss:i(p),l:i(g,3),L:i(g>99?Math.round(g/10):g),t:f<12?"a":"p",tt:f<12?"am":"pm",T:f<12?"A":"P",TT:f<12?"AM":"PM",Z:l?"UTC":(String(a).match(e)||[""]).pop().replace(n,""),o:(y>0?"-":"+")+i(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return r.replace(t,(function(t){return t in U?U[t]:t.slice(1,t.length-1)}))}}(),RamaddaUtils,RamaddaUtil;function jqid(t){return HtmlUtils.jqid(t)}dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(t,e){return dateFormat(this,t,e)},$(document).ready((function(){HU.documentReady=!0,Utils.checkForResize()})),Utils.areDisplaysReady();var Ramadda=RamaddaUtils=RamaddaUtil={contents:{},currentRamaddaBase:null,currentSelector:null,initToggleTable:function(container){$(container).find(".entry-arrow").click((function(){let url=$(this).attr("data-url");if(!url)return;let title=$(this).attr("data-title")??"",handler=request=>{if(null==request.responseXML)return;let xmlDoc=request.responseXML.documentElement,script,html;for(i=0;i<xmlDoc.childNodes.length;i++){let t=xmlDoc.childNodes[i];"javascript"==t.tagName?script=getChildText(t):"content"==t.tagName&&(html=getChildText(t))}if(html||(html=getChildText(xmlDoc)),html){html=HU.div(["style",HU.css("margin","5px","max-height","300px","overflow-y","auto")],html);let t=HU.makeDialog({content:html,my:"left top",at:"left bottom",title:title,anchor:this,draggable:!0,header:!0,inPlace:!1,stick:!0});Utils.checkTabs(html)}script&&eval(script)};GuiUtils.loadXML(url,handler)}))},selectInitialClick:function(t,e,n,i,a,r,l,s,o){return RamaddaUtils.currentSelector&&RamaddaUtils.currentSelector.cancel(),RamaddaUtils.currentSelector=RamaddaUtils.selectCreate(t,e,n,i,a,r,l,s,o),!1},selectCreate:function(t,e,n,i,a,r,l,s,o){let d=e+(s||"");return selectors[e]=selectors[d]=new Selector(t,e,n,i,a,r,l,s,o)},clearSelect:function(t){if(selector=selectors[t],selector)selector.clearInput();else{let e=GuiUtils.getDomObject(t),n=GuiUtils.getDomObject(t+"_hidden");n&&(n.obj.value=""),e&&(e.obj.value="")}},viewSelect:function(t){let e=GuiUtils.getDomObject(t+"_hidden");if(e){let t=e.obj.value;if(Utils.stringDefined(t)){let e=RamaddaUtils.getEntryUrl(t);window.open(e,"_blank")}}},initEntryPopup:function(t,e){let n=HU.input("","",["id",t+"_input",CLASS,"input","placeholder","Search","style",HU.css("width","200px")]);n=HU.center(n);let i=n+HU.div([CLASS,"ramadda-select-search-results","id",t+"_results"]);$("#"+t).html(i);let a=$("#"+t+"_results");$("#"+t+"_input").keyup((function(t){let n=$(this).val();if(""==n)return a.hide(),void a.html("");if(13==(t.keyCode?t.keyCode:t.which)){let t=ramaddaBaseUrl+"/search/do?text="+encodeURIComponent(n)+"&output=json";a.html(HU.getIconImage(icon_wait)+" Searching..."),a.show();let i={entryListChanged:function(t){let n=t.getEntries();if(0==n.length)return a.show(),void a.html("Nothing found");let i="";n.forEach(((t,e)=>{i+=HU.div(["index",e,"class","ramadda-clickable ramadda-entry"],t.getIconImage()+" "+t.getName())})),a.html(i),a.find(".ramadda-entry").click((function(){let t=n[$(this).attr("index")];RamaddaUtils.selectClick(e,t.getId(),t.getName(),{entryName:t.getName(),icon:t.getIconUrl(),entryType:t.getType().id})})),a.show(400)},handleSearchError:function(t,e){a.html("An error occurred:"+e)}};new EntryList(getGlobalRamadda(),t,i,!1).doSearch()}}))},selectClick:function(t,e,n,i){selector=selectors[t];let a=getHandler(t);if(a||(a=getHandler(selector.elementId)),a)return a.selectClick(selector.selecttype,t,e,n),void selector.cancel();if("wikilink"==selector.selecttype){let t={entryId:e,name:n};i&&$.extend(t,i),WikiUtil.insertAtCursor(selector.elementId,selector.textComp.obj,t)}else if("fieldname"==selector.selecttype)WikiUtil.insertAtCursor(selector.elementId,selector.textComp.obj,n);else if("image"==selector.selecttype)WikiUtil.insertAtCursor(selector.elementId,selector.textComp.obj,'{{image entry="'+e+'" caption="'+n+'" width=400px align=center}} ');else if("entryid"==selector.selecttype){let t=WikiUtil.getWikiEditor(selector.elementId);t?t.insertTags(e," ","importtype"):selector.props&&selector.props.callback?selector.props.callback(e,i):WikiUtil.insertText(selector.elementId,e)}else"entry:entryid"==selector.selecttype?WikiUtil.getWikiEditor(selector.elementId).insertTags("entry:"+e," ","importtype"):(selector.getHiddenComponent().val(e),selector.getTextComponent().val(n));selector.cancel()},getBaseUrl:function(){return ramaddaBaseUrl},isRamaddaUrl:function(t){return t.startsWith(ramaddaBaseUrl)},getUrl:function(t){return RamaddaUtil.getBaseUrl()+t},getCdnUrl:function(t){return ramaddaCdn+t},getEntryUrl:function(t){return RamaddaUtil.getUrl("/entry/show?entryid="+t)},fileDrops:{},doSave:function(t,e,n,i,a){(n=n||{}).entryid=t,n.authtoken=e,n.response="json";let r=RamaddaUtil.getUrl("/entry/change");$.post(r,n,(t=>{i&&i(t)})).fail((t=>{try{let e=JSON.parse(t.responseText);if(e.error)return void(t?t(e.error):alert("Error:"+e.error))}catch(t){}a?a(t.responseText):alert("Error:"+t.responseText)}))},initEntryTable:function(t,e,n){let i={};Utils.isDefined(e.details)&&0==e.details&&(e.simple=!0);let a=e.simple,r=!a,l={actions:[],showCrumbs:!1,showHeader:r,showDate:r,showCreateDate:r,showSize:r,showType:r,showIcon:r,showThumbnails:r,showArrow:r,showForm:r};$.extend(l,e);let s=n.map(((t,e)=>{let n=new Entry(t);return i[n.getId()]=n,n})),o="",d=[];if(d.push({id:"name",label:"Name"}),l.showDate&&d.push({id:"fromdate",label:"Date",width:120}),l.showCreateDate&&d.push({id:"createdate",label:"Create Date",width:120}),l.showSize&&d.push({id:"size",label:"Size",width:100}),l.showType&&d.push({id:"type",label:"Type",width:120}),l.showHeader){o+="<table cellspacing=0 cellpadding=0 width=100% class=entry-list-header><tr>";let e=["class","entry-list-header-column ramadda-clickable"];d.forEach(((n,i)=>{let a=e,r=n.width;0==i&&l.showForm&&(o+=HU.td(["style","padding-left:3px;","width","10"],HU.div(["style","width:15px","id",t+"_formarrow","title","Click to show entry form","class","ramadda-clickable"],HU.getIconImage("fas fa-caret-right"))),r-=10),Utils.isDefined(n.width)&&(a=Utils.mergeLists(a,["width",n.width])),a=Utils.mergeLists(a,["orderby",n.id,"title","Sort by "+n.label]);let s=n.label;n.id==l.orderby&&Utils.isDefined(l.ascending)&&(s=l.ascending?HU.getIconImage("fas fa-arrow-up")+SPACE+s:HU.getIconImage("fas fa-arrow-down")+SPACE+s),o+=HU.td(a,s)})),o+="</table>"}else a||(o+=HU.div(["class","entry-list-noheader"]));let c,u=Utils.getUniqueId(),h=Utils.getUniqueId(),f=a?"entry-list-simple":"entry-list",m=["id",u,"class",f];if(o+=HU.open("div",m),l.showForm){c=HU.getUniqueId("form_"),o+=HU.open("form",["id",c,"method","post","action",RamaddaUtil.getUrl("/entry/getentries")]);let e=HU.checkbox("",["style",HU.css("margin-left","3px"),"title","Toggle all","id",t+"_form_cbx"],!1),n=[["","Apply action"]];l.actions.forEach((t=>{n.push([t.id,t.label])})),e+=SPACE1,e+=HU.select("",["name","output","id",t+"_form_action"],n),e+=SPACE1,e+=HU.open("input",["name","getselected","type","submit","value","Selected","class","submit ui-button ui-corner-all ui-widget","id","getselected1338","role","button"]),e+=SPACE1,e+=HU.open("input",["name","getall","type","submit","value","All","class","submit ui-button ui-corner-all ui-widget","id","getall1337","role","button"]),o+=HU.div(["class",f+"-row","id",t+"_form","style","display:none;width:100%"],e)}let p=["id",h];l.maxHeight&&p.push("style",HU.css("max-height",l.maxHeight,"overflow-y","auto")),o+=HU.open("div",p),o+="</div>",o+="</form>",o+="</div>";let g=jqid(t);g.html(o),c&&jqid(c).submit((e=>{Utils.stringDefined(jqid(t+"_form_action").val())||(alert("No action specified"),e.preventDefault())})),g.find(".entry-list-header-column").click((function(){let t,e=$(this).attr("orderby");l.orderby==e?Utils.isDefined(l.ascending)?l.ascending?t=HU.addToDocumentUrl("ascending",!1):(t=HU.addToDocumentUrl("ascending",null),t=HU.addToDocumentUrl("orderby",null)):(t=HU.addToDocumentUrl("orderby",e),t=HU.addToDocumentUrl("ascending",!0)):(t=HU.addToDocumentUrl("ascending",!0),t=HU.addToDocumentUrl("orderby",e)),window.location=t}));let y=!1;$("#"+t+"_form_cbx").click((function(){let e=$(this).is(":checked");jqid(t).find(".entry-form-select").prop("checked",e)}));$("#"+t+"_formarrow").click((function(){y=!y,y?(jqid(t+"_form").show(),jqid(t).find(".entry-form-select").show(),$(this).html(HU.getIconImage("fas fa-caret-down"))):(jqid(t+"_form").hide(),jqid(t).find(".entry-form-select").hide(),$(this).html(HU.getIconImage("fas fa-caret-right")))})),RamaddaUtil.showEntryTable(h,l,d,t,i,(t=>{y&&jqid(t).find(".entry-form-select").show()}),s)},showEntryTable:function(t,e,n,i,a,r,l){let s=$("#"+i),o="",d=e.simple?"entry-list-simple-row":"entry-list-row entry-list-row-data";if(l.forEach((t=>{let i=Utils.getUniqueId("row_"),a=HU.open("div",["entryid",t.getId(),"id",i]);a+=HU.open("div",["entryid",t.getId(),"id",i,"class",d]);let r=Utils.getUniqueId();a+=HU.open("table",["cellspacing","0","cellpadding","border","width","100%","class","entry-row-table","entryid",t.getId()]),a+="<tr valign=top>",n.forEach(((l,s)=>{let o=s==n.length-1,d=[],c=t.getProperty(l.id),u=null;if("name"==l.id){e.showIcon&&(c=t.getIconImage()+SPACE+c),c=t.getLink(c);let n=[],a=Utils.getUniqueId("entry_");if(e.showForm&&n.push(HU.hidden("allentry",t.getId())+HU.checkbox(a,["rowid",i,"name","selentry","value",t.getId(),"class","entry-form-select","style",HU.css("margin-right","2px","display","none")],!1)),n.push(HU.div(["style",HU.css("min-width","10px"),"innerid",r,"entryid",t.getId(),"title","Click to show contents","class","entry-arrow ramadda-clickable"],HU.getIconImage("fas fa-caret-right"))),e.showThumbnails){let e=t.getThumbnail();e&&n.push(HU.div(["class","ramadda-thumbnail","style",HU.css("max-height","100px","overflow-y","auto")],HU.image(e,["loading","lazy","class","ramadda-clickable ramadda-thumbnail-image","title","Click to enlarge","style",HU.css("width","100px")])))}if(e.showCrumbs&&t.breadcrumbs){let e=Utils.getUniqueId();c=HU.span(["id","breadcrumbtoggle_"+e,"breadcrumbid",e,"title","Show breadcrumbs","class","ramadda-clickable ramadda-breadcrumb-toggle"],HU.getIconImage("fas fa-plus-square"))+SPACE2+HU.span(["style",HU.css("display","none"),"id",e],t.breadcrumbs+"&nbsp;&raquo;&nbsp;")+c}n.push(c),e.simple||(u="Right-click to see entry menu. Shift-drag to copy/move"),c=HU.table([],HU.tr(["valign","top"],HU.tds([],n)))}else{"type"==l.id&&(c=HU.href(RamaddaUtil.getUrl("/search/type/"+t.getType().id),c,["title","Search for entries of type "+c]));let e=l.width-20;e=l.width,c=HU.div(["style",HU.css("padding-left","5px","white-space","nowrap","width",HU.getDimension(l.width),"text-align","right","max-width",HU.getDimension(e),"overflow-x","hidden")+(o?HU.css("padding-right","4px"):"")],c),d.push("align","right")}Utils.isDefined(l.width)&&d.push("width",HU.getDimension(l.width)),u&&d.push("title",u),a+=HU.td(d,c)})),a+="</tr></table>",a+="</div>",a+=HU.div(["id",r,"style",HU.css("margin-left","20px")]),a+="</div>",o+=a})),o+=HU.close("div"),$("#"+t).html(o),$("#"+t).find(".ramadda-breadcrumb-toggle").click((function(){let t=$(this).attr("breadcrumbid"),e=$("#"+t);"none"==e.css("display")?($("#breadcrumbtoggle_"+t).html(HU.getIconImage("fas fa-minus-square")),e.css("display","inline")):($("#breadcrumbtoggle_"+t).html(HU.getIconImage("fas fa-plus-square")),e.css("display","none"))})),$("#"+t).find(".entry-arrow").click((function(){let t=$(this).attr("entryid"),l=$(this).attr("innerid"),s=$("#"+l),o=$(this).attr("filled"),d=$(this).attr("open");if(d?$(this).html(HU.getIconImage("fas fa-caret-right")):$(this).html(HU.getIconImage("fas fa-caret-down")),o)return void(d?(s.hide(),$(this).attr("open",!1)):(s.show(),$(this).attr("open",!0)));let c=a[t];$(this).attr("filled",!0),$(this).attr("open",!0);let u=RamaddaUtil.getUrl("/entry/show?output=json&includeproperties=false&includedescription=false&includeservices=false&children=true&entryid="+t);$.getJSON(u,(function(t,s,o){if(GuiUtils.isJsonError(t))return;let d=t.map(((t,e)=>{let n=new Entry(t);return a[n.getId()]=n,n}));if(d.length>0)RamaddaUtil.showEntryTable(l,e,n,i,a,r,d);else{let t=HU.open("table",["class","formtable"]);if(c.getIsUrl())t+=HU.formEntry("URL:",HU.href(c.getResourceUrl(),c.getResourceUrl()));else if(c.getIsFile()){let e=c.getResourceUrl();t+=HU.formEntry("File:",HU.href(e,c.getFilename())+"  ("+c.getFormattedFilesize()+") "+HU.href(e,HU.getIconImage("fas fa-download")))}t+=HU.formEntry("Kind:",HU.href(RamaddaUtil.getUrl("/search/type/"+c.getType().id),c.typeName,["title","Search for entries of type "+c.typeName]));let e=RamaddaUtil.getUrl("/search/type/"+c.getType().id+"?user_id="+c.creator+"&search.submit=true"),n=HU.href(e,c.creator,["title","Search for entries of this type created by "+c.creator]);t+=HU.formEntry("Created by:",n),t+=HU.formEntry("Created:",c.createDateFormat),c.startDate&&c.startDate.getTime()!=c.createDate.getTime()&&(t+=HU.formEntry("Date:",c.startDateFormat)),c.startDate&&c.endDate&&c.startDate.getTime()!=c.endDate.getTime()&&(console.log(c.startDate),console.log(c.endDate),t+=HU.formEntry("To Date:",c.endDateFormat)),t+="</table>",HU.jqid(l).html(t)}}))})),e.simple)return;$("#"+t).find(".entry-form-select").click((function(t){$(this).is(":checked"),$("#"+$(this).attr("rowid"));HU.checkboxClicked(t,"entry_",$(this).attr("id")),s.find(".entry-form-select").each((function(){let t=$(this).is(":checked"),e=$("#"+$(this).attr("rowid"));t?e.addClass("entry-list-row-selected"):e.removeClass("entry-list-row-selected")}))})),$("#"+t).find(".ramadda-thumbnail-image").click((function(){let t=$(this).attr("src");HU.makeDialog({content:HU.image(t),my:"left top",at:"left bottom",anchor:this,header:!0,draggable:!0})}));let c=$("#"+t).find(".entry-list-row");c.bind("contextmenu",(function(t){let e=$(this),n=a[$(this).attr("entryid")];if(!n)return;eventX=GuiUtils.getEventX(t);let i=RamaddaUtil.getUrl("/entry/show?entryid="+n.getId()+"&output=metadataxml");if(GuiUtils.loadXML(i,(function(t){let i=t.responseXML.documentElement;text=getChildText(i),HU.makeDialog({content:text,my:"left top",at:"left bottom",title:n.getIconImage()+" "+n.getName(),anchor:e,header:!0})}),this),!t.preventDefault)return t.returnValue=!1,!1;t.preventDefault()})),RamaddaUtil.initDragAndDropEntries(c,a,i),r(t)},initDragAndDropEntries:function(t,e,n){function i(t){return t.hasClass("ramadda-entry-target")}t.mousedown((function(t){if(!t.shiftKey||!e)return;let i=e[$(this).attr("entryid")];if(!i)return;let a=$(this),r=[i];if($("#"+n).find(".entry-list-row-selected").each((function(){let t=e[$(this).attr("entryid")];t&&t.getId()!=i.getId()&&r.push(t)})),Utils.entryDragInfo={dragSource:a.attr("id"),entry:i,getIds:function(){return r.map((t=>t.getId())).join(",")},hasEntry:function(t){return r.includes(t)},getHtml:function(){let t="";return r.forEach((e=>{""!=t&&(t+="<br>"),t+=HU.image(e.getIconUrl())+SPACE+e.getName()})),t}},i){if(Utils.mouseIsDown=!0,!t.preventDefault)return t.returnValue=!1,!1;t.preventDefault()}})),t.mouseover((function(t){let n="#C6E2FF";if(i($(this)))return void(Utils.mouseIsDown&&Utils.entryDragInfo&&$(this).css("background",n));let a=e[$(this).attr("entryid")];if(a&&Utils.mouseIsDown&&Utils.entryDragInfo){if(Utils.entryDragInfo.hasEntry(a))return;$(this).css("background",n)}})),t.mouseout((function(t){if(Utils.entryDragInfo){if(i($(this)))return void $(this).css("background","");let t=e[$(this).attr("entryid")];if(Utils.entryDragInfo.entry==t)return;$(this).css("background","")}})),t.mouseup((function(t){if(!Utils.entryDragInfo)return;if($(this).css("background",""),i($(this))){let t=RamaddaUtil.getUrl("/entry/getentries?output="+$(this).attr("target-type"));return Utils.entryDragInfo.getIds().split(",").forEach((e=>{t+="&selentry="+e})),void(document.location=t)}let n=e[$(this).attr("entryid")];n&&(Utils.entryDragInfo.hasEntry(n)||Utils.entryDragInfo.hasEntry(n)||(url=RamaddaUtil.getUrl("/entry/copy?action=action.move&from="+Utils.entryDragInfo.getIds()+"&to="+n.getId()),document.location=url))}))},initFormTags:function(t){let e=$("#"+t),n=e.find(".metadata-tag-input");e.attr("autocomplete","off"),n.attr("autocomplete","off"),n.keyup((function(t){HtmlUtils.hidePopupObject();let e=$(this).val();if(""==e)return;let n=HU.getUrl(RamaddaUtil.getUrl("/metadata/suggest"),["value",e.trim()]),i=$(this);$.getJSON(n,(t=>{if(0==t.length)return;let e="";t.forEach((t=>{e+=HU.div([CLASS,"ramadda-clickable metadata-suggest","suggest",t],t)}));let n=HU.div([CLASS,"ramadda-search-popup",STYLE,HU.css("max-width","200px","padding","4px")],e);HU.makeDialog({content:n,my:"left top",at:"left bottom",anchor:i}).find(".metadata-suggest").click((function(){HtmlUtils.hidePopupObject(),i.val($(this).attr("suggest"))}))})).fail((t=>{console.log("url failed:"+n+"\n"+t)}))}));let i=$("#"+t).find(".metadata-tag");i.attr("title","Click to remove"),i.click((function(){let t=e.find("#"+$(this).attr("metadata-id"));$(this).hasClass("metadata-tag-deleted")?($(this).removeClass("metadata-tag-deleted"),t.val("")):($(this).addClass("metadata-tag-deleted"),t.val("delete"))}))},initFormUpload:function(t,e){let n=$("#"+t),i=n.closest("form"),a=HU.div([TITLE,"Click to select a file",ID,t+"_filewrapper",CLASS,"fileinput_wrapper"],HU.getIconImage("fas fa-cloud-upload-alt")+" "+HU.div([ID,t+"_filename",CLASS,"fileinput_label"]));n.after(a),n.hide();let r=$("#"+t+"_filewrapper");$("#"+t+"_filename");r.click((()=>{n.trigger("click")}));let l=()=>{let e=n[0].files?n[0].files[0]:null,i=e?e.name:n.val(),a=i.lastIndexOf("\\");a<0&&(a=i.lastIndexOf("/")),a>=0&&(i=i.substring(a+1)),e&&(i=i+" ("+Utils.formatFileLength(e.size)+")"),""==i&&(i=HU.span([CLASS,"fileinput_label_empty"],"Please select a file")),$("#"+t+"_filename").html(i)};if(n.bind("change",l),l(),Utils.stringDefined(e)){let n=$("#"+e),a={files:{},cnt:0,added:!1};n.append(HU.div([CLASS,"ramadda-dnd-target-files",ID,t+"_dnd_files"]));let r=$("#"+t+"_dnd_files");Utils.initDragAndDrop(n,(t=>{}),(t=>{}),((e,n,l,s)=>{a.cnt++;let o=n.name;if(!o){let t=n.type&&n.type.match("image/.*");if(o=prompt("Entry file name:",t?"image":"file"),!o)return;if(n.type)if("text/plain"==n.type)o.endsWith(".txt")||(o+=".txt");else{o=o+"."+n.type.replace(/.*\//,"")}}let d=t+"_list"+a.cnt,c=t+"_file"+a.cnt,u=t+"_file_name"+a.cnt,h="upload_file_"+a.cnt,f="upload_name_"+a.cnt;a.files[c]=l;let m=HU.span([CLASS,"ramadda-clickable",ID,d+"_trash"],HU.getIconImage(icon_trash)),p=Utils.isDefined(n.size)?Utils.formatFileLength(n.size):"";r.append(HU.div([ID,d],m+" "+o+" "+p)),i.append(HU.tag("input",["type","hidden","name",h,"id",c])),i.append(HU.tag("input",["type","hidden","name",f,"id",u])),$("#"+c).val(l),$("#"+u).val(o),$("#"+d+"_trash").click((function(){$("#"+d).remove(),$("#"+c).remove(),$("#"+u).remove()}))}),null,!0)}},handleDropEvent:function(t,e,n,i,a){let r=e.type.match("^image.*"),l=RamaddaUtil.getUrl("/entry/addfile"),s=e.name;if(!s&&(s=prompt("Entry Name:"),!s))return;let o=e.name,d=e.type.replace(/image\//,"");o||(o=s+"."+d);let c,u=new FormData;u.append("filename",o),"application/zip"==e.type?u.append("filetype","geo_shapefile"):"application/json"==e.type?u.append("filetype","geo_geojson"):u.append("filetype",e.type),u.append("group",i),u.append("description",""),u.append("file",n),$.ajax({url:l,cache:!1,contentType:!1,processData:!1,method:"POST",type:"POST",data:u,success:t=>{c.remove(),"ok"==t.status?a&&a(t,t.entryid,t.name,r):alert("An error occurred creating entry: "+t.message)},error:function(t){c.remove(),alert("An error occurred creating entry: "+t)}});let h=HU.div(["style",HU.css("text-align","center","padding","5px")],"Creating entry<br>"+HU.image(ramaddaCdn+"/icons/mapprogress.gif",["width","50px"]));c=HU.makeDialog({content:h,anchor:$(document),my:"center top",at:"center top+100"})},inherit:function(t,e){return $.extend(t,e),e.getThis=function(){return t},t.getThis=function(){return t},t.mysuper=e,t},initMembers:function(t,e){return $.extend(t,e),t},defineMembers:function(t,e){return $.extend(t,e),t},showEntryPopup:function(t,e,n){let i=RamaddaUtils.contents[e];if(i)RamaddaUtils.showEntryPopupInner(t,e,n,i);else{let i=RamaddaUtil.getUrl("/entry/menu?entryid="+e);$.ajax({url:i,dataType:"text",success:function(i){RamaddaUtils.contents[e]=i,RamaddaUtils.showEntryPopupInner(t,e,n,i)}}).fail(((t,e,n)=>{console.log("/entry/menu failed:"+n),alert("Failed to contact the server")}))}},showEntryPopupInner:function(t,e,n,i){let a=$("#"+t);HU.makeDialog({content:i,my:"left top",at:"left bottom",title:n,anchor:a,draggable:!0,header:!0,inPlace:!1,headerRight:null})},initEntryListForm:function(t){let e=Utils.entryGroups[t];e&&(e.on=0,e.setVisbility())},hideEntryPopup:function(){HtmlUtils.getTooltip().hide()},originalImages:new Array,changeImages:new Array,folderClick:function(t,e,n){console.log(e),RamaddaUtil.changeImages[t]=n;let i=$("#"+t);if(0==i.length)return;let a=$("#img_"+t);"none"!=i.css("display")?(n&&a.html(HU.getIconImage("fa-caret-right")),i.hide()):(RamaddaUtil.originalImages[t]=a.html(),i.show(),a.html(HU.getIconImage("fa-caret-down")),(e+="&orderby=entryorder&ascending=true").startsWith("/")&&RamaddaUtil.currentRamaddaBase&&(e=RamaddaUtil.currentRamaddaBase+e),GuiUtils.loadXML(e,RamaddaUtil.handleFolderList,t))},handleFolderList:function(request,uid){if(null!=request.responseXML){let xmlDoc=request.responseXML.documentElement,script,html;for(i=0;i<xmlDoc.childNodes.length;i++){let t=xmlDoc.childNodes[i];"javascript"==t.tagName?script=getChildText(t):"content"==t.tagName&&(html=getChildText(t))}html||(html=getChildText(xmlDoc)),html&&($("#"+uid).html("<div>"+html+"</div>"),Utils.checkTabs(html)),script&&eval(script)}RamaddaUtil.changeImages[uid]?$("#img_"+uid).attr("src",icon_folderopen):$("#img_"+uid).attr("src",RamaddaUtil.originalImages[uid])},Components:{init:function(t){let e=$("#"+t),n=$("#"+t+"_header"),i=!1,a=!1,r=e.find(".ramadda-component"),l={},s={},o={};r.each((function(){let t=$(this).attr("component-date");if(!t)return;let e,n=Utils.parseDate(t);$(this).attr("component-day",e=Utils.formatDateWithFormat(n,"mmmm d yyyy")),o[e]=!0,$(this).attr("component-month",e=Utils.formatDateWithFormat(n,"mmmm yyyy")),s[e]=!0,$(this).attr("component-year",e=Utils.formatDateWithFormat(n,"yyyy")),l[e]=!0,$(this).attr("component-latitude")&&(a=!0),Utils.stringDefined($(this).attr("component-tags"))&&(i=!0)})),n.css("text-align","center");let d=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar ramadda-button-on","layout","grid"],"Grid");Object.keys(l).length>1&&(d+=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar","layout","year"],"Year")),Object.keys(s).length>1&&(d+=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar","layout","month"],"Month")),Object.keys(o).length>1&&(d+=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar","layout","day"],"Day")),d+=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar","layout","title"],"Title"),i&&(d+=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar","layout","tags"],"Tag")),d+=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar","layout","author"],"Author"),a&&(d+=HU.div([STYLE,HU.css("display","inline-block"),CLASS,"ramadda-button ramadda-button-bar","layout","map"],"Map")),n.append(HU.div([],d));let c=n.find(".ramadda-button");c.click((function(){c.removeClass("ramadda-button-on"),$(this).addClass("ramadda-button-on");let t=$(this).attr("layout");"grid"==t?RamaddaUtil.Components.layout(e,r,null):RamaddaUtil.Components.layout(e,r,"component-"+t)}))},layout:function(t,e,n){if(t.find(".ramadda-group").each((function(){$(this).detach()})),t.mapId&&$("#"+t.mapId).detach(),t.ramaddaMap&&(ramaddaMapRemove(t.ramaddaMap),t.ramaddaMap=null),null==n)return e.show(),void e.each((function(){$(this).detach(),t.append($(this))}));if("component-map"==n){e.hide();let n=Utils.getUniqueId();t.mapId=n,t.append(HU.div([ID,n,STYLE,HU.css("width","100%","height","400px")]));let i=new RepositoryMap(n,{});t.ramaddaMap=i,i.initMap(!1),e.each((function(){let t=$(this).attr("component-url"),e=+$(this).attr("component-latitude"),n=+$(this).attr("component-longitude");if(!Utils.isNumber(e))return;let a=$(this).attr("component-image"),r=HU.center(HU.b($(this).attr("component-title")));a&&(r+=HU.image(a,[WIDTH,"300px"])),t&&(r=HU.href(t,r));let l=new MapUtils.createLonLat(n,e);i.addPoint("",l,{pointRadius:6,strokeWidth:1,strokeColor:"#000",fillColor:"blue"},r)})),i.centerOnMarkers()}else{e.show();let i="component-day"==n||"component-month"==n||"component-year"==n,a=[],r={};e.each((function(){let t=$(this).attr(n)||"";if("component-tags"==n){let e=t.split(",");t=e[0]}if(!r[t]){r[t]=[];if(i){let e=$(this).attr("component-date"),n=e?Utils.parseDate(e):null;a.push([t,n])}else a.push(t)}r[t].push($(this))})),a=i?a.sort(((t,e)=>(t=t[1],e=e[1],t&&e?t?e?e.getTime()-t.getTime():-1:1:0))):a.sort(),a.forEach((e=>{i&&(e=e[0]);let n=t.append($(HU.div([CLASS,"ramadda-group"],HU.div([CLASS,"ramadda-group-header"],e))));r[e].forEach((t=>{n.append(t)}))}))}}}};function EntryRow(t,e,n,i,a,r){r||(r={showIcon:!0}),this.args=r,r.entryId=t,Utils.globalEntryRows[t]=this,Utils.globalEntryRows[e]=this,Utils.globalEntryRows[n]=this,this.entryId=t,this.showIcon=r.showIcon,this.onColor="#FFFFCC",this.overColor="#f4f4f4",this.rowId=e,this.cbxId=n,this.cbxWrapperId=i,this.showDetails=a,this.getRow=function(){return $("#"+this.rowId)},this.getCbx=function(){return $("#"+this.cbxId)};let l=this.getCbx().closest("form");if(l.length){let t=Utils.entryGroups[l.attr("id")];t&&t.addEntryRow(this)}else this.getCbx().hide();this.setCheckbox=function(t){this.getCbx().prop("checked",t),this.setRowColor()},this.isSelected=function(){return this.getCbx().is(":checked")},this.setRowColor=function(){this.getRow().removeClass("entry-row-hover"),this.isSelected()?this.getRow().addClass("entry-list-row-selected"):this.getRow().removeClass("entry-list-row-selected")},this.mouseOver=function(t){$("#entrymenuarrow_"+e).attr("src",icon_menuarrow),this.getRow().addClass("entry-row-hover")},this.mouseOut=function(t){$("#entrymenuarrow_"+e).attr("src",icon_blank),this.setRowColor()},this.mouseClick=function(e){eventX=GuiUtils.getEventX(e);let n=this.getRow().offset();if(eventX-n.left<150)return;this.lastClick=eventX;let i=RamaddaUtil.getUrl("/entry/show?entryid="+t+"&output=metadataxml");this.showDetails?i+="&details=true":i+="&details=false",this.showIcon?i+="&showIcon=true":i+="&showIcon=false",GuiUtils.loadXML(i,this.handleTooltip,this)},this.handleTooltip=function(t,e){let n=t.responseXML.documentElement;text=getChildText(n);let i=e.getRow().offset().left,a=(e.lastClick,HU.jsLink("",HU.getIconImage(icon_close),["onmousedown","RamaddaUtil.hideEntryPopup();","id","tooltipclose"])),r=HU.image(e.args.icon)+SPACE+e.args.name,l=HU.div([CLASS,"ramadda-popup-header"],a+SPACE2+r),s=HU.div([CLASS,"ramadda-popup",STYLE,"display:block;"],l+"<table>"+text+"</table>"),o=HtmlUtils.getTooltip();o.html(s),o.draggable(),Utils.checkTabs(text);let d=e.getRow().offset(),c=(e.getRow().outerWidth(),e.getRow().outerHeight()),u=HtmlUtils.getTooltip().outerWidth(),h=$(window).width(),f=e.lastClick;e.lastClick+u>h&&(f-=e.lastClick+u-h);let m=f+"px",p=3+d.top+c+"px";o.css({position:"absolute",zIndex:5e3,left:m,top:p}),o.show()}}var selectors=new Array;function Selector(t,e,n,i,a,r,l,s,o){let d=this;this.id=e,this.domId=HU.getUniqueId("selector_"),this.props=o||{},this.elementId=n,this.localeId=r,this.entryType=l,this.allEntries=i,this.selecttype=a,this.textComp=GuiUtils.getDomObject(this.elementId),this.ramaddaUrl=s||ramaddaBaseUrl,this.getTextComponent=function(){let t="#"+this.elementId;return $(t)},this.getHiddenComponent=function(){let t="#"+this.elementId+"_hidden";return $(t)},this.cancel=function(t){!t&&this.pinned||jqid(this.domId).remove()},this.clearInput=function(){this.getHiddenComponent().val(""),this.getTextComponent().val("")},this.handleClick=function(t){let e=this.props.anchor;if(!e){if(this.props.eventSourceId&&(e=jqid(this.props.eventSourceId)),null!=e&&0!=e.length||t&&t.target&&(e=$(t.target)),null==e||0==e.length){e=jqid(this.id+"_selectlink")}null!=e&&0!=e.length||(e=jqid(this.id))}HtmlUtils.hidePopupObject(t);let n=$(HU.div(["style","position:relative;"])).appendTo("body");$(HU.div(["style",HU.css("min-width","200px","min-height","200px"),"class","ramadda-selectdiv","id",this.domId])).appendTo(n),this.div=jqid(this.domId),this.props.minWidth&&this.div.css("min-width",this.props.minWidth),this.div.draggable(),this.anchor=e,this.showDiv=()=>{this.div.show(),this.div.position({of:this.anchor,my:this.props.locationMy??"left top",at:this.props.locationAt??"left bottom",collision:this.props.collision??"fit fit"})};let i="/entry/show?output=selectxml&selecttype="+this.selecttype+"&allentries="+this.allEntries+"&target="+this.id+"&noredirect=true&firstclick=true";if(this.ramaddaUrl&&!this.ramaddaUrl.startsWith("/")){let t=new URL(this.ramaddaUrl).pathname,e=this.ramaddaUrl.replace(t,"");RamaddaUtil.currentRamaddaBase=e,i=this.ramaddaUrl+i}else RamaddaUtil.currentRamaddaBase=null,i=RamaddaUtil.getUrl(i);return this.localeId&&(i=i+"&localeid="+this.localeId),this.entryType&&(i=i+"&entrytype="+this.entryType),this.props.typeLabel&&(i=i+"&typelabel="+this.props.typeLabel),GuiUtils.loadXML(i,((t,e)=>{d.handleSelect(t,e)}),this.id),!1},this.handleClick(t)}function getChildText(t){let e="";for(childIdx=0;childIdx<t.childNodes.length;childIdx++)e+=t.childNodes[childIdx].nodeValue;return e}function toggleBlockVisibility(t,e,n,i){HtmlUtils.toggleBlockVisibility(t,e,n,i)}function toggleInlineVisibility(t,e,n,i){let a,r=GuiUtils.getDomObject(e);a=toggleVisibility(t,"inline")?n:i,StringUtil.startsWith(a,"fa-")?$("#"+e).html(HtmlUtils.getIconImage(a,[])):r&&(r.obj.src=a),Utils.ramaddaUpdateMaps()}function toggleVisibility(t,e,n){let i=$("#"+t).css("display");return $("#"+t).toggle(n),"block"!=i}function hide(t){$("#"+t).hide()}function hideObject(t){return t?($("#"+t.id).hide(),1):0}function showObject(t,e){if(!t)return 0;$("#"+t.id).show()}function toggleVisibilityOnObject(t,e){if(!t)return 0;$("#"+t.id).toggle()}Selector.prototype={handleSelect:function(t,e){let n=this,i=t.responseXML.documentElement;text=getChildText(i);let a=this.domId+"-pin",r=HU.jsLink("",HtmlUtils.getIconImage(icon_pin),["class","ramadda-popup-pin","id",a]),l=HtmlUtils.getIconImage(icon_close,[]),s=e+"_close",o=HU.span(["id",s,"class","ramadda-clickable"],l),d=(this.props?this.props.title:"")??"",c=(this.props?this.props.extra:"")??"";Utils.stringDefined(d)&&(d=HU.span(["style","margin-left:5px;"],d));let u=HtmlUtils.div(["style","text-align:left;","class","ramadda-popup-header"],SPACE+o+SPACE+r+d),h=HtmlUtils.div(["id",e+"-popup"],u+c+text);this.div.html(h),this.showDiv(),jqid(s).click((()=>{this.cancel(!0)})),$("#"+a).click((function(){n.pinned=!n.pinned,n.pinned?$(this).addClass("ramadda-popup-pin-pinned"):$(this).removeClass("ramadda-popup-pin-pinned")})),this.props&&this.props.initCallback&&this.props.initCallback()}};var OUTPUT_JSON="json",OUTPUT_CSV="default.csv",OUTPUT_ZIP="zip.tree",OUTPUT_EXPORT="zip.export",DEFAULT_MAX=100,OUTPUTS=[{id:OUTPUT_ZIP,name:"Download Zip"},{id:OUTPUT_EXPORT,name:"Export"},{id:OUTPUT_JSON,name:"JSON"},{id:OUTPUT_CSV,name:"CSV"}];function getRamadda(t){t||(t=ramaddaBaseUrl);let e=t.split(";"),n=null;e.length>1&&(t=e[0].trim(),n=e[1].trim());let i=null,a=new RegExp("^(.*)\\((.+)\\).*$").exec(t);if(a&&(t=a[1].trim(),i=a[2]),"this"==t)return getGlobalRamadda();null==window.globalRamaddas&&(window.globalRamaddas={});let r=window.globalRamaddas[t];if(null!=r)return r;let l=window[t];return null==l&&(l=window[t+"Repository"]),l&&(r=new Object,l.call(r,n,i)),null==r&&(r=new RamaddaRepository(t),null!=n&&(r.name=n)),addRepository(r),r}function addRepository(t){null==window.globalRamaddas&&(window.globalRamaddas={}),window.globalRamaddas[t.repositoryRoot]=t}function getGlobalRamadda(){return getRamadda(ramaddaBaseUrl)}function Repository(t){let e=null,n=t.match("^(http.?://[^/]+)/");n&&n.length>0&&(e=n[1]),RamaddaUtil.defineMembers(this,{repositoryRoot:t,baseEntry:null,hostname:e,name:null,getId:function(){return this.repositoryRoot},getSearchMessage:function(){return"Searching "+this.getName()},getSearchLinks:function(t){return null},getSearchUrl:function(t){return null},getId:function(){return this.repositoryRoot},getIconUrl:function(t){return ramaddaCdn+"/icons/page.png"},getEntryTypes:function(t){return new Array},getEntryType:function(t){return null},getMetadataCount:function(t,e){return 0},getEntryUrl:function(t,e){return null},getBaseEntry:function(t){if(null!=this.baseEntry)return this.baseEntry},getRoot:function(){return this.repositoryRoot},getHostname:function(){return this.hostname},canSearch:function(){return!0},getName:function(){if(this.children)return"Search all repositories";if(null!=this.name)return this.name;if(0==this.repositoryRoot.indexOf("/"))return this.name="This RAMADDA";let t=this.repositoryRoot,e=document.createElement("a");e.href=t;let n=e.hostname,i=e.pathname;return"/repository"==i?n:this.name=n+": "+i}})}function RepositoryContainer(t,e){let n;this._id="CONTAINER",RamaddaUtil.inherit(this,n=new Repository(t)),RamaddaUtil.defineMembers(this,{name:e,children:[],canSearch:function(){return!1},getSearchMessage:function(){return"Searching "+this.children.length+" repositories"},addRepository:function(t){this.children.push(t)},getEntryTypes:function(t){if(null!=this.entryTypes)return this.entryTypes;this.entryTypes=[];let e={};for(let t=0;t<this.children.length;t++){let n=this.children[t].getEntryTypes();if(null!=n)for(let t=0;t<n.length;t++){let i=n[t];if(null==e[i.getId()]){let t={};t=$.extend(t,i),e[i.getId()]=t,this.entryTypes.push(t)}else e[i.getId()].entryCount+=i.getEntryCount()}}return this.entryTypes}})}function RamaddaRepository(t){let e;null==t&&(t=ramaddaBaseUrl),RamaddaUtil.inherit(this,e=new Repository(t)),RamaddaUtil.defineMembers(this,{entryCache:{},entryTypes:null,entryTypeMap:{},toString:function(){return"ramadda:"+this.getId()},canSearch:function(){return!0},getJsonUrl:function(t){return this.repositoryRoot+"/entry/show?entryid="+t+"&output=json"},createEntriesFromJson:function(t){let e=new Array;for(let n=0;n<t.length;n++){let i=t[n];i.baseUrl=this.getRoot();let a=new Entry(i);this.addEntry(a),e.push(a)}return e},getEntryType:function(t){return this.entryTypeMap[t]},entryTypeCallPending:!1,entryTypeCallbacks:null,getEntryTypes:function(t,e){if(null!=this.entryTypes)return this.entryTypes;if(this.entryTypeCallPending){let e=this.entryTypeCallbacks;return null==e&&(e=[]),e.push(t),this.entryTypeCallbacks=e,this.entryTypes}let n=this,i=this.repositoryRoot+"/entry/types";e&&(i=i+"?types="+e),this.entryTypeCallPending=!0,this.entryTypeCallbacks=null;$.getJSON(i,(function(e){if(GuiUtils.isJsonError(e))return;n.entryTypes=[];for(let t=0;t<e.length;t++){let i=new EntryType(e[t]);n.entryTypeMap[i.getId()]=i,n.entryTypes.push(i)}null!=t&&t(n,n.entryTypes);let i=n.entryTypeCallbacks;if(n.entryTypeCallPending=!1,n.entryTypeCallbacks=null,i)for(let t=0;t<i.length;t++)i[t](n,n.entryTypes)})).done((function(t,e,i){n.entryTypeCallPending=!1})).always((function(t,e,i){n.entryTypeCallPending=!1})).fail((function(t,e,a){n.entryTypeCallPending=!1;let r="";a&&a.length>0&&(r+=":  "+a),GuiUtils.handleError("An error has occurred reading entry types"+r,"URL: "+i,!1)}));return this.entryTypes},metadataCache:{},metadataCachePending:{},metadataCacheCallbacks:{},getMetadataCount:function(t,e){let n=t.getType(),i=this.metadataCache[n];if(null!=i)return e(t,i),null;if(this.metadataCachePending[n]){let t=this.metadataCacheCallbacks[n];return null==t&&(t=[]),t.push(e),this.metadataCacheCallbacks[n]=t,null}this.metadataCacheCallbacks[n]=null,this.metadataCachePending[n]=!0;let a=this.repositoryRoot+"/metadata/list?metadata_type="+t.getType()+"&response=json",r=this;$.getJSON(a,(function(i){let a=r.metadataCacheCallbacks[n];if(r.metadataCachePending[n]=!1,!GuiUtils.isJsonError(i)&&(r.metadataCache[n]=i,e(t,i),a))for(let e=0;e<a.length;e++)a[e](t,i)})).fail((function(t,e,i){r.metadataCachePending[n]=!1;let l=e+", "+i;GuiUtils.handleError("Error getting metadata count: "+l,a,!1)}));return null},getEntryUrl:function(t,e){let n;n="string"==typeof t?t:t.id;let i=this.getRoot()+"/entry/show?entryid="+n;return null!=e&&(StringUtil.startsWith(e,"&")||(i+="&"),i+=e),i},getEntryDownloadUrl:function(t,e){let n;n="string"==typeof t?t:t.id;let i=this.getRoot()+"/entry/get?entryid="+n;return null!=e&&(StringUtil.startsWith(e,"&")||(i+="&"),i+=e),i},getSearchLinks:function(t){let e=[];for(let n=0;n<OUTPUTS.length;n++)e.push(HtmlUtils.href(this.getSearchUrl(t,OUTPUTS[n].id),OUTPUTS[n].name));return e},getUrlRoot:function(){return this.repositoryRoot},getSearchUrl:function(t,e,n){let i=this.repositoryRoot+"/search/do?output="+e;for(let e=0;e<t.types.length;e++){i+="&type="+t.types[e]}null!=t.parent&&t.parent.length>0&&(i+="&group="+t.parent),null!=t.provider&&t.provider.length>0&&(i+="&provider="+t.provider),null!=t.text&&t.text.length>0&&(i+="&text="+t.text),null!=t.name&&t.name.length>0&&(i+="&name="+t.name),t.startDate&&t.startDate.length>0&&(i+="&datadate.from="+t.startDate),t.endDate&&t.endDate.length>0&&(i+="&datadate.to="+t.endDate),t.createstartDate&&t.createstartDate.length>0&&(i+="&createdate.from="+t.createstartDate),t.createendDate&&t.createendDate.length>0&&(i+="&createdate.to="+t.createendDate),t.entries&&t.entries.length>0&&(i+="&entries="+t.entries),t.orderBy&&(i+="&orderby="+t.orderBy,Utils.isDefined(t.ascending)&&(i+="&ascending="+(t.ascending?"true":"false"))),t.getAreaContains()&&(i+="&areamode=contains"),isNaN(t.getNorth())||(i+="&maxlatitude="+t.getNorth()),isNaN(t.getWest())||(i+="&minlongitude="+t.getWest()),isNaN(t.getSouth())||(i+="&minlatitude="+t.getSouth()),isNaN(t.getEast())||(i+="&maxlongitude="+t.getEast()),t.ancestor&&(i+="&ancestor="+encodeURIComponent(t.ancestor));for(let e=0;e<t.metadata.length;e++){let n=t.metadata[e];i+="&metadata_attr1_"+n.type+"="+encodeURIComponent(n.value)}return i+="&max="+t.getMax(),i+="&skip="+t.getSkip(),t.rootEntry&&(i+="&rootEntry="+encodeURIComponent(t.rootEntry)),i+=t.getExtra(),i},addEntry:function(t){this.entryCache[t.getId()]=t},getEntry:async function(t,e){let n=!1;if(null==t)return console.log("Error in getEntry: entry id is null"),console.trace(),null;let i=this.entryCache[t];if(null!=i)return Utils.call(e,i);if(window.globalRamaddas)for(let n=0;n<window.globalRamaddas.length;n++){let i=window.globalRamaddas[n].entryCache[t];if(null!=i)return Utils.call(e,i)}if(null==e)return null;let a=this,r=this.getJsonUrl(t)+"&ancestors=true";await $.getJSON(r,(function(t){if(GuiUtils.isJsonError(t))return void 0;let n=createEntriesFromJson(t,a),i=null;n.length>0&&(i=n[0]),Utils.call(e,i,n)})).fail((function(t,e,n){let i=e+", "+n;GuiUtils.handleError("Error getting entry information: "+i,r,!1)}))}})}function createEntriesFromJson(t,e){return null==e&&(e=getGlobalRamadda()),e.createEntriesFromJson(t)}var metadataTypeCount=-1,metadataColorPalette=["#FDF5E6","#F0FFFF","#FFE3D5","#a7d0cd","#fbeeac","#dbe3e5","#e8e9a1"],metadataColors={};function getMetadataColor(t){return t.color?t.color:metadataColors[t]?metadataColors[t]:metadataColorPalette[0]}function MetadataType(t,e,n){$.extend(this,{type:t,label:e,value:n}),this.color=Utils.getEnumColor(t),$.extend(this,{getType:function(){return this.type},getColor:function(){return this.color},getLabel:function(){return null!=this.label?this.label:this.type},getValue:function(){return this.value}})}function EntryTypeColumn(t){$.extend(this,t),RamaddaUtil.defineMembers(this,{getName:function(){return this.name},getLabel:function(){return this.label},getType:function(){return this.type},getValues:function(){return this.values},getSuffix:function(){return this.suffix},getSearchArg:function(){return"search."+this.namespace+"."+this.name},getCanSearch:function(){return this.cansearch},getCanShow:function(){return this.canshow},isEnumeration:function(){return"enumeration"==this.getType()||"enumerationplus"==this.getType()},isNumeric:function(){return"double"==this.getType()||"int"==this.getType()},isUrl:function(){return"url"==this.getType()}})}function EntryType(t){let e=t.columns;null==e&&(e=[]);let n=[];for(let t=0;t<e.length;t++)n.push(new EntryTypeColumn(e[t]));t.columns=n,$.extend(this,t),RamaddaUtil.defineMembers(this,{getIsGroup:function(){return this.isgroup},getIcon:function(){return this.icon},getLabel:function(){return this.label||this.name},getId:function(){return null!=this.type?this.type:this.id},getCategory:function(){return this.category},getEntryCount:function(){return this.entryCount},getIncludeInSearch:function(){return this.includeInSearch},getColumns:function(){return this.columns}})}function Entry(t){null==t.repositoryId&&(t.repositoryId=t.baseUrl),null==t.repositoryId&&(t.repositoryId=ramaddaBaseUrl);let e=-9999;if(t.typeObject)t.type=new EntryType(t.typeObject);else if(t.type){let e={id:t.type,name:null!=t.typeName?t.typeName:t.type};t.type=new EntryType(e)}if($.extend(this,{id:null,name:null,description:null,bbox:null,geometry:null,services:[],properties:[],childrenEntries:null,startDate:null,endDate:null}),$.extend(this,t),this.domId=Utils.cleanId(this.id),this.createDate=Utils.parseDate(t.createDate),this.startDate=Utils.parseDate(t.startDate),this.endDate=Utils.parseDate(t.endDate),this.endDate&&this.startDate&&this.endDate.getTime()<this.startDate.getTime()){let t=this.startDate;this.startDate=this.endDate,this.endDate=t}this.attributes=[],this.metadata=[];for(let t=0;t<this.properties.length;t++){let e=this.properties[t];"attribute"==e.type?this.attributes.push(e):this.metadata.push(e)}RamaddaUtil.defineMembers(this,{getId:function(){return this.id},getIdForDom:function(){return this.domId},canEdit:function(){return this.canedit},isSynth:function(){return this.id.startsWith("synth:")},getFullId:function(){return this.getRamadda().getRoot()+","+this.id},doSave:function(t,e,n,i){RamaddaUtil.doSave(this.getId(),t,e,n,i)},getDisplayName:function(){return this.displayName?this.displayName:this.getName()},getCreateDate:function(){return this.createCreate},getStartDate:function(){return this.startDate},getEndDate:function(){return this.endDate},getIsGroup:function(){return this.isGroup},getProperty:function(t){return"name"==t?this.getName():"fromdate"==t?HU.span(["class","ramadda-datetime","title",this.startDate],this.startDateFormat):"createdate"==t?HU.span(["class","ramadda-datetime","title",this.createDate],this.createDateFormat):"size"==t?this.getFilesize()?this.getFormattedFilesize():"---":"type"==t?this.typeName:"Unknown:"+t},getRoot:async function(t,e){let n=this;for(;;){let e;if(await n.getParentEntry((t=>e=t)),!e)return Utils.call(t,n);n=e}},map:async function(t,e){let n;await this.getChildrenEntries((t=>{n=t})),n.map(t),Utils.call(e)},getParentName:function(){return this.parentName},getParentEntry:async function(t,e){return this.parent?this.parentEntry?Utils.call(t,this.parentEntry):void await this.getRamadda().getEntry(this.remoteParent||this.parent,(e=>{this.parentEntry=e,Utils.call(t,e)})):Utils.call(t,null)},getChildrenEntries:async function(t,e){if(null!=this.childrenEntries)return Utils.call(t,this.childrenEntries);new EntrySearchSettings({parent:this.getId()});let n=this.getRamadda().getJsonUrl(this.getAbsoluteId())+"&justchildren=true";null!=e&&(n+="&"+e);let i={entryListChanged:function(e){t(e.getEntries())}},a=new EntryList(this.getRamadda(),n,i,!1);await a.doSearch()},getType:function(){return this.typeObject,this.type},getThumbnail:function(){if(!this.metadata)return null;for(let t=0;t<this.metadata.length;t++){let e=this.metadata[t];if("content.thumbnail"==e.type&&Utils.stringDefined(e.value.attr1)){if(e.value.attr1.startsWith("http"))return e.value.attr1;return this.getRamadda().getRoot()+"/metadata/view/"+e.value.attr1+"?element=1&entryid="+this.getAbsoluteId()+"&metadata_id="+e.id}}return null},getMetadata:function(){return this.metadata},getRamadda:function(){return this.remoteRepository?getRamadda(this.remoteRepository.url):getRamadda(this.repositoryId)},getLocationLabel:function(){return"n: "+this.getNorth()+" w:"+this.getWest()+" s:"+this.getSouth()+" e:"+this.getEast()},getServices:function(){return this.services},getService:function(t){for(let e=0;e<this.services.length;e++)if(this.services[e].relType==t)return this.services[e];return null},goodLoc:function(t){return!isNaN(t)&&t!=e},hasBounds:function(){return this.goodLoc(this.getNorth())&&this.goodLoc(this.getWest())&&this.goodLoc(this.getSouth())&&this.goodLoc(this.getEast())},hasLocation:function(){return this.goodLoc(this.getNorth())},getNorth:function(){return this.bbox?this.bbox[3]:this.geometry?this.geometry.coordinates[1]:e},getWest:function(){return this.bbox?this.bbox[0]:this.geometry?this.geometry.coordinates[0]:e},getSouth:function(){return this.bbox?this.bbox[1]:this.geometry?this.geometry.coordinates[1]:e},getEast:function(){return this.bbox?this.bbox[2]:this.geometry?this.geometry.coordinates[0]:e},getLatitude:function(){return this.geometry?this.geometry.coordinates[1]:this.getNorth()},getLongitude:function(){return this.geometry?this.geometry.coordinates[0]:this.getWest()},getIconUrl:function(){if(null==this.icon)return this.getRamadda().getIconUrl(this);if(this.icon.match("^http.*"))return this.icon;let t,e=this.getRamadda().getHostname();return t=e?e+this.icon:this.icon,t},getIconImage:function(t){return this.iconRelative?HtmlUtils.image(this.iconRelative,t):HtmlUtils.image(this.getIconUrl(),t)},getColumns:function(){return null==this.type.getColumns()?new Array:this.type.getColumns()},getAttributes:function(){return this.attributes},getAttribute:function(t){for(let e=0;e<this.attributes.length;e++){let n=this.attributes[e];if(n.id==t)return n}return null},getAttributeValue:function(t){let e=this.getAttribute(t);return null==e?null:e.value},getAttributeNames:function(){let t=[];for(let e=0;e<this.attributes.length;e++){let n=this.attributes[e];t.push(n.id)}return t},getAttributeLabels:function(){let t=[];for(let e=0;e<this.attributes.length;e++){let n=this.attributes[e];n.label?t.push(n.label):t.push(n.id)}return t},getName:function(){return null==this.name||""==this.name?"no name":this.name},getSnippet:function(t){return null==this.snippet?t:this.snippet},getDescription:function(t){return null==this.description?t:this.description},getFilesize:function(){let t=parseInt(this.filesize);return t==t?t:0},getFormattedFilesize:function(){return GuiUtils.size_format(this.getFilesize())},getEntryUrl:function(t){return this.remoteUrl?this.remoteUrl:this.getRamadda().getEntryUrl(this,t)},getFilename:function(){return this.filename},isImage:function(){return!!(this.url&&this.url.search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)||(!!(this.hasResource()&&this.getFilename().search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)||!!this.getThumbnail())},getImageUrl:function(){if(this.url&&this.url.search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)return this.url;if(this.hasResource()&&this.getFilename().search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)return this.getResourceUrl();let t=this.getThumbnail();return t||null},getIsUrl:function(){return this.isurl},getIsFile:function(){return this.isfile},hasResource:function(){return null!=this.getFilename()},getAbsoluteId:function(){if(this.remoteRepository&&this.remoteUrl){let t=this.remoteUrl.match("entryid=(.*)");if(t&&t.length>1)return t[1]}return this.id},getResourceUrl:function(){if(this.url)return this.url;if(this.remoteRepository)return this.remoteRepository.url+"/entry/get?entryid="+this.getAbsoluteId();let t=this.getRamadda().getRoot()+"/entry/get";return null!=this.getFilename()&&(t+="/"+this.getFilename()),t+"?entryid="+this.id},getLink:function(t,e,n){return t||(t=this.getName()),(n=n||[]).push("href",this.getEntryUrl()),e&&(t=this.getIconImage()+SPACE+t),HtmlUtils.tag("a",n,t)},getResourceLink:function(t){return t||(t=this.getName()),HtmlUtils.tag("a",["href",this.getResourceUrl()],t)},toString:function(){return"entry:"+this.getName()+" id:"+this.getId()}})}function EntryList(t,e,n,i){$.extend(this,{repository:t,url:e,listener:n,haveLoaded:!1,entries:[],map:{},getRepository:function(){return this.repository},setEntries:function(t){this.entries=t,this.haveLoaded=!0},getEntry:async function(t,e){let n=this.map[t];if(null!=n)return Utils.call(e,n);await this.getRepository().getEntry(t,(t=>{Utils.call(e,t)}))},getEntries:function(){return this.entries},createEntries:function(t,e,n){this.entries=createEntriesFromJson(t,this.getRepository());for(let t=0;t<this.entries.length;t++){let e=this.entries[t];this.map[e.getId()]=e}null==e&&(e=this.listener),n?n(this):e&&e.entryListChanged&&e.entryListChanged(this)},doSearch:async function(t,e,n){null==t&&(t=this.listener);let i=this;await $.getJSON(this.url,(function(n,a,r){GuiUtils.isJsonError(n)||(i.haveLoaded=!0,i.createEntries(n,t,e))})).fail((function(e,a,r){GuiUtils.handleError("An error occurred doing search: "+r,i.url,!0),n?n(r):t&&t.handleSearchError&&t.handleSearchError(i.url,r)}))}}),i&&this.doSearch()}function EntrySearchSettings(t){$.extend(this,{types:[],parent:null,max:DEFAULT_MAX,skip:0,metadata:[],extra:"",orderBy:"",entries:null,startDate:null,endDate:null,north:NaN,west:NaN,north:NaN,east:NaN,areaContains:!1,getMax:function(){return this.max},getSkip:function(){return this.skip},toString:function(){return"n:"+this.north+" w:"+this.west+" s:"+this.south+" e:"+this.east},getAreaContains:function(){return this.areaContains},setAreaContains:function(t){this.areaContains=t},getNorth:function(){return this.north},getSouth:function(){return this.south},getWest:function(){return this.west},getEast:function(){return this.east},setDateRange:function(t,e){this.startDate=t,this.endDate=e},setCreateDateRange:function(t,e){this.createstartDate=t,this.createendDate=e},setBounds:function(t,e,n,i){this.north=null==t||0==t.toString().length?NaN:parseFloat(t),this.west=null==e||0==e.toString().length?NaN:parseFloat(e),this.south=null==n||0==n.toString().length?NaN:parseFloat(n),this.east=null==i||0==i.toString().length?NaN:parseFloat(i)},getTypes:function(){return this.types},hasType:function(t){return this.types.indexOf(t)>=0},getExtra:function(){return this.extra},setExtra:function(t){this.extra=t},clearAndAddType:function(t){return this.types=[],this.addType(t),this},addType:function(t){if(null!=t&&0!=t.length&&!this.hasType(t))return this.types.push(t),this}}),null!=t&&$.extend(this,t)}function EntryListHolder(t){let e;RamaddaUtil.inherit(this,e=new EntryList(t,null)),$.extend(this,{entryLists:[],addEntryList:function(t){this.entryLists.push(t)},doSearch:function(t){let e=this;null==t&&(t=this.listener);for(let n=0;n<this.entryLists.length;n++){let i=this.entryLists[n];if(!i.getRepository().canSearch())continue;let a={entryListChanged:function(n){t&&t.entryListChanged(e,n)}};i.doSearch(a)}},getEntry:async function(t){for(let e=0;e<this.entryLists.length;e++){let n,i=this.entryLists[e];if(await i.getEntry(t,(t=>{n=t})),null!=n)return n}return null},getEntries:function(){let t=[];for(let e=0;e<this.entryLists.length;e++){let n=this.entryLists[e].getEntries();for(let e=0;e<n.length;e++)t.push(n[e])}return t}})}
