var build_date="RAMADDA build date: Fri Oct 31 09:22:23 MDT 2025",ramaddaGlobals={iconWidth:"18px"},root=ramaddaBaseUrl,NAMESPACE_SVG="http://www.w3.org/2000/svg",ACTION_OK="ok",ACTION_NO="no",ACTION_CANCEL="cancel",ACTION_APPLY="apply",LABEL_SUBMIT="Submit",LABEL_OK="OK",LABEL_YES="Yes",LABEL_NO="No",LABEL_CANCEL="Cancel",LABEL_APPLY="Apply",LABEL_DELETE="Delete",ID_CANCEL="cancel",ID_OK="ok",ID_APPLY="apply",ARG_ANCESTOR="ancestor",ARG_AUTHTOKEN="authtoken",ARG_ASCENDING="ascending",ARG_ORDERBY="orderby",ARG_PAGESEARCH="pagesearch",ARG_FILE="file",ARG_MAPBOUNDS="map_bounds",ARG_NAME="name",ARG_ENTRYID="entryid",ARG_METADATAID="metadata_id",ARG_OUTPUT="output",ARG_ELEMENT="element",ARG_RESPONSE="response",ARG_TYPE="type",ARG_TEXT="text",ICON_CLOSE="fas fa-window-close",ICON_STOP="fas fa-stop",ICON_PLAY="fas fa-play",ICON_CLOSE="fas fa-window-close",ICON_LINK="fas fa-link",ICON_CLIPBOARD="fas fa-clipboard",ICON_ERASER="fas fa-eraser",icon_pin="fas fa-thumbtack",icon_help="fas fa-question-circle",icon_command=ramaddaCdn+"/icons/command.png",icon_rightarrow=ramaddaCdn+"/icons/grayrightarrow.gif",icon_downdart=ramaddaCdn+"/icons/downdart.gif",icon_updart=ramaddaCdn+"/icons/updart.gif",icon_rightdart=ramaddaCdn+"/icons/rightdart.gif",icon_progress=ramaddaCdn+"/icons/progress.gif",icon_wait=ramaddaCdn+"/icons/wait.gif",icon_information=ramaddaCdn+"/icons/information.png",icon_folderclosed=ramaddaCdn+"/icons/folderclosed.png",icon_folderopen=ramaddaCdn+"/icons/togglearrowdown.gif",icon_folderclosed="fas fa-caret-right",icon_folderopen="fas fa-caret-down",icon_tree_open=ramaddaCdn+"/icons/togglearrowdown.gif",icon_tree_closed=ramaddaCdn+"/icons/togglearrowright.gif",icon_zoom=ramaddaCdn+"/icons/magnifier.png",icon_zoom_in=ramaddaCdn+"/icons/magnifier_zoom_in.png",icon_zoom_out=ramaddaCdn+"/icons/magnifier_zoom_out.png",icon_menuarrow=ramaddaCdn+"/icons/downdart.gif",icon_blank16=ramaddaCdn+"/icons/blank16.png",icon_blank=ramaddaCdn+"/icons/blank.gif",icon_menu=ramaddaCdn+"/icons/menu.png",icon_trash="fas fa-trash-alt",UNIT_FT="ft",UNIT_MILES="mi",UNIT_KM="km",UNIT_M="m",UNIT_NM="nm",CLASS_BUTTON="ramadda-button",CLASS_BUTTONS="ramadda-buttons",CLASS_BUTTON_APPLY="ramadda-button-apply",CLASS_BUTTON_BAR="ramadda-button-bar",CLASS_BUTTON_CANCEL="ramadda-button-cancel",CLASS_BUTTON_DISABLED="ramadda-button-disabled",CLASS_BUTTON_OK="ramadda-button-ok",CLASS_BUTTON_SMALL="ramadda-button-small",CLASS_CLICKABLE="ramadda-clickable",CLASS_COLORTABLE_CATEGORY="ramadda-colortable-category",CLASS_COLORTABLE_SELECT="ramadda-colortable-select",CLASS_COPYABLE="ramadda-copyable",CLASS_DATETIME="ramadda-datetime",CLASS_DIALOG="ramadda-dialog",CLASS_DIALOG_BUTTON="ramadda-dialog-button",CLASS_FORMLABEL="formlabel",CLASS_FORMTABLE="formtable",CLASS_HIGHLIGHTABLE="ramadda-highlightable",CLASS_HOVERABLE="ramadda-hoverable",CLASS_INPUT="input",CLASS_LINK="ramadda-link",CLASS_MENUBAR="ramadda-menubar",CLASS_MENUITEM="ramadda-menu-item",CLASS_MENU_BUTTON="ramadda-menu-button",CLASS_MENU_ITEM="ramadda-menu-item",CLASS_POPUP="ramadda-popup",CLASS_POPUP_INNER="ramadda-popup-inner",CLASS_POPUP_MENU="ramadda-popup-menu",CLASS_PULLDOWN="ramadda-pulldown",CLASS_ROW="row",CLASS_SEARCHABLE="ramadda-searchable",CLASS_SESSION_ERROR="ramadda-session-error",CLASS_SLIDER="ramadda-slider",CLASS_SEARCH_INPUT="ramadda-search-input",CLASS_TABLE="ramadda-table",CLASS_TABLE_CELLBORDER="cell-border",CLASS_TABLE_HOVER="hover",CLASS_TABLE_NOWRAP="nowrap",CLASS_TABLE_ROWBORDER="row-border",CLASS_TABLE_STRIPE="stripe",CURSOR_MOVE="move",CURSOR_POINTER="pointer",CURSOR_DEFAULT="default",CURSOR_TEXT="text",CURSOR_CONTEXT_MENU="context-menu",CURSOR_CROSSHAIR="crosshair",CURSOR_ROW_RESIZE="row-resize",EVENT_CLICK="click",EVENT_MOUSEDOWN="mousedown",EVENT_MOUSEUP="mouseup",EVENT_MOUSEOUT="mouseout",EVENT_MOUSEOVER="mouseover",EVENT_MOUSEMOVE="mousemove",EVENT_KEYDOWN="keydown",EVENT_WHEEL="wheel",EVENT_DBLCLICK="dblclick",EVENT_DRAGSTART="dragstart",EVENT_DRAGMOVE="dragmove",EVENT_DRAGEND="dragend",ID="id",BACKGROUND="background",CLASS="class",DIV="div",POSITION="position",WIDTH="width",ALIGN="align",VALIGN="valign",HEIGHT="height",SRC="src",STYLE="style",TABLE="table",TITLE="title",THEAD="thead",TBODY="tbody",TFOOT="tfoot",TR="tr",TD="td",BR="br",PRE="pre",SELECT="select",OPTION="option",VALUE="value",TAG_A="a",TAG_B="b",TAG_BODY="body",TAG_BR="br",TAG_CANVAS="canvas",TAG_CENTER="center",TAG_DIV="div",TAG_FORM="form",TAG_G="g",TAG_H1="h1",TAG_H2="h2",TAG_H3="h3",TAG_HEAD="head",TAG_I="i",TAG_IFRAME="iframe",TAG_IMG="img",TAG_INPUT="input",TAG_LABEL="label",TAG_LI="li",TAG_LINK="link",TAG_OL="ol",TAG_OPTION="option",TAG_PATH="path",TAG_PRE="pre",TAG_RECT="rect",TAG_SCRIPT="script",TAG_SELECT="select",TAG_SOURCE="source",TAG_SPAN="span",TAG_STYLE="style",TAG_SVG="svg",TAG_TABLE="table",TAG_TBODY="tbody",TAG_TD="td",TAG_TFOOT="tfoot",TAG_TH="th",TAG_THEAD="thead",TAG_TR="tr",TAG_UL="ul",TAG_VIDEO="video",ID_COLORTABLE="colortable",COLOR_TRANSPARENT="transparent",COLOR_BLACK="#000",COLOR_WHITE="#fff",COLOR_LIGHT_GRAY="#ccc",COLOR_MELLOW_YELLOW="var(--color-mellow-yellow)",ATTR_ACTION="action",ATTR_ALIGN="align",ATTR_ALT="alt",ATTR_AUTOFOCUS="autofocus",ATTR_BACKGROUND="background",ATTR_BORDER="border",ATTR_CANCEL="cancel",ATTR_CATEGORY="category",ATTR_CELLPADDING="cellpadding",ATTR_CELLSPACING="cellspacing",ATTR_CLASS="class",ATTR_COLORTABLE="colortable",ATTR_COLS="cols",ATTR_COLSPAN="colspan",ATTR_COMMAND="command",ATTR_CURSOR="cursor",ATTR_DATA_ACTION="data-action",ATTR_DATA_CAPTION="data-caption",ATTR_DATA_CORPUS="data-corpus",ATTR_DATA_FANCYBOX="data-fancybox",ATTR_DATA_FIELD="data-field",ATTR_DATA_FIELDID="data-fieldid",ATTR_DATA_MAX="data-max",ATTR_DATA_MIN="data-min",ATTR_DATA_NAME="data-name",ATTR_DATA_TITLE="data-title",ATTR_DATA_TYPE="data-type",ATTR_DATA_URL="data-url",ATTR_DATA_VALUE="data-value",ATTR_DISABLED="disabled",ATTR_EAST="east",ATTR_ENTRYID="entryid",ATTR_FILL="fill",ATTR_FOR="for",ATTR_HEIGHT="height",ATTR_HREF="href",ATTR_ID="id",ATTR_IDX="idx",ATTR_IMGSRC="img-src",ATTR_INDEX="index",ATTR_LATITUDE="latitude",ATTR_LAYOUT="layout",ATTR_LOADING="loading",ATTR_LONGITUDE="longitude",ATTR_METHOD="method",ATTR_MULTIPLE="multiple",ATTR_NAME="name",ATTR_NORTH="north",ATTR_NOWRAP="nowrap",ATTR_ONCHANGE="onchange",ATTR_ONCLICK="onclick",ATTR_ONMOUSEDOWN="onmousedown",ATTR_PLACEHOLDER="placeholder",ATTR_POSITION="position",ATTR_READONLY="readonly",ATTR_REL="rel",ATTR_ROWS="rows",ATTR_SELECTED="selected",ATTR_SIZE="size",ATTR_SLIDER_MAX="slider-max",ATTR_SLIDER_MIN="slider-min",ATTR_SLIDER_STEP="slider-step",ATTR_SLIDER_VALUE="slider-value",ATTR_SOUTH="south",ATTR_SRC="src",ATTR_STATE="state",ATTR_STROKE="stroke",ATTR_STROKE_WIDTH="stroke-width",ATTR_STYLE="style",ATTR_TABINDEX="tabindex",ATTR_TABLE_HEIGHT="table-height",ATTR_TAG="tag",ATTR_TARGET="target",ATTR_TITLE="title",ATTR_TRANSFORM="transform",ATTR_TYPE="type",ATTR_URL="url",ATTR_VALIGN="valign",ATTR_VALUE="value",ATTR_WEST="west",ATTR_WHAT="what",ATTR_WIDTH="width",ATTR_X="x",ATTR_X="x",ATTR_XMLNS="xmlns",ATTR_Y="y",ATTR_Y="y",SPACE="&nbsp;",SPACE1="&nbsp;",SPACE2="&nbsp;&nbsp;",SPACE3="&nbsp;&nbsp;&nbsp;",SPACE4="&nbsp;&nbsp;&nbsp;&nbsp;",ALIGN_CENTER="center",ALIGN_TOP="top",ALIGN_BOTTOM="bottom",ALIGN_LEFT="left",ALIGN_RIGHT="right",POS_TOP="top",POS_LEFT="left",POS_BOTTOM="bottom",POS_RIGHT="right",POSITION_ABSOLUTE="absolute",POSITION_RELATIVE="relative",DISPLAY_TABLE_CELL="table-cell",DISPLAY_FLEX="flex",DISPLAY_NONE="none",DISPLAY_RELATIVE="relative",DISPLAY_BLOCK="block",DISPLAY_INLINE="inline",DISPLAY_INLINE_BLOCK="inline-block",OVERFLOW_NONE="none",OVERFLOW_AUTO="auto",OVERFLOW_HIDDEN="hidden",FONT_BOLD="bold",FONT_ITALIC="italic",WHITE_SPACE_NOWRAP="nowrap",CSS_BASIC_BORDER="var(--basic-border)",CSS_ALIGN="align",CSS_ALIGN_ITEMS="align-items",CSS_BACKGROUND="background",CSS_BACKGROUND_COLOR="background-color",CSS_BACKGROUND_IMAGE="background-image",CSS_BACKGROUND_IMAGE="background-image",CSS_BACKGROUND_REPEAT="background-repeat",CSS_BORDER="border",CSS_BORDER_BOTTOM="border-bottom",CSS_BORDER_COLLAPSE="border-collapse",CSS_BORDER_COLOR="border-color",CSS_BORDER_LEFT="border-left",CSS_BORDER_RADIUS="border-radius",CSS_BORDER_RIGHT="border-right",CSS_BORDER_SPACING="border-spacing",CSS_BORDER_TOP="border-top",CSS_BORDER_WIDTH="border-width",CSS_BOTTOM="bottom",CSS_CLIP_PATH="clip-path",CSS_COLOR="color",CSS_CURSOR="cursor",CSS_DISPLAY="display",CSS_FILL="fill",CSS_FILL_OPACITY="fill-opacity",CSS_FONT_SIZE="font-size",CSS_FONT_STYLE="font-style",CSS_FONT_WEIGHT="font-weight",CSS_HEIGHT="height",CSS_LEFT="left",CSS_LINE_HEIGHT="line-height",CSS_MARGIN="margin",CSS_MARGIN_BOTTOM="margin-bottom",CSS_MARGIN_LEFT="margin-left",CSS_MARGIN_RIGHT="margin-right",CSS_MARGIN_TOP="margin-top",CSS_MAX_HEIGHT="max-height",CSS_MAX_WIDTH="max-width",CSS_MIN_HEIGHT="min-height",CSS_MIN_WIDTH="min-width",CSS_OPACITY="opacity",CSS_OVERFLOW_WRAP="overflow-wrap",CSS_OVERFLOW_X="overflow-x",CSS_OVERFLOW_Y="overflow-y",CSS_PADDING="padding",CSS_PADDING_BOTTOM="padding-bottom",CSS_PADDING_LEFT="padding-left",CSS_PADDING_RIGHT="padding-right",CSS_PADDING_TOP="padding-top",CSS_POINTER_EVENTS="pointer-events",CSS_POSITION="position",CSS_RIGHT="right",CSS_STROKE="stroke",CSS_STROKE_WIDTH="stroke-width",CSS_TEXT_ALIGN="text-align",CSS_TEXT_DECORATION="text-decoration",CSS_TOP="top",CSS_TRANSFORM="transform",CSS_VERTICAL_ALIGN="vertical-align",CSS_VISIBILITY="visibility",CSS_WEBKIT_TRANSFORM="-webkit-transform",CSS_WHITE_SPACE="white-space",CSS_WIDTH="width",CSS_WORD_BREAK="word-break",CSS_Z_INDEX="z-index",LOADING_LAZY="lazy";function noop(){}function addHandler(t,e){return null==window.globalHandlers&&(window.globalHandlers={}),e||(e=HU.getUniqueId()),window.globalHandlers[e]=t,e}function getHandler(t){return t&&null!=window.globalHandlers?window.globalHandlers[t]:null}var Utils={me:"Utils",pageLoaded:!1,loadFunctions:[],mouseMoveCnt:0,mouseIsDown:!1,entryGroups:new Array,groupList:new Array,tooltipObject:null,entryDragInfo:null,globalEntryRows:{},isSafari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},defineGlobal:function(t,e){Utils.isDefined(window[t])||(window[t]=e)},checkLicense:function(t,e,a){let n={message:"To access this content do you agree with the following license?",showLicense:!0,suffix:"",onlyAnonymous:!1,redirect:ramaddaBaseUrl,logName:!1};a&&$.extend(n,a);let i=jqid(t).html(),r="licenseagree_"+e,s=Utils.getLocalStorage(r);if((!n.onlyAnonymous||Utils.isAnonymous())&&!s){let t=[HU.div([ATTR_ACTION,ACTION_OK,ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_CLICKABLE)],LABEL_YES),HU.div([ATTR_ACTION,ACTION_NO,ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_CLICKABLE)],LABEL_NO)],a=HU.buttons(t),s=n.message;s+=(n.showLicense?HU.div([],i):HU.br())+n.suffix,n.logName&&(s+=HU.vspace(HU.em(1)),s+=HU.div([],"Please enter your contact information"),s+=HU.formTable(),s+=HU.formEntryLabel("Name",HU.input("","",[ATTR_TABINDEX,1,ATTR_ID,"licenseagreename",ATTR_SIZE,30])),s+=HU.formEntryLabel("Email",HU.input("","",[ATTR_TABINDEX,2,ATTR_ID,"licenseagreeemail",ATTR_SIZE,30])),s+=HU.formTableClose()),s+=a,s=HU.div([ATTR_CLASS,"ramadda-license-dialog"],s);let l=HU.makeDialog({anchor:$(window),at:"left+100 top+100",my:"left top",content:s,remove:!1,modalStrict:!0,sticky:!0});l.find(HU.dotClass(CLASS_BUTTON)).click((function(){if($(this).attr(ATTR_ACTION)!=ACTION_OK)return void(window.location.href=n.redirect);let t="",a="";if(n.logName&&(t=jqid("licenseagreename").val().trim(),a=jqid("licenseagreeemail").val().trim(),!Utils.stringDefined(t)||!Utils.stringDefined(a)))return void alert("Please enter your contact information");let i=HU.url(RamaddaUtil.getUrl("/loglicense"),["licenseid",e,ARG_NAME,t,"email",a,ARG_ENTRYID,n.entryid]);$.getJSON(i,(t=>{})),Utils.setLocalStorage(r,!0),l.remove()}))}},clone:function(){if(0==arguments.length)return{};let t=arguments[0]?$.extend({},arguments[0]):{};for(let e=1;e<arguments.length;e++)arguments[e]&&(t=$.extend(t,arguments[e]));return t},preventSubmit:function(t){return 13!==t.keyCode},getMin:function(t){let e=NaN;return t.forEach((t=>{isNaN(t)||(isNaN(e)||t<e)&&(e=t)})),e},getMax:function(t){let e=NaN;return t.forEach((t=>{isNaN(t)||(isNaN(e)||t>e)&&(e=t)})),e},bufferedCalls:{},bufferedCall:function(t,e,a){a=Utils.isDefined(a)?a:1,this.bufferedCalls[t]&&clearTimeout(this.bufferedCalls[t]),this.bufferedCalls[t]=setTimeout((()=>{e()}),a)},throttle:function(t,e){let a=0;return function(...n){clearTimeout(a),a=setTimeout((()=>{t.apply(this,n)}),e)}},initCopyable:function(t,e){let a={title:null,ack:null,addLink:!1,addLinkToParent:!0,removeTags:!1,removeNL:!1,downloadFileName:null,extraStyle:null,textArea:null,input:null};e&&$.extend(a,e),$(t).each((function(){$(this).attr(ATTR_TITLE)||$(this).attr(ATTR_TITLE,a.title??"Click to copy");let t,e,n=$(this);if(a.addLink){let t=a.addLinkToParent?$(this).parent():$(this);t.css(CSS_POSITION,POSITION_RELATIVE);let e=HU.css(CSS_POSITION,POSITION_ABSOLUTE)+(a.extraStyle??HU.css(CSS_TOP,HU.px(5),CSS_RIGHT,HU.px(5)));n=$(HU.tag("ramadda-copy-link",[ATTR_CLASS,CLASS_CLICKABLE,ATTR_STYLE,e],HU.getIconImage("fa-copy"))).appendTo(t)}else $(this).addClass(CLASS_CLICKABLE);a.input&&(t=$(a.input),0==t.length&&console.log("InitCopyable: no inputs found with selector:"+a.input),t.on("focus",(function(){e=$(this),t.each((function(){$(this).css(CSS_BACKGROUND,COLOR_WHITE)})),$(this).css(CSS_BACKGROUND,COLOR_MELLOW_YELLOW)}))),n.click((()=>{let n=$(this).attr("data-copy-prefix"),i=$(this).attr("data-copy-suffix"),r=$(this).attr("data-copy")??$(this).html();if(n&&(n=n.replace(/\\n/g,"\n"),r=n+r),i&&(i=i.replace(/\\n/g,"\n"),r+=i),r=r.replace(/<ramadda-copy-link.*<\/ramadda-copy-link.*>/,""),a.removeTags&&(r=r.replace(/<br>/g,"\n").replace(/<p>/g,"\n\n").replace(/<[^>]+>/g,""),r=r.replace(/&lt;/g,"<").replace(/&gt;/g,">")),a.removeNL&&(r=r.replace(/\n/g," ")),a.addNL&&(r+="\n"),a.input)return e||(e=t.first()),void(e.length>0&&e.val(e.val()+" "+r));if(a.textArea)HU.insertIntoTextarea(a.textArea,r);else{if(a.downloadFileName){let t=prompt("Download file name",a.downloadFileName);if(t)return void Utils.makeDownloadFile(t,r)}Utils.copyToClipboard(r),alert($(this).attr("copy-message")??a.ack??"Text copied to clipboard")}}))}))},initPage:function(){this.initContent(),this.pageLoaded=!0,this.initDisplays(),HU.initTooltip(".ramadda-tooltip-element"),document.onmousemove=Utils.handleMouseMove,document.onmousedown=Utils.handleMouseDown,document.onmouseup=Utils.handleMouseUp,document.onkeypress=Utils.handleKeyPress,$(document).delegate("textarea","keydown",(function(t){if(9==(t.keyCode||t.which)){t.preventDefault();var e=this.selectionStart,a=this.selectionEnd;$(this).val($(this).val().substring(0,e)+"\t"+$(this).val().substring(a)),this.selectionStart=this.selectionEnd=e+1}})),Utils.loadFunctions.forEach((t=>{t()}))},addLoadFunction:function(t){Utils.loadFunctions.push(t)},getLocalStorage:function(t,e,a){try{a&&(t=ramaddaBaseEntry+"."+t);let n=localStorage.getItem(t);return null!==n&&e?JSON.parse(n):n}catch(e){return console.log("Error getting local storage. key="+t),null}},setLocalStorage:function(t,e,a,n){if(localStorage)try{if(n&&(t=ramaddaBaseEntry+"."+t),null===e)return void localStorage.removeItem(t);e&&a&&(e=JSON.stringify(e)),localStorage.setItem(t,e)}catch(e){console.log("Error setting local storage. key="+t)}},getFileTail:function(t){try{return new URL(t).pathname.replace(/.*\/([^\/]+)$/g,"$1")}catch(t){return null}},isImage:function(t){return!!t&&t.search(/(\.png|\.jpg|\.jpeg|\.gif|\.webp|\.heic)/i)>=0},initDragAndDrop:function(t,e,a,n,i,r,s){s||t.attr("contenteditable",!0),t.on("dragover",(a=>{a.stopPropagation(),a.preventDefault(),t.addClass("ramadda-drop-active"),e&&e(a)})),t.on("dragleave",(t=>{a&&a(t)})),t.on("drop",(e=>{t.removeClass("ramadda-drop-active"),e.stopPropagation(),e.preventDefault();let a=e.originalEvent.target.files||e.originalEvent.dataTransfer.files;for(let t=0;t<a.length;t++){let e=a[t];if(!e)continue;if(i)if("string"==typeof i){if(!e.type.match(i))continue}else if(!i(e))continue;let r=new FileReader;r.onload=t=>{n&&n(t,e,t.target.result,!0)},r.readAsDataURL(e)}})),t.on("paste",(t=>{let e=(t.clipboardData||t.originalEvent.clipboardData).items;for(let a=0;a<e.length;a++){let i=e[a];if("string"==i.kind){if(!r)continue;if("text/plain"!=i.type)continue;i.getAsString((e=>{n&&n(t,i,e,!1)}));continue}if("file"!=i.kind)continue;t.stopPropagation(),t.preventDefault();let s=new FileReader;s.onload=t=>{n&&n(t,i,t.target.result,!1)};let l=i.getAsFile();s.readAsDataURL(l);break}}))},isPost:function(){let t=$("#request-method");return 0!=t.length&&"POST"==t.attr("content")},max:function(t,e){return Utils.isDefined(t)?Utils.isDefined(e)?isNaN(t)?e:isNaN(e)?t:Math.max(t,e):t:e},min:function(t,e){return Utils.isDefined(t)?Utils.isDefined(e)?isNaN(t)?e:isNaN(e)?t:Math.min(t,e):t:e},toRadians:function(t){return t*Math.PI/180},toDegrees:function(t){return 180*t/Math.PI},distance:function(t,e,a,n){return Math.hypot(a-t,n-e)},reverseBearing:function(t,e,a){a/=6371,e=Utils.toRadians(e);var n=Utils.toRadians(t.lat),i=Utils.toRadians(t.lon),r=Math.asin(Math.sin(n)*Math.cos(a)+Math.cos(n)*Math.sin(a)*Math.cos(e)),s=i+Math.atan2(Math.sin(e)*Math.sin(a)*Math.cos(n),Math.cos(a)-Math.sin(n)*Math.sin(r));return isNaN(r)||isNaN(s)?null:MapUtils.createLonLat(Utils.toDegrees(s),Utils.toDegrees(r))},getBearing:function(t,e){let a=Utils.toRadians(t.lat),n=Utils.toRadians(t.lon),i=Utils.toRadians(e.lat),r=Utils.toRadians(e.lon),s=Math.cos(i)*Math.sin(r-n),l=Math.cos(a)*Math.sin(i)-Math.sin(a)*Math.cos(i)*Math.cos(r-n),o=Math.atan2(s,l);return o=Utils.toDegrees(o),o=(o+360)%360,o},isEscapeKey:function(t){return"Escape"===t.key||27===t.keyCode},isReturnKey:function(t){return 13==(t.keyCode||t.which)},getBounds:function(t){if(!t)return null;let e=null,a=null,n=null,i=null;return t.forEach((t=>{e=null===e?t[0]:Math.min(e,t[0]),a=null===a?t[0]:Math.max(a,t[0]),n=null===n?t[1]:Math.min(n,t[1]),i=null===i?t[1]:Math.max(i,t[1])})),{getWidth:function(){return this.maxx-this.minx},getHeight:function(){return this.maxy-this.miny},getCenter:function(){return{x:this.minx+(this.maxx-this.minx)/2,y:this.miny+(this.maxy-this.miny)/2}},minx:e,maxx:a,miny:n,maxy:i}},mergeBounds(t,e){if(null==t)return e;if(null==e)return t;let a={};return a=$.extend(a,t),$.extend(a,{minx:Math.min(t.minx,e.minx),maxx:Math.max(t.maxx,e.maxx),miny:Math.min(t.miny,e.miny),maxy:Math.max(t.maxy,e.maxy)}),a},addCopyLink:function(t){let e=jqid(t).html();e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim();let a=jqid(t);a.css(CSS_POSITION,POSITION_RELATIVE);let n=t+"_copy",i=t+"_download",r=10;if("true"==a.attr("add-copy")){let e=HU.div([ATTR_ID,n,ATTR_TITLE,"Copy to clipboard",ATTR_CLASS,CLASS_CLICKABLE,ATTR_STYLE,HU.css(CSS_POSITION,POSITION_ABSOLUTE,CSS_RIGHT,HU.px(r),CSS_TOP,HU.px(5))],HU.getIconImage(ICON_CLIPBOARD));r+=20,jqid(t).append(e)}if("true"==a.attr("add-download")){let e=HU.div([ATTR_ID,i,ATTR_TITLE,"Download",ATTR_CLASS,CLASS_CLICKABLE,ATTR_STYLE,HU.css(CSS_POSITION,POSITION_ABSOLUTE,CSS_RIGHT,HU.px(r),CSS_TOP,HU.px(5))],HU.getIconImage("fas fa-download"));jqid(t).append(e)}jqid(n).click((function(){Utils.copyToClipboard(e);let t=HU.div([ATTR_STYLE,HU.css(CSS_BACKGROUND,COLOR_MELLOW_YELLOW,CSS_PADDING,HU.px(5))],"Ok, result is copied"),a=HU.makeDialog({content:t,anchor:$(this),my:"right top",at:"right bottom"});setTimeout((()=>{a.hide(1e3),setTimeout((()=>{a.remove()}),1100)}),1e3)})),jqid(i).click((()=>{Utils.makeDownloadFile(a.attr("download-file")??"download.txt",e)}))},copyToClipboardOld:function(t){let e=$("<textarea></textarea>");$(TAG_BODY).append(e),e.val(t).select(),document.execCommand("copy")||console.error("Copy to clipboard failed"),e.remove()},getGeoLocation:function(t,e){let a={enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3};e&&$.extend(a,e),navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{let a=e.coords.latitude,n=e.coords.longitude;t({latitude:a,longitude:n})}),(t=>{console.error(t)}),a):t(null)},copyToClipboard:function(t){navigator.clipboard.writeText(t).then((()=>{})).catch((e=>{console.error("Unable to write to clipboard with navigator.clipboard.writeText:"+e),Utils.copyToClipboardOld(t)}))},isAnonymous:function(){return"anonymous"==ramaddaUser},getIcon:function(t){return RamaddaUtil.getCdnUrl("/icons/"+t)},imports:{},get:function(t,e,a){return t&&e<t.length?t[e]:a},getRotation:function(t){if(t[0].x){let e=[];t.forEach((t=>{e.push(t.x,t.y)})),t=e}var e=[(t[0]+t[4])/2,(t[1]+t[5])/2],a=[t[0]-t[6],t[1]-t[7]],n=180*Math.atan(a[0]/a[1])/Math.PI;return a[1]<0?n+=180:a[0]<0&&(n+=360),{center:e,angle:n}},rotate:function(t,e,a,n,i,r){if(0==i)return{x:parseFloat(a),y:parseFloat(n)};if(r)var s=Math.PI/180*i;else s=Math.PI/-180*i;var l=Math.cos(s),o=Math.sin(s);return{x:l*(a-t)+o*(n-e)+t,y:l*(n-e)-o*(a-t)+e}},MSGCHAR:"​",NOMSGCHAR:"⁣",delimMsg:function(t){return Utils.MSGCHAR+t+Utils.MSGCHAR},msgLabel:function(t){return HU.span([],t)+": "},noMsg:function(t){return this.NOMSGCHAR+t+this.NOMSGCHAR},isNoMsg:function(t){return t.includes(this.NOMSGCHAR)},tokenizeMessage:function(t){let e=Utils.MSGCHAR,a=Utils.MSGCHAR;const n=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`${n(e)}(.*?)${n(a)}`,"g");let r=[],s=0;return t.replace(i,((e,a,n)=>{n>s&&r.push({type:"text",value:t.slice(s,n)}),r.push({type:"token",value:a}),s=n+e.length})),s<t.length&&r.push({type:"text",value:t.slice(s)}),r},splitFirst:function(t,e){let a=t.indexOf(e);return a<0?[t]:[t.substring(0,a),t.substring(a+1)]},debug:!1,split:function(t,e,a,n,i){if(!Utils.isDefined(t))return i;let r=[];e=e??",";let s=new RegExp("\\\\"+e,"g");return t=t.replace(s,"_HIDEDELIM_"),this.debug&&console.log(t),t.split(e).forEach((t=>{t=(t=t.replace(/_comma_/g,",")).replace(/_HIDEDELIM_/g,e),a&&(t=t.trim()),n&&""==t||r.push(t)})),r},sortNumbers:function(t){return t.sort(((t,e)=>+t-+e)),t},sortDates:function(t){return t.sort(((t,e)=>t.getTime()-e.getTime())),t},convertText:function(t){return t?(t.startsWith("base64:")&&(t=window.atob(t.substring(7))),t):t},utf8ToB64:function(t){return window.btoa(unescape(encodeURIComponent(t)))},b64ToUtf8:function(t){return decodeURIComponent(escape(window.atob(t)))},decodeText:function(t){return t?(t=String(t),(t=Utils.convertText(t)).replace(/_leftbracket_/g,"[").replace(/_rightbracket_/g,"]").replace(/_dq_/g,'""').replace(/&quote;/gi,'"').replace(/_quote_/gi,'"').replace(/_qt_/gi,'"').replace(/_newline_/gi,"\n").replace(/newline/gi,"\n").replace(/_nl_/g,"\n")):null},handleActionResults:function(t,e){setTimeout((()=>{$.getJSON(e,(a=>{let n="";a.message&&(n=a.message.replace(/\n/g,HU.br())),jqid(t).html(n),"running"==a.status&&Utils.handleActionResults(t,e)})).fail((e=>{jqid(t).html("Error:"+e)}))}),1e3)},sumList:function(t){let e=0;return t.forEach((t=>{isNaN(t)||(e+=t)})),e},moveBefore:function(t,e,a){const n=(t=this.removeItem(t,a)).indexOf(e);return t.splice(n,0,a),t},toFront:function(t,e,a){const n=t.indexOf(a?e[0]:e);return n>-1&&(t.splice(n,1),a?t.push(...e):t.push(e)),t},toBack:function(t,e,a){const n=t.indexOf(a?e[0]:e);return n>-1&&(t.splice(n,1),a?t.unshift(...e):t.unshift(e)),t},makeKeyValueList:function(t){return Object.keys(t).map((e=>({key:e,value:t[e]})))},forEach:function(t,e){t&&t.forEach(e)},mergeLists:function(t,e,a,n,i){let r=[];return t&&t.map((t=>r.push(t))),e&&e.map((t=>r.push(t))),a&&a.map((t=>r.push(t))),n&&n.map((t=>r.push(t))),i&&i.map((t=>r.push(t))),r},getNameValue:function(t,e){if(!t)return null;for(var a={},n=t.split(","),i=0;i<n.length;i++){var r=n[i].split(":"),s=r[1].trim();e&&""==s||(s=s.replace(/_colon_/g,":"),a[r[0].trim()]=s)}return a},translatePoint:function(t,e,a,n,i,r){let s={x:t=+t,y:e=+e};if("nw"==i)s.x=t,s.y=e;else if("w"==i)s.x=t,s.y=e-n/2;else if("sw"==i)s.x=t,s.y=e-n;else if("s"==i)s.x=t-a/2,s.y=e-n;else if("se"==i)s.x=t-a,s.y=e-n;else if("e"==i)s.x=t-a,s.y=e-n/2;else if("ne"==i)s.x=t-a,s.y=e;else if("n"==i)s.x=t-a/2,s.y=e;else{if("c"!=i)throw new Error("Unknown point"+i);s.x=t-a/2,s.y=e-n/2}return null!=r&&(s.x+=+r.dx,s.y+=+r.dy),s},displayTimes:function(t,e,a,n){let i="",r=a?" ":"\n",s=a?" ":"\t";i+=t+r;for(var l=0;l<e.length-1;l++){let t=null;n&&l<n.length&&(t=n[l]),t||(t="time"+(l+1)),i+=s+t+": "+(e[l+1].getTime()-e[l].getTime())/1e3+r}console.log(i)},cloneList:function(t){return t?t.slice(0):null},removeElement:function(t,e){t||(t=[]);let a=t.indexOf(e);return a>=0&&t.splice(a,1),t},addUnique:function(t,e){return null==t&&(t=[]),t.includes(e)||t.push(e),t},replaceAll:function(t,e,a){let n=t.indexOf(e);return n<0?t:t.substring(0,n)+a+t.substring(n+e.length)},parseAttributes:function(t){let e,a={};for(;null!=(e=t.match(/([^ ]+) *= *"([^"]*)"/));)a[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+) *= *'([^']*)'/));)a[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+) *= *([^ ]*)( |$)/));)a[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+)( |$)/));)a[e[1].trim()]="true",t=Utils.replaceAll(t,e[0],"");return a},parseAttributesAsList:function(t){let e=[],a=!1,n=!1,i="";for(let r=0;r<t.length;r++){let s=t[r],l='"'==s;n?(i+=s,n=!1):"\\"!=s?n?(i+=s,n=!1):l?a?(a=!1,e.push(i),i=""):a=!0:a||" "!=s&&"\n"!=s?i+=s:i.length>0&&(e.push(i),i=""):n?(i+=s,n=!1):n=!0}""!=i&&e.push(i);let r=[];return e.forEach((t=>{let e=t.indexOf("="),a=t,n="";e>=0&&(a=t.substring(0,e),n=t.substring(e+1)),r.push(a),r.push(n)})),r},hideMore:function(t){var e=GuiUtils.getDomObject("morelink_"+t);hideObject(GuiUtils.getDomObject("morediv_"+t)),showObject(e)},showMore:function(t){var e=GuiUtils.getDomObject("morelink_"+t),a=GuiUtils.getDomObject("morediv_"+t);hideObject(e),showObject(a)},ramaddaUpdateMaps:function(){if("undefined"!=typeof ramaddaMaps)for(i=0;i<ramaddaMaps.length;i++){var t=ramaddaMaps[i];t.map&&t.map.updateSize()}},formDialogId:"",submitEntryForm:function(t){return Utils.popupFormLoadingDialog(t),!0},closeFormLoadingDialog:function(){$(Utils.formDialogId).dialog("close")},popupFormLoadingDialog:function(t){Utils.formDialogId=t,$(t).dialog({resizable:!1,height:100,modal:!0})},replaceRoot:function(t){var e=new RegExp("\\${root}");return t=t.replace(e,ramaddaBaseUrl)},loadScriptInfo:{},loadScript:function(t,e,a){let n="js:"+t,i=Utils.loadScriptInfo[n];if(i||(i=Utils.loadScriptInfo[n]={loaded:!1,loading:!1,callbacks:[]}),!a&&i.loaded)return e&&e(),!0;if(e&&i.callbacks.push(e),i.loading)return!1;i.loading=!0;let r=document.createElement("script");r.type="text/javascript",r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,i.loaded=!0,i.callbacks.forEach((t=>t())))}:r.onload=function(){i.loaded=!0,i.callbacks.forEach((t=>t()))},i.callback=[],r.src=t,document.getElementsByTagName(TAG_HEAD)[0].appendChild(r)},importJS:async function(t,e,a,n){t=this.replaceRoot(t);let i=this;var r="js:"+t;if(!n&&this.imports[r])return Utils.call(e);try{await $.ajax({url:t,dataType:"script",cache:!0,success:function(t){i.imports[r]=!0,Utils.call(e)}}).fail(((e,a,n)=>{console.log("initial importJS failed: "+t),console.log("error:"+n)}))}catch(n){try{await $.ajax({url:t,dataType:"text",success:function(a){console.log("got script as text -  "+t);var n=document.createElement("script");n.innerHTML=a,document.body.appendChild(n),Utils.call(e),i.imports[r]=!0}}).fail(((e,n,i)=>{a?a(e,n,i):console.log("importJS failed:"+t)}))}catch(t){}}},waitOn:async function(t,e){window[t]},importCSS:async function(t,e,a,n){var i="css:"+(t=this.replaceRoot(t));if(!n&&this.imports[i])return Utils.call(e);try{await $.ajax({url:t,dataType:"text",success:t=>{n||(this.imports[i]=!0),$('<style type="text/css">\n'+t+"</style>").appendTo(TAG_HEAD),Utils.call(e)}}).fail(a)}catch(t){}},doFetch:async function(t,e,a,n){t=this.replaceRoot(t);let i=!1;try{let r={url:t,success:function(t){Utils.call(e,t)}};n||(n="text/plain",r.beforeSend=function(t){t.overrideMimeType("text/plain;")}),r.xhrFields={responseType:n},await $.ajax(r).fail(((t,e,n)=>{i=!0,a&&a(t,e,n)}))}catch(t){i||Utils.call(a,t)}},formatXml:function(t,e){e&&$.extend({},e);let a,n=(new DOMParser).parseFromString(t,"text/xml"),i="";return a=function(t,e,n){let r="";for(let t=0;t<n;t++)r+="  ";if(n>5)i+=r+"...\n";else{if("#text"==t.nodeName){let e=t.nodeValue||"";return e=e.trim(),void(Utils.stringDefined(e)&&(i+=r+"text:"+e+"\n"))}if("#cdata-section"==t.nodeName)return i+=r+t.wholeText,void(i+="\n");""!=e&&(e+="."),e+=t.nodeName,i+=r+"&lt;"+HU.span(["data-path",e,ATTR_TITLE,"Add path selector",ATTR_STYLE,HU.css(CSS_CURSOR,CURSOR_POINTER,CSS_TEXT_DECORATION,"underline"),ATTR_CLASS,"ramadda-xmlnode"],t.nodeName)+"&gt;\n",t.childNodes.forEach((t=>{a(t,e,n+1)})),i+=r+"&lt;/"+t.nodeName+"&gt;\n"}},n.childNodes.forEach((t=>{if("parsererror"==t.nodeName)throw new Error("Parse error:"+t)})),n.childNodes.forEach((t=>{a(t,"",0)})),i},formatJson:function(t,e){var a=this.formatJsonInner(t,0,e);return this.formatJsonBlob(a,null,0,e)},formatJsonClick:function(t,e){var a=jqid(e),n=jqid(t);HU.isVisible(a)?(a.hide(),n.attr(ATTR_SRC,icon_tree_closed)):(a.show(),n.attr(ATTR_SRC,icon_tree_open))},formatJsonBlob:function(t,e,a,n){var i="";if(null!=e&&(i=e+": "),i+=t.value,t.inner){var r=HU.getUniqueId(),s=HU.image(icon_tree_closed,[ATTR_ID,r]),l=HU.getUniqueId(),o="Utils.formatJsonClick('"+r+"','"+l+"')";i=HU.div([ATTR_ONCLICK,o,ATTR_CLASS,"json-label"],s+" "+i);var d=a<n?DISPLAY_BLOCK:DISPLAY_NONE;i+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,d),ATTR_CLASS,"json-inner",ATTR_ID,l],t.inner)}return i},formatJsonInner:function(t,e,a){if(null==t)return{value:"null"};var n=typeof t;if("string"==n){var i="json-string";return t.match("^http")&&(i="json-url",t=HU.href(t,t,[ATTR_CLASS,i])),{value:HU.span([ATTR_CLASS,i],'"'+t+'"')}}if("number"==n||"boolean"==n)return{value:HU.span([ATTR_CLASS,"json-"+n],t)};if(t.toISOString)return{value:HU.span([ATTR_CLASS,"json-date"],'"'+t.toISOString()+'"')};if("function"==n){var r=(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"");return r=(r=r.replace(/[/][*][^\/*]*[*][/]/g,"")).split("){",1)[0].replace(/^[^\(]*[\(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean),{value:HU.span([ATTR_CLASS,"json-function"],t.name+"("+r+") {...}")}}var s=Array.isArray(t),l=s?HU.span([ATTR_CLASS,"json-number"],"["+t.length+"]"):"",o=HU.openTag(TAG_DIV),d=[],c=[];if(s){for(var u=0;u<t.length;u++)d.push(u),c.push(u);0==c.length&&(o+=this.formatJsonBlob({value:HU.span([ATTR_CLASS,"json-none"],"[]")},null,e+1,a))}else{for(var T in t)d.push(T),c.push(T);0==c.length&&(o+=this.formatJsonBlob({value:HU.span([ATTR_CLASS,"json-none"],"No properties")},null,e+1,a))}for(u=0;u<c.length;u++){o+=HU.open(TAG_DIV);var h=Utils.formatJsonInner(t[c[u]],e+1,a);o+=this.formatJsonBlob(h,d[u],e+1,a),o+=HU.close(TAG_DIV)}return{value:l,inner:o+=HU.close(TAG_DIV)}},padLeft:function(t,e,a){for(t=""+t,a||(a=" ");t.length<e;)t=a+t;return t},reverseArray:function(t){for(var e=[],a=t.length-1;a>=0;a--)e.push(t[a]);return e},makeArray:function(t){return Array.isArray(t)?t:[t]},getUniqueId:function(t){return HU.getUniqueId(t)},uuidv4:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))},splitList:function(t,e){let a=[];if(t.length<e)a.push(t);else{let n=Math.ceil(t.length/e),i=Math.ceil(t.length/n),r=[];a.push(r),t.forEach((t=>{r.length>=i&&(r=[],a.push(r)),r.push(t)}))}return a},removeItem:function(t,e){for(var a=t.length-1;a>=0;a--)t[a]==e&&t.splice(a,1);return t},getStack:function(t){Utils.isDefined(t)||(t=100);let e="",a=new Error;if(!a.stack)return"no stack available";let n=Utils.split(a.stack,"\n",!0,!0);for(let a=1;a<t&&a<n.length;a++){let t=n[a];t=Utils.split(t,"@");let i=t[1].match(/\/([^/]+)$/);e=e+"  "+t[0]+":"+i[1].replace(/:[^:]+$/,"")+"\n"}return e},normalize:function(t){let e=Math.min(...t.filter((t=>!isNaN(t)))),a=Math.max(...t.filter((t=>!isNaN(t))))-e;return t.map((t=>0==a?0:(t-e)/a))},getBoolean:function(t){return!!Utils.isDefined(t)&&Utils.getProperty(t)},getProperty:function(t){if(Utils.isDefined(t)){if("string"!=typeof t)return t;let e=String(t).trim();return"true"===e||"false"!==e&&t}return null},triggerDownload:function(t){let e=document.createElement("a");if(e.href=t,e.target="_download",document.createEvent){let t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}else e.click()},clearSessionMessage:function(){$(HU.dotClass(CLASS_SESSION_ERROR)).remove()},join:function(t,e,a){void 0===a&&(a=0);for(var n="",i=a;i<t.length;i++)i>a&&(n+=e),n+=t[i];return n},wrap:function(t,e,a){if(!t)return null;let n="";return t.forEach((t=>{n+=e+t+a})),n},parseMap:function(t,e,a){if(null==t)return null;let n=t.split(e??","),i={};for(var r=0;r<n.length;r++){let t=n[r],e=t.indexOf(a??":");if(e>=0){let a=t.substring(0,e),n=t.substring(e+1);i[a]=n}}return i},getUniqueValues:function(t){for(var e=[],a={},n=0;n<t.length;n++){var i=t[n];this.isDefined(a[i])||(a[i]=!0,e.push(i))}return e},getMacro:function(t){return"${states}"==t?"Alabama,Alaska,Arizona,Arkansas,California,Colorado,Connecticut,Delaware,District of Columbia,Florida,Georgia,Hawaii,Idaho,Illinois,Indiana,Iowa,Kansas,Kentucky,Louisiana,Maine,Maryland,Massachusetts,Michigan,Minnesota,Mississippi,Missouri,Montana,Nebraska,Nevada,New Hampshire,New Jersey,New Mexico,New York,North Carolina,North Dakota,Ohio,Oklahoma,Oregon,Origin State,Pennsylvania,Rhode Island,South Carolina,South Dakota,Tennessee,Texas,Utah,Vermont,Virginia,Washington,West Virginia,Wisconsin,Wyoming":t},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesShortShort:["S","M","T","W","Th","F","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],createDate:function(t,e){let a=Utils.createDateInner(t);return a&&e&&(a=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours()-e,a.getUTCMinutes(),a.getUTCSeconds()))),a},createDateInner:function(t,e){if(!t)return t;if(t.getTime)return t;t=t.trim();let a=new RegExp("^(\\+|-)?([0-9]+) *(minute|hour|day|week|month|year)s?$"),n=t.match(a);if(n){let t=parseFloat(n[1]+n[2]),a=n[3];e||(e=new Date);let i=e.getTime();return"minute"==a||"minutes"==a?new Date(i+1e3*t*60):"hour"==a||"hours"==a?new Date(i+1e3*t*60*60):"day"==a||"days"==a?new Date(i+1e3*t*60*60*24):"week"==a||"weeks"==a?new Date(i+1e3*t*60*60*24*7):"month"==a||"months"==a?new Date(i+1e3*t*60*60*24*7*31):new Date(i+1e3*t*60*60*24*365)}if(t.match(/^[0-9,-]+$/)){let e=t.split(","),a=t.split("-");n=a.length>e.length?a:e;let i=0,r=t=>t>=n.length?null:1==t?+n[t]-1:+n[t];return new Date(Date.UTC(r(i++),r(i++),r(i++),r(i++),r(i++),r(i++)))}return new Date(t)},minutesSince:function(t){return Math.round(this.toMinutes((new Date).getTime()-t))},toMinutes:function(t){return t/1e3/60},formatHour:function(t,e){let a=e?"":SPACE;return 0==t?"12"+a+"AM":12==t?"12"+a+"PM":t>12?t-12+a+"PM":t+a+"AM"},formatDateMonthDayYear:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date";var n=this.monthNames[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+" "+i+", "+t.getUTCFullYear()},formatDateYearMonth:function(t,e,a){return isNaN(t.getUTCMonth())?"Unknown date":this.monthNames[t.getUTCMonth()]+", "+t.getUTCFullYear()},formatDateMonthDay:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date";var n=this.monthNames[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+" "+i},formatDateMonDay:function(t,e,a){if(isNaN(t.getUTCMonth()))return"NA";var n=this.monthNamesShort[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+"-"+i},formatDateMDY:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=this.monthNamesShort[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+" "+i+", "+t.getUTCFullYear()},formatDateYYYYMMDD:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;n<10&&(n="0"+n);var i=t.getUTCDate();return i<10&&(i="0"+i),t.getUTCFullYear()+"-"+n+"-"+i},formatDateYYYYMMDDHHMM:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;let n=t.getUTCMonth()+1;n<10&&(n="0"+n);let i=t.getUTCDate();i<10&&(i="0"+i);let r=t.getUTCHours();r<10&&(r="0"+r);let s=t.getUTCMinutes();s<10&&(s="0"+s);let l=r+":"+s;return t.getUTCFullYear()+"-"+n+"-"+i+" "+l},formatDateYYYYMMDDHHMMSS:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;n<10&&(n="0"+n);var i=t.getUTCDate();i<10&&(i="0"+i);var r=t.getUTCHours()+1;r<10&&(r="0"+r);var s=t.getUTCMinutes();s<10&&(s="0"+s);var l=t.getUTCSeconds();l<10&&(l="0"+l);let o=r+":"+s+":"+l;return t.getUTCFullYear()+"-"+n+"-"+i+" "+o},formatDateYYYYMMDDHH:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;n<10&&(n="0"+n);var i=t.getUTCDate();i<10&&(i="0"+i);var r=Utils.formatHour(t.getUTCHours(),!0);return t.getUTCFullYear()+"-"+n+"-"+i+" "+r},formatDateYYYYMM:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;return n<10&&(n="0"+n),t.getUTCFullYear()+"-"+n},formatDateMMDD:function(t,e){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;let a=t.getUTCMonth()+1;a<10&&(a="0"+a);let n=t.getUTCDate();return n<10&&(n="0"+n),a+(e||"-")+n},formatDateHHMM:function(t,e){let a=t.getUTCHours();a<10&&(a="0"+a);let n=t.getUTCMinutes();return n<10&&(n="0"+n),a+":"+n},formatDateYYYY:function(t,e,a){return t.getUTCFullYear()},formatDateYYYYWeek:function(t,e,a){return t.getUTCFullYear()+" week:"+this.formatDateWeek(t)},formatDateWeek:function(t){var e=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-e)/864e5+1)/7)},formatDateWithFormat(t,e,a){if(null==e){if(a)return null;e="yyyymmdd"}let n=e.toLowerCase();return"yyyymmdd"==n?Utils.formatDateYYYYMMDD(t):"yyyymmddhh"==n?Utils.formatDateYYYYMMDDHH(t):"yyyymmddhhmm"==n?Utils.formatDateYYYYMMDDHHMM(t):"yyyymmddhhmmss"==n?Utils.formatDateYYYYMMDDHHMMSS(t):"yyyymm"==n?Utils.formatDateYYYYMM(t):"yearmonth"==n?Utils.formatDateYearMonth(t):"monthdayyear"==n?Utils.formatDateMonthDayYear(t):"monthday"==n?Utils.formatDateMonthDay(t):"mon_day"==n?Utils.formatDateMonDay(t):"mdy"==n?Utils.formatDateMDY(t):"hhmm"==n?Utils.formatDateHHMM(t):String(t.format(e,"UTC:",!0))},dateOptions:{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},formatDate:function(t,e,a){return this.formatDateWithFormat(t,"yyyy-mm-dd HH:MM")},incrementYear:function(t,e){return null==e&&(e=1),t.setUTCFullYear(t.getUTCFullYear()+e),t},incrementMonth:function(t,e){for(null==e&&(e=1);e>0;)11==t.getUTCMonth()?(t.setUTCFullYear(t.getUTCFullYear()+1),t.setUTCMonth(0)):t.setUTCMonth(t.getUTCMonth()+1),e--;return t},incrementDay:function(t,e){return null==e&&(e=1),t.setTime(t.getTime()+1e3*e*3600*24),t},getDayInYear:function(t){return(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())-Date.UTC(t.getUTCFullYear(),0,0))/24/60/60/1e3},monthShortNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthLongNames:["January","February","March","April","May","June","July","August","September","October","November","December"],getMonthShortNames:function(){return this.monthShortNames},xparseDate:function(t){return t=t.replaceAll(/\+0000$/,""),new Date(t)},dateRegex:new RegExp("(rel|now|today)(\\+|-)(.*)","i"),parseDate:function(t,e,a){if(null==t)return null;if("NA"==t)return null;if("number"==typeof t)return new Date(t);if(""==(t=t.trim()))return null;var n=t.match(this.dateRegex),i=0;null!=n&&(i=parseFloat(n[3]),"-"==n[2]&&(i=-i),t=n[1]);var r=null;if("now"==t);else if("rel"==t){if(null==a)return null;r=new Date(a.getTime())}else{if("today"!=t){let e=Date.parse(t);if(isNaN(e)){let e=t.split(/[^0-9]/).map((t=>parseInt(t,10)));return new Date(e[0],e[1]-1||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0)}return new Date(e)}(r=new Date(Date.now())).setMilliseconds(0),r.setSeconds(0),r.setMinutes(0),e&&r.setHours(24)}return 0!=i&&r.setDate(r.getDate()+i),r},makeDownloadFile:function(t,e){var a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t),a.style.display=DISPLAY_NONE,document.body.appendChild(a),a.click(),document.body.removeChild(a)},later:function(t){t&&setTimeout(t,1)},call:function(t,e,a,n,i){if(t){var r=[];Utils.isDefined(e)&&r.push(e),Utils.isDefined(a)&&r.push(a),Utils.isDefined(n)&&r.push(n),Utils.isDefined(i)&&r.push(i),t.apply(this,r)}return e},isTrue:function(t){return null!==t&&"true"==String(t)},isDefined:function(t){let e=!0;Array.from(arguments).every((t=>(null==t&&(e=!1),e)));return e},makeLabel:function(t,e){return t=String(t).trim(),e||(t=t.replace(/([a-z]+)([A-Z])/g,"$1 $2")),t=t.replace(/_/g," ").replace(/  +/g," ").replace(/-+/g," "),t=this.camelCase(t)},makeID:function(t){return Utils.makeId(t)},makeId:function(t){return t=(t=(t=(t=(t=(t=(t=String(t)).replace(/[^\x00-\x7F]/g,"_")).replace(/&/g,"_")).replace(/\./g,"_")).replace(/[:\//]+/g,"_")).replace(/_+$/,"")).trim().toLowerCase().replace(/ /g,"_")},camelCase:function(t,e){if(!t)return t;let a="",n=t.split(" ");for(let t=0;t<n.length;t++){let i=n[t],r=i.substring(0,1);(t>>0||!e)&&(r=r.toUpperCase()),i.length>1&&(r+=i.substring(1).toLowerCase()),""!=a&&(a+=" "),a+=r}return a},stripTags:function(t){return t.replace(/(<([^>]+)>)/gi," ")},articles:"that,this,they,those,with,them,their,have,than,there,when,more,much,many,will,were".split(","),stopWords:["not","no","will","must","just","a","about","above","after","again","against","all","am","an","and","any","are","as","at","be","because","been","before","being","below","between","both","but","by","could","did","do","does","doing","down","during","each","few","for","from","further","had","has","have","having","he","he'd","he'll","he's","her","here","here's","hers","herself","him","himself","his","how","how's","i","i'd","i'll","i'm","i've","if","in","into","is","it","it's","its","itself","let's","me","more","most","my","myself","nor","of","on","once","only","or","other","ought","our","ours","ourselves","out","over","own","same","she","she'd","she'll","she's","should","so","some","such","than","that","that's","the","their","theirs","them","themselves","then","there","there's","these","they","they'd","they'll","they're","they've","this","those","through","to","too","under","until","up","very","was","we","we'd","we'll","we're","we've","were","what","what's","when","when's","where","where's","which","while","who","who's","whom","why","why's","with","would","you","you'd","you'll","you're","you've","your","yours","yourself","yourselves"],tokenizeWords:function(t,e,a,n){e||(e=this.stopWords);for(var i=[],r=(t=t.replace(/https?:\/\/[^ ]+/g," ")).split(/[ ,\(\)\.:\;\n\?\-!\*]/),s=0;s<r.length;s++){var l=r[s].trim();if(""!=l){var o=l.toLowerCase();e.includes(o)||a&&a.includes(o)||n&&this.articles.includes(o)||l.match(/^[0-9]+$/)||i.push(l)}}return i},stringEquals:function(t,e){return null===t&&null===e||null!==t&&null!==e&&new String(t).valueOf()===new String(e).valueOf()},stringDefined:function(){for(let t=0;t<arguments.length;t++){let e=arguments[t];if(!Utils.isDefined(e))return!1;if(null==e||""==e)return!1}return!0},getStringDefined:function(){for(let t=0;t<arguments.length;t++)if(Utils.stringDefined(arguments[t]))return arguments[t];return null},getDefined:function(){for(let t=0;t<arguments.length;t++){let e=arguments[t];if(Utils.isDefined(e))return e}return null},tokenizeMacros:function(s,args,debug){let opts={};args&&$.extend(opts,args);let hook=opts.hook,tokens=[],tokenMap={},cnt=0;for(;s.length>0;){let t=s.indexOf("${");if(t<0)break;let e=s.substring(0,t);""!=e&&tokens.push({type:"string",s:e}),s=s.substring(t);let a="",n=0,i=!1;for(;n<s.length;){let t=s.charAt(n++);if('"'!=t&&"'"!=t){if("}"==t&&!i)break;a+=t}else i=!i,a+=t}if(n>s.length)break;s=s.substring(n);let r=a.substring(2),l={};t=r.indexOf(" ");let o="";if(t<0)o=r;else{o=r.substring(0,t).trim();let e=r.substring(t).trim();l=Utils.parseAttributes(e),debug&&console.dir(l)}let d={id:String(cnt++),attrs:l,tag:o,macro:r};tokens.push(d),tokenMap[o]=d}return""!=s&&tokens.push({type:"string",s:s}),{tokens:tokens,tokenMap:tokenMap,getAttributes:function(t){let e=this.tokenMap[t];return e?e.attrs:null},apply:function(source,debug,handler){let cnt=0,tokenFunc=t=>{let has=e=>Utils.isDefined(t.attrs[e])||Utils.isDefined(t.attrs[e.toLowerCase()]),get=e=>t.attrs[e]??t.attrs[e.toLowerCase()],value=source[t.tag];if(!value){let e=Object.keys(source);e.every((e=>e.match(t.tag)?(value=source[e],!1):(t.tag.indexOf("|")&&t.tag.split("|").every((t=>t!=e&&!e.match(t)||(value=source[e],!1))),!value)))}let s="";if("func"==t.tag){let f=t.attrs.f;if(!f)return"&lt;no function defined&gt;";let code="function macroFunc() {\n";for(a in source){if("default"==a)continue;let t=source[a];"number"!=typeof t&&(t='"'+t+'"'),code+=a+"="+t+";\n"}code+="return "+f+";\n}\n",code+="macroFunc()";try{value=eval(code)}catch(t){return console.log("Error applying macro function:"+code+"\n"+t),"&lt;Error:"+t+"&gt;"}}if(t.attrs.nonblank&&0==String(value).length)return"";if(!Utils.isDefined(value))return"${"+t.macro+"}";if(value.getTime){let e=t.attrs.offset??opts.timezoneOffset,a="";if(t.attrs.localTime){let t=60*(new Date).getTimezoneOffset()*1e3;value=new Date(value.getTime()-t)}return Utils.formatDateWithFormat(value,t.attrs.format||opts.dateFormat)+a}if(t.attrs.display&&handler){let e=handler(t,value);if(!1!==e)return e}if(t.attrs.missing&&(""==value||isNaN(value)))return t.attrs.missing;if(t.attrs.bar){let e=t.attrs.min||0,a=t.attrs.max;if(""==value||isNaN(value))return t.attrs.missing||value;if(Utils.isDefined(e,a)){let n=t.attrs.color||"#4E79A7",i=t.attrs[ATTR_WIDTH]||HU.perc(100),r=parseFloat(t.attrs[ATTR_HEIGHT]||12),s=HU.perc(100-100*(value-e)/(a-e)),l=t.attrs[ATTR_BORDER]||HU.border(1,COLOR_LIGHT_GRAY),o=t.attrs.includeValue||!0,d=HU.div([ATTR_TITLE,value+"/"+a,ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_POSITION,POSITION_RELATIVE,CSS_HEIGHT,HU.px(r+2),CSS_WIDTH,i,CSS_BORDER,l,CSS_BORDER_LEFT,"none")],HU.div([ATTR_STYLE,HU.css(CSS_POSITION,POSITION_ABSOLUTE,CSS_LEFT,HU.px(0),CSS_RIGHT,s,CSS_HEIGHT,HU.px(r),CSS_BACKGROUND,n)]));return o?HU.row([[ATTR_WIDTH,HU.perc(1)],value],d):d}}if(t.attrs.stars){if(""==value||isNaN(value))return t.attrs.missing||value;let e=t.attrs.count||5,a=t.attrs.min||0,n=t.attrs.max;if(Utils.isDefined(a,n)){let i=t.attrs.color||"#F9CF03",r="",s="";for(let t=0;t<e;t++)r+=HU.getIconImage("far fa-star",null,[ATTR_STYLE,HU.css(CSS_FONT_SIZE,HU.pt(10),CSS_COLOR,COLOR_BLACK)]),s+=HU.getIconImage("fas fa-star",null,[ATTR_STYLE,HU.css(CSS_FONT_SIZE,HU.pt(10),CSS_COLOR,i)]);let l=HU.perc(100-100*(value-a)/(n-a)),o=t.attrs.includeValue||!0,d=HU.div([ATTR_TITLE,value+"/"+n,ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_POSITION,POSITION_RELATIVE)],r+HU.div([ATTR_STYLE,HU.css(CSS_WHITE_SPACE,WHITE_SPACE_NOWRAP,CSS_OVERFLOW_X,OVERFLOW_HIDDEN,CSS_POSITION,POSITION_ABSOLUTE,CSS_LEFT,HU.px(0),CSS_RIGHT,l,CSS_TOP,HU.px(0),CSS_BOTTOM,HU.px(0))],s));return o?HU.row([[ATTR_WIDTH,HU.perc(1)],value],d):d}}if(Utils.isDefined(t.attrs.nan)&&isNaN(value)&&(value=t.attrs.nan),(t.attrs.positiveTemplate||t.attrs.negativeTemplate)&&(value=+value,value>=0?t.attrs.negativeTemplate&&(value=t.attrs.positiveTemplate.replace("${value}",value)):t.attrs.negativeTemplate&&(t.attrs.doAbsolute&&(value=-value),value=t.attrs.negativeTemplate.replace("${value}",value))),t.attrs.youtube)return 0==value.trim().length?null:(s+=Utils.embedYoutube(value,t.attrs),s);if(t.attrs.list)return value=String(value),s+="<ul>",value.split("\n").forEach((t=>{""!=(t=t.trim())&&(s+="<li> "+t)})),s+="</ul>",s;if(t.attrs.pre)return value=String(value),""!=value.trim()&&(value="<pre class=thin_pre>"+value.trim()+"</pre>"),value;if(t.attrs.showUrl){let e=t.attrs.label||value;value=HU.href(value,e,[ATTR_TARGET,"_other",ATTR_STYLE,t.attrs[ATTR_STYLE]||""])}if(t.attrs.delimiter&&t.attrs.fields){let e=[];Utils.stringDefined(value)&&e.push(value),t.attrs.fields.split(",").forEach((t=>{let a=source[t];Utils.stringDefined(a)&&e.push(a)})),value=Utils.join(e,t.attrs.delimiter)}if(t.attrs.urlField){let e=source[t.attrs.urlField];Utils.stringDefined(e)&&(value=HU.href(e,value))}if(t.attrs.offset1&&(value+=parseFloat(t.attrs.offset1)),t.attrs.scale&&(value*=parseFloat(t.attrs.scale)),t.attrs.offset2&&(value+=parseFloat(t.attrs.offset2)),t.attrs.decimals){value=parseFloat(value);let e=Math.pow(10,t.attrs.decimals);value=Math.floor(value*e)/e}if(t.attrs.format){let e=t.attrs.format;"comma"==e&&(isNaN(value)?value=0:0!=value&&(value=Utils.formatNumberComma(value)))}if(t.attrs.lowercase&&(value=String(value).toLowerCase()),t.attrs.uppercase&&(value=String(value).toUpperCase()),t.attrs.camelcase&&(value=Utils.camelCase(String(value),!0)),t.attrs.trim&&value.length>t.attrs.trim&&(value=value.substring(0,t.attrs.trim),t.attrs.ellipsis&&(value+="...")),t.attrs.replace){let e=t.attrs.replace;"_space_"==e&&(e=" ");let a=t.attrs.with??" ";("_nl_"==a||"\\n"==a)&&(a="\n");let n=new RegExp(e,"g");value=value.replace(n,a)}if(t.attrs.suffix&&(value+=t.attrs.suffix),t.attrs.prefix&&(value=t.attrs.prefix+value),t.attrs.toggle,t.attrs.image&&(Utils.stringDefined(value)&&t.attrs.urlPrefix&&(value=t.attrs.urlPrefix+value),!Utils.stringDefined(value)&&t.attrs.defaultUrl&&(value=t.attrs.defaultUrl),""!=value)){let e="";if(t.attrs[ATTR_TITLE])for(a in e=t.attrs[ATTR_TITLE],source)e=e.replace("{"+a+"}",source[a]);let n=[ATTR_TITLE,e,ATTR_DATA_CAPTION,e];t.attrs[ATTR_HEIGHT]?(n.push(ATTR_HEIGHT),n.push(t.attrs[ATTR_HEIGHT])):(n.push(ATTR_WIDTH),n.push(t.attrs[ATTR_WIDTH]||HU.perc(100))),n.push(ATTR_LOADING),n.push("lazy");let i=value;if(value=HU.image(i,n),t.attrs.doPopup){t.attrs.popupBase||(t.attrs.popupBase="gallery"+Utils.getUniqueId());let a=t.attrs.popupBase;value=HU.href(i,value,[ATTR_CLASS,"popup_image",ATTR_DATA_FANCYBOX,"fancybox",ATTR_DATA_CAPTION,e,ATTR_TITLE,e])}}if(t.attrs.images&&""!=value){let e;value=value.trim(),e=value.startsWith("[")?JSON.parse(value):t.attrs.delimiter?value.split(t.attrs.delimiter):value.split(";");let n="";if(t.attrs[ATTR_TITLE])for(a in n=t.attrs[ATTR_TITLE],source)n=n.replace("{"+a+"}",source[a]);let i=[ATTR_TITLE,n];t.attrs[ATTR_HEIGHT]?(i.push(ATTR_HEIGHT),i.push(t.attrs[ATTR_HEIGHT])):(i.push(ATTR_WIDTH),i.push(t.attrs[ATTR_WIDTH]||HU.perc(100))),value="",e.forEach((t=>{value+=HU.image(t,i)})),console.log(value)}if(t.attrs.convertDegrees){let t=[["NNE",11.25,33.75],["NE",33.75,56.25],["ENE",56.25,78.75],["E",78.75,101.25],["ESE",101.25,123.75],["SE",123.75,146.25],["SSE",146.25,168.75],["S",168.75,191.25],["SSW",191.25,213.75],["SW",213.75,236.25],["WSW",236.25,258.75],["W",258.75,281.25],["WNW",281.25,303.75],["NW",303.75,326.25],["NNW",326.25,348.75]],e="N";return value=+value,t.every((t=>!(value>=t[1]&&value<=t[2])||(e=t[0],!1))),e}if(t.attrs.template&&(value=t.attrs.template.replace("{value}",value)),t.attrs.templateif){let e=t.attrs.templateif.split(":"),a=e[0],n=e.slice(1).join(":");value=String(value),value.match(a)&&(value=n.replace("{value}",value))}let maxLength=t.attrs.maxLength??t.attrs.maxlength;if(maxLength&&value.length>+maxLength&&(value=value.substring(0,+maxLength),(t.attrs.maxLengthSuffix??t.attrs.maxlengthsuffix)&&(value+=t.attrs.maxLengthSuffix)),t.attrs.crop&&value.length>+t.attrs.crop&&(value=String(value).substring(0,t.attrs.crop)+"..."),t.attrs.cropLength&&value.length>+t.attrs.cropLength){let e=+t.attrs.cropLength;for(;e>=0&&" "!=value[e]&&"\n"!=value[e]&&"\t"!=value[e];)e--;if(0==e)for(;e<value.length&&" "!=value[e]&&"\n"!=value[e]&&"\t"!=value[e];)e++;let a=Utils.getUniqueId(),n=value.substring(0,e)+HU.span([ATTR_ID,a+"_ellipsis"],"..."),i=HU.span([ATTR_ID,a+"_post",ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_NONE)],value.substring(e)),r=HU.div([ATTR_ONCLICK,"Utils.toggleShowMore('"+a+"')",ATTR_ID,a,ATTR_CLASS,"ramadda-showmore "+CLASS_CLICKABLE],"Show More "+HU.getIconImage("fas fa-sort-down"));value=n+i+r}return t.attrs.tableRow&&(value="<tr><td align=right>"+t.attrs.label+":</td><td>"+value+"</td></tr>"),has("prefixLabel")&&(value=get("label")+": "+value),has("maxHeight")&&(value=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_MAX_HEIGHT,HU.getDimension(get("maxHeight")),CSS_OVERFLOW_Y,OVERFLOW_AUTO)],value)),has("maxWidth")&&(value=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_WHITE_SPACE,WHITE_SPACE_NOWRAP,CSS_MAX_WIDTH,HU.getDimension(get("maxWidth")),CSS_OVERFLOW_X,OVERFLOW_AUTO)],value)),s+=value,s},s="";return this.tokens.forEach((t=>{if("string"==t.type)s+=t.s;else{let e=null;if(hook&&(e=hook(t,source[t.tag])),e||(e=tokenFunc(t)),!e)return;e.trim().length>0&&t.attrs.toggle&&(e=HU.toggleBlock(t.attrs.label||"More",e)),s+=e}})),s},getText:function(){let t=0,e="";return this.tokens.map((a=>{"string"==a.type?e+=a.s:(e+="${macro"+t+"}",t++)})),e}}},embedAudio:function(t){return HU.tag(TAG_AUDIO,["controls",null],HU.tag(TAG_SOURCE,[ATTR_SRC,t,ATTR_TYPE,"audio/mpeg"],"Your browser does not support the audio tag."))},embedYoutube:function(t,e){e=e||{};let a=t.match(/.*watch\?v=(.*)$/);if(a&&2==a.length||(a=t.match(/.*youtu.be\/(.*)$/)),!a||2!=a.length)return HU.href(t,t);let n="//www.youtube.com/embed/"+a[1]+"?enablejsapi=1&autoplay="+("true"==Utils.getBoolean(e.autoplay)?"1":"0")+"&playerapiid=video_1",i="";return e.includeLink&&(i+=HU.href(t,"Link")+HU.br()),i+=HU.tag(TAG_IFRAME,[ATTR_ID,"ytplayer","allow","autoplay; fullscreen",ATTR_TYPE,"text/html","frameborder","0",ATTR_WIDTH,e[ATTR_WIDTH]||640,ATTR_HEIGHT,e.height||360,SRC,n]),i},toggleShowMore:function(t){let e=jqid(t),a=e.attr("open");a=!a,e.attr("open",a),a?(jqid(t+"_ellipsis").hide(),jqid(t+"_post").show(),e.html("Show Less "+HU.getIconImage("fas fa-sort-up"))):(jqid(t+"_ellipsis").show(),jqid(t+"_post").hide(),e.html("Show More "+HU.getIconImage("fas fa-sort-down")))},formatNumberComma:function(t,e,a){if(!Utils.isDefined(t))return"NA";let n=Math.floor(t),i=t-n,r=n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");if(0==i)return r;{let n=Math.abs(t);Utils.isDefined(e)||(e=n>=9999?0:n>=999?1:n>=99?2:n>=9?3:4);let i=number_format(t,e);return a&&console.log(t,e,i),i}},formatFileLength:function(t){return t<0?"":t<5e3?Math.round(t)+" bytes":t<1e6?(t=Math.round(100*t/1e3)/100,Math.round(t)+" KB"):(t=Math.round(100*t/1e6)/100)+" MB"},numberToString:null,trimDecimals:function(t,e){if(0==e)return parseInt(t);return t=parseFloat(t),parseInt(t*Math.pow(10,e))/Math.pow(10,e)},roundDecimals:function(t,e,a){null==this.numberToString&&(this.numberToString=new Intl.NumberFormat("fullwide",{useGrouping:!1}));let n=this.numberToString.format(t),i=Number(Math.round(n+"e"+e)+"e-"+e);return a&&console.log("decimals:"+n+" "+Math.round(n+"e"+e)),i},formatNumber:function(t,e,a){let n=this.formatNumberInner(t,a);return e?parseFloat(n):n},formatNumberInner:function(t,e){let a=Math.abs(t);if(a==Math.floor(a))return String(Math.floor(t));if(a>1e3)return number_format(t,0);if(a>100)return number_format(t,2);if(a>10)return number_format(t,3);if(a>1)return number_format(t,4);{let a=""+(t-Math.floor(t));return number_format(t,Math.min(a.length-2,5),e)}},isRealNumber:function(t){return!(t==Number.POSITIVE_INFINITY||isNaN(t)||!Utils.isNumber(t)||!Utils.isDefined(t)||null==t)},isNumber:function(t){return null!=t&&(""!==t&&("number"==typeof t||!isNaN(t-0)))},isType:function(t,e){return!(!t||typeof t!=e)},cleanId:function(t){return t=(t=t.replace(/:/g,"_").replace(/\./g,"_").replace(/=/g,"_").replace(/\//g,"_").replace(/[\(\)]/g,"_")).replace(/[^a-zA-Z0-9_]/g,"_")},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isFalse:function(t){return void 0!==t&&0==t},toFloat:function(t,e){return null==t||""==String(t).trim()?void 0!==e?e:NaN:parseFloat(t)},getUrlArgs:function(t){t=t.split("+").join(" ");for(var e,a={},n=/[?&]?([^=]+)=([^&]*)/g;e=n.exec(t);)a[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return a},checkTabs:function(t){for(;;){var e=new RegExp('id="(tabId[^"]+)"').exec(t);if(!e)break;var a=e[1];a.indexOf("-")<0&&jQuery((function(){jQuery("#"+a).tabs()}));var n=t.indexOf('id="tabId');if(n<0)break;t=t.substring(n+20)}},initRangeSelect:function(){let t=$(".ramadda-range-select"),e=function(){let t=$(this).attr("to-id");"between"==$(this).val()?jqid(t).show():jqid(t).hide()};t.each(e),t.change(e)},initNavbarPopup:function(t,e){let a={side:"right"};e&&$.extend(a,e),jqid(t).click((function(){let e=jqid(t+"_popup");if(HU.isVisible(e))return void e.hide();e.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK);let n={of:$(this),my:a.side+" top",at:a.side+" bottom",collision:"fit fit"};e.show(400),e.position(n)}))},initPageReload:function(t,e,a){let n=jqid(e),i=jqid(e+"_label");n.length>0&&n.change((()=>{let r="Reload"+HU.span([ATTR_STYLE,HU.css(CSS_COLOR,COLOR_TRANSPARENT)]," in 00  seconds");i.html(r),HU.isChecked(n)&&Utils.checkPageReload(t,e,a)})),(0==n.length||HU.isChecked(n))&&Utils.checkPageReload(t,e,a)},checkPageReloadPending:!1,checkPageReload:function(t,e,a){let n=jqid(e),i=jqid(e+"_label");if(!(n.length>0)||HU.isChecked(n))if(t<=0)location.reload();else{if(a){let e="Reload in "+t+" seconds";i.html(e)}t<=5?i.css(CSS_BACKGROUND,"#eee"):i.css(CSS_BACKGROUND,COLOR_TRANSPARENT),Utils.checkPageReloadPending||(Utils.checkPageReloadPending=!0,setTimeout((()=>{Utils.checkPageReloadPending=!1,Utils.checkPageReload(t-1,e,a)}),1e3))}},areDisplaysReady:function(){if(!Utils.getPageLoaded())return 0;if(0==Utils.displaysList.length)return 1;let t=!0;return Utils.displaysList.forEach((e=>{e.isDisplayFinished&&(e.isDisplayFinished()||(t=!1))})),t?1:0},checkForResize:function(){$(window).resize((()=>{this.pendingResizeTimeout&&(clearTimeout(this.pendingResizeTimeout),this.pendingResizeTimeout=null);this.pendingResizeTimeout=setTimeout((()=>{for(let t=0;t<Utils.displaysList.length;t++){let e=Utils.displaysList[t];e.handleWindowResize&&e.handleWindowResize()}this.pendingResizeTimeout=null}),1e3)}))},displaysList:[],displaysMap:[],addDisplay:function(t){this.displaysList.push(t),t.getId&&(this.displaysMap[t.getId()]=t),t.displayId&&(this.displaysMap[t.displayId]=t)},removeDisplay:function(t){let e=this.displaysList.indexOf(t);e>=0&&this.displaysList.splice(e,1),t.getId&&delete this.displaysMap[t.getId()],t.displayId&&delete this.displaysMap[t.displayId]},initDisplays:function(){this.displaysList.forEach((t=>{if(t.pageHasLoaded){new Date;t.pageHasLoaded();new Date}}))},getPageLoaded:function(){return this.pageLoaded},initBigText:function(t){let e=t.html(),a=t.attr("bigtext-length")??400;if(e.length<a)return;let n=t.attr("bigtext-label-more")??"More...",i=t.attr("bigtext-label-less")??"Less...",r=t.attr("bigtext-height")??HU.px(100),s=HU.getUniqueId("fade_");t.css(CSS_PADDING_BOTTOM,HU.px(25)).css(CSS_MAX_HEIGHT,r).css(CSS_OVERFLOW_Y,OVERFLOW_HIDDEN).css(CSS_POSITION,POSITION_RELATIVE);let l=$(HU.div([ATTR_STYLE,HU.css(CSS_HEIGHT,t.attr("bigtext-fade-height")??HU.px(50)),ATTR_ID,s,ATTR_CLASS,"ramadda-bigtext-fade"])).appendTo(t),o=HU.div([ATTR_TITLE,"Expand",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-bigtext-toggle")],n);o=$(o).appendTo(t);let d=!1;o.click((function(){d=!d,d?(l.hide(),o.html(i),t.css(CSS_MAX_HEIGHT,HU.px(1e3))):(o.html(n),t.css(CSS_MAX_HEIGHT,r),l.show())}))},initContent:function(t){t?t+=" ":t="";try{let e=$(t+".ramadda-table");e.length&&HU.formatTable(e)}catch(t){console.log("Error formatting table:"+t),console.log(t.stack)}$(t+".ramadda-bigtext").each((function(){Utils.initBigText($(this))})),$(t+".ramadda-snippet-hover").each((function(){let t=$(this),e=t.html(),a="ramadda-snippet-popup";e.length>200&&(a+=" ramadda-snippet-popup-large");let n=$(this).attr("hover-target")?jqid($(this).attr("hover-target")):t.parent();n.parent().attr(ATTR_TITLE,""),n.tooltip({content:()=>e,position:{my:"left+15 top",at:"left top+30"},classes:{"ui-tooltip":a},show:{effect:"slideDown",delay:600,duration:600}})}));let e=$(t+".ramadda-page-title"),a=$(t+".ramadda-header-fixedtitle");e.length&&a.length&&(e=e.first(),a=a.first(),$(window).scroll((()=>{e.offset().top<a.offset().top+a.height()+10?this.showingHeaderCenter||(this.showingHeaderCenter=!0,a.html(e.html()),e.html(SPACE)):this.showingHeaderCenter&&(this.showingHeaderCenter=!1,e.html(a.html()),a.html(SPACE))}))),$(t+":submit").button().click((function(t){})),$(t+"."+CLASS_BUTTON).button().click((function(t){}));let n=$(t+".ramadda-linkable");n.mouseenter((function(){let t=$(this).attr(ATTR_ID);t&&(jqid(t+"-hover").html(HU.getIconImage(ICON_LINK,null,[ATTR_STYLE,HU.css(CSS_FONT_SIZE,HU.pt(10))])),jqid(t+"-hover").show())})),n.click((function(){let t=$(this).attr(ATTR_ID);t&&HU.scrollToAnchor(t,-50)})),n.mouseleave((function(){let t=$(this).attr(ATTR_ID);t&&jqid(t+"-hover").hide()})),$(t+".ramadda-pulldown-with-icons").each((function(){let t=$(this).attr(ATTR_WIDTH);$(this).iconselectmenu({width:t,create:function(t,e){$(this).iconselectmenu("menuWidget").css({height:HU.px(200),"max-height":HU.px(200),"overflow-y":OVERFLOW_AUTO})}}),$(this).addClass("ui-menu-icons ramadda-select-icon")}))},setMenuValue:function(t,e){t.val(e),t.iconselectmenu&&t.iconselectmenu("instance")&&t.iconselectmenu("refresh")},searchLastInput:"",searchAscending:!1,searchCnt:0,searchSuggestInit:function(t,e,a,n,i){let r=jqid(t),s=jqid(e);Utils.isDefined(n)||(n=!0);let l=!1;if(!i){l=!0,i=HU.getUniqueId();let t=r.width(),e=HU.div([ATTR_ID,i,ATTR_STYLE,HU.css(CSS_BORDER,HU.px(0),CSS_WIDTH,HU.px(t),CSS_POSITION,POSITION_ABSOLUTE),ATTR_CLASS,HU.classes(CLASS_POPUP,"ramadda-search-popup")],"");r.parent().append(e)}let o=jqid(i),d=()=>{o.slideUp(250)},c=()=>{let t=r.val()||"";this.searchCnt++,this.pendingSearch&&(clearTimeout(this.pendingSearch),this.pendingSearch=null),0!=t.length?this.pendingSearch=setTimeout((()=>{this.pendingSearch=null,Utils.doSearchSuggest(this.searchCnt,r,s,o,a,l)}),200):d()};s.length&&s.change(c),Utils.searchLastInput=r.val(),r.keyup((t=>{let e=t.keyCode||t.which;27!=e&&13!=e?(t.stopPropagation(),c()):d()}))},doSearchSuggest:function(t,e,a,n,i,r){let s=this,l=e.val()||"";Utils.searchLastInput=l;let o=HU.url(RamaddaUtil.getUrl("/search/suggest"),ARG_TEXT,l);i&&(o=HU.url(o,ARG_TYPE,i)),a.length>0&&HU.isChecked(a)&&ramaddaThisEntry&&(o=HU.url(o,ARG_ANCESTOR,ramaddaThisEntry)),o=HU.url(o,"ascending",Utils.searchAscending,ARG_ORDERBY,"createdate");$.getJSON(o,(function(a){if(t!=s.searchCnt)return;let i=()=>{n.slideDown(400)};if(0==a.values.length)return n.html(HU.div([ATTR_CLASS,"ramadda-search-suggestion "],"No results")),void i();let l="",o=!0;if(a.values.forEach(((t,e)=>{let a,n=t.name,i=t.id,s=n.replace(/\"/g,"_quote_"),d=HU.href(HU.url(RamaddaUtil.getUrl(URL_ENTRY_SHOW),ARG_ENTRYID,i),HU.getIconImage(t.icon??icon_blank16,[ATTR_WIDTH,ramaddaGlobals.iconWidth])+SPACE+n,[ATTR_TITLE,"View entry",ATTR_DATA_TYPE,t.typeName,ATTR_DATA_NAME,t.name,"data-icon",t.icon,"data-thumbnail",t.thumbnail?t.thumbnail:"",ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_WIDTH,HU.perc(100)),ATTR_CLASS,CLASS_HIGHLIGHTABLE]);a=r?HU.span([ATTR_CLASS,HU.classes(CLASS_HIGHLIGHTABLE,CLASS_SEARCH_INPUT),ATTR_INDEX,e,ATTR_TITLE,"Search for"],HU.getIconImage("fa-search")):HU.href(HU.url(RamaddaUtil.getUrl(URL_SEARCH_DO),ARG_TEXT,s),HU.getIconImage("fa-search"),[ATTR_TITLE,"Search for text: "+t.name]),a="";let c=a+SPACE+d;l+=HU.div([ATTR_CLASS,"ramadda-search-suggestion "],c),l+="\n",o=!o})),n.html(l),n.find(HU.dotClass(CLASS_HIGHLIGHTABLE)).tooltip({show:{delay:1e3,duration:300},content:function(){let t=$(this).attr(ATTR_DATA_NAME),e=$(this).attr("data-thumbnail"),a=HU.div([],"Click to view entry")+HU.image($(this).attr("data-icon"),[ATTR_WIDTH,ramaddaGlobals.iconWidth])+" "+HU.b(t)+HU.div([],Utils.msgLabel("Type")+$(this).attr(ATTR_DATA_TYPE));return Utils.stringDefined(e)&&(a+=HU.thinLine(),a+=HU.image(e,[ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(5)),ATTR_WIDTH,240])),a}}),r){let t=HU.findClass(n,CLASS_SEARCH_INPUT);t.css(CSS_CURSOR,CURSOR_POINTER),t.click((function(t){t.stopPropagation();let n=a.values[$(this).attr(ATTR_INDEX)].name;e.val(n),e.closest(TAG_FORM).submit()}))}i()})).fail((function(t,e,a){console.log("fail:"+e)}))},searchLink:function(){let t=jqid("popup_search_input").val().trim(),e=$(this).attr(ATTR_URL);Utils.stringDefined(t)&&(e=HU.url(e,ARG_TEXT,t)),window.location=e},searchPopup:function(t,e){e=t;let a=Utils.searchLastInput||"",n=HU.open(TAG_FORM,[ATTR_ACTION,RamaddaUtil.getUrl(URL_SEARCH_DO)]),i=HU.tag(TAG_INPUT,[ATTR_VALUE,a,ATTR_PLACEHOLDER,"Search text","autocomplete","off",ATTR_AUTOFOCUS,"true",ATTR_ID,"popup_search_input",ATTR_CLASS,CLASS_SEARCH_INPUT,ATTR_STYLE,HU.css(CSS_MARGIN_LEFT,HU.px(4),CSS_PADDING,HU.px(2),CSS_WIDTH,HU.px(250),CSS_BORDER,HU.px(0)),ATTR_NAME,"text"]),r="";ramaddaThisEntry&&(r=HU.span([ATTR_STYLE,HU.css(CSS_MARGIN_RIGHT,HU.px(5)),ATTR_TITLE,Utils.delimMsg("Search under")+": "+ramaddaThisEntryName],HU.checkbox("popup_search_here",[ATTR_NAME,"ancestor",ATTR_VALUE,ramaddaThisEntry],!1)+HU.tag(TAG_LABEL,[ATTR_CLASS,CLASS_CLICKABLE,ATTR_FOR,"popup_search_here"],HU.div([ATTR_STYLE,HU.css(CSS_MARGIN_LEFT,HU.px(5))],HU.getIconImage("fas fa-folder-tree"))))),n+=HU.leftCenterRight(i,"",r),n+="</form>";let s=HU.getUniqueId(),l=HU.link(RamaddaUtil.getUrl("/search/form"),HU.span([ATTR_CLASS,CLASS_CLICKABLE],HU.span([],"Search Form")),[ATTR_TITLE,"Go to search form",ATTR_STYLE,HU.css()]),o=HU.link(RamaddaUtil.getUrl("/search/type"),HU.span([ATTR_TITLE,"Go to type search form",ATTR_CLASS,CLASS_CLICKABLE],"By Type")),d=HU.div([ATTR_ID,s,ATTR_STYLE,HU.css(CSS_TEXT_ALIGN,ALIGN_RIGHT,CSS_FONT_SIZE,HU.px(12))],l+HU.space(1)+"|"+HU.space(1)+o),c=HU.getUniqueId("searchresults"),u=HU.div([ATTR_ID,c,ATTR_CLASS,"ramadda-search-popup-results"]),T=HU.div([ATTR_CLASS,"ramadda-search-popup"],n+u),h=(jqid(t),this.dialog=HU.makeDialog({content:T,my:"right top",at:"right bottom",title:d,anchor:e,draggable:!0,header:!0,inPlace:!1}));jqid(s).find(HU.dotClass(CLASS_LINK)).click(Utils.searchLink);let f=jqid("popup_search_input");f.mousedown((function(t){t.stopPropagation()})),f.keydown((function(t){"Escape"==t.key&&h.remove()})),Utils.searchSuggestInit("popup_search_input","popup_search_here",null,!0,c),f.focus()},handleKeyPress:function(t){HU.getTooltip().hide()},handleMouseDown:function(t){return(HU.hasPopupObject()||Utils.tooltipObject)&&setTimeout((()=>{if(Utils.tooltipObject&&(Utils.tooltipObject.hide(),Utils.tooltipObject=null),HU.hasPopupObject()){let t=HU.getPopupObject().attr(ATTR_ID);HU.checkToHidePopup()&&t==HU.getPopupObject().attr(ATTR_ID)&&HU.hidePopupObject()}}),250),Utils.mouseIsDown=!0,Utils.mouseMoveCnt=0,!0},handleMouseUp:function(t){t=GuiUtils.getEvent(t),Utils.mouseIsDown=!1,GuiUtils.setCursor("default");let e=jqid("ramadda-floatdiv");if(e.length){let t=Utils.entryDragInfo?GuiUtils.getDomObject(Utils.entryDragInfo.dragSource):null;if(t){let a=GuiUtils.getLeft(t.obj),n=GuiUtils.getTop(t.obj),i=parseInt(e.css(CSS_LEFT)),r=parseInt(e.css(CSS_TOP)),s=10,l=(a-i)/s,o=(n-r)/s;Utils.flyBackAndHide("ramadda-floatdiv",0,s,i,r,l,o)}else e.hide();Utils.entryDragInfo=null}return!0},flyBackAndHide:function(t,e,a,n,i,r,s){var l=GuiUtils.getDomObject(t);if(l){e+=1,l.style.left=HU.px(n+r*e),l.style.top=HU.px(i+s*e);if(e<a){setTimeout((()=>{Utils.flyBackAndHide(t,e,a,n,i,r,s)}),30)}else setTimeout((()=>{Utils.finalHide(t)}),150)}},handleMouseMove:function(t){if(t=GuiUtils.getEvent(t),Utils.entryDragInfo&&Utils.mouseIsDown){Utils.mouseMoveCnt++;var e=jqid("ramadda-floatdiv");6==Utils.mouseMoveCnt&&GuiUtils.setCursor("move"),Utils.mouseMoveCnt>=6&&e.length&&Utils.moveFloatDiv(GuiUtils.getEventX(t),GuiUtils.getEventY(t))}return!0},finalHide:function(t){var e=GuiUtils.getDomObject(t);e&&(hideObject(e),e.style.filter="alpha(opacity=80)",e.style.opacity="0.8")},centerDiv:function(t){return this.div([ATTR_STYLE,HU.css(CSS_TEXT_ALIGN,ALIGN_CENTER)],this.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_TEXT_ALIGN,left)],t))},moveFloatDiv:function(t,e){let a=jqid("ramadda-floatdiv");if(a.length){if(!(a.css(CSS_DISPLAY)!=DISPLAY_NONE)){a.show();let t="";Utils.entryDragInfo&&(t=Utils.entryDragInfo.getHtml()),a.html(t+HU.div([],"Drag to a group to copy/move/associate"))}a.css(CSS_TOP,e).css(CSS_LEFT,t+10)}},framesClick:function(t,e,a,n){let i=a.attr(ATTR_DATA_URL),r=a.attr("data-label");jqid(t).find(".ramadda-frames-entry").removeClass("ramadda-frames-entry-active"),a.addClass("ramadda-frames-entry-active");let s=HU.href(i,HU.getIconImage("fa-solid fa-link")+" "+r,[ATTR_TARGET,"_link",ATTR_CLASS,CLASS_CLICKABLE]);jqid(e+"_header_link").html(s),n&&"default"!=n&&(i=i+"&template="+n),jqid(e).attr(ATTR_SRC,i)},framesInit:function(t,e,a){let n=jqid(t);n.find(".ramadda-frames-entry").click((function(){Utils.framesClick(t,e,$(this),a)}));let i=jqid(e+"_leftheader");i.append(HU.div([ATTR_CLASS,"ramadda-frames-nav"],HU.span([ATTR_TITLE,"View previous",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-frames-nav-link ramadda-frames-nav-link-prev"),"data-nav","prev"],HU.getIconImage("fas fa-caret-left",null,[ATTR_STYLE,HU.css(CSS_FONT_SIZE,HU.perc(130))]))+HU.space(1)+HU.span([ATTR_TITLE,"View next",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-frames-nav-link ramadda-frames-nav-link-next"),"data-nav","next"],HU.getIconImage("fas fa-caret-right",null,[ATTR_STYLE,HU.css(CSS_FONT_SIZE,HU.perc(130))]))));i.find(".ramadda-frames-nav-link").click((function(){(i=>{let r,s=i.attr("data-nav"),l=n.find(".ramadda-frames-entry-active");r="next"==s?l.nextAll(".ramadda-frames-entry"):l.prevAll(".ramadda-frames-entry"),r.length>0&&Utils.framesClick(t,e,r.first(),a)})($(this))}))},copyText:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},foregroundColors:{purple:"white"},getContrastYIQ:function(t){return t=t.replace("#",""),(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"black":"white"},getForegroundColor:function(t){return t?(t.match("rgb")&&(t=Utils.rgbToHex(t)),t?!this.foregroundColors[t]&&t.startsWith("#")?this.getContrastYIQ(t):this.foregroundColors[t]||COLOR_BLACK:COLOR_BLACK):null},darkerColor:function(t,e){return t?this.pSBC(e||-.5,t):t},brighterColor:function(t,e){return t?this.pSBC(e||.5,t):t},pSBC:function(t,e,a,n){e=this.colorToRgb[e]||e,a=this.colorToRgb[a]||a;let i,r,s,l,o,d,c,u=parseInt,T=Math.round,h="string"==typeof a;return"number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||a&&!h?null:(this.pSBCr||(this.pSBCr=t=>{let e=t.length,a={};if(e>9){if([i,r,s,h]=t=t.split(","),e=t.length,e<3||e>4)return null;a.r=u("a"==i[3]?i.slice(5):i.slice(4)),a.g=u(r),a.b=u(s),a.a=h?parseFloat(h):-1}else{if(8==e||6==e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=u(t.slice(1),16),9==e||5==e?(a.r=t>>24&255,a.g=t>>16&255,a.b=t>>8&255,a.a=T((255&t)/.255)/1e3):(a.r=t>>16,a.g=t>>8&255,a.b=255&t,a.a=-1)}return a}),c=e.length>9,c=h?a.length>9||"c"==a&&!c:c,o=this.pSBCr(e),l=t<0,d=a&&"c"!=a?this.pSBCr(a):l?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},l=1-(t=l?-1*t:t),o&&d?(n?(i=T(l*o.r+t*d.r),r=T(l*o.g+t*d.g),s=T(l*o.b+t*d.b)):(i=T((l*o.r**2+t*d.r**2)**.5),r=T((l*o.g**2+t*d.g**2)**.5),s=T((l*o.b**2+t*d.b**2)**.5)),h=o.a,d=d.a,o=h>=0||d>=0,h=o?h<0?d:d<0?h:h*l+d*t:0,c?"rgb"+(o?"a(":"(")+i+","+r+","+s+(o?","+T(1e3*h)/1e3:"")+")":"#"+(4294967296+16777216*i+65536*r+256*s+(o?T(255*h):0)).toString(16).slice(1,o?void 0:-2)):null)},colorToRgb:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},addAlphaToColor:function(t,e){if(t=this.colorToRgb[t]||t,Utils.isDefined(e)||(e="0.5"),0==t.indexOf("#")){let a=Utils.hexToRgb(t);return a&&(t="rgba("+a.r+","+a.g+","+a.b+","+e+")"),t}return t.replace(/rgba? *\(([^,]+),([^,]+),([^,\)]+).*/,"rgba($1,$2,$3,"+e+")")},enumTypeCount:-1,enumColorPalette:["#9CA3AF","#BDB7D0","#D8A29D","#BCCAB3","#D9C7A8","#C4A69A","#E7C4B0","#9CAAC0","#A8A895","#D4A5A4"],enumColors:{},getEnumColor:function(t){return t.color?t.color:(this.enumColors[t]||(this.enumTypeCount++,this.enumTypeCount>=this.enumColorPalette.length&&(this.enumTypeCount=0),this.enumColors[t]=this.enumColorPalette[this.enumTypeCount]),this.enumColors[t])},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},componentToHex:function(t){"string"==typeof t&&(t=+t);var e=t.toString(16);return 1==e.length?"0"+e:e},rgbToHex:function(t,e,a){if(null==e){let n=/.*\(([^,]+),([^,]+),(.*)\).*/i.exec(t);if(!n)return null;t=n[1].trim(),e=n[2].trim(),a=n[3].trim()}return t&&e&&a?"#"+Utils.componentToHex(t)+Utils.componentToHex(e)+Utils.componentToHex(a):null},hexStringToInt:function(t){return hex=parseInt(t.replace(/^#/,""),16)}},GuiUtils={getProxyUrl:function(t){return HU.url(RamaddaUtil.getUrl("/proxy"),"trim",!0,"url",t)},showingError:!1,pageUnloading:!1,handleError:function(t,e,a){this.pageUnloading||(console.log(t),console.trace(),e&&console.log(e),this.showingError||(a&&(this.showingError=!0,this.showingError=!1),Utils.closeFormLoadingDialog()))},isJsonError:function(t){if(null==t)return this.handleError("Null JSON data",null,!1),!0;if(null!=t.error){var e=t.errorcode;return null==e&&(e="error"),this.handleError("Error in Utils.isJsonError:"+t.error,null,!1),!0}return!1},loadXML:function(t,e,a){var n=!1;if(window.XMLHttpRequest)try{n=new XMLHttpRequest}catch(t){n=!1}else if(window.ActiveXObject)try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){n=!1}}n&&(n.onreadystatechange=function(){4==n.readyState&&200==n.status&&e(n,a)},n.open("GET",t,!0),n.send(""))},loadHtml:async function(t,e){await $.get(t,(function(t){e(t)})).done((function(){})).fail((function(){console.log("Failed to load url: "+t)}))},loadUrl:function(t,e,a){var n=!1;if(window.XMLHttpRequest)try{n=new XMLHttpRequest}catch(t){n=!1}else if(window.ActiveXObject)try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){n=!1}}n&&(n.onreadystatechange=function(){4==n.readyState&&200==n.status&&e(n,a)},n.open("GET",t,!0),n.send(""))},getUrlArg:function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let a=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);if(null==a||""==a)return e;let n=a[1];return n=decodeURIComponent(n),n},setCursor:function(t){var e=document.cursor;!e&&document.getElementById&&(e=document.getElementById(CSS_CURSOR)),e||(document.body.style.cursor=t)},getDomObject:function(t){let e=new DomObject(t);return e.obj?e:null},getEvent:function(t){return t||window.event},getEventX:function(t){return t.pageX?t.pageX:t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft},getEventY:function(t){return t.pageY?t.pageY:t.clientY+document.body.scrollTop+document.documentElement.scrollTop},getTop:function(t){return t?t.offsetTop+this.getTop(t.offsetParent):0},getBottom:function(t){return t?this.getTop(t)+t.offsetHeight:0},setPosition:function(t,e,a){t.style.top=a,t.style.left=e},getLeft:function(t){return t?t.offsetLeft+this.getLeft(t.offsetParent):0},getRight:function(t){return t?t.offsetRight+this.getRight(t.offsetParent):0},getStyle:function(t){return t.style?t.style:document.layers?document.layers[t.name]:null},size_format:function(t){return t=t>=1073741824?number_format(t/1073741824,2)+" GB":t>=1048576?number_format(t/1048576,2)+" MB":t>=1024?number_format(t/1024,0)+" KB":number_format(t,0)+" bytes"},inputLengthOk:function(t,e,a){var n=jqid(t).val();if(null==n)return!0;if(a){if(n.length<e)return Utils.closeFormLoadingDialog(),!1}else if(n.length>e)return Utils.closeFormLoadingDialog(),!1;return!0},inputValueOk:function(t,e,a){var n=jqid(t).val();return null==n||(a&&n<e?(Utils.closeFormLoadingDialog(),!1):!(!a&&n>e)||(Utils.closeFormLoadingDialog(),!1))},inputIsRequired:function(t,e,a){var n=jqid(t).val();return null!=n&&0!=n.trim().length||(Utils.closeFormLoadingDialog(),!1)}},HU=HtmlUtils=window.HtmlUtils=window.HtmlUtil={me:"HtmlUtils",loaded:{},checkInputChange:function(t){let e=!1;$(window).bind("beforeunload",(t=>{e&&(t.preventDefault(),t.returnValue="Changes have been made. Are you sure you want to exit?")}));let a=t?jqid(t):$(TAG_BODY);a.find("input[type='submit']").on("click",(function(){e=!1})),a.on("change","input, select, textarea",(function(){e=!0}))},onReturn:function(t,e){t.keydown((function(t){"Enter"!==t.key&&13!==t.keyCode||e($(this))}))},initTabs:function(t,e){let a=jqid(t).tabs({activate:HU.tabLoaded});if(!e)return;let n=[],i=[];for(let e=1;;e++){let r=t+"-"+e,s='[aria-controls="'+r+'"]',l=a.find(s);if(0==l.length)break;i.push(l);let o=jqid(r);if(0==o.length)break;let d=o.html();d&&0!=d.trim().length||n.push(l)}1!=i.length&&i.length!=n.length&&n.forEach((t=>{t.hide()}))},initTypeMenu:function(t,e){HU.makeSelectTagPopup("#"+t,{after:!0}),jqid(t).change((function(){let t=$(this).val();if(!Utils.stringDefined(t))return;$(this).val("");let a=jqid(e).val()??"";a=a.trim(),""!=a&&(a+="\n"),a+=t+":",jqid(e).val(a)}))},getTitleBr:function(){return"&#10;"},hide:function(t){jqid(t).hide()},writeHtmlHere:function(t){document.currentScript.insertAdjacentHTML("afterend",t)},toggleAllInit:function(){let t=Utils.getUniqueId("toggleall");HU.writeHtmlHere(HU.div([ATTR_ID,t],"Toggle Details"));let e=!1;jqid(t).button().click((function(){e=!e,$(".entry-toggleblock-label,.toggleblocklabel").each((function(){let t=$(this).attr("block-id"),a=$(this).attr("block-image-id"),n="fa-regular fa-square-minus",i="fa-regular fa-square-plus";$(this).hasClass("entry-toggleblock-label")&&(i="fas fa-caret-right",n="fas fa-caret-down"),HU.toggleBlockVisibility(t,a,n,i,null,e)}))}))},initTooltip:function(t){$(t).tooltip({delay:{show:0,hide:5e3},open:function(t,e){let a=$(this).attr("tooltip-width");a&&e.tooltip.css(ATTR_WIDTH,a).css(CSS_MAX_WIDTH,a)},show:{delay:1e3},position:{xmy:"center bottom",xat:"center top",collision:"none"},hide:!1,content:function(){let t=$(this).attr(ATTR_TITLE);return t=Utils.convertText(t??""),HU.div([ATTR_CLASS,"ramadda-tooltip",ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(5))],t)}})},initPageSearch:function(t,e,a,n,i){let r={focus:!1,inputSize:"15",target:null,hideAll:n,linkSelector:null,widgets:[]};i&&($.extend(r,i),i.buttons&&(r.widgets=i.buttons));let s=HU.getUniqueId("search_"),l=HU.getUrlArgument(ARG_PAGESEARCH)??"",o=HU.input("",l,[ATTR_CLASS,"ramadda-pagesearch-input",ATTR_ID,s,ATTR_PLACEHOLDER,a??"Search",ATTR_SIZE,r.inputSize]),d="ramadda-button-active",c={};r.widgets.forEach((t=>{if(t.id=HU.getUniqueId("button"),c[t.id]=t,t.clear)o+=HU.span([ATTR_ID,t.id,"clear",!0],t.label);else{if(!t.value)return o+=SPACE1,void(o+=HU.b(t.label));o+=SPACE1,o+=HU.span([ATTR_ID,t.id],t.label)}})),r.linkSelector&&(r.linksDivId=HU.getUniqueId("links"),o+=HU.div([ATTR_ID,r.linksDivId])),r.target?(0==$(r.target).length&&console.log("initPageSearch: no target div found:"+r.target),$(r.target).html(o)):HU.writeHtmlHere(o);let u=()=>{let a=[];a.push(jqid(s).val()),r.widgets.forEach((t=>{t.element&&t.element.hasClass(d)&&(t.clear||a.push(t.value))})),HU.doPageSearch(a,t,e,r.hideAll,i)};r.widgets.forEach((a=>{a.element=jqid(a.id).button(),a.element.click((function(){let a=$(this).attr(ATTR_ID),n=c[a];if(n){if($(this).hasClass(d)?$(this).removeClass(d):($(this).addClass(d),n.group&&r.widgets.forEach((t=>{t.id!=a&&t.group==n.group&&t.element&&t.element.removeClass(d)}))),n.clear)return r.widgets.forEach((t=>{t.element&&t.element.removeClass(d)})),void HU.doPageSearch("",t,e,r.hideAll,i);u()}}))})),r.focus&&jqid(s).focus(),jqid(s).keydown((function(t){"Enter"===t.key&&t.preventDefault()})),jqid(s).keyup((function(){if("Enter"===event.key)return void event.preventDefault();u();let t=$(this).val();Utils.stringDefined(t)?HU.addToDocumentUrl(ARG_PAGESEARCH,t):HU.removeFromDocumentUrl(ARG_PAGESEARCH)})),Utils.stringDefined(l)&&HU.doPageSearch(l,t,e,r.hideAll,r)},classes:function(){return" "+Utils.join(Array.from(arguments)," ")+" "},doPageSearch:function(t,e,a,n,i){if((i=i??{}).handler)return void i.handler(t,i);let r,s=[];i.linksDivId&&(r=jqid(i.linksDivId),r.html(""));let l=t;Array.isArray(t)||(l=[t]);let o=$(e),d=!1;l=l.map((t=>{let e=null,a=null;if(Utils.stringDefined(t)){let n=(t=t.toLowerCase()).indexOf(":");n>=0&&(e=t.substring(0,n+1),a=t.substring(n+1))}return Utils.stringDefined(t)&&(d=!0),{value:t,pre:e,post:a}})),n&&(d?$(n).hide():$(n).show());o.each((function(){let e=!0;if(l.every((a=>{let n=((e,a)=>{if(t=e.value,!Utils.stringDefined(t))return!0;let n=!1,i=a.html(),r=a.attr("data-category");r&&(i+=" "+r);let s=a.attr(ATTR_DATA_CORPUS);s&&(i+=" "+s);let l=i.match(/title *= *(\"|')([^(\"|')]+)/);if(l&&(i=i+" "+l[2]),i=Utils.stripTags(i),i=i.toLowerCase(),e.pre&&e.post){let t=i.indexOf(e.pre);if(t>=0){let a=i.substring(t+e.pre.length),r=a.indexOf(":");r>=0&&(a=a.substring(0,r).trim(),a.startsWith(e.post)&&(n=!0))}}return i.indexOf(t)>=0&&(n=!0),n})(a,$(this));return!!n||(e=!1,!1)})),e){if($(this).attr("isvisible","true"),$(this).show(),r&&i.linkSelector){let t=$(this).find(i.linkSelector);if(t.length){let e=t.attr(ATTR_NAME);e&&s.push(e)}}}else $(this).attr("isvisible","false"),$(this).fadeOut()})),a&&$(a).each((function(){let t=!1;$(this).find(e).each((function(){"true"===$(this).attr("isvisible")&&(t=!0)})),t?$(this).show():$(this).fadeOut()})),s.length>0&&s.length<15&&s.forEach((t=>{let e=HU.href("#"+t,t);r.append(e+" ")})),i.callback&&i.callback()},initScreenshot:function(t){t.width/=2,$(t).css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK).css(CSS_MAX_WIDTH,HU.vw(90))},insertIntoTextarea:function(t,e,a){"string"==typeof t&&(t=document.getElementById(t)),e=Utils.decodeText(e),a&&(e="\n"+e);let n=t.scrollTop;if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e;else if(t.selectionStart||"0"==t.selectionStart){var i=t.selectionStart,r=t.selectionEnd;t.value=t.value.substring(0,i)+e+t.value.substring(r,t.value.length);let a=i+e.length;t.selectionEnd=a}else t.value+=e;a&&t.value&&(t.value=t.value.trim()),t.scrollTop=n},initLoadingImage:function(t){setTimeout((()=>{$(t).removeClass("ramadda-image-loading")}),2e3)},initRadioToggle(t,e){$(t).find("input[type=radio]").change((function(){for(a in e)a==$(this).attr(ATTR_VALUE)?$(e[a]).show():$(e[a]).hide()}))},initToggleAll:function(t,e,a){jqid(t).change((function(){let t=HU.isChecked($(this));$(e).each((function(){a&&$(this).is(":hidden")||($(this).prop("checked",t),$(this).trigger("change"))}))}))},getEmojis:function(t){this.emojis?t(this.emojis):$.getJSON(RamaddaUtil.getUrl("/emojis/emojis.json"),(e=>{let a,n=[],i={};this.emojis=[],e.forEach((t=>{let e=t.category??a;e&&(a=e);let r=i[e];r||(r={name:e,images:[]},i[e]=r,n.push(r));let s=t.image;s.startsWith("/")||(s="/emojis/"+s),r.images.push({name:t.name,image:RamaddaUtil.getUrl(s)})})),this.emojis=n,t(this.emojis)})).fail((t=>{console.log("Failed to load json:")}))},loadJqueryLib:function(t,e,a,n,i){let r=!1;HU.loaded[t]||(e.forEach((t=>{$("<link rel='stylesheet' href='"+t+"' crossorigin='anonymous'>").appendTo(TAG_HEAD)})),a.forEach((t=>{$("<script src='"+t+"'  type=text/JavaScript><\/script>").appendTo(TAG_HEAD)})),HU.loaded[t]=!0),$(n)[t]?i():setTimeout((()=>{HU.loadJqueryLib(t,e,a,n,i)}),50)},createFancyBox:function(t,e){e=e??{};let a=$(t);a.length>0&&Utils.isDefined(a.attr("data-order"))&&(a=a.sort(((t,e)=>$(t).data("order")-$(e).data("order")))),HU.loadJqueryLib("fancybox",[RamaddaUtil.getCdnUrl("/lib/fancybox-3/jquery.fancybox.min.css")],[RamaddaUtil.getCdnUrl("/lib/fancybox-3/jquery.fancybox.min.js")],t,(()=>{$(a).fancybox(e)}))},checkToHidePopup:function(){if(this.popupTime){var t=new Date;return timeDiff=t-this.popupTime,timeDiff>1e3}return!0},jqname:function(t){return this.jqattr(ATTR_NAME,t)},jqattr:function(t,e){return $("["+t+'="'+e+'"]')},findClass:function(t,e){return t?t.find(HU.dotClass(e)):$(HU.dotClass(e))},jqid:function(t){return $("#"+t)},initInteractiveInput:function(t,e){HU.jqid(t).keyup((function(t){HU.hidePopupObject();let a=$(this).val();if(!Utils.stringDefined(a))return;let n=$(this);$.getJSON(e+"?text="+a,(t=>{if(0==t.length)return;let e="";t.forEach((t=>{e+=HU.div([ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-suggest"),"suggest",t],t)}));let a=HU.div([ATTR_CLASS,"ramadda-search-popup",ATTR_STYLE,HU.css(CSS_MAX_WIDTH,HU.px(200),CSS_PADDING,HU.px(4))],e);HU.makeDialog({content:a,my:"left top",at:"left bottom",anchor:n}).find(".ramadda-suggest").click((function(){HU.hidePopupObject(),n.val($(this).attr("suggest"))}))})).fail((t=>{console.log("suggest call failed:"+e+"\n"+t),console.dir(t)}))}))},getTooltip:function(){return jqid("ramadda-popupdiv")},getPopupObject:function(){return this.popupObject},hasPopupObject:function(){return null!=this.popupObject},clearPopupObject:function(){this.popupObject=null},isPopupObject:function(t){return!(!this.popupObject||!t)&&this.popupObject.attr(ATTR_ID)==t.attr(ATTR_ID)},setPopupObject:function(t){return this.isPopupObject(t)||(this.popupObject&&this.hidePopupObject(null,!0),this.popupObject=t,this.popupObject.attr("addedMouseListener")||(this.popupObject.attr("addedMouseListener","true"),this.popupObject.mousedown((function(t){t.stopPropagation()}))),this.popupObjectTime=new Date),t},hidePopupObject:function(t,e){if(!e&&this.popupObjectTime){if((new Date).getTime()-this.popupObjectTime.getTime()<500)return}this.popupObjectTime=null,this.popupObject&&(this.popupObject.hide(),"true"==this.popupObject.attr("removeonclose")&&this.popupObject.remove(),this.popupObject=null),this.popupTime=new Date,t&&t.stopPropagation()},lastCbxClicked:null,lastCbxIdClicked:null,checkboxClicked:function(t,e,a){if(!t)return;let n=GuiUtils.getDomObject(a);if(!n)return;n=n.obj;let r=new Array;if(!n.form)return;let s=n.form.elements;for(i=0;i<s.length;i++)(s[i].name.indexOf(e)>=0||s[i].id.indexOf(e)>=0)&&r.push(s[i]);let l=n.checked;if(t.ctrlKey)for(i=0;i<r.length;i++)r[i].checked=l;if(t.shiftKey){if(HU.lastCbxClicked){let t=GuiUtils.getTop(n),e=GuiUtils.getTop(HU.lastCbxClicked),s=jqid(HU.lastCbxIdClicked),o=jqid(a);if(s.position()&&(e=s.offset().top),o.position()&&(t=o.offset().top),t>e){let a=t;t=e,e=a}for(i=0;i<r.length;i++){let a=jqid(r[i].id).offset().top;a>=t&&a<=e&&(r[i].checked=l)}}}else HU.lastCbxClicked=n,HU.lastCbxIdClicked=a},tabLoaded:function(t,e){window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout(),window.ramaddaMapCheckLayout&&ramaddaMapCheckLayout()},elementScrolled:function(t){var e=$(window).scrollTop(),a=e+$(window).height(),n=$(t).offset().top,i=n+$(t).outerHeight(!0);return n<=a&&n>=e||(i<=a&&i>=e||i>=a&&n<=e)},initOdometer:function(t,e,a,n){Utils.isDefined(a)||(a=0),$(document).ready((function(){n?jqid(t).html(e):setTimeout((function(){HU.elementScrolled("#"+t)?setTimeout((function(){jqid(t).html(e)}),a):$(window).scroll((function(){HU.elementScrolled("#"+t)&&setTimeout((function(){jqid(t).html(e)}),a)}))}),1e3)}))},callWhenScrolled:function(t,e,a){Utils.isDefined(a)||(a=0),$(document).ready((function(){setTimeout((function(){HU.elementScrolled("#"+t)?setTimeout(e,a):$(window).scroll((function(){HU.elementScrolled("#"+t)&&setTimeout(e,a)}))}),1e3)}))},waitForIt:function(t,e,a,n){window[t]?e():(Utils.isDefined(n)||(n=500),0!==n?setTimeout((()=>{HU.waitForIt(t,e,a,n-1)}),50):a&&a())},loadAndWait:function(t,e,a,n){if(!window[t]){$(e).appendTo(TAG_HEAD)}HU.waitForIt(t,a,n)},makeMessage:function(t,e){return"<div class='ramadda-message ramadda-message-plain ' id='messageblock'><table width='100%'><tbody><tr valign='top'><td width='5%'><div class='ramadda-message-icon'><span><i class='"+t+"' style='font-size:32pt;'></i></span></div></td><td><div class='ramadda-message-inner'><p>"+e+"</p></div></td></tr></tbody></table></div>"},makeErrorMessage:function(t){return HU.makeMessage("fas fa-exclamation-triangle text-danger",t)},makeInfoMessage:function(t){return HU.makeMessage("fas fa-info",t)},makeRunningMessage:function(t){return HU.makeMessage("fas fa-spinner fa-spin",t)},makeSlides:async function(t,e,a){Utils.isDefined(a)||(a=0),await HU.loadSlides();let n={arrows:!0,speed:0,dots:!0,slidesToShow:1,variableWidth:!0};e&&$.extend(n,e),jqid(t).slick(n),HU.swapHtml("#"+t+"_headercontents","#"+t+"_header"),setTimeout((()=>{let e=jqid(t+"_header"),a=e.find(".ramadda-slides-header-item");a.click((function(){let e=+$(this).attr("slideindex");jqid(t).slick("slickGoTo",e)})),jqid(t).on("afterChange",(function(t,n,i){a.removeClass("ramadda-slides-header-item-selected"),e.find(HU.attrSelect("slideindex",i)).addClass("ramadda-slides-header-item-selected")}))}))},loadSlides:async function(){return!!HU.slidesLoaded||($("<link>").appendTo(TAG_HEAD).attr({type:"text/css",rel:"stylesheet",href:RamaddaUtil.getCdnUrl("/lib/slick/slick.css")}),$("<link>").appendTo(TAG_HEAD).attr({type:"text/css",rel:"stylesheet",href:RamaddaUtil.getCdnUrl("/lib/slick/slick-theme.css")}),await Utils.importJS(RamaddaUtil.getCdnUrl("/lib/slick/slick.min.js")),HU.slidesLoaded=!0,!1)},loadKatex:function(t,e){if(!window.katex){let t="0.16.25";$(`<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@${t}/dist/fonts/KaTeX_Main-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@${t}/dist/fonts/KaTeX_Math-Italic.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@${t}/dist/fonts/KaTeX_Size2-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@${t}/dist/fonts/KaTeX_Size4-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'/>\n<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Lato:300,400,700,700i'>\n<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/katex@${t}/dist/katex.min.css' crossorigin='anonymous'>\n<script defer src='https://cdn.jsdelivr.net/npm/katex@${t}/dist/katex.min.js' crossorigin='anonymous'><\/script>`).appendTo(TAG_HEAD)}HU.waitForIt("katex",t,e)},applyMarkdown:function(t,e){let a=HU.tag(TAG_SCRIPT,[ATTR_SRC,RamaddaUtil.getCdnUrl("/lib/showdown.min.js")]);HU.loadAndWait("showdown",a,(()=>{let a=jqid(t).html();try{var n=new showdown.Converter;a=a.replace(/```{r([^}]*)}/g,((t,e)=>"```r\n##"+e));var i=n.makeHtml(a);jqid(e).html(i)}catch(t){jqid(e).html("Error processing markdown:"+t)}}),(()=>{jqid(e).html("Error loading showdown")}))},applyLatex:function(t,e){HU.loadKatex((()=>{let a=jqid(t).html();try{var n=katex.renderToString(a,{throwOnError:!0});jqid(e).html(n)}catch(t){jqid(e).html("Error processing markdown:"+t)}}),(()=>{jqid(e).html("Error loading katex")}))},isFontAwesome:function(t){return t.startsWith("fa-")||t.startsWith("fas ")||t.startsWith("far ")||t.startsWith("fab ")},thinLine:function(){return"<thin_hr></thin_hr>"},getIconImage:function(t,e,a){if(HU.isFontAwesome(t)){let n;return n=t.startsWith("fa-thin")||t.startsWith("fa-light")||t.startsWith("fa-regular")||t.startsWith("fa-solid")||t.startsWith("fas ")||t.startsWith("fab ")||t.startsWith("far")?[ATTR_CLASS,t]:[ATTR_CLASS,"fas "+t],a&&(n=Utils.mergeLists(n,a)),HU.span(e,HU.tag(TAG_I,n))}return HU.image(t,e)},getObjectURL:function(t){return(window.URL||window.webkitURL).createObjectURL(t)},getErrorDialog:function(t){return'<div class="ramadda-message"><table><tr valign=top><td><div class="ramadda-message-link"><img border="0"  src="/repository/icons/error.png"  /></div></td><td><div class="ramadda-message-inner">'+t+"</div></td></tr></table></div>"},makeBreadcrumbsInit:function(t){if(Utils.getPageLoaded())HU.makeBreadcrumbs(t);else{let e=t;Utils.addLoadFunction((()=>{HU.makeBreadcrumbs(e)}))}},makeBreadcrumbs:function(t){let e=jqid(t),a=4;e.find("li").length>5&&(a=0),e.jBreadCrumb({previewWidth:0,easing:"easeOutQuad",beginingElementsToLeaveOpen:0,endElementsToLeaveOpen:a})},tooltipInit:function(t,e){jqid(e).dialog({autoOpen:!1,minWidth:650,hide:{effect:"blind",duration:250}}),jqid(t).click((function(){jqid(e).dialog("open")}))},join:function(t,e){t.forEach||(t=[t]);let a="";return t.forEach(((t,n)=>{n>0&null!=e&&(a+=e),a+=t})),a},qt:function(t){return'"'+t+'"'},sqt:function(t){return"'"+t+"'"},getUniqueId:function(t){return window.uniqueCnt||(window.uniqueCnt=(new Date).getTime()),(t||"id_")+window.uniqueCnt++},inset:function(t,e,a,n,i){var r="";return e&&(r+=HU.css(CSS_PADDING_TOP,HU.px(e))),a&&(r+=HU.css(CSS_PADDING_LEFT,HU.px(a))),n&&(r+=HU.css(CSS_PADDING_BOTTOM,HU.px(n))),i&&(r+=HU.css(CSS_PADDING_RIGHT,HU.px(i))),HU.div([ATTR_STYLE,r],t)},makeTabs(t,e){let a={};e&&$.extend(a,e);let n=HU.getUniqueId("tabs_"),i=HU.open(TAG_DIV,[ATTR_ID,n]);return i+="\n",i+=HU.open(TAG_UL),t.forEach(((t,e)=>{i+=HU.tag(TAG_LI,[],HU.href("#"+n+"-"+(e+1),t.label??t.header)),i+="\n"})),i+=HU.close(TAG_UL),t.forEach(((t,e)=>{let r=t.contents;a.contentsStyle&&(r=HU.div([ATTR_STYLE,a.contentsStyle],r)),i+=HU.div([ATTR_ID,n+"-"+(e+1)],r),i+="\n"})),i+=HU.close(TAG_DIV),{contents:i,init:()=>{jqid(n).tabs()}}},makeAccordionHtml(t){let e=HU.getUniqueId("accordion_"),a=HU.open(TAG_DIV,[ATTR_CLASS,"ui-accordion ui-widget ui-helper-reset",ATTR_ID,e]);return t.forEach((t=>{a+=HU.tag(TAG_H3,[ATTR_CLASS,"ui-accordion-header ui-helper-reset ui-corner-top",ATTR_STYLE,HU.css(CSS_BORDER,HU.px(0),CSS_BACKGROUND,"none")+(t.style??"")],HU.href("#",HU.span([ATTR_CLASS,CLASS_CLICKABLE],t.header??t.label))),a+=HU.div([ATTR_ID,HU.getUniqueId("accordion_"),ATTR_CLASS,"ramadda-accordion-contents"],t.contents)})),a+=HU.close(TAG_DIV),{id:e,contents:a,init:t=>{HU.makeAccordion("#"+e,t)}}},makeAccordion:function(t,e){null==e&&(e={heightStyle:"content",collapsible:!0,active:0,decorate:!1,animate:200});var a={header:"iconClosed",activeHeader:"iconOpen"};$((function(){$(t+" .ramadda-accordion-contents").css(CSS_DISPLAY,DISPLAY_BLOCK);var n={animate:200,icons:a,collapsible:!0,heightStyle:"content",active:0,decorate:!0,activate:function(){window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout()}};($.extend(n,e),n.decorate)||$(t+" .ui-accordion-header").css(CSS_PADDING,"0em 0em 0em 0em");n.active<0&&(n.active="none");let i=$(t).accordion(n),r=function(t,e){e.stopPropagation();let a=t.closest(".ui-accordion-header"),n=a.find(":checkbox");HU.isChecked(n)?a.css(CSS_BACKGROUND,"#fffeec"):a.css(CSS_BACKGROUND,COLOR_TRANSPARENT)},s=function(t){r($(this),t)};i.find(".accordion-toolbar").find(":checkbox").click(s),i.find(".accordion-toolbar").find("label").click(s),i.find(".accordion-toolbar").find(":checkbox").change((function(t){r($(this),t)}))}))},buttons:function(t,e,a){let n=Utils.wrap(t,HU.open(TAG_DIV,[ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_MARGIN_RIGHT,HU.px(6))]),HU.close(TAG_DIV));return HU.div([ATTR_CLASS,e??CLASS_BUTTON_BAR,ATTR_STYLE,a??""],n)},vspace:function(t){return this.div([ATTR_STYLE,this.css(CSS_MARGIN_TOP,t??HU.em(.5))])},hbox:function(t,e){let a=HU.openTag(TAG_TR,[ATTR_VALIGN,ALIGN_TOP]);return a+=Utils.wrap(t,HU.open(TAG_TD,[ATTR_ALIGN,ALIGN_LEFT])+HU.open(TAG_DIV,[ATTR_STYLE,e??""]),HU.close(TAG_DIV,TAG_TD)),a+=HU.close(TAG_TR),HU.tag(TAG_TABLE,[ATTR_BORDER,0,ATTR_CELLSPACING,0,ATTR_CELLPADDING,0],a)},vbox:function(t){let e=HU.join(t,HU.br());return this.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK)],e)},leftRight:function(t,e,a,n){return null==a&&(a="6"),null==n&&(n="6"),this.div([ATTR_CLASS,"row"],this.div([ATTR_CLASS,"col-md-"+a],t)+this.div([ATTR_CLASS,"col-md-"+n,ATTR_STYLE,HU.css(CSS_TEXT_ALIGN,ALIGN_RIGHT)],e))},leftCenterRight:function(t,e,a,n,i,r,s,l){return s||(s={}),s.valign||(s.valign=ALIGN_TOP),l||(l=""),this.tag(TAG_TABLE,[ATTR_BORDER,0,ATTR_WIDTH,HU.perc(100),ATTR_CELLSPACING,0,ATTR_CELLPADDING,0],this.tr([ATTR_VALIGN,s.valign],this.td([ATTR_ALIGN,ALIGN_LEFT,ATTR_WIDTH,n,ATTR_STYLE,l],t)+this.td([ATTR_ALIGN,ALIGN_CENTER,ATTR_WIDTH,i,ATTR_STYLE,l],e)+this.td([ATTR_ALIGN,ALIGN_RIGHT,ATTR_WIDTH,r,ATTR_STYLE,l],a)))},row:function(){let t=HU.open(TAG_TABLE,[ATTR_CELLPADDING,0,ATTR_CELLSPACING,0,ATTR_BORDER,0,ATTR_WIDTH,HU.perc(100)])+HU.open(TAG_TR,[ATTR_VALIGN,ALIGN_CENTER]);return Array.from(arguments).forEach((e=>{Array.isArray(e)?t+=HU.tag(TAG_TD,e[0],e[1]):t+=HU.tag(TAG_TD,[],e)})),t+=HU.close(TAG_TR,TAG_TABLE),t},hrow:function(){let t="";return Array.from(arguments).forEach((e=>{t+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK)],e)})),t},leftRightTable:function(t,e,a,n,i){i||(i={}),i.valign||(i.valign=ALIGN_TOP);var r=[ATTR_ALIGN,ALIGN_LEFT],s=[ATTR_ALIGN,ALIGN_RIGHT];return a&&(r.push(ATTR_WIDTH),r.push(a)),n&&(s.push(ATTR_WIDTH),s.push(n)),this.tag(TAG_TABLE,[ATTR_BORDER,0,ATTR_WIDTH,HU.perc(100),ATTR_CELLSPACING,0,ATTR_CELLPADDING,0],this.tr([ATTR_VALIGN,i.valign],this.td(r,t)+this.td(s,e)))},heading:function(t){return this.tag(TAG_H3,[],t)},bootstrapClasses:["col-md-12","col-md-6","col-md-4","col-md-4","col-md-4","col-md-2"],getBootstrapClass:function(t){return t-=1,(t=Math.max(t,0))<this.bootstrapClasses.length?this.bootstrapClasses[t]:"col-md-1"},toggleDialogs:{},makeOkCancelDialog:function(t,e,a,n,i,r){r=r??{};let s=[HU.div([ATTR_ACTION,ACTION_OK,ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_CLICKABLE)],r.okLabel??LABEL_OK),HU.div([ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_CLICKABLE)],r.cancelLabel??LABEL_CANCEL)];i&&s.push(i);let l=HU.buttons(s),o=e+HU.vspace()+l;o=HU.div([ATTR_STYLE,r.style??HU.css(CSS_PADDING,HU.px(5))],o);let d=HU.makeDialog({content:o,header:!1,anchor:t,my:r.my??"left top",at:r.at??"left bottom",title:r.title,header:r.header,draggable:r.draggable});d.find("."+CLASS_CLICKABLE).button().click((function(){$(this).attr(ATTR_ACTION)==ACTION_OK?a():n&&n(),d.remove()}))},initSideToggle:function(t,e,a){a=a??{},t=jqid(t),e=jqid(e);let n=a.width??a.boxWidth??HU.px(200);a.buttonWidth&&t.css(ATTR_WIDTH,a.buttonWidth),a.fontSize&&t.css(CSS_FONT_SIZE,a.fontSize),(a.buttonColor||a.color)&&t.css(CSS_COLOR,a.buttonColor??a.color),(a.buttonBackground||a.background)&&t.css(CSS_BACKGROUND,a.buttonBackground??a.background),(a.boxBackground||a.background)&&e.css(CSS_BACKGROUND,a.boxBackground??a.background),a.boxHeight&&e.css(CSS_HEIGHT,a.boxHeight),(a.buttonTop??a.top)&&t.css(CSS_TOP,a.buttonTop??a.top),a.boxHeight&&e.css(CSS_HEIGHT,a.boxHeight),(a.boxTop??a.top)&&e.css(CSS_TOP,a.boxTop??a.top),e.css(ATTR_WIDTH,n),e.css(CSS_LEFT,"-"+n);let i=(t,e)=>{t.animate({left:e},Utils.isDefined(a.speed)?parseInt(a.speed):500)};t.click((function(){let a="toggle-open";"true"===t.attr(a)?(t.attr(a,"false"),i(t,HU.px(0)),i(e,"-"+n)):(t.attr(a,"true"),i(t,n),i(e,HU.px(0)))}))},makeDialog:function(args){let opts={hidePopup:!0,modal:!1,modalStrict:!1,modalContentsCss:"",sticky:!1,content:null,contentId:null,anchor:null,draggable:!1,resizable:!1,decorate:!0,header:!1,showCloseIcon:!0,headerRight:null,remove:!0,my:"left top",at:"left bottom",animate:!1,animateSpeed:300,title:"",rightSideTitle:"",inPlace:!0,fit:!0},parentId,html;if(args&&(""==args.at&&delete args.at,""==args.my&&delete args.my,$.extend(opts,args)),opts.hidePopup&&HU.hidePopupObject(null,!0),opts.toggleid&&this.toggleDialogs[opts.toggleid]){let t=this.toggleDialogs[opts.toggleid];if(HU.isVisible(t))return t.hide(),void(this.toggleDialogs[opts.toggleid]=null)}opts.anchor&&"string"==typeof opts.anchor&&(opts.anchor=jqid(opts.anchor)),opts.anchor&&0==opts.anchor.length&&(console.log("Utils.makeDialog: Invalid anchor"),console.trace(),opts.anchor=null),opts.content&&(opts.inPlace=!1),opts.inPlace?(opts.remove=!1,parentId=HU.getUniqueId(),html=HU.div([ATTR_ID,parentId,ATTR_STYLE,HU.css()],HU.SPACE)):(html=opts.content,null==html&&(html=opts.contentId?jqid(opts.contentId).html():"No html provided"));let id=HU.getUniqueId();if(opts.header&&(html=HU.div([ATTR_CLASS,"ramadda-popup-inner"],html)),opts.header){let t=HU.div([ATTR_TITLE,"Close",ATTR_CLASS,"ramadda-popup-close"],HU.jsLink("",HU.getIconImage(ICON_CLOSE),[ATTR_ID,id+"_close",ATTR_STYLE,HU.css(CSS_CURSOR,CURSOR_POINTER)]));opts.showCloseIcon||(t="");let e=HU.div([ATTR_CLASS,"ramadda-popup-title"],opts.title);opts.rightSideTitle&&(e+=HU.div([ATTR_CLASS,"ramadda-popup-title-right"],opts.rightSideTitle));let a=t+e;opts.headerRight&&(a+=HU.div([ATTR_STYLE,HU.css(CSS_POSITION,POSITION_ABSOLUTE,CSS_TOP,HU.px(0),CSS_RIGHT,HU.px(0))],opts.headerRight));let n=HU.div([ATTR_STYLE,HU.css(CSS_POSITION,POSITION_RELATIVE,CSS_TEXT_ALIGN,ALIGN_LEFT),ATTR_CLASS,"ramadda-popup-header"],a);html=n+html}(opts.decorate||opts.header)&&(html=HU.div([ATTR_CLASS,CLASS_POPUP],html));let innerId=HU.getUniqueId("model_inner");(opts.modal||opts.modalStrict)&&(html=HU.div([ATTR_ID,innerId,ATTR_STYLE,opts.modalContentsCss,ATTR_CLASS,"ramadda-modal-contents"],html),html=HU.div([ATTR_CLASS,"ramadda-modal "+(opts.modalStrict?"ramadda-modal-strict":"")],html));let popup=$(html).appendTo(TAG_BODY);if(popup.find("a,div").tooltip({classes:{"ui-tooltip":"wiki-editor-tooltip"},content:function(){return $(this).prop(ATTR_TITLE)},show:{effect:"slide",delay:500,duration:400},position:{my:"left top",at:"right top"}}),opts.remove&&popup.attr("removeonclose","true"),opts.inPlace){let t=jqid(opts.contentId),e=jqid(parentId);e.css(CSS_DISPLAY,DISPLAY_BLOCK).css(ATTR_WIDTH,"fit-content").css(CSS_HEIGHT,"fit-content"),t.appendTo(e),t.show()}if(opts.anchor&&(opts.width&&popup.css(CSS_WIDTH,opts.width),popup.position({of:opts.anchor,my:opts.my,at:opts.at,collision:opts.fit?"fit fit":null})),opts.animate&&"false"!==opts.animate)if(opts.animateSpeed=+opts.animateSpeed,popup.hide(),opts.slideLeft){let t="right bottom";popup.position({of:opts.anchor,my:opts.my,at:t,collision:opts.fit?"fit fit":null}),popup.show("slide",{direction:"right"},+opts.animateSpeed)}else popup.show(opts.animateSpeed);else popup.show();return opts.resizable&&(opts.modal?jqid(innerId).resizable():popup.resizable()),opts.draggable?opts.modal?jqid(innerId).draggable():popup.draggable():opts.sticky||opts.toggleid||HU.setPopupObject(popup),opts.header&&jqid(id+"_close").click((function(){popup.hide(),opts.callback&&opts.callback(popup),opts.remove&&popup.remove()})),opts.initCall&&("string"==typeof opts.initCall?(window.ramaddaGlobalDialog=popup,eval(opts.initCall)):opts.initCall()),opts.toggleid&&(this.toggleDialogs[opts.toggleid]=popup),HU.handleNewContent(popup),popup},handleNewContent:function(t){Translate.translate(t)},addToDocumentUrl:function(t,e,a){if(Utils.isPost())return;let n=String(window.location);a?(n.includes("?")||(n+="?"),n+="&"+HU.urlArg(t,e)):(n=new URL(n),null===e?n.searchParams.delete(t):n.searchParams.set(t,e));try{window.history.replaceState&&window.history.replaceState("","",n)}catch(t){console.log("err:"+t),console.trace()}return n},removeFromDocumentUrl:function(t){try{let e=String(window.location),a=new RegExp("[?&]"+t+"=[^&]*(&|$)","gi");e=e.replace(a,"$1"),e=e.replace(/&$/,"").replace(/\?$/,""),window.history.replaceState&&window.history.replaceState("","",e)}catch(t){console.log("err:"+t)}},getUrlArgument:function(t,e){let a=new URLSearchParams(window.location.search).get(t);return Utils.isDefined(a)?Utils.getProperty(a):e},pre:function(t,e){return this.tag(TAG_PRE,t,e)},div:function(t,e){return this.tag(TAG_DIV,t,e)},center:function(t,e){return this.tag(TAG_CENTER,e,t)},span:function(t,e){return this.tag(TAG_SPAN,t,e)},movie:function(t,e){let a="";return e&&(a=HU.attrs(e)),"<video src='"+t+"' "+a+" controls='controls'></video>"},image:function(t,e){return"<img "+this.attrs([ATTR_SRC,t,"border","0"])+" "+this.attrs(e)+"/>"},swapHtml:function(t,e){$(document).ready((function(){let a=$(t),n=$(e);a.appendTo(n)}))},table:function(t,e){return HU.tag(TAG_TABLE,t,e)},tr:function(t,e){return this.tag(TAG_TR,t,e)},css:function(...t){1==t.length&&Array.isArray(t[0])&&(t=t[0]);let e="";for(let a=0;a<t.length;){let n=t[a];Array.isArray(n)&&2==n.length?(e+=n[0]+":"+n[1]+";",a++):(e+=t[a]+":"+t[a+1]+";",a+=2)}return e},h2:function(t){return HU.tag(TAG_H2,[],t)},h3:function(t){return HU.tag(TAG_H3,[],t)},cssTag:function(t){return'<style type="text/css">\n'+t+"</style>"},cssLink:function(t){return"<link href='"+t+"'  rel='stylesheet'  type='text/css' />"},javascriptLink:function(t){return"<script type='text/javascript' src='"+t+"'><\/script>"},BR_ENTITY:"&#10;",makeMultiline:function(t){return Utils.join(t,HU.BR_ENTITY)},rgb:function(t,e,a,n){return Utils.isDefined(n)?"rgba("+t+","+e+","+a+","+n+")":"rgb("+t+","+e+","+a+")"},rgba:function(t,e,a,n){return HU.rgb(t,e,a,n)},perc:function(t){return HU.getDimension(t,"%")},border:function(t,e,a){return a=a??"solid",e=e??COLOR_LIGHT_GRAY,HU.px(t)+" "+a+" "+e},translate:function(t,e){return"translate("+t+","+e+")"},boldLabel:function(t){return HU.b(t)+": "},dotClass:function(t){return"."+t},important:function(t){return t+" !important"},px:function(t){return HU.getDimension(t,"px")},em:function(t){return HU.getDimension(t,"em")},vw:function(t){return HU.getDimension(t,"vw")},vh:function(t){return HU.getDimension(t,"vh")},pt:function(t){return HU.getDimension(t,"pt")},getDimension:(t,e)=>Utils.isDefined(t)?((t=String(t).trim()).match("calc")&&(t=(t=t.replace(/calc *\(/,"calc(").replace(/-/," - ").replace(/\+/," + ")).replace(/([0-9]) *\)/,"$1px)")),t.endsWith(")")||t.endsWith("%")||t.endsWith("px")||t.endsWith("vh")?t:t+(e=e??"px")):null,br:function(t){return t?t+"<br>":"<br>"},p:function(t){return t?t+"<p>":"<p>"},td:function(t,e){return this.tag(TAG_TD,t,e)},tds:function(t,e){if(!e)return"";Array.isArray(e)||(e=[e]);let a="";for(let n=0;n<e.length;n++)a+=this.td(t,e[n]);return a},ths:function(t,e){let a="";for(let n=0;n<e.length;n++)a+=this.th(t,e[n]);return a},onReturnEvent:function(t,e){"string"==typeof t&&(t=$(t)),t.keyup((function(t){13==(t.keyCode?t.keyCode:t.which)&&e($(this),t)}))},formatTable:function(t,e,a){HU.loadJqueryLib("DataTable",[RamaddaUtil.getCdnUrl("/lib/datatables-1.13.1/datatables.min.css")],[RamaddaUtil.getCdnUrl("/lib/datatables-1.13.1/datatables.min.js")],t,(()=>{$(t).each((function(){if($.fn.dataTable.isDataTable(this))return;let t=HU.formatTableInner($(this),e);a&&a($(this),t)}))}))},formatTableInner:function(t,e){let a={paging:!1,ordering:!1,info:!1,searching:!1,scrollCollapse:!0,retrieve:!0,fixedHeader:!1};e&&$.extend(a,e);let n=a.height||t.attr("table-height");n&&(a.scrollY=n);let i=t.attr("table-ordering");i&&(a.ordering="true"==i);let r=t.attr("table-ordering-init");r&&(a.order="none"==r?[]:r.split(","));let s=t.attr("table-searching");s&&(a.searching="true"==s);let l=t.attr("table-paging");if(l&&(a.paging="true"==l),Utils.isDefined(a.scrollY)){(""+a.scrollY).endsWith("px")||(a.scrollY+="px")}return t.DataTable(a),t},th:function(t,e){return this.tag(TAG_TH,t,e)},attrSelect:function(t,e){return"["+t+'="'+e+'"]'},scrollToAnchor:function(t,e,a){Utils.isDefined(e)||(e=-50);let n=$("a[name='"+t+"']");if(e||(e=0),e=+e,Utils.scrollToAnchorTime=new Date,a){let t=jqid(a),e=n;t.animate({scrollTop:e.offset().top-t.offset().top+t.scrollTop()},1e3)}else $("html,body").animate({scrollTop:n.offset().top+e},"slow"),location.hash=t},scrollVisible:function(t,e,a){if(0==e.length||0==t.length)return;let n=e.offset().top-t.offset().top;Utils.isDefined(a)||(a=1e3),t.animate({scrollTop:n+t.scrollTop()},a)},initNavPopup:function(t,e){let a={align:ALIGN_LEFT};e&&$.extend(a,e),jqid(t).click((function(){let e,n,i=HU.setPopupObject(jqid(t+"-popup"));a.align==ALIGN_RIGHT?(e="right top",n="right top"):(e="left top",n="right+5 top"),i.show(),i.position({of:i.parent(),my:e,at:n,collision:"fit fit"})}))},navLinkClicked:function(t,e){$(".ramadda-nav-left-link").removeClass("ramadda-nav-link-active"),jqid(t+"_href").parent().addClass("ramadda-nav-link-active"),HU.scrollToAnchor(t,e)},initNavLinks:function(t){let e={leftOpen:!0,showToggle:!0,leftWidth:HU.px(250)};t&&$.extend(e,t);let a=$(".ramadda-nav-left"),n=$(".ramadda-nav-right");if(e.showToggle){let t=HU.div(["toggle-state",e.leftOpen?"open":"closed",ATTR_TITLE,"Toggle left",ATTR_ID,"ramadda-nav-left-toggle",ATTR_CLASS,"ramadda-nav-left-toggle"],HU.getIconImage("fa-bars"));$(t).appendTo(n),jqid("ramadda-nav-left-toggle").click((function(){let t="closed"===$(this).attr("toggle-state");t?(a.show(),n.animate({"margin-left":e.leftWidth})):(a.hide(),n.animate({"margin-left":HU.px(0)})),$(this).attr("toggle-state",t?"open":"closed")}))}let i=$(".ramadda-nav-left-links");i.mouseenter((function(){Utils.linksMouseIn=!0})),i.mouseleave((function(){Utils.linksMouseIn=!1}));let r=$(".ramadda-nav-anchor"),s=$(".ramadda-nav-left-link"),l=null;$(window).scroll((function(){if(Utils.linksMouseIn)return;let t=!1;if(Utils.scrollToAnchorTime){t=(new Date).getTime()-Utils.scrollToAnchorTime.getTime()<2e3}let e=$(window).scrollTop(),a=e+$(window).height(),n=null,i=null;if(r.each((function(){let t=$(this).offset().top,r=t+$(this).outerHeight(!0);(t<=a&&t>=e||r<=a&&r>=e||r>=a&&t<=e)&&(null==i||t<i)&&(i=t,n=$(this))})),!n)return;if(l&&l.attr(ATTR_NAME)==n.attr(ATTR_NAME))return;l=n,s.removeClass("ramadda-nav-link-active");let o=null;s.each((function(){$(this).attr("navlink")==n.attr(ATTR_NAME)&&($(this).addClass("ramadda-nav-link-active"),o=$(this))})),!t&&o&&HU.scrollVisible(o.parent(),o,100)}))},setFormValue:function(t,e){jqid(t).val(e)},setHtml:function(t,e){jqid(t).html(e)},formTable:function(){return this.openTag(TAG_TABLE,[ATTR_CLASS,CLASS_FORMTABLE,ATTR_CELLSPACING,"0",ATTR_CELLSPACING,"0"])},formTableClose:function(){return this.closeTag(TAG_TABLE)},formEntryTopLabel:function(t,e,a){return HU.formEntryTop(HU.span([],t)+":",e,a)},formEntryTop:function(t,e,a){return a?HU.tag(TAG_TR,[ATTR_VALIGN,ALIGN_TOP],HU.tag(TAG_TD,[ATTR_CLASS,CLASS_FORMLABEL,ATTR_ALIGN,ALIGN_RIGHT],t)+HU.tag(TAG_TD,[],e)+HU.tag(TAG_TD,[],a)):this.tag(TAG_TR,[ATTR_VALIGN,ALIGN_TOP],this.tag(TAG_TD,[ATTR_CLASS,CLASS_FORMLABEL,ATTR_ALIGN,ALIGN_RIGHT],t)+this.tag(TAG_TD,[],e))},formEntryLabel:function(t,e){return HU.formEntry(HU.span([],t)+":",e)},formEntry:function(t,e){return this.tag(TAG_TR,[],this.tag(TAG_TD,[ATTR_CLASS,CLASS_FORMLABEL,ATTR_ALIGN,ALIGN_RIGHT],t)+this.tag(TAG_TD,[],e))},appendArg:function(t,e,a){return t.indexOf("?")<0?t+="?":t+="&",t+=HU.urlArg(e,a)},b:function(t){return this.tag(TAG_B,[],t)},italic:function(t){return this.tag(TAG_I,[],t)},td:function(t,e){return this.tag(TAG_TD,t,e)},th:function(t,e){return this.tag(TAG_TH,t,e)},tag:function(t,e,a){a||"string"!=typeof e||(a=e,e=null);let n="<"+t+" "+this.attrs(e)+">";return null!=a&&(n+=a),n+="</"+t+">",n},openTag:function(t,e,a){let n="<"+t+" "+this.attrs(e)+">";return null!=a&&(n+=a),n},open:function(t,e,a){let n="<"+t+" "+(e?this.attrs(e):"")+">";return a&&(n+=a),n},openRow:function(){return this.openTag(TAG_DIV,[ATTR_CLASS,"row"])},closeRow:function(){return this.closeTag(TAG_DIV)},openDiv:function(t){return this.openTag(TAG_DIV,t)},closeDiv:function(){return this.closeTag(TAG_DIV)},closeTag:function(t){return"</"+t+">\n"},close:function(...t){let e="";return t.forEach((t=>{e+="</"+t+">\n"})),e},urlArg:function(t,e){return encodeURIComponent(t)+"="+encodeURIComponent(e)},attrSelect:function(t,e){return Utils.isDefined(e)?"["+t+"='"+e+"']":"["+t+"]"},space:function(t){let e="";for(let a=0;a<t;a++)e+=SPACE;return e},attr:function(t,e){return null==e?" "+t+" ":" "+t+"="+this.qt(e)+" "},attrs:function(...t){if(null==t)return"";let e=this.convertVarArgs(t);if(0==e.length)return"";if(1==e.length&&!Utils.isDefined(e[0]))return"";if("string"==typeof e)return e;let a="";if(null==e)return a;if(1==e.length)return e[0];for(let t=0;t<e.length;t+=2){let n=e[t];if(!n)continue;let i=e[t+1];a+=null===i?" "+n+" ":this.attr(n,i)}return a},styleAttr:function(t){return this.attr(ATTR_STYLE,t)},classAttr:function(t){return this.attr(ATTR_CLASS,t)},makeFullScreen:function(t){if(null==t)return console.log("HU.makeFullScreen: null elem argument"),void console.trace();t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():console.err("No full screen")},makeEnlargable:function(t,e,a){$(document).ready((function(){HU.makeEnlargableInner(t,e,a)}))},makeEnlargableInner:function(t,e,a){let n=jqid(t),i=(jqid(t+"_inner"),jqid(t+"_contents")),r=!1,s=i.height();e=Utils.getStringDefined(e,"Show more"),a=Utils.getStringDefined(a,"Show less");let l=HU.div([ATTR_ID,t+"_button",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-enlarge-button ramadda-enlarge-bbutton")],e);$(l).appendTo(n).click((function(){r=!r,i.css(CSS_HEIGHT,r?"":s),$(this).html(r?a:e)}))},makeExpandable:function(t,e,a){let n={right:HU.px(0),top:HU.px(0),icon:"fa-solid fa-maximize"};a&&$.extend(n,a);let i=HU.getIconImage(n.icon,[ATTR_CLASS,CLASS_CLICKABLE],[]),r=HU.getUniqueId(),s=HU.css(CSS_DISPLAY,DISPLAY_NONE,CSS_CURSOR,CURSOR_POINTER,CSS_TEXT_ALIGN,ALIGN_RIGHT,CSS_POSITION,POSITION_ABSOLUTE,CSS_MARGIN_TOP,HU.px(0));s+=n.left?HU.css(CSS_LEFT,n.left):HU.css(CSS_RIGHT,n.right),s+=HU.css(CSS_TOP,n.top);let l=HU.div([ATTR_ID,r,ATTR_TITLE,"Expand",ATTR_CLASS,"ramadda-expandable-link",ATTR_STYLE,s],i);$(t).append(l);let o=jqid(r),d=$(t).hasClass("ramadda-expand-now");o.attr("data-expanded",d);let c=$(t).css(CSS_BACKGROUND);$(t).mouseenter((function(){o.css(CSS_DISPLAY,DISPLAY_BLOCK)})),$(t).mouseleave((function(){o.css(CSS_DISPLAY,DISPLAY_NONE)}));let u=function(){let a,n="true"==$(this).attr("data-expanded");if(n)a=HU.getIconImage("fa-expand-arrows-alt"),$(this).attr(ATTR_TITLE,"Expand"),$(t).css(CSS_LEFT,"").css(CSS_RIGHT,"").css(CSS_TOP,"").css(CSS_BOTTOM,"").css(CSS_POSITION,POSITION_RELATIVE).css(CSS_HEIGHT,"").css(CSS_Z_INDEX,"").css(CSS_BACKGROUND,c||""),$(t).removeClass("ramadda-expandable-expanded"),o.css(CSS_DISPLAY,DISPLAY_NONE),$(t).find(".ramadda-expandable-target").each((function(){$(this).attr("isexpanded","false"),$(this).attr(ATTR_STYLE,$(this).attr("original-style"))}));else{let n=$(window).height();a=HU.getIconImage("fa-compress-arrows-alt");$(t).offset().top;if($(this).attr(ATTR_TITLE,"Contract"),e){let e=$(t).find(".ramadda-expandable");return e.css(CSS_BACKGROUND,COLOR_WHITE),void HU.makeFullScreen(e.get(0))}$(t).addClass("ramadda-expandable-expanded"),$(t).css(CSS_LEFT,HU.px(50)).css(CSS_RIGHT,HU.px(5)).css(CSS_TOP,HU.px(5)).css(CSS_POSITION,"fixed").css(CSS_Z_INDEX,"2000").css(CSS_BACKGROUND,COLOR_WHITE).css(CSS_HEIGHT,HU.px(n)),$(t).find(".ramadda-expandable-target").each((function(){$(this).attr("original-style",$(this).attr(ATTR_STYLE)),$(this).attr("isexpanded","true");let t=$(this).attr("expandable-height");(t||-1!=t)&&$(this).css(CSS_HEIGHT,t||HU.vh(95))})),o.css(CSS_DISPLAY,DISPLAY_BLOCK)}$(this).attr("data-expanded",!n+""),$(this).html(a),window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout(),window.ramaddaMapCheckLayout&&ramaddaMapCheckLayout()};jqid(r).click(u),d&&u()},makeDraggable:function(t){$(t).draggable({zIndex:1e3,drag:function(t,e){},start:function(t,e){if(!$(this).attr("started")){$(this).attr("started",!0);let t=$(this).offset();$(this).attr("oleft",t.left),$(this).attr("otop",t.top),$(this).css(CSS_POSITION,POSITION_ABSOLUTE).css(CSS_LEFT,HU.px(t.left)).css(CSS_TOP,HU.px(t.top)),console.log("start:"+t.left+" "+t.top)}}})},idAttr:function(t){return this.attr(ATTR_ID,t)},link:function(t,e,a){null==a&&(a=[]);let n=[];for(i in a)n.push(a[i]);return(a=n).push(ATTR_URL,t),a.push(ATTR_CLASS,CLASS_LINK),a.style?a.style+=HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK):a.style=HU.attr(ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK)),this.div(a,e)},getEntryImage:function(t,e){if(e.indexOf("::")>=0){var a=e.split("::");a[0].trim().length>0&&(t=a[0].trim());var n=a[1].trim();return HU.url(RamaddaUtil.getUrl("/metadata/view/"+n),ARG_ENTRYID,t)}return e},jsLink:function(t,e,a){return a=a||[],HU.href("javascript:noop();",e,a)},getUrl:function(t,...e){let a=this.convertVarArgs(e);a.length>0&&(t+="?");for(let e=0;e<a.length;e+=2)e>0&&(t+="&"),t+=this.urlArg(a[e],a[e+1]);return t},convertVarArgs:function(t){let e=[];return t.forEach((t=>{Array.isArray(t)?e.push(...t):e.push(t)})),e},url:function(t,...e){let a=t,n=this.convertVarArgs(e);for(let t=0;t<n.length;t+=2){0==t&&a.indexOf("?")<0?a+="?":a+="&";let e=n[t],i=n[t+1];a+=encodeURIComponent(e)+"="+encodeURIComponent(i)}return a},href:function(t,e,a){null==a&&(a=[]);let n=[];for(let t in a)n.push(a[t]);return(a=n).push(ATTR_HREF),a.push(t),Utils.isDefined(e)&&""!=e||(e=t),this.tag(TAG_A,a,e)},onClick:function(t,e,a){let n=[ATTR_ONCLICK,t,ATTR_STYLE,HU.css(CSS_COLOR,COLOR_BLACK,CSS_CURSOR,CURSOR_POINTER)];if(null!=a)for(let t=0;t<a.length;t++)n.push(a[t]);return this.tag(TAG_A,n,e)},isChecked:function(t){return $(t).is(":checked")},isVisible:function(t){return $(t).is(":visible")},checkbox:function(t,e,a,n){if(e=e||[],!Utils.stringDefined(t))for(let a=0;a<e.length;a+=2)if(e[a]==ATTR_ID){t=e[a+1];break}e.push(ATTR_ID),e.push(t),e.push("type"),e.push("checkbox"),e.includes(ATTR_VALUE)||e.push(ATTR_VALUE,!0),a&&(e.push("checked"),e.push(null));let i=this.tag(TAG_INPUT,e);if(n){let a="";for(let t=0;t<e.length;t+=2)if(e[t]==ATTR_TITLE){a=e[t+1];break}let r=[ATTR_FOR,t];Utils.stringDefined(a)&&(r.push(ATTR_TITLE),r.push(a)),i+=SPACE+HU.tag(TAG_LABEL,r,n)}return i},radioGroup:function(t,e,a){let n="";return e.forEach(((e,i)=>{let r=e;Array.isArray(e)?(r=e[1],e=e[0]):Utils.isDefined(e.value)&&(r=e.label??e.value,e=e.value);let s=HU.getUniqueId("radio_");n+=HU.radio(s,t,"",e,a?a==e:0==i)+HU.tag(TAG_LABEL,[ATTR_FOR,s],r)+HU.br(),n+="\n"})),n},radio:function(t,e,a,n,i,r,s){r||(r="");let l="<input id='"+t+"'  class='"+a+"' name='"+e+"' type=radio value='"+n+"' ";return i&&(l+=" checked "),l+=" "+r,l+="/>",s&&(l+=HU.tag(TAG_LABEL,[ATTR_FOR,t],s)),l},handleFormChangeShowUrl:function(t,e,n,i,r,s){let l={showInputField:!0,includeCopyArgs:!1};s&&$.extend(l,s),null==i&&(i=[".*OpenLayers_Control.*","authtoken"]);let o=jqid(e).attr("action")+"?";o=o.replace(/ +/g,"_");let d=jqid(e+" :input"),c=0,u=[],T="",h={},f=(t,e)=>{let a=t+"---"+e;return!!h[a]||(h[a]=!0,!1)};d.each((function(t,e){if(""==e.name||null==e.value||""==e.value)return;if("-all-"==e.value)return;if("submit"==e.type&&e.value==LABEL_CANCEL)return;if("checkbox"==e.type&&!e.checked)return;if("radio"==e.type&&!e.checked)return;if(e.attributes&&e.attributes.default&&e.attributes.default.value==e.value)return;if(null!=i)for(t=0;t<i.length;t++){let a=i[t];if(e.name.match(a))return}if("formurl"==e.id)return;let n=e.attributes["default-value"]?.value;e.name;var r=[];if("select-multiple"==e.type&&e.selectedOptions)for(a in e.selectedOptions)option=e.selectedOptions[a],Utils.isDefined(option.value)&&n!=option.value&&r.push(option.value);else n!=e.value&&r.push(e.value);for(v in 1==r.length&&r.forEach((t=>{"entryid"!=e.name&&"submit"!=e.name&&"output"!=e.name&&(T+=e.name+"="+t+"\n")})),r)value=r[v],u.push({item:e,value:value}),f(e.name,value)||(c>0&&(o+="&"),c++,o+=encodeURIComponent(e.name)+"="+encodeURIComponent(value))}));let g=window.location.protocol+"//"+window.location.host;o=g+o;let p=l.showInputField?HU.input("formurl",o,[ATTR_SIZE,80,ATTR_ID,"formurl"]):HU.hidden("formurl",o,[ATTR_SIZE,80,ATTR_ID,"formurl"]),m=HU.vspace()+HU.div([ATTR_CLASS,"ramadda-form-url"],p+SPACE2+(l.includeCopyArgs?HU.span([ATTR_ID,"argscopy",ATTR_CLASS,CLASS_CLICKABLE,ATTR_TITLE,"Copy json for subset action"],HU.getIconImage("fas fa-earth-americas"))+SPACE2:"")+HU.span([ATTR_ID,"clipboard",ATTR_CLASS,CLASS_CLICKABLE,ATTR_TITLE,"Copy URL to clipboard"],HU.getIconImage(ICON_CLIPBOARD))+SPACE2+HU.href(o,HU.getIconImage(ICON_LINK),[ATTR_TITLE,"Form URL"]));r&&(m+=r({entryId:t,formId:e,inputs:d,itemValuePairs:u})),jqid(n).html(m),jqid("argscopy").click((()=>{Utils.copyToClipboard(T),alert("args for subset are copied to clipboard")})),jqid("clipboard").click((()=>{Utils.copyToClipboard(jqid("formurl").val()),alert("URL copied to clipboard")}))},preventSubmitOnEnter:function(t){"Enter"===t.key&&t.preventDefault()},makeUrlShowingForm:function(t,e,a,n,i,r){jqid(e).find(":input").change((function(){HU.handleFormChangeShowUrl(t,e,a,n,i,r)})),HU.handleFormChangeShowUrl(t,e,a,n,i,r)},makeSelectTagPopup:function(t,e){e=e??{};let a={label:"Select",icon:!1,single:!1,showCategories:!1,buttonLabel:"Select",hide:!1,addBreak:!1,after:!1,wrap:"${widget}",makeButton:!0,makeButtons:!0};"string"==typeof t&&(t=$(t)),e.icon&&!e.buttonLabel&&(e.buttonLabel=HU.getIconImage("fas fa-list-check")),$.extend(a,e),a.tooltip||(a.tooltip=a.single?"Select value":"Select multiple");let n=a.label??"Select";a.hide&&t.hide();let i=HU.getUniqueId("btn"),r=HU.span([ATTR_CLASS,CLASS_CLICKABLE,ATTR_TITLE,a.tooltip,ATTR_ID,i],a.buttonLabel)+(a.addBreak?HU.br():"");r=a.wrap.replace("${widget}",r),a.after?t.after(" "+r):t.before(r+SPACE);let s,l={},o=function(e,n){let i=l[e.attr(ATTR_ID)];if(!i)return;let r=HU.isChecked(e);i.prop("selected",r),n&&(t.change(),t.iconselectmenu&&t.iconselectmenu("instance")&&t.iconselectmenu("refresh")),a.single&&s.remove()},d=function(){o($(this),!0)},c=e=>{let i=[],r="",c=HU.getUniqueId("radio");t.find(TAG_OPTION).each((function(){let t=$(this).attr(ATTR_VALUE);if(!Utils.stringDefined(t))return void($(this).attr(ATTR_CATEGORY)&&a.showCategories&&(r=$(this).html(),i.push(HU.div([ATTR_DATA_CORPUS,r,ATTR_CLASS,"ramadda-select-tag-category"],r))));let e=$(this).html();e=e.replace(SPACE," "),$(this).attr(ATTR_IMGSRC)&&(e=HU.image($(this).attr(ATTR_IMGSRC),[ATTR_WIDTH,HU.px(16)])+" "+e);let n=$(this).is(":selected"),s=HU.getUniqueId("cbx");l[s]=$(this);let o=a.single?HU.radio(s,c,"",e,n,null,e):HU.checkbox(s,[],n,e),d=r;d+=" "+($(this).attr(ATTR_DATA_CORPUS)??"");let u=$(this).html()+" "+t;o=HU.div([ATTR_CLASS,"ramadda-select-tag",ATTR_DATA_CORPUS,d,ATTR_TITLE,t,"tag",u],o),i.push(o)}));let u=HU.div([ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(5),CSS_WIDTH,HU.px(600),CSS_MAX_HEIGHT,HU.px(300),CSS_OVERFLOW_Y,OVERFLOW_AUTO)],Utils.wrap(i,"","")),T=HU.getUniqueId("input_"),h=HU.input("","",[ATTR_STYLE,HU.css(CSS_WIDTH,HU.px(200)),ATTR_PLACEHOLDER,"Search for "+n.toLowerCase(),ATTR_ID,T]);if(a.makeButtons){let t="";a.single||(t+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action",ATTR_DATA_ACTION,"clear"],"Clear all"),t+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action",ATTR_DATA_ACTION,"selectshown"],"Select shown")),t+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action",ATTR_DATA_ACTION,"showselected"],"Show selected"),t+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action",ATTR_DATA_ACTION,"showall"],"Show all"),h+=HU.div([ATTR_STYLE,HU.css(CSS_BORDER_BOTTOM,CSS_BASIC_BORDER,CSS_PADDING,HU.px(6))],t)}let f=HU.div([ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(10))],HU.center(h)+u);s=HU.makeDialog({content:f,anchor:e,title:n,draggable:!0,header:!0}),s.find(":checkbox").change(d),s.find(":radio").change(d);let g=s.find(".ramadda-select-tag, .ramadda-select-tag-category");s.find(".ramadda-select-action").button().click((function(){let e=$(this).attr(ATTR_DATA_ACTION);"showall"!=e?"showselected"!=e?("selectshown"==e&&(g.each((function(){if(HU.isVisible($(this))){let t=$(this).find(":checkbox");0==t.length&&(t=$(this).find(":radio")),t.prop("checked",!0),o(t,!1)}})),t.change()),"clear"==e&&(g.each((function(){let t=$(this).find(":checkbox");t.prop("checked",!1),o(t,!1)})),t.change())):g.each((function(){let t=$(this).find(":checkbox");0==t.length&&(t=$(this).find(":radio")),HU.isChecked(t)||$(this).hide()})):g.show()})),jqid(T).focus(),jqid(T).keyup((function(t){let e=$(this).val().trim().toLowerCase();g.each((function(){if(""==e)return void $(this).show();let t=$(this).attr("tag")??"";t+=" "+($(this).attr(ATTR_DATA_CORPUS)??""),t&&(t=t.toLowerCase(),t.indexOf(e)>=0?$(this).show():$(this).hide())}))}))};a.makeButton&&!a.icon&&jqid(i).button(),jqid(i).click((function(){c($(this))}))},select:function(t,e,a,n,i,r){var s=this.openTag("select",e);return s+=HU.makeOptions(a,n,i,r),s+=this.closeTag("select")},makeOptions:function(t,e,a,n){let i="";return t.forEach((t=>{let n=[],r=t,s="";if("string"==typeof t&&t.indexOf("<option")>=0)return void(i+=t);Array.isArray(t)?(r=t[1],s=t[0]):Utils.isDefined(t.category)?(r=t.category,n.push("isheader",!0),n.push(ATTR_CLASS,"ramadda-select-header"),n.push(ATTR_CATEGORY,t.category)):Utils.isDefined(t.value)?(t.imgsrc&&n.push(ATTR_IMGSRC,t.imgsrc),t.datatitle&&n.push(ATTR_TITLE,t.datatitle),t.corpus&&n.push(ATTR_DATA_CORPUS,t.corpus),t.datastyle&&n.push("data-style",t.datastyle),s=String(t.value).replace(/"/g,'\\"'),r=t.label??s):s=t;let l=r;a&&r.length>a&&(r=r.substring(0,a)+"...");let o="";e&&Array.isArray(e)?e.indexOf(s)>=0&&(o=" selected "):e==s&&(o=" selected ");let d=l;t&&t!=d&&t.indexOf&&t.indexOf("base64"),n.push(ATTR_TITLE,d,o,null,ATTR_VALUE,s);let c=HU.tag(TAG_OPTION,n,r);i+=c})),i},datePicker:function(t,e,a){return a.push(ATTR_SIZE),a.push("8"),HU.input(t,e,a)},makeClearDatePickerArgs:function(t){let e={showButtonPanel:!0,closeText:"Clear",onClose:function(t){$(window.event.srcElement).hasClass("ui-datepicker-close")&&$(this).val("")}};return t&&$.extend(e,t),e},datePickerInit:function(t){jqid(t).datepicker({onSelect:function(t,e){t!==e.lastVal&&$(this).change()},dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,constrainInput:!1,yearRange:"1900:2100"})},rangeInput:function(t,e){var a='<form><div><input type="text" class="ramadda-slider-value sliderValue" data-index="0" value="10" /> <input type="text" class="ramadda-slider-value  sliderValue" data-index="1" value="90" /></div>'+HU.div([ATTR_ID,e])+"</form>";return console.log(a),a},rangeInputInit:function(t){jqid(t).slider({min:0,max:100,step:1,values:[10,90],slide:function(t,e){for(var a=0;a<e.values.length;++a)$("input.sliderValue[data-index="+a+"]").val(e.values[a])}}),$("input.sliderValue").change((function(){var t=$(this);jqid("slider").slider("values",t.data("index"),t.val())}))},input:function(t,e,a){return"<input "+HU.attrs(a)+HU.attrs([ATTR_VALUE,e])+(null==t?"":HU.attrs(ATTR_NAME,t))+">"},hidden:function(t,e,a){return"<input type=hidden "+HU.attrs(a)+HU.attrs([ATTR_NAME,t,ATTR_VALUE,e])+">"},textarea:function(t,e,a){return"<textarea "+HU.attrs(a)+HU.attrs([ATTR_NAME,t])+">"+e+"</textarea>"},initSelect:function(t,e){if(0==t.length)return;let a={dynamicPositioning:!1,showEffect:"fadeIn",showEffectSpeed:400,hideEffect:"fadeOut",hideEffectSpeed:400,autoWidth:!1};e&&$.extend(a,e),$(document).ready((function(){HU.loadJqueryLib("selectBoxIt",[RamaddaUtil.getCdnUrl("/lib/selectboxit/stylesheets/jquery.selectBoxIt.css")],[RamaddaUtil.getCdnUrl("/lib/selectboxit/javascripts/jquery.selectBoxIt.min.js")],t,(()=>{setTimeout((()=>{$(t).selectBoxIt(a)}),100)}))}))},valueDefined:function(t){return""!=t&&0!=t.indexOf("--")},squote:function(t){return"'"+t+"'"},quote:function(t){return'"'+t+'"'},makeToggle:function(t,e,a){null===a&&(a=!0);let n=RamaddaUtil.getCdnUrl("/icons/togglearrowdown.gif"),i=RamaddaUtil.getCdnUrl("/icons/togglearrowright.gif");jqid(t).attr(ATTR_STATE,"open"),jqid(t).attr(ATTR_SRC,n),jqid(t).css(CSS_CURSOR,CURSOR_POINTER);let r=t=>{t.attr(ATTR_STATE,"close"),t.attr(ATTR_SRC,i),jqid(e).hide()};jqid(t).click((function(t){var a;"open"==$(this).attr(ATTR_STATE)?r($(this)):((a=$(this)).attr(ATTR_STATE,"open"),a.attr(ATTR_SRC,n),jqid(e).show()),t.preventDefault()})),a||r(jqid(t))},makeSplash:function(t,e){let a={width:HU.perc(50),style:"",showOk:!0};if(e&&$.extend(a,e),a.src&&(t=jqid(a.src).html()),null==t||""==t.trim())return;t=HU.div([ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(10))],t);let n=Utils.getUniqueId("close_"),i=HU.div([ATTR_ID,n,ATTR_CLASS,CLASS_CLICKABLE,ATTR_STYLE,HU.css(CSS_POSITION,POSITION_ABSOLUTE,CSS_RIGHT,HU.px(10),CSS_TOP,HU.px(10))],HU.getIconImage("far fa-window-close"))+t;a.showOk&&(i+=HU.center(HU.div([ATTR_ID,n+"_button"],LABEL_OK))),i=HU.div([ATTR_CLASS,"ramadda-shadow-box ramadda-splash",ATTR_STYLE,HU.css(ATTR_WIDTH,a.width)+a.style],i);let r=$(HU.div([ATTR_CLASS,"ramadda-splash-container"],i)).appendTo($(TAG_BODY));$(TAG_BODY).addClass("ramadda-splash-body");let s=()=>{$(TAG_BODY).removeClass("ramadda-splash-body"),r.remove()};r.click((t=>{})),jqid(n).click((()=>{s()})),jqid(n+"_button").button().click((()=>{s()}))},makeToggleImage:function(t,e){return e=e||"",HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_MIN_WIDTH,HU.px(10))],HU.getIconImage(t,[ATTR_ALIGN,ALIGN_BOTTOM],[ATTR_STYLE,e]))},toggleBlockListeners:{},toggleBlockVisibility:function(t,e,a,n,i,r){let s=!0;Utils.isDefined(s)||(s=!0),toggleVisibility(t,"block",i,r)?HU.isFontAwesome(a)?jqid(e).html(HU.makeToggleImage(a)):jqid(e).attr(ATTR_SRC,a):(s=!1,HU.isFontAwesome(a)?jqid(e).html(HU.makeToggleImage(n)):jqid(e).attr(ATTR_SRC,n)),Utils.ramaddaUpdateMaps(),HU.toggleBlockListeners[t]&&HU.toggleBlockListeners[t](t,s)},toggleBlock:function(t,e,a,n,i){let r={headerClass:HU.classes("ramadda-noselect ramadda-toggleblock entry-toggleblock-label",CLASS_HOVERABLE,CLASS_CLICKABLE),headerStyle:"",orientation:"h",imgopen:"fas fa-caret-down",imgclosed:"fas fa-caret-right"};n&&$.extend(r,n);let s="horizontal"==r.orientation;s&&(r.headerStyle+=HU.css(CSS_LINE_HEIGHT,HU.px(1)));let l=Utils.getUniqueId("block_"),o=l+"_img";i&&(i.id=l,i.imgid=o);let d=r.imgopen,c=r.imgclosed,u="HU.toggleBlockVisibility("+HU.join([HU.squote(l),HU.squote(o),HU.squote(d),HU.squote(c),Utils.isDefined(r.animated)?r.animated:"null"],",")+");",T=HU.span([ATTR_ID,o],HU.makeToggleImage(a?d:c)),h=HU.div([ATTR_STYLE,r.headerStyle,ATTR_CLASS,r.headerClass,ATTR_ONCLICK,u],T+" "+t),f=a?HU.css(CSS_DISPLAY,DISPLAY_BLOCK,CSS_VISIBILITY,"visible"):HU.css(CSS_DISPLAY,DISPLAY_NONE),g=HU.div([ATTR_CLASS,"hideshowblock",ATTR_ID,l,ATTR_STYLE,f],e);return r.listener&&(HU.toggleBlockListeners[l]=r.listener),r.separate?{header:h,body:g,id:l}:s?HU.hbox([h,g]):h+g},toggleBlockNew:function(t,e,a,n){Utils.isDefined(a)||(a=!1);let i={headerClass:HU.classes("ramadda-noselect ramadda-toggleblock-label",CLASS_CLICKABLE),headerStyle:""};n&&$.extend(i,n);let r=Utils.getUniqueId("block_"),s=r+"_img",l=HU.span([ATTR_ID,s],HU.makeToggleImage(a?"fas fa-caret-down":"fas fa-caret-right")),o=["toggle-block-id",r,"toggle-block-visible",a,ATTR_STYLE,i.headerStyle,ATTR_CLASS,i.headerClass];i.extraAttributes&&(o=Utils.mergeLists(o,i.extraAttributes));let d=HU.div(o,l+" "+t),c=a?HU.css(CSS_DISPLAY,DISPLAY_BLOCK,CSS_VISIBILITY,"visible"):HU.css(CSS_DISPLAY,DISPLAY_NONE),u=HU.div([ATTR_CLASS,"hideshowblock",ATTR_ID,r,ATTR_STYLE,c],e);return i.separate?{header:d,body:u,id:r}:d+u},initToggleBlock:function(t,e){t.find("[toggle-block-id]").click((function(){let t=$(this).attr("toggle-block-id"),a=t+"_img",n="true"===$(this).attr("toggle-block-visible");n=!n,$(this).attr("toggle-block-visible",""+n),jqid(a).html(HU.makeToggleImage(n?"fas fa-caret-down":"fas fa-caret-right")),n?jqid(t).show():jqid(t).hide(),e&&e(t,n,$(this))}))}},StringUtil={endsWith:function(t,e){return t.length>=e.length&&t.lastIndexOf(e)+e.length==t.length},startsWith:function(t,e){return t.length>=e.length&&0===t.lastIndexOf(e,0)}},blockCnt=0,SU;function DomObject(t){this.obj=null,document.getElementById?(this.obj=document.getElementById(t),this.obj&&(this.style=this.obj.style)):document.all?(this.obj=document.all[t],this.obj&&(this.style=this.obj.style)):document.layers&&(this.obj=document.layers[t],this.style=document.layers[t]),this.obj&&(this.id=this.obj.id,this.id||(this.id="obj"+blockCnt++))}function pageIsUnloading(){GuiUtils.pageUnloading=!0,window.onbeforeunload=confirmExit}function confirmExit(){return null}function Div(t,e){this.id=HU.getUniqueId(),this.contents=t||"",this.extra="",this.clazz=e,this.setHidden=function(){},this.toString=function(){return HU.div([ATTR_CLASS,e||"",ATTR_ID,this.id],this.contents)},this.getId=function(){return this.id},this.jq=function(){return jqid(this.id)},this.set=function(t,e){return e&&(this.extra=HU.attrs(e)),this.contents=t,this.jq().html(t),this},this.append=function(t){this.content?this.content+=t:this.content=t,jqid(this.id).append(t)},this.msg=function(t){return this.set(HU.div([ATTR_CLASS,"display-message"],t))}}function number_format(t,e,a){let n,i=t<0,r=Utils.roundDecimals(t,e,!1);i?(n=Math.ceil(r),n=Math.abs(n)):n=Math.floor(r);let s=String(r).match(/\.(.*)/),l=s?s[1]:"",o=String(n).replace(/(.)(?=(\d{3})+$)/g,"$1,");return""!=l&&(o+="."+l),a&&console.log("number:"+t+" n:"+r+" i:"+n+" s:"+o),i&&0==n||i?"-"+o:o}$.widget("custom.iconselectmenu",$.ui.selectmenu,{_renderItem:function(t,e){let a=$("<li>"),n=$("<span>");e.disabled&&a.addClass("ui-state-disabled");let i=e.label,r=e.element.attr("img-src"),s=e.element.attr(ATTR_TITLE);"<blank>"==i&&(i="&lt;blank&gt;"),r&&(r=r.startsWith("fa")?HU.getIconImage(r):HU.image(r,[ATTR_STYLE,e.element.attr("data-style")||"",ATTR_WIDTH,64,ATTR_TITLE,s,ATTR_CLASS,"ui-icon "+e.element.attr("data-class")]),$(r).appendTo(n)),e.element.attr("isheader")?(n.css(CSS_PADDING_LEFT,HU.px(0)).css(CSS_POINTER_EVENTS,"none"),a.css(CSS_POINTER_EVENTS,"none")):i=HU.span([ATTR_TITLE,i,ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK,CSS_WIDTH,HU.perc(100),CSS_MARGIN_LEFT,r?HU.px(32):HU.px(4),CSS_WHITE_SPACE,WHITE_SPACE_NOWRAP)],i);let l=e.element.attr("label-class");return l&&(i=HU.div([ATTR_STYLE,HU.css(CSS_WIDTH,HU.perc(100)),ATTR_CLASS,l],i)),n.append(i),a.append(n).appendTo(t)}}),window.onbeforeunload=pageIsUnloading,function(t,e){t.fn.getCursorPosition=function(){var e=t(this).get(0),a=0;if("selectionStart"in e)a=e.selectionStart;else if("selection"in document){e.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-e.value.length),a=n.text.length-i}return a}}(jQuery);var SvgUtils=SU={translate:function(t,e){return" translate("+t+","+e+") "},scale:function(t){return" scale("+t+") "},rotate:function(t){return" rotate("+t+") "},skewX:function(t){return" skewX("+t+") "},transform:function(t,...e){return t.attr("transform",e.join(" ")),t},makeBlur:function(t,e,a){return t.append("defs").append("filter").attr(ATTR_ID,e).append("feGaussianBlur").attr("stdDeviation",a)}},dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,n=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(i,r,s){var l=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(i)||/\d/.test(i)||(r=i,i=void 0),i=i?new Date(i):new Date,isNaN(i))throw SyntaxError("invalid date");"UTC:"==(r=String(l.masks[r]||r||l.masks.default)).slice(0,4)&&(r=r.slice(4),s=!0);var o=s?"getUTC":"get",d=i[o+"Date"](),c=i[o+"Day"](),u=i[o+"Month"](),T=i[o+"FullYear"](),h=i[o+"Hours"](),f=i[o+"Minutes"](),g=i[o+"Seconds"](),p=i[o+"Milliseconds"](),m=s?0:i.getTimezoneOffset(),A={d:d,dd:n(d),ddd:l.i18n.dayNames[c],dddd:l.i18n.dayNames[c+7],m:u+1,mm:n(u+1),mmm:l.i18n.monthNames[u],mmmm:l.i18n.monthNames[u+12],yy:String(T).slice(2),yyyy:T,h:h%12||12,hh:n(h%12||12),H:h,HH:n(h),M:f,MM:n(f),s:g,ss:n(g),l:n(p,3),L:n(p>99?Math.round(p/10):p),t:h<12?"a":"p",tt:h<12?"am":"pm",T:h<12?"A":"P",TT:h<12?"AM":"PM",Z:s?"UTC":(String(i).match(e)||[""]).pop().replace(a,""),o:(m>0?"-":"+")+n(100*Math.floor(Math.abs(m)/60)+Math.abs(m)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return r.replace(t,(function(t){return t in A?A[t]:t.slice(1,t.length-1)}))}}();function jqid(t){return HU.jqid(t)}function jqname(t){return $('[name="'+t+'"]')}dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(t,e){return dateFormat(this,t,e)},$(document).ready((function(){HU.documentReady=!0,Utils.checkForResize()})),Utils.areDisplaysReady();var LANGUAGE_ENGLISH="en",LANGUAGE_SPANISH="es",Translate={packs:{},missing:{},language:null,init:function(){let t=HU.getIconImage("fas fa-language ramadda-header-icon"),e=t+HU.space(1),a=HU.span([ATTR_TITLE,"Change language",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-page-link"),ATTR_ID,"ramadda_language_menu"],t);a=$(a).appendTo(jqid("ramadda_links_prefix")),a.click((()=>{let t="";t+=HU.div([ATTR_TITLE,"Clear language",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-language-switch ramadda-menu-language-switch ramadda-user-link")],e+"Clear"),ramaddaLanguages.forEach((a=>{t+=HU.div(["data-language",a.id,ATTR_TITLE,"Switch language",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-language-switch ramadda-menu-language-switch ramadda-user-link")],e+a.label)})),t=HU.div([],t),this.menuPopup&&this.menuPopup.remove(),this.menuPopup=HU.makeDialog({content:t,anchor:a,my:"right top",at:"right bottom"});let n=this;this.menuPopup.find(".ramadda-menu-language-switch").click((function(){n.switcherClicked($(this))}))})),this.switchLang=jqid("switchlang"),Translate.translate()},switcherClicked:function(t){let e=t.attr("data-language");"showmissing"!=e?(HU.hidePopupObject(),this.setLanguage(e),Utils.setLocalStorage("ramadda-language",e),e==LANGUAGE_ENGLISH?Translate.translateInner(null,LANGUAGE_ENGLISH,{},!0):Translate.translate(null,e)):Translate.showMissing()},setDefaultLanguage:function(t){this.defaultLanguage=t||LANGUAGE_ENGLISH,this.language=t,Translate.translate(null,t)},checkSwitcher:function(){let t=this.language;$(".ramadda-language-switch").each((function(){$(this).attr("data-language")==t?$(this).addClass("ramadda-link-bar-item-active"):$(this).removeClass("ramadda-link-bar-item-active")}))},showLanguages:function(t,e){let a=HU.getUniqueId("switcher"),n=HU.getUniqueId("contents"),i=HU.center(HU.div([ATTR_ID,a]))+HU.div([ATTR_ID,n]);jqid(t).html(i);let r=t=>{Translate.setLanguage(t),Translate.checkSwitcher(),t&&HU.addToDocumentUrl("language",t),Translate.loadPack(t,(e=>{let a=HU.getUniqueId("search"),i=HU.div([ATTR_ID,a]);i+=HU.open(TAG_TABLE),i+=HU.tr([],HU.tds([ATTR_STYLE,HU.css(CSS_MIN_WIDTH,HU.px(400))],[HU.b("English"),HU.b("Translated - "+t)])),Object.keys(e).sort(((t,e)=>t.length-e.length)).forEach((t=>{t.startsWith("language.")||(i+=HU.tr([ATTR_CLASS,"phrase"],HU.tds([],[t,e[t]])))})),i+=HU.close(TAG_TABLE),jqid(n).html(i),HU.initPageSearch(".phrase",null,null,!1,{target:"#"+a,focus:!0})}))};e&&r(e),Translate.addSwitcher(a,null,!1,{callback:r,skipEnglish:!0}),Translate.disable()},addSwitcher:function(t,e,a,n){if(n=n??{},this.disabled)return;e?e=Utils.split(e,",",!0,!0):(e=[],ramaddaLanguages.forEach((t=>{e.push(t.id)})));let i=HU.open(TAG_DIV,[ATTR_CLASS,"ramadda-link-bar"]);e.forEach((t=>{n.skipEnglish&&t==LANGUAGE_ENGLISH||ramaddaLanguages.forEach((e=>{e.id==t&&(i+=HU.span(["data-language",e.id,ATTR_TITLE,"Switch language",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-link-bar-item ramadda-language-switch")],e.label))}))})),a&&(Translate.downloadMode=!0,i+=HU.span(["data-language","showmissing",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-link-bar-item ramadda-language-switch")],"Download missing")),i+=HU.close(TAG_DIV);let r=$(i);r.appendTo(jqid(t));let s=this;r.find(".ramadda-language-switch").click((function(){if(n.callback){let t=$(this).attr("data-language");n.callback(t)}else s.switcherClicked($(this))})),this.checkSwitcher()},pending:{},loadPack:function(t,e){if(Translate.packs[t])return void e(Translate.packs[t]);if(Translate.pending[t])return void Translate.pending[t].push(e);Translate.pending[t]=[];let a=HU.url(RamaddaUtil.getUrl("/getlanguage"),"language",t);ramaddaCurrentEntry&&(a=HU.url(a,ARG_ENTRYID,ramaddaCurrentEntry)),$.ajax({url:a,dataType:"text",success:function(a){let n=Translate.makePack(a);$('.ramadda-dict[lang="'+t+'"]').each((function(){let t=Translate.makePack($(this).text());n=$.extend(n,t)})),Translate.packs[t]=n,e(Translate.packs[t]),Translate.pending[t]&&Translate.pending[t].forEach((e=>{e(Translate.packs[t])})),Translate.pending[t]=null}}).fail((function(){console.log("Failed to load url: "+a),Translate.packs[t]={}}))},makePack:function(t){let e={};return t?(Utils.split(t,"\n",!0,!0).forEach((t=>{if((t=t.replace(/\"/g,"")).startsWith("#"))return;let a=t.indexOf("=");if(a<0)return;let n=t.substring(0,a).trim(),i=t.substring(a+1).trim();"NA"!=i&&(e[n]=i)})),e):e},disable:function(){this.disabled=!0},setLanguage:function(t){this.language=ramaddaLanguage=t},translate:function(t,e){this.disabled||((e=this.language)||(e=this.defaultLanguage),e||("undefined"!==(e=this.language??Utils.getLocalStorage("ramadda-language"))&&"null"!==e||(e=null),e=e??ramaddaLanguage??navigator?.language??navigator?.userLanguage),Utils.stringDefined(e)?(e=(e=e.toLowerCase()).replace(/-.*/,""),this.setLanguage(e),e!=LANGUAGE_ENGLISH?Translate.loadPack(e,(a=>{Translate.translateInner(t,e,a)})):Translate.translateInner(t,e,{},!0)):e=LANGUAGE_ENGLISH)},haveDoneAnyTranslations:!1,phrases:{},definePhrase:function(t,e,a){let n=Translate.phrases[t];n||(n=Translate.phrases[t]={}),n[e]=a},canTranslate:function(t,e,a){return(!Translate.downloadMode||!t.hasClass("display-metadatalist-item"))&&(!t.hasClass("ramadda-notranslate")&&!t.hasClass("ramadda-language-block")&&(!(!e||e.indexOf("<")>=0)&&(!(e.length<=1)&&(!e.match(/.*[0-9].*/)&&(!e.match(/^[0-9]+/)&&!e.match(/ [0-9]+$/))))))},translateInner:function(t,e,a,n){let i,r;if(e=this.language,t?(i=$(t).find("*"),r=$(t).find(".ramadda-language-block")):(i=$("*"),r=$(".ramadda-language-block")),r.each((function(){$(this).attr("data-lang")==e?$(this).show():$(this).hide()})),this.checkSwitcher(),n&&!this.haveDoneAnyTranslations)return;if(this.haveDoneAnyTranslations=!0,!a)return void console.log("no language pack:"+e);let s=Translate.phrases[e];s&&$.extend(a,s);let l=t=>"lang-orig-"+(t??""),o=t=>"lang-current-"+(t??""),d=(t,e,i)=>{if("I"==t.prop("tagName")&&"title"!=i)return null;if(n){let e=t.attr(l(i));return e||null}if(e.indexOf(Utils.MSGCHAR)>=0){let a=Utils.tokenizeMessage(e),n="";return a.forEach((e=>{if("text"==e.type)return void(n+=e.value);let a=d(t,e.value,i);n+=a||e.value})),n}if(e=e.trim(),!Translate.canTranslate(t,e,i))return null;let r=e;return a[e]||(e=e.toLowerCase()),a[e]?"<skip>"==a[e]?null:(t.attr(l(i),r),a[e]):(Translate.missing[r]=!0,t.attr(l(i)))},c={SCRIPT:!0,BR:!0,HTML:!0,STYLE:!0,TEXTAREA:!0,HEAD:!0,META:!0,LINK:!0,BODY:!0},u=[ATTR_PLACEHOLDER,ATTR_TITLE,ATTR_VALUE];i.each((function(){let t,a=$(this),n=a.prop("tagName");if(c[n])return;u.forEach((i=>{if(i==ATTR_VALUE&&("INPUT"!=n||"submit"!=a.attr("type")))return;let r=a.attr(i);if(r){let n=o(i);a.attr(n)!=e&&(a.attr(n,e),t=d(a,a.attr(l(i))??r,i),t&&a.attr(i,t))}}));let i=l(),r=o(),s=a.attr(i)??a.html();Translate.canTranslate(a,s)&&a.attr(r)!=e&&(t=d(a,s),t&&(a.html(t),a.attr(r,e)))}))},showMissing:function(){let t="";t+="#page: "+window.location.pathname+" title:"+document.title+"\n";let e=0;Object.keys(Translate.missing).forEach((a=>{a.length>100||a.match(/^[_\{\}=0-9]+/)||a.match(/ [0-9]+$/)||a.match(/\./)&&!a.match(/\s/)||a.match("©")||a.match(/^Test$/)||a.match(/^:.*/)||a.match(/^-.*/)||a.match(/.*&.*/)||a.match(/.*yyyy.*/i)||a.match(/.*ramadda.*/i)||Utils.isNoMsg(a)||(console.log(a),t+=a+"=\n",e++)})),0!=e?Utils.makeDownloadFile("phrases.txt",t):alert("No missing phrases")}};ramaddaLanguagesEnabled&&$(document).ready((function(){Translate.init()}));var URL_ENTRY_SHOW="/entry/show",URL_ENTRY_GET="/entry/get",URL_SEARCH_DO="/search/do",RamaddaUtils,RamaddaUtil,Ramadda=RamaddaUtils=RamaddaUtil={entryListeners:[],addEntryListener:function(t){this.entryListeners.push(t)},handleEntrySelect:function(t,e){this.entryListeners.forEach((a=>{a(t,e)}))},contents:{},currentRamaddaBase:null,currentSelector:null,captureScreen:function(t){if(!confirm("Do you want to create a thumbnail image of the screen?"))return;let e=RamaddaUtil.getCdnUrl("/lib/html2canvas.min.js");Utils.importJS(e,(()=>{RamaddaUtil.hideEntryPopup();let e=document.body;html2canvas(e,{userCORS:!0,allowTaint:!0}).then((function(e){const a=document.createElement(TAG_CANVAS),n=a.getContext("2d");a.width=e.width+20,a.height=e.height+20,n.drawImage(e,0,0),n.fillStyle="white",n.fillRect(0,0,a.width,a.height),n.strokeStyle="#ccc",n.lineWidth=10,n.strokeRect(0,0,a.width,a.height),n.drawImage(e,10,10);let i=a.toDataURL("image/png"),r=new FormData;r.append("addthumbnail","true"),r.append("filename","screencapture.png"),r.append("file",i),r.append(ARG_ENTRYID,t);let s=RamaddaUtil.getUrl("/entry/addfile");$.ajax({url:s,cache:!1,contentType:!1,processData:!1,method:"POST",type:"POST",data:r,success:t=>{if("ok"!=t.status)return void alert("An error occurred creating entry: "+t.message);let e=t.message+HU.br()+HU.image(t.imageurl,[ATTR_WIDTH,HU.px(600)]);HU.makeDialog({content:e,my:"left top",at:"left top",title:"",anchor:$(TAG_BODY),draggable:!0,header:!0,inPlace:!1,stick:!0})},error:function(t){alert("An error occurred creating entry: "+t)}})}))}))},initToggleTable:function(container){$(container).find(HU.dotClass("entry-arrow")).click((function(){let url=$(this).attr("data-url");if(!url)return;let title=$(this).attr("data-title")??"",handler=request=>{if(null==request.responseXML)return;let xmlDoc=request.responseXML.documentElement,script,html;for(i=0;i<xmlDoc.childNodes.length;i++){let t=xmlDoc.childNodes[i];"javascript"==t.tagName?script=getChildText(t):"content"==t.tagName&&(html=getChildText(t))}if(html||(html=getChildText(xmlDoc)),html){html=HU.div([ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(5),CSS_MAX_HEIGHT,HU.px(300),CSS_OVERFLOW_Y,OVERFLOW_AUTO)],html);let t=HU.makeDialog({content:html,my:"left top",at:"left bottom",title:title,anchor:this,draggable:!0,header:!0,inPlace:!1,stick:!0});Utils.checkTabs(html)}script&&eval(script)};GuiUtils.loadXML(url,handler)}))},handleEntryCreated:function(t,e,a){if(!window.opener)return void console.log("RamaddaUtils.handleEntryCreated: no opener");let n=window.opener.document.getElementById(t),i=window.opener.document.getElementById(t+"_hidden");n&&i?(n.val?n.val(a):n.value=a,i.val?i.val(e):i.value=e,n.title&&setTimeout((()=>{alert("Entry ID has been set for "+n.title)}),1e3)):console.log("RamaddaUtils.handleEntryCreated: could not find entry widget:"+t)},selectInitialClick:function(t,e,a,n,i,r,s,l,o){return RamaddaUtils.currentSelector&&RamaddaUtils.currentSelector.cancel(),RamaddaUtils.currentSelector=RamaddaUtils.selectCreate(t,e,a,n,i,r,s,l,o),!1},selectCreate:function(t,e,a,n,i,r,s,l,o){let d=e+(l??"");return selectors[e]=selectors[d]=new Selector(t,e,a,n,i,r,s,l,o)},clearSelect:function(t){if(selector=selectors[t],selector)selector.clearInput();else{let e=GuiUtils.getDomObject(t),a=GuiUtils.getDomObject(t+"_hidden");a&&(a.obj.value=""),e&&(e.obj.value="")}},viewSelect:function(t){let e=GuiUtils.getDomObject(t+"_hidden");if(e){let t=e.obj.value;if(Utils.stringDefined(t)){let e=RamaddaUtils.getEntryUrl(t);window.open(e,"_blank")}}},selectorRamaddas:{},initEntryPopup:function(t,e,a,n){let i=e=>t+e,r=HU.input("","",[ATTR_ID,i("_input"),ATTR_CLASS,"input",ATTR_PLACEHOLDER,"Search",ATTR_STYLE,HU.css(CSS_WIDTH,HU.px(250))]);r+=SPACE+HU.span([ATTR_CLASS,CLASS_CLICKABLE,ATTR_TITLE,"Submit search",ATTR_ID,i("button")],HU.getIconImage("fas fa-magnifying-glass"));let s=!Utils.stringDefined(a);!s&&n&&(s=!0),s&&(r+=HU.div([ATTR_ID,i("types")]));let l=r+HU.div([ATTR_CLASS,"ramadda-select-search-results",ATTR_ID,t+"_results"]);if(jqid(t).html(l),s){let t=t=>{let e=[],a="",n=[],r={};t.forEach((t=>{t.getCategory()!=a&&(a=t.getCategory());let e=r[a];e||(n.push(a),r[a]=e=[]);let i={value:t.id,label:t.label,corpus:t.getSuperCategory()+" - "+t.getCategory()};e.push(i)})),n.forEach((t=>{e.push({category:t}),e=Utils.mergeLists(e,r[t])})),e.unshift({value:"",label:"Select entry type"});let s=i("types_select"),l=HU.select("",[ATTR_STYLE,HU.css(CSS_MAX_WIDTH,HU.px(250),CSS_MARGIN_TOP,HU.px(4)),ATTR_ID,s],e);l=HU.vspace()+l,jqid(i("types")).html(l),HU.makeSelectTagPopup("#"+s,{after:!0,icon:!0,single:!0,showCategories:!0}),HU.initSelect("#"+s)},e=a??"",n=this.selectorRamaddas[e];n||(n=this.selectorRamaddas[e]=getGlobalRamadda(!0));let r=n.getEntryTypes(((e,a)=>{t(a)}),a);r&&t(r)}let o=jqid(i("_input")),d=()=>{let t=o.val()??"",n=HU.url(RamaddaUtil.getUrl(URL_SEARCH_DO),[ARG_ORDERBY,"createdate",ARG_ASCENDING,"false",ARG_TEXT,t,ARG_OUTPUT,"json"]),r=a;if(s){let t=jqid(i("types_select")).val();Utils.stringDefined(t)&&"any"!=t&&(r=t)}Utils.stringDefined(r)&&(n=HU.url(n,["type",r])),c.html(HU.getIconImage(icon_wait)+" Searching..."),c.show();let l={entryListChanged:function(t){let a=t.getEntries();if(0==a.length)return c.show(),void c.html("Nothing found");let n="";a.forEach(((t,e)=>{let a="Type: "+t.getTypeName()+HU.BR_ENTITY+"Parent: "+t.getParentName();n+=HU.div([ATTR_INDEX,e,ATTR_TITLE,a,ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-entry")],t.getIconImage()+" "+t.getName())})),c.html(n),c.find(HU.dotClass("ramadda-entry")).click((function(){let t=a[$(this).attr(ATTR_INDEX)];t&&RamaddaUtils.selectClick(e,t.getId(),t.getName(),{entry:t,entryName:t.getName(),isImage:t.getIsImage(),thumbnailUrl:t.getThumbnail(),icon:t.getIconUrl(),entryType:t.getType().id,north:t.getNorth(),west:t.getWest(),south:t.getSouth(),east:t.getEast()})})),c.show(400)},handleSearchError:function(t,e){c.html("An error occurred:"+e)}};new EntryList(getGlobalRamadda(),n,l,!1).doSearch()};jqid(i("button")).click(d);let c=jqid(t+"_results");o.keyup((function(t){let e=$(this).val();if(!Utils.isReturnKey(t)&&""==e)return c.hide(),void c.html("");13==(t.keyCode?t.keyCode:t.which)&&d()}))},selectClick:function(t,e,a,n){selector=selectors[t];let i=getHandler(t);if(i||(i=getHandler(selector.elementId)),i)return i.selectClick(selector.selecttype,t,e,a,n),void selector.cancel();if("wikilink"==selector.selecttype){let t={entryId:e,name:a};n&&$.extend(t,n),WikiUtil.insertAtCursor(selector.elementId,selector.textComp.obj,t)}else if("fieldname"==selector.selecttype)WikiUtil.insertAtCursor(selector.elementId,selector.textComp.obj,a);else if("image"==selector.selecttype)WikiUtil.insertAtCursor(selector.elementId,selector.textComp.obj,'{{image entry="'+e+'" caption="'+a+'" width=400px align=center}} ');else if("entryid"==selector.selecttype){let t=WikiUtil.getWikiEditor(selector.elementId);t?t.insertTags(e," ","importtype"):selector.props&&selector.props.callback?selector.props.callback(e,n):WikiUtil.insertText(selector.elementId,e,!0)}else"entry:entryid"==selector.selecttype?WikiUtil.getWikiEditor(selector.elementId).insertTags("entry:"+e," ","importtype"):(selector.getHiddenComponent().val(e),selector.getTextComponent().val(a));selector.cancel()},getBaseUrl:function(){return ramaddaBaseUrl},isRamaddaUrl:function(t){return t.startsWith(ramaddaBaseUrl)},getUrl:function(t,e){return e&&(console.error("RamaddaUtils.getUrl passed extra argument:"+e),console.trace()),RamaddaUtil.getBaseUrl()+t},getCdnUrl:function(t){return ramaddaCdn+t},getEntryUrl:function(t){return HU.url(RamaddaUtil.getUrl(URL_ENTRY_SHOW),ARG_ENTRYID,t)},fileDrops:{},changeField:function(t,e,a,n,i){let r={entryid:t,what:e,value:a,response:"json"},s=RamaddaUtil.getUrl("/entry/changefield");$.post(s,r,(t=>{n&&n(t)})).fail((t=>{try{let e=JSON.parse(t.responseText);if(e.error)return void(i?i(e.error):alert("Error:"+e.error))}catch(t){}i?i(t.responseText):alert("Error:"+t.responseText)}))},doSave:function(t,e,a,n,i){(a=a||{}).entryid=t,a.authtoken=e,a.response="json";let r=RamaddaUtil.getUrl("/entry/change");$.post(r,a,(t=>{n&&n(t)})).fail((t=>{try{let e=JSON.parse(t.responseText);if(e.error)return void(t?t(e.error):alert("Error:"+e.error))}catch(t){}i?i(t.responseText):alert("Error:"+t.responseText)}))},initEntryTable:function(t,e,a){e=e||{};let n={};Utils.isDefined(e.details)&&0==e.details&&(e.simple=!0);let i=e.simple,r=!i,s=null!=e.columns,l={actions:[],showName:!0,showCrumbs:!1,showCreator:s,showHeader:r,showDownload:s,showTime:s,showDate:s||r,showCreateDate:s||r,showChangeDate:s,showSize:s||r,showEntryOrder:s,showType:s||r,showAttachments:!1,showIcon:r,showThumbnails:r,showArrow:r,showForm:r,formOpen:!1,inlineEdit:!1,metadataDisplay:null};$.extend(l,e),this.props=l;let o=a.map(((t,e)=>{let a=new Entry(t);return n[a.getId()]=a,a})),d="",c=[],u=l.columns;u||(u="name,entryorder,creator,date,time,createdate,download,size,type,attachments",l.inlineEdit&&(u+=",editcolumns",l.nameWidth=400));let T=Utils.split(u,",",!0,!0);T.forEach((t=>{"name"==t&&l.showName?c.push({id:"name",label:"Name",width:l.nameWidth}):"date"==t&&l.showDate?c.push({id:"fromdate",label:"Date",width:l.fromDateWidth??l.dateWidth??130}):"editcolumns"==t?c.push({align:ALIGN_LEFT,overflowX:OVERFLOW_AUTO,cansort:!1,id:"editcolumns",label:"Edit Columns",width:300}):"geo"==t?(c.push({id:"latitude",label:"Latitude",width:100}),c.push({id:"longitude",label:"Longitude",width:100}),c.push({id:"altitude",label:"Altitude",width:100})):"altitude"==t?c.push({id:"altitude",label:"Altitude",width:100}):"latlon"==t?(c.push({id:"latitude",label:"Latitude",width:100}),c.push({id:"longitude",label:"Longitude",width:100})):"createdate"==t&&l.showCreateDate?c.push({id:t,label:"Create Date",width:l.createDateWidth??l.dateWidth??130}):"download"==t&&l.showDownload?c.push({id:t,label:"&nbsp;Download&nbsp;",width:100,align:ALIGN_LEFT}):"time"==t&&l.showTime?c.push({id:t,label:"&nbsp;Time&nbsp;",width:100,align:ALIGN_RIGHT}):"creator"==t&&l.showCreator?c.push({id:t,label:"Creator",width:l.creatorWidth??200}):"entryorder"==t&&l.showEntryOrder?c.push({id:t,label:"Order",width:75}):"changedate"==t&&l.showChangeDate?c.push({id:t,label:"Change Date",width:l.changeDateWidth??l.dateWidth??130}):"size"==t&&l.showSize?c.push({id:t,label:"Size",width:l.sizeWidth??80}):"type"==t&&l.showType?c.push({id:t,label:"Type",align:ALIGN_LEFT,paddingLeft:HU.px(10),width:l.typeWidth??100}):"attachments"==t&&l.showAttachments&&c.push({id:t,label:"Attachments",align:ALIGN_LEFT,paddingLeft:HU.px(10),width:l.attachmentsWidth??240})}));let h=l.tableWidth??"100%";if(l.showHeader){d+=HU.open(TAG_TABLE,[ATTR_CELLSPACING,0,ATTR_CELLPADDING,0,ATTR_CLASS,"entry-list-header",ATTR_WIDTH,h]);let e=[ATTR_CLASS,HU.classes("entry-list-header-column","entry-list-header-column-sortable",CLASS_CLICKABLE)],a=[ATTR_CLASS,HU.classes("entry-list-header-column")];c.forEach(((n,i)=>{let r=a;Utils.isDefined(n.cansort)&&!n.cansort||(r=e);let s=n.width;0==i&&l.showForm&&(d+=HU.td([ATTR_STYLE,HU.css(CSS_PADDING_LEFT,HU.px(3),CSS_WIDTH,HU.px(10))],HU.div([ATTR_STYLE,HU.css(CSS_WIDTH,HU.px(15)),ATTR_ID,t+"_formarrow",ATTR_TITLE,"Click to show entry form",ATTR_CLASS,CLASS_CLICKABLE],HU.getIconImage("fas fa-caret-right"))),s-=10),Utils.isDefined(n.width)&&(r=Utils.mergeLists(r,[ATTR_WIDTH,n.width])),r.push(ATTR_STYLE,HU.css(CSS_PADDING_LEFT,n.paddingLeft??HU.px(0))),Utils.isDefined(n.cansort)&&!n.cansort||(r=Utils.mergeLists(r,[ARG_ORDERBY,"download"==n.id?"size":n.id,ATTR_TITLE,"Sort by "+("download"==n.id?"Size":n.label)]));let o=n.label;o=HU.span([ATTR_STYLE,this.props.headerStyle??""],o),(n.id==l.orderby||"size"==l.orderby&&"download"==n.id)&&Utils.isDefined(l.ascending)&&(o=l.ascending?HU.getIconImage("fas fa-arrow-up")+SPACE+HU.span([],o):HU.getIconImage("fas fa-arrow-down")+SPACE+HU.span([],o)),d+=HU.td(r,o)})),d+=HU.close(TAG_TABLE)}else i||(d+=HU.div([ATTR_CLASS,"entry-list-noheader"]));let f,g,p=Utils.getUniqueId(),m=Utils.getUniqueId(),A=i?"entry-list-simple":"entry-list",_=[ATTR_ID,p,ATTR_CLASS,A];if(l.showHeader&&l.tableWidth&&_.push(ATTR_STYLE,HU.css(CSS_WIDTH,l.tableWidth)),d+=HU.open(TAG_DIV,_),l.showForm){f=HU.getUniqueId("form_"),d+=HU.open(TAG_FORM,[ATTR_ID,f,ATTR_METHOD,"post",ATTR_ACTION,RamaddaUtil.getUrl("/entry/getentries")]);let e=HU.checkbox("",[ATTR_STYLE,HU.css(CSS_MARGIN_LEFT,HU.px(3)),ATTR_TITLE,"Toggle all",ATTR_ID,t+"_form_cbx"],!1),a=[["","Apply action"]];l.actions.forEach((t=>{a.push([t.id,t.label])})),e+=SPACE1,e+=HU.select("",[ATTR_NAME,"output",ATTR_ID,t+"_form_action"],a),e+=SPACE1,e+=HU.open(TAG_INPUT,[ATTR_NAME,"getselected",ATTR_TYPE,"submit",ATTR_VALUE,"Selected",ATTR_CLASS,"submit ui-button ui-corner-all ui-widget",ATTR_ID,"getselected1338","role","button"]),e+=SPACE1,e+=HU.open(TAG_INPUT,[ATTR_NAME,"getall",ATTR_TYPE,"submit",ATTR_VALUE,"All",ATTR_CLASS,"submit ui-button ui-corner-all ui-widget",ATTR_ID,"getall1337","role","button"]),g=HU.getUniqueId("find"),e+=HU.span([ATTR_STYLE,HU.css(CSS_MARGIN_LEFT,HU.px(20)),ATTR_ID,g]),d+=HU.div([ATTR_CLASS,HU.classes(A+"-row","entry-list-form-header"),ATTR_ID,t+"_form",ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_NONE,CSS_WIDTH,HU.perc(100))],e)}let S=[ATTR_ID,m];l.maxHeight&&S.push(ATTR_STYLE,HU.css(CSS_MAX_HEIGHT,l.maxHeight,CSS_OVERFLOW_Y,OVERFLOW_AUTO)),d+=HU.open(TAG_DIV,S),d+=HU.close(TAG_DIV,TAG_TABLE,TAG_DIV);let U=jqid(t);U.html(d),g&&HU.initPageSearch(".search-component,.entry-list-row-data",null,"Search table",!1,{target:jqid(g)}),f&&jqid(f).submit((e=>{Utils.stringDefined(jqid(t+"_form_action").val())||(alert("No action specified"),e.preventDefault())})),U.find(HU.dotClass("entry-list-header-column-sortable")).click((function(){let t,e=$(this).attr(ARG_ORDERBY);l.orderby==e?Utils.isDefined(l.ascending)?t=l.ascending?HU.addToDocumentUrl(ARG_ASCENDING,!l.ascending):HU.addToDocumentUrl(ARG_ASCENDING,!0):(t=HU.addToDocumentUrl(ARG_ORDERBY,e),t=HU.addToDocumentUrl(ARG_ASCENDING,!0)):(t=HU.addToDocumentUrl(ARG_ASCENDING,!0),t=HU.addToDocumentUrl(ARG_ORDERBY,e)),window.location=t})),jqid(t+"_form_cbx").click((function(){let e=HU.isChecked($(this));jqid(t).find(HU.dotClass("entry-form-select")).prop("checked",e)}));let R=jqid(t+"_formarrow"),C=()=>{l.formOpen?(jqid(t+"_form").show(),jqid(t).find(HU.dotClass("entry-form-select")).show(),R.html(HU.getIconImage("fas fa-caret-down"))):(jqid(t+"_form").hide(),jqid(t).find(HU.dotClass("entry-form-select")).hide(),R.html(HU.getIconImage("fas fa-caret-right")))};jqid(t+"_formarrow").click((function(){l.formOpen=!l.formOpen,C()})),l.formOpen&&C(),RamaddaUtil.showEntryTable(m,l,c,t,n,(t=>{l.formOpen&&jqid(t).find(HU.dotClass("entry-form-select")).show()}),o)},formatMetadata:function(t,e,a){let n={doBigText:!0,wrapInDiv:!0};a&&(n=$.extend(n,a));let i={};e.forEach((e=>{t.getMetadata().forEach((t=>{if(!e.ok(t))return;let a=i[t.type];a||(a=i[t.type]={display:e,contents:[]});let n=e.format(t).trim(),r=!1;Utils.split(n," ").every((t=>!(t.length>50)||(r=!0,!1))),r&&(n=HU.div([ATTR_STYLE,HU.css(CSS_WORD_BREAK,"break-all")],n)),a.contents.push(n)}))}));let r="";return n.wrapInDiv?Object.keys(i).forEach((t=>{let e=i[t];e.display.delimiter?(r+=HU.open(TAG_DIV,[ATTR_CLASS,"ramadda-metadata-display"]),e.display.header&&(r+=HU.b(e.display.header+":")+" "),r+=Utils.join(e.contents,e.display.delimiter+" "),r+=HU.close(TAG_DIV)):(e.display.header&&(r+=HU.b(e.display.header+":")+" "),e.contents.forEach((t=>{r+=HU.div([ATTR_CLASS,"ramadda-metadata-display"],t)})))})):Object.keys(i).forEach((t=>{let e=i[t];r+=HU.open(TAG_DIV,[ATTR_CLASS,"ramadda-metadata-display"]),e.display.header&&(r+=HU.b(e.display.header+":")+" "),r+=Utils.join(e.contents,"; "),r+=HU.close(TAG_DIV)})),Utils.stringDefined(r)&&n.doBigText&&(r=HU.div([ATTR_CLASS,"ramadda-metadata-bigtext","bigtext-length",100],r)),r},makeMetadataDisplay:function(t){if(!t)return null;let e=[];return Utils.split(t,",",!0,!0).forEach((t=>{let a,n,i,r,s=t.split(":");if(0==s.length)return;let l="{attr1} {attr2}";s.forEach(((t,e)=>{if(0==e)return void(r=t);let s=t.split("=");if(2!=s.length)return;let o=s[0],d=s[1];o.startsWith("attr")?i=t=>t.value[o]==d:"template"==o?l=d:"delimiter"==o?n=d:"header"==o&&(a=d)}));let o={prop:t,type:r,delimiter:n,header:a,template:l.replace("_colon_",":","_comma_",","),check:i,ok:function(t){return t.type==this.type&&(!this.check||this.check(t))},format:function(t){let e=this.template;return["attr1","attr2","attr3","attr4"].forEach((a=>{e=e.replace("{"+a+"}",t.value[a]??"")})),e}};e.push(o)})),e},getToggleIcon:function(t){return t?HU.getIconImage("fas fa-caret-down",null,[ATTR_STYLE,this.props.toggleStyle||""]):HU.getIconImage("fas fa-caret-right",null,[ATTR_STYLE,this.props.toggleStyle||""])},applyInlineEdit:function(t,e){"string"==typeof t&&(t=$(t));let a=(t,e)=>{let a=t.attr(ATTR_ENTRYID);e=e??t.val().trim();let n=t.attr("data-field"),i=HU.url(RamaddaUtil.getUrl("/entry/changefield"),ARG_ENTRYID,a,"what",n,"value",e);if($.getJSON(i,(function(t){t.error&&alert("An error has occurred: "+t.error)})).fail((t=>{console.dir(t),alert("An error occurred:"+t)})),!event.preventDefault)return event.returnValue=!1,!1;event.preventDefault(),t.css(CSS_BACKGROUND,"yellow"),setTimeout((()=>{t.css(CSS_BACKGROUND,COLOR_WHITE)}),4e3)},n=(t,n)=>{let i=!1,r=parseInt(t.val()),s=t.attr(ATTR_ENTRYID);e.each((function(){let t=$(this).attr(ATTR_ENTRYID);if(i)r+=n;else{if(t!=s)return;i=!0}$(this).val(r),a($(this))}))};t.each((function(){let t=$(this).prop("tagName")??"",e=$(this).prop(ATTR_TYPE);t=t.toLowerCase(),"checkbox"==e?$(this).change((function(){a($(this),HU.isChecked($(this)))})):"select"==t?$(this).change((function(){a($(this))})):$(this).keypress((function(t){if(13==t.which){if(t.shiftKey&&"entryorder"==$(this).attr("data-field")){t.preventDefault?t.preventDefault():t.returnValue=!1;let e=prompt("Do you want to reorder all of the following entries. Delta:",5);return e&&n($(this),parseInt(e)),!1}a($(this))}}))}))},showEntryTable:function(t,e,a,n,i,r,s,l){let o=jqid(n),d="",c=e.simple?"entry-list-simple-row":"entry-list-row entry-list-row-data",u=RamaddaUtil.makeMetadataDisplay(this.props.metadataDisplay),T=!1;s.forEach(((t,n)=>{let i="",r=Utils.getUniqueId("row_"),s=Utils.getUniqueId();a.forEach(((n,l)=>{let o=l==a.length-1,d=[ATTR_CLASS,"entry-row"],c=t.getProperty(n.id,{},e.inlineEdit)??"";"number"==typeof c&&isNaN(c)&&(c="NA");let h=c;if(c=HU.span([ATTR_CLASS,this.props.textClass??"",ATTR_STYLE,this.props.textStyle??""],c),"name"==n.id){let a="";if(e.showIcon&&(a=t.getLink(t.getIconImage([ATTR_WIDTH,this.props.iconWidth??ramaddaGlobals.iconWidth]))),e.inlineEdit||(c=t.getLink(c)),e.showIcon&&(c=a+SPACE+c),u&&u.length){let e=RamaddaUtil.formatMetadata(t,u);Utils.stringDefined(e)&&(c+=HU.div([ATTR_STYLE,HU.css(CSS_MAX_WIDTH,HU.perc(100),CSS_OVERFLOW_WRAP,"break-word")],e),T=!0)}let n=[],i=Utils.getUniqueId("entry_");if(e.showForm&&n.push(HU.hidden("allentry",t.getId())+HU.checkbox(i,["rowid",r,ATTR_NAME,"selentry",ATTR_VALUE,t.getId(),ATTR_CLASS,"entry-form-select",ATTR_STYLE,HU.css(CSS_MARGIN_RIGHT,HU.px(2),CSS_DISPLAY,DISPLAY_NONE)],!1)),n.push(HU.div([ATTR_STYLE,HU.css(CSS_MARGIN_RIGHT,HU.px(2),CSS_MIN_WIDTH,HU.px(10)),"innerid",s,ATTR_ENTRYID,t.getId(),ATTR_TITLE,"Click to show contents",ATTR_CLASS,HU.classes("entry-arrow",CLASS_CLICKABLE)],this.getToggleIcon(!1))),e.showCrumbs&&t.breadcrumbs){let e=Utils.getUniqueId();c=HU.span([ATTR_ID,"breadcrumbtoggle_"+e,"breadcrumbid",e,ATTR_TITLE,"Show breadcrumbs",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-breadcrumb-toggle")],HU.getIconImage("fas fa-plus-square"))+SPACE2+HU.span([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_NONE),ATTR_ID,e],t.breadcrumbs+"&nbsp;&raquo;&nbsp;")+c}e.showThumbnails&&t.getThumbnail()&&(c+=HU.br()+HU.div([ATTR_CLASS,"ramadda-thumbnail",ATTR_STYLE,HU.css(CSS_MAX_HEIGHT,HU.px(100),CSS_OVERFLOW_Y,OVERFLOW_AUTO)],HU.image(t.getThumbnail(),[ATTR_LOADING,"lazy",ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"ramadda-thumbnail-image"),ATTR_TITLE,"Click to enlarge",ATTR_STYLE,HU.css(CSS_WIDTH,HU.px(100)),"entry-url",t.getEntryUrl()]))),n.push(c),c=HU.table([],HU.tr([ATTR_VALIGN,ALIGN_TOP],HU.tds([],n)))}else{"attachments"==n.id?(c="",t.getMetadata().forEach((e=>{if("content.thumbnail"==e.type||"content.attachment"==e.type){let a,n=e.value.attr1,i=n.replace(/.*_file_/,""),r=HU.url(RamaddaUtil.getBaseUrl()+"/metadata/view/"+n,["element","1",ATTR_ENTRYID,t.getId(),"metadata_id",e.id]);if("content.thumbnail"==e.type||Utils.isImage(n))a=r,i+=HU.br()+HU.image(a,[ATTR_WIDTH,HU.px(290)]).replace(/"/g,"'");else{n=n.toLowerCase();let t=null;t=n.endsWith("pdf")?"/icons/pdf.png":n.endsWith("txt")?"/icons/txt.png":"/icons/file.png",t&&(a=RamaddaUtil.getBaseUrl()+t)}a&&(c+=HU.href(r,HU.image(a,[ATTR_CLASS,HU.classes("ramadda-attachment",CLASS_CLICKABLE),ATTR_TITLE,i,ATTR_WIDTH,HU.px(75),ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(2))])))}})),""!=c&&(c=HU.div([ATTR_STYLE,HU.css(CSS_MAX_WIDTH,HU.getDimension(n.width),CSS_OVERFLOW_X,OVERFLOW_AUTO)],c))):"type"==n.id&&(c=HU.href(RamaddaUtil.getUrl("/search/type/"+t.getType().id),c,[ATTR_DATA_CORPUS,"type:"+t.getType()+" "+h,ATTR_TITLE,Utils.delimMsg("Search for entries of type")+" "+h]));let e=n.width-20;e=n.width,c=HU.div([ATTR_STYLE,HU.css(CSS_PADDING_LEFT,n.paddingLeft??HU.px(5),CSS_WHITE_SPACE,WHITE_SPACE_NOWRAP,CSS_WIDTH,HU.getDimension(n.width),CSS_TEXT_ALIGN,n.align??ALIGN_RIGHT,CSS_MAX_WIDTH,HU.getDimension(e),CSS_OVERFLOW_X,n.overflowX??OVERFLOW_HIDDEN)+(o?HU.css(CSS_PADDING_LEFT,HU.px(4)):"")],c),d.push(ATTR_ALIGN,n.align??ALIGN_RIGHT)}Utils.isDefined(n.width)&&d.push(ATTR_WIDTH,HU.getDimension(n.width)),i+=HU.td(d,c)}));let l=HU.open(TAG_DIV,[ATTR_ENTRYID,t.getId(),ATTR_ID,r]);l+=HU.open(TAG_DIV,[ATTR_ENTRYID,t.getId(),ATTR_ID,r,ATTR_CLASS,c]),l+=HU.open(TAG_TABLE,[ATTR_CELLSPACING,0,ATTR_CELLPADDING,"border",ATTR_WIDTH,"100%",ATTR_CLASS,"entry-row-table",ATTR_ENTRYID,t.getId()]);let o="",h=[ATTR_CLASS,"entry-row",ATTR_VALIGN,ALIGN_TOP];if(!e.simple){t.getIconImage([ATTR_WIDTH,HU.px(32)]).replace(/"/g,"'");o=t.getName(),t.remoteRepository&&h.push("remote-repository",t.remoteRepository.name);let e=t.getType();e&&h.push(ATTR_DATA_TYPE,e.name);let a=t.getThumbnail();a&&h.push("data-thumbnail",a);let n=t.getFilename();n&&h.push("data-filename",n),h.push(ATTR_TITLE,o,"data-icon",t.getIconUrl())}l+=HU.open(TAG_TR,h),l+=i,l+=HU.close(TAG_TR,TAG_TABLE,TAG_DIV),l+=HU.div([ATTR_ID,s,ATTR_STYLE,HU.css(CSS_MARGIN_LEFT,HU.px(20))]),l+=HU.close(TAG_DIV),d+=l})),d+=HU.close(TAG_DIV);let h=jqid(t);!l&&e.tableWidth&&h.css(ATTR_WIDTH,e.tableWidth),d=$(d).appendTo(h),Translate.translate(d),T&&d.find(HU.dotClass("ramadda-metadata-bigtext")).each((function(){Utils.initBigText($(this))}));let f=o.find(HU.dotClass("ramadda-entry-inlineedit")),g=o.find(HU.dotClass("ramadda-entry-inlineedit-entryorder"));this.applyInlineEdit(f,g),d.find(HU.dotClass("entry-row")).tooltip({show:{effect:"slideDown",delay:1500,duration:300},position:{my:"right top",at:"right bottom"},content:function(){if($(this).hasClass("ramadda-edit-input"))return null;let t=$(this).attr(ATTR_TITLE),e=$(this).attr("data-icon"),a=$(this).attr("data-thumbnail");e&&(e=HU.image(e,[ATTR_WIDTH,HU.px(32)]),t=e+HU.space(1)+t),t=HU.div([],HU.b(t));let n=$(this).val();n&&(t+=HU.div([],n));let i=$(this).attr(ATTR_DATA_TYPE);i&&(t=t+"Type: "+i+HU.br());let r=$(this).attr("data-filename");r&&(t=t+"File: "+r+HU.br());let s=$(this).attr("remote-repository");return s&&(t=t+"Remote: "+s+HU.br()),t=t+HU.div([],"Right-click to see entry menu")+HU.div([],"Shift-drag to copy/move"),a&&(a=HU.image(a,[ATTR_WIDTH,HU.px(250)]),t+=HU.div([ATTR_STYLE,HU.css(CSS_MAX_HEIGHT,HU.px(200),CSS_OVERFLOW_Y,OVERFLOW_HIDDEN)],a)),HU.div([ATTR_STYLE,HU.css(CSS_MARGIN,HU.px(5))],t)}}),h.find(HU.dotClass("ramadda-breadcrumb-toggle")).click((function(){let t=$(this).attr("breadcrumbid"),e=jqid(t);e.css(CSS_DISPLAY)==DISPLAY_NONE?(jqid("breadcrumbtoggle_"+t).html(HU.getIconImage("fas fa-minus-square")),e.css(CSS_DISPLAY,DISPLAY_INLINE)):(jqid("breadcrumbtoggle_"+t).html(HU.getIconImage("fas fa-plus-square")),e.css(CSS_DISPLAY,DISPLAY_NONE))}));let p=this;if(h.find(HU.dotClass("entry-arrow")).click((function(){let t=$(this).attr(ATTR_ENTRYID),s=$(this).attr("innerid"),l=jqid(s),o=$(this).attr("filled"),d=$(this).attr("open");if($(this).html(p.getToggleIcon(!d)),o)return void(d?(l.hide(),$(this).attr("open",!1)):(l.show(),$(this).attr("open",!0)));let c=i[t];$(this).attr("filled",!0),$(this).attr("open",!0);let u=HU.url(RamaddaUtil.getUrl(URL_ENTRY_SHOW),ARG_OUTPUT,"json","includeproperties","false","includedescription","false","includeservices","false","children","true",ARG_ENTRYID,t);e.sortby&&(u=HU.url(u,[ARG_ORDERBY,e.sortby])),e.orderby&&(u=HU.url(u,[ARG_ORDERBY,e.orderby])),e.ascending&&(u=HU.url(u,[ARG_ASCENDING,e.ascending])),e.sortdir&&(u=HU.url(u,[ARG_ASCENDING,"up"==e.sortdir])),$.getJSON(u,(function(t,l,o){if(GuiUtils.isJsonError(t))return;let d=t.map(((t,e)=>{let a=new Entry(t);return i[a.getId()]=a,a}));if(d.length>0)RamaddaUtil.showEntryTable(s,e,a,n,i,r,d,!0);else{let t=HU.open(TAG_TABLE,[ATTR_CLASS,"formtable"]);if(c.getIsUrl())t+=HU.formEntry("URL:",HU.href(c.getResourceUrl(),c.getResourceUrl()));else if(c.getIsFile()){let e=c.getResourceUrl();t+=HU.formEntry("File:",HU.href(e,c.getFilename())+"  ("+c.getFormattedFilesize()+") "+HU.href(e,HU.getIconImage("fas fa-download")))}t+=HU.formEntry(Utils.delimMsg("Kind"),HU.href(RamaddaUtil.getUrl("/search/type/"+c.getType().id),c.typeName,[ATTR_TITLE,Utils.delimMsg("Search for entries of type")+" "+c.typeName]));let e=HU.url(RamaddaUtil.getUrl("/search/type/"+c.getType().id),"user_id",c.creator,"search.submit",!0),a=HU.href(e,c.creator,[ATTR_TITLE,Utils.delimMsg("Search for entries of this type created by")+" "+c.creator]);t+=HU.formEntry(Utils.msgLabel("Created by"),a),t+=HU.formEntry(Utils.msgLabel("Created"),c.createDateFormat),c.startDate&&c.startDate.getTime()!=c.createDate.getTime()&&(t+=HU.formEntry(Utils.msgLabel("Date"),c.startDateFormat)),c.startDate&&c.endDate&&c.startDate.getTime()!=c.endDate.getTime()&&(t+=HU.formEntry(Utils.msgLabel("To Date"),c.endDateFormat)),t+=HU.close(TAG_TABLE),HU.jqid(s).html(t)}HU.handleNewContent(jqid(s))}))})),e.simple)return;h.find(HU.dotClass("entry-form-select")).click((function(t){HU.isChecked($(this)),jqid($(this).attr("rowid"));HU.checkboxClicked(t,"entry_",$(this).attr(ATTR_ID)),o.find(HU.dotClass("entry-form-select")).each((function(){let t=HU.isChecked($(this)),e=jqid($(this).attr("rowid"));t?e.addClass("entry-list-row-selected"):e.removeClass("entry-list-row-selected")}))})),h.find(HU.dotClass("ramadda-thumbnail-image")).click((function(){let t=$(this).attr(ATTR_SRC),e=$(this).attr("entry-url"),a=HU.href(e,HU.image(t),[ATTR_TITLE,"Click to view entry"]);HU.makeDialog({content:a,my:"left top",at:"left bottom",anchor:this,header:!0,draggable:!0})})),h.find(HU.dotClass("ramadda-attachment")).tooltip({show:{effect:"slideDown",delay:500,duration:1e3},content:function(){return $(this).prop(ATTR_TITLE)}});let m=h.find(".entry-list-row");m.bind("contextmenu",(function(t){let e=$(this),a=i[$(this).attr(ATTR_ENTRYID)];if(!a)return;eventX=GuiUtils.getEventX(t);let n=HU.url(RamaddaUtil.getUrl(URL_ENTRY_SHOW),ARG_ENTRYID,a.getId(),ARG_OUTPUT,"metadataxml");if(GuiUtils.loadXML(n,(function(t){let n=t.responseXML.documentElement;text=getChildText(n),HU.makeDialog({content:text,my:"left top",at:"left bottom",title:a.getIconImage()+" "+a.getName(),anchor:e,header:!0})}),this),!t.preventDefault)return t.returnValue=!1,!1;t.preventDefault()})),RamaddaUtil.initDragAndDropEntries(m,i,n),r(t)},initDragAndDropOnHeader:function(t,e){let a=(t,e,a,n)=>{HU.makeOkCancelDialog($(".ramadda-header"),"New entry has been created: "+a+HU.div([],"Do you want to view it?"),(()=>{let t=HU.url(RamaddaUtil.getUrl(URL_ENTRY_SHOW),ARG_ENTRYID,e);document.location=t}),null,null,{okLabel:"Yes",cancelLabel:"No",at:"middle bottom",my:"middle top",title:"New Entry",header:!0})};Utils.initDragAndDrop($(".ramadda-header"),(t=>{}),(t=>{}),((n,i,r,s)=>{Ramadda.handleDropEvent(n,i,r,t,e,a)}),null,!0,!0)},initDragAndDropEntries:function(t,e,a){function n(t){return t.hasClass("ramadda-entry-target")}t.mousedown((function(t){if(!t.shiftKey||!e)return;let n=e[$(this).attr(ATTR_ENTRYID)];if(!n)return;let i=$(this),r=[n];if(jqid(a).find(".entry-list-row-selected").each((function(){let t=e[$(this).attr(ATTR_ENTRYID)];t&&t.getId()!=n.getId()&&r.push(t)})),Utils.entryDragInfo={dragSource:i.attr(ATTR_ID),entry:n,getIds:function(){return r.map((t=>t.getId())).join(",")},hasEntry:function(t){return r.includes(t)},getHtml:function(){let t="";return r.forEach((e=>{""!=t&&(t+=HU.br()),t+=e.getIconImage()+SPACE+e.getName()})),t}},n){if(Utils.mouseIsDown=!0,!t.preventDefault)return t.returnValue=!1,!1;t.preventDefault()}})),t.mouseover((function(t){let a="#C6E2FF";if(n($(this)))return void(Utils.mouseIsDown&&Utils.entryDragInfo&&$(this).css("background",a));let i=e[$(this).attr(ATTR_ENTRYID)];if(i&&Utils.mouseIsDown&&Utils.entryDragInfo){if(Utils.entryDragInfo.hasEntry(i))return;$(this).css("background",a)}})),t.mouseout((function(t){if(Utils.entryDragInfo){if(n($(this)))return void $(this).css("background","");let t=e[$(this).attr(ATTR_ENTRYID)];if(Utils.entryDragInfo.entry==t)return;$(this).css("background","")}})),t.mouseup((function(t){if(!Utils.entryDragInfo)return;if($(this).css("background",""),n($(this))){let t=HU.url(RamaddaUtil.getUrl("/entry/getentries"),ARG_OUTPUT,$(this).attr("target-type"));return Utils.entryDragInfo.getIds().split(",").forEach((e=>{t+="&selentry="+e})),void(document.location=t)}let a=e[$(this).attr(ATTR_ENTRYID)];a&&(Utils.entryDragInfo.hasEntry(a)||Utils.entryDragInfo.hasEntry(a)||(url=HU.url(RamaddaUtil.getUrl("/entry/copy"),"action","action.move","from",Utils.entryDragInfo.getIds(),"to",a.getId()),document.location=url))}))},initFormTags:function(t){let e=jqid(t),a=e.find(".metadata-tag-input");e.attr("autocomplete","off"),a.attr("autocomplete","off"),a.keyup((function(t){HU.hidePopupObject();let e=$(this).val();if(!Utils.stringDefined(e))return;let a=HU.url(RamaddaUtil.getUrl("/metadata/suggest"),ATTR_VALUE,e.trim()),n=$(this);$.getJSON(a,(t=>{if(0==t.length)return;let e="";t.forEach((t=>{e+=HU.div([ATTR_CLASS,HU.classes(CLASS_CLICKABLE,"metadata-suggest"),"suggest",t],t)}));let a=HU.div([ATTR_CLASS,"ramadda-search-popup",ATTR_STYLE,HU.css(CSS_MAX_WIDTH,HU.px(200),CSS_PADDING,HU.px(4))],e);HU.makeDialog({content:a,my:"left top",at:"left bottom",anchor:n}).find(".metadata-suggest").click((function(){HU.hidePopupObject(),n.val($(this).attr("suggest"))}))})).fail((t=>{console.log("url failed:"+a+"\n"+t)}))}));let n=jqid(t).find(".metadata-tag");n.attr(ATTR_TITLE,"Click to remove"),n.click((function(){let t=e.find("#"+$(this).attr("metadata-id"));$(this).hasClass("metadata-tag-deleted")?($(this).removeClass("metadata-tag-deleted"),t.val("")):($(this).addClass("metadata-tag-deleted"),t.val("delete"))}))},initFormUpload:function(t,e,a,n){t||(t="upload");let i=jqid(e);n&&i.attr("multiple","");let r=i.closest("form"),s=HU.div([ATTR_TITLE,"Click to select a file",ATTR_ID,e+"_filewrapper",ATTR_CLASS,"fileinput_wrapper"],HU.getIconImage("fas fa-upload")+SPACE+HU.div([ATTR_ID,e+"_filename",ATTR_CLASS,"fileinput_label"]));i.after(s),i.hide();let l=jqid(e+"_filewrapper");jqid(e+"_filename");l.click((()=>{i.trigger("click")}));let o=()=>{let t=t=>{let e=t.lastIndexOf("\\");return e<0&&(e=t.lastIndexOf("/")),e>=0&&(t=t.substring(e+1)),t},a="";if(i[0].files){let e=[];for(let a=0;a<i[0].files.length;a++){let n=i[0].files[a];e.push(t(n.name)+" ("+Utils.formatFileLength(n.size)+")")}a=Utils.join(e,",")}else a=t(i.val());""==a&&(a=HU.span([ATTR_CLASS,"fileinput_label_empty"],"Click to select a file")),jqid(e+"_filename").html(a)};if(i.bind("change",o),o(),Utils.stringDefined(a)){let n=jqid(a),i={files:{},cnt:0,added:!1};n.append(HU.div([ATTR_CLASS,"ramadda-dnd-target-files",ATTR_ID,e+"_dnd_files"]));let s=jqid(e+"_dnd_files");Utils.initDragAndDrop(n,(t=>{}),(t=>{}),((a,n,l,o)=>{i.cnt++;let d=n.name;if(!d&&n.getAsFile&&(d=n.getAsFile().name),!d){let t=n.type&&n.type.match("image/.*");if(d=prompt("Entry file name:",t?"image":"file"),!d)return;if(n.type)if("text/plain"==n.type)d.endsWith(".txt")||(d+=".txt");else{d=d+"."+n.type.replace(/.*\//,"")}}let c=e+"_list"+i.cnt,u=e+"_file"+i.cnt,T=e+"_file_name"+i.cnt,h=t+"_file_"+i.cnt,f=t+"_name_"+i.cnt;i.files[u]=l;let g=HU.span([ATTR_CLASS,CLASS_CLICKABLE,ID,c+"_trash"],HU.getIconImage(icon_trash)),p=Utils.isDefined(n.size)?Utils.formatFileLength(n.size):"";s.append(HU.div([ATTR_ID,c],g+" "+d+" "+p)),r.append(HU.tag(TAG_INPUT,[ATTR_TYPE,"hidden",ATTR_NAME,h,ATTR_ID,u])),r.append(HU.tag(TAG_INPUT,[ATTR_TYPE,"hidden",ATTR_NAME,f,ATTR_ID,T])),jqid(u).val(l),jqid(T).val(d),jqid(c+"_trash").click((function(){jqid(c).remove(),jqid(u).remove(),jqid(T).remove()}))}),null,!0)}},handleDropEvent:function(t,e,a,n,i,r){let s,l=e.type.match("^image.*"),o=RamaddaUtil.getUrl("/entry/addfile"),d=e.name??"file",c=e.name;s="text/plain"==e.type?"txt":e.type.replace(/image\//,""),c||(c=d+"."+s);d=Utils.makeLabel(d.replace(/.[^\.]*$/,"")),d=e.name?prompt("Dropped file: "+c+"\nNew entry name:",d):prompt("Copied file: "+s+"\nNew entry name:",d),d&&(()=>{e.name||(c=Utils.makeId(d)+"."+s);let t,u=new FormData;u.append("filename",c),i&&u.append(ARG_AUTHTOKEN,i),"application/zip"==e.type?u.append("filetype","geo_shapefile"):"application/json"==e.type?u.append("filetype","geo_geojson"):u.append("filetype",e.type),u.append(ARG_NAME,d),u.append("group",n),u.append("description",""),u.append(ARG_FILE,a),$.ajax({url:o,cache:!1,contentType:!1,processData:!1,method:"POST",type:"POST",data:u,success:e=>{t.remove(),"ok"==e.status?r&&r(e,e.entryid,e.name,l):alert("An error occurred creating entry: "+e.message)},error:function(e){t.remove(),alert("An error occurred creating entry: "+e)}});let T=HU.div([ATTR_STYLE,HU.css(CSS_TEXT_ALIGN,ALIGN_CENTER,CSS_PADDING,HU.px(5))],HU.div([],"Creating entry")+HU.image(RamaddaUtil.getCdnUrl("/icons/mapprogress.gif"),[ATTR_WIDTH,HU.px(50)]));t=HU.makeDialog({content:T,anchor:$(document),my:"center top",at:"center top+100"})})()},inherit:function(t,e){return $.extend(t,e),e.getThis=function(){return t},t.getThis=function(){return t},t.mysuper=e,t},initMembers:function(t,e){return $.extend(t,e),t},defineMembers:function(t,e){return $.extend(t,e),t},showEntryPopup:function(t,e,a,n){let i=RamaddaUtils.contents[e];if(i)RamaddaUtils.showEntryPopupInner(t,e,a,i);else{let i=HU.url(RamaddaUtil.getUrl("/entry/menu"),ARG_ENTRYID,e);$.ajax({url:i,dataType:"text",success:function(i){RamaddaUtils.contents[e]=i,RamaddaUtils.showEntryPopupInner(t,e,a,i,n)}}).fail(((t,e,a)=>{console.log("/entry/menu failed:"+a),alert("Failed to contact the server")}))}},showEntryPopupInner:function(t,e,a,n,i){let r=jqid(t);this.entryPopup=HU.makeDialog({content:n,my:"left top",at:"left bottom",title:a,rightSideTitle:i,anchor:r,draggable:!0,header:!0,inPlace:!1,headerRight:null})},initEntryListForm:function(t){let e=Utils.entryGroups[t];e&&(e.on=0,e.setVisbility())},hideEntryPopup:function(){this.entryPopup&&(this.entryPopup.remove(),this.entryPopup=null),HU.getTooltip().hide()},originalImages:new Array,changeImages:new Array,folderClick:function(t,e,a){RamaddaUtil.changeImages[t]=a;let n=jqid(t);if(0==n.length)return;let i=jqid("img_"+t);n.css(CSS_DISPLAY)!=DISPLAY_NONE?(a&&i.html(HU.getIconImage("fa-caret-right")),n.hide()):(RamaddaUtil.originalImages[t]=i.html(),n.show(),i.html(HU.getIconImage("fa-caret-down")),(e+="&orderby=entryorder&ascending=true").startsWith("/")&&RamaddaUtil.currentRamaddaBase&&(e=RamaddaUtil.currentRamaddaBase+e),GuiUtils.loadXML(e,RamaddaUtil.handleFolderList,t))},handleFolderList:function(request,uid){if(null!=request.responseXML){let xmlDoc=request.responseXML.documentElement,script,html;for(i=0;i<xmlDoc.childNodes.length;i++){let t=xmlDoc.childNodes[i];"javascript"==t.tagName?script=getChildText(t):"content"==t.tagName&&(html=getChildText(t))}html||(html=getChildText(xmlDoc)),html&&(jqid(uid).html(HU.div([],html)),Utils.checkTabs(html)),script&&eval(script)}RamaddaUtil.changeImages[uid]?jqid("img_"+uid).attr("src",icon_folderopen):jqid("img_"+uid).attr("src",RamaddaUtil.originalImages[uid])},Components:{init:function(t){let e=jqid(t),a=jqid(t+"_header"),n=!1,i=!1,r=e.find(".ramadda-component"),s={},l={},o={};r.each((function(){let t=$(this).attr("component-date");if(!t)return;let e,a=Utils.parseDate(t);$(this).attr("component-day",e=Utils.formatDateWithFormat(a,"mmmm d yyyy")),o[e]=!0,$(this).attr("component-month",e=Utils.formatDateWithFormat(a,"mmmm yyyy")),l[e]=!0,$(this).attr("component-year",e=Utils.formatDateWithFormat(a,"yyyy")),s[e]=!0,$(this).attr("component-latitude")&&(i=!0),Utils.stringDefined($(this).attr("component-tags"))&&(n=!0)})),a.css(CSS_TEXT_ALIGN,ALIGN_CENTER);let d=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,HU.classes(CLASS_BUTTON_BAR,"ramadda-button-on")),ATTR_LAYOUT,"grid"],"Grid");Object.keys(s).length>1&&(d+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_BUTTON_BAR),ATTR_LAYOUT,"year"],"Year")),Object.keys(l).length>1&&(d+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_BUTTON_BAR),ATTR_LAYOUT,"month"],"Month")),Object.keys(o).length>1&&(d+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_BUTTON_BAR),ATTR_LAYOUT,"day"],"Day")),d+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_BUTTON_BAR),ATTR_LAYOUT,ATTR_TITLE],"Title"),n&&(d+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_BUTTON_BAR),ATTR_LAYOUT,"tags"],"Tag")),d+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_BUTTON_BAR),ATTR_LAYOUT,"author"],"Author"),i&&(d+=HU.div([ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_INLINE_BLOCK),ATTR_CLASS,HU.classes(CLASS_BUTTON,CLASS_BUTTON_BAR),ATTR_LAYOUT,"map"],"Map")),a.append(HU.div([],d));let c=a.find(HU.dotClass(CLASS_BUTTON));c.click((function(){c.removeClass("ramadda-button-on"),$(this).addClass("ramadda-button-on");let t=$(this).attr(ATTR_LAYOUT);"grid"==t?RamaddaUtil.Components.layout(e,r,null):RamaddaUtil.Components.layout(e,r,"component-"+t)}))},layout:function(t,e,a){if(t.find(".ramadda-group").each((function(){$(this).detach()})),t.mapId&&jqid(t.mapId).detach(),t.ramaddaMap&&(ramaddaMapRemove(t.ramaddaMap),t.ramaddaMap=null),null==a)return e.show(),void e.each((function(){$(this).detach(),t.append($(this))}));if("component-map"==a){e.hide();let a=Utils.getUniqueId();t.mapId=a,t.append(HU.div([ATTR_ID,a,STYLE,HU.css(CSS_WIDTH,HU.perc(100),CSS_HEIGHT,HU.px(400))]));let n=new RepositoryMap(a,{});t.ramaddaMap=n,n.initMap(!1),e.each((function(){let t=$(this).attr("component-url"),e=+$(this).attr("component-latitude"),a=+$(this).attr("component-longitude");if(!Utils.isNumber(e))return;let i=$(this).attr("component-image"),r=HU.center(HU.b($(this).attr("component-title")));i&&(r+=HU.image(i,[ATTR_WIDTH,HU.px(300)])),t&&(r=HU.href(t,r));let s=new MapUtils.createLonLat(a,e);n.addPoint("",s,{pointRadius:6,strokeWidth:1,strokeColor:COLOR_BLACK,fillColor:"blue"},r)})),n.centerOnMarkers()}else{e.show();let n="component-day"==a||"component-month"==a||"component-year"==a,i=[],r={};e.each((function(){let t=$(this).attr(a)||"";if("component-tags"==a){let e=t.split(",");t=e[0]}if(!r[t]){r[t]=[];if(n){let e=$(this).attr("component-date"),a=e?Utils.parseDate(e):null;i.push([t,a])}else i.push(t)}r[t].push($(this))})),i=n?i.sort(((t,e)=>(t=t[1],e=e[1],t&&e?t?e?e.getTime()-t.getTime():-1:1:0))):i.sort(),i.forEach((e=>{n&&(e=e[0]);let a=t.append($(HU.div([ATTR_CLASS,"ramadda-group"],HU.div([ATTR_CLASS,"ramadda-group-header"],e))));r[e].forEach((t=>{a.append(t)}))}))}}}};function EntryRow(t,e,a,n,i,r){r||(r={showIcon:!0}),this.args=r,r.entryId=t,Utils.globalEntryRows[t]=this,Utils.globalEntryRows[e]=this,Utils.globalEntryRows[a]=this,this.entryId=t,this.showIcon=r.showIcon,this.onColor="#FFFFCC",this.overColor="#f4f4f4",this.rowId=e,this.cbxId=a,this.cbxWrapperId=n,this.showDetails=i,this.getRow=function(){return jqid(this.rowId)},this.getCbx=function(){return jqid(this.cbxId)};let s=this.getCbx().closest("form");if(s.length){let t=Utils.entryGroups[s.attr(ATTR_ID)];t&&t.addEntryRow(this)}else this.getCbx().hide();this.setCheckbox=function(t){this.getCbx().prop("checked",t),this.setRowColor()},this.isSelected=function(){return HU.isChecked(this.getCbx())},this.setRowColor=function(){this.getRow().removeClass("entry-row-hover"),this.isSelected()?this.getRow().addClass("entry-list-row-selected"):this.getRow().removeClass("entry-list-row-selected")},this.mouseOver=function(t){jqid("entrymenuarrow_"+e).attr("src",icon_menuarrow),this.getRow().addClass("entry-row-hover")},this.mouseOut=function(t){jqid("entrymenuarrow_"+e).attr("src",icon_blank),this.setRowColor()},this.mouseClick=function(e){eventX=GuiUtils.getEventX(e);let a=this.getRow().offset();if(eventX-a.left<150)return;this.lastClick=eventX;let n=HU.url(RamaddaUtil.getUrl(URL_ENTRY_SHOW),ARG_ENTRYID,t,ARG_OUTPUT,"metadataxml");this.showDetails?n+="&details=true":n+="&details=false",this.showIcon?n+="&showIcon=true":n+="&showIcon=false",GuiUtils.loadXML(n,this.handleTooltip,this)},this.handleTooltip=function(t,e){let a=t.responseXML.documentElement;text=getChildText(a);let n=e.getRow().offset().left,i=(e.lastClick,HU.jsLink("",HU.getIconImage(ICON_CLOSE),[ATTR_ONMOUSEDOWN,"RamaddaUtil.hideEntryPopup();",ATTR_ID,"tooltipclose"])),r=HU.image(e.args.icon)+SPACE+e.args.name,s=HU.div([ATTR_CLASS,"ramadda-popup-header"],i+SPACE2+r),l=HU.div([ATTR_CLASS,CLASS_POPUP,ATTR_STYLE,HU.css(CSS_DISPLAY,DISPLAY_BLOCK)],s+HU.table([],text)),o=HU.getTooltip();o.html(l),o.draggable(),Utils.checkTabs(text);let d=e.getRow().offset(),c=(e.getRow().outerWidth(),e.getRow().outerHeight()),u=HU.getTooltip().outerWidth(),T=$(window).width(),h=e.lastClick;e.lastClick+u>T&&(h-=e.lastClick+u-T);let f=HU.px(h),g=HU.px(3+d.top+c);o.css({position:POSITION_ABSOLUTE,zIndex:5e3,left:f,top:g}),o.show()}}var selectors=new Array;function Selector(t,e,a,n,i,r,s,l,o){let d=this;this.id=e,this.elementId=a,this.domId=HU.getUniqueId("selector_"),this.props=o||{},this.localeId=r,this.entryType=s,this.allEntries=n,this.selecttype=i,this.textComp=GuiUtils.getDomObject(this.elementId),this.ramaddaUrl=l??ramaddaBaseUrl,this.getTextComponent=function(){let t="#"+this.elementId;return $(t)},this.getHiddenComponent=function(){let t="#"+this.elementId+"_hidden";return $(t)},this.cancel=function(t){!t&&this.pinned||jqid(this.domId).remove()},this.clearInput=function(){this.getHiddenComponent().val(""),this.getTextComponent().val("")},this.handleClick=function(t){let e=this.props.anchor;if(!e){if(this.props.eventSourceId&&(e=jqid(this.props.eventSourceId)),null!=e&&0!=e.length||t&&t.target&&(e=$(t.target)),null==e||0==e.length){e=jqid(this.id+"_selectlink")}null!=e&&0!=e.length||(e=jqid(this.id))}HU.hidePopupObject(t);let a=$(HU.div([ATTR_STYLE,HU.css(CSS_POSITION,POSITION_RELATIVE)])).appendTo(TAG_BODY);$(HU.div([ATTR_STYLE,HU.css(CSS_MIN_WIDTH,HU.px(200),CSS_MIN_HEIGHT,HU.px(200)),ATTR_CLASS,"ramadda-selectdiv",ATTR_ID,this.domId])).appendTo(a),this.div=jqid(this.domId),this.props.minWidth&&this.div.css("min-width",this.props.minWidth),this.div.draggable(),this.anchor=e,this.showDiv=()=>{this.div.show(),this.div.position({of:this.anchor,my:this.props.locationMy??"left top",at:this.props.locationAt??"left bottom",collision:this.props.collision??"fit fit"})};let n=HU.url(URL_ENTRY_SHOW,ARG_OUTPUT,"selectxml","noredirect","true","firstclick",!0);if(this.selecttype&&(n=HU.url(n,["selecttype",this.selecttype])),n=HU.url(n,"allentries",this.allEntries,"target",this.id),this.ramaddaUrl&&!this.ramaddaUrl.startsWith("/")){let t=new URL(this.ramaddaUrl).pathname,e=this.ramaddaUrl.replace(t,"");RamaddaUtil.currentRamaddaBase=e,n=this.ramaddaUrl+n}else RamaddaUtil.currentRamaddaBase=null,n=RamaddaUtil.getUrl(n);return this.localeId&&(n=HU.url(n,"localeid",this.localeId)),this.entryType&&(n=HU.url(n,"entrytype",this.entryType)),this.props.typeLabel&&(n=HU.url(n,"typelabel",this.props.typeLabel)),Utils.isDefined(this.props.showTypeSelector)&&(n=HU.url(n,"showtypeselector",this.props.showTypeSelector)),GuiUtils.loadXML(n,((t,e)=>{d.handleSelect(t,e)}),this.id),!1},this.handleClick(t)}function getChildText(t){let e="";for(childIdx=0;childIdx<t.childNodes.length;childIdx++)e+=t.childNodes[childIdx].nodeValue;return e}function toggleBlockVisibility(t,e,a,n,i){HU.toggleBlockVisibility(t,e,a,n,null,i)}function toggleInlineVisibility(t,e,a,n){let i,r=GuiUtils.getDomObject(e);toggleVisibility(t,DISPLAY_INLINE),i=jqid(t).is(":visible")?a:n,StringUtil.startsWith(i,"fa-")?jqid(e).attr(ATTR_CLASS,i):r&&(r.obj.src=i),Utils.ramaddaUpdateMaps()}function toggleVisibility(t,e,a,n){let i=jqid(t).css(CSS_DISPLAY);return Utils.isDefined(n)?(n?jqid(t).show():jqid(t).hide(),n):(jqid(t).toggle(a),i!=DISPLAY_BLOCK)}function hide(t){jqid(t).hide()}function hideObject(t){return t?(jqid(t.id).hide(),1):0}function showObject(t,e){if(!t)return 0;jqid(t.id).show()}function toggleVisibilityOnObject(t,e){if(!t)return 0;jqid(t.id).toggle()}Selector.prototype={handleSelect:function(t,e){let a=this,n=t.responseXML.documentElement;text=getChildText(n);let i=this.domId+"-pin",r=HU.jsLink("",HU.getIconImage(icon_pin),[ATTR_CLASS,"ramadda-popup-pin",ATTR_ID,i]),s=HU.getIconImage(ICON_CLOSE,[]),l=e+"_close",o=HU.span([ATTR_ID,l,ATTR_CLASS,CLASS_CLICKABLE],s),d=(this.props?this.props.title:"")??"",c=(this.props?this.props.extra:"")??"";Utils.stringDefined(d)&&(d=HU.span([ATTR_STYLE,HU.css(CSS_MARGIN_LEFT,HU.px(5))],d));let u=HU.div([ATTR_STYLE,HU.css(CSS_TEXT_ALIGN,ALIGN_LEFT),ATTR_CLASS,"ramadda-popup-header"],SPACE+o+SPACE+r+d),T=HU.div([ATTR_ID,e+"-popup"],u+c+text);this.div.html(T),this.showDiv(),jqid(l).click((()=>{this.cancel(!0)})),jqid(i).click((function(){a.pinned=!a.pinned,a.pinned?$(this).addClass("ramadda-popup-pin-pinned"):$(this).removeClass("ramadda-popup-pin-pinned")})),this.props&&this.props.initCallback&&this.props.initCallback()}};var OUTPUT_JSON="json",OUTPUT_CSV="default.csv",OUTPUT_CHOOSE="default.ids",OUTPUT_ZIP="zip.tree",OUTPUT_EXPORT="zip.export",VALUE_ANY_TYPE="_any_",DEFAULT_MAX=100,ENTRY_NONGEO=-9999,OUTPUTS=[{id:OUTPUT_CHOOSE,name:"Select Output"},{id:OUTPUT_ZIP,name:"Download Files"},{id:OUTPUT_EXPORT,name:"Export"}];function getRamadda(t,e){t||(t=ramaddaBaseUrl);let a=t.split(";"),n=null;a.length>1&&(t=a[0].trim(),n=a[1].trim());let i,r=null,s=new RegExp("^(.*)\\((.+)\\).*$").exec(t);if(s&&(t=s[1].trim(),r=s[2]),"this"==t)return getGlobalRamadda();if(null==window.globalRamaddas&&(window.globalRamaddas={}),!e&&(i=window.globalRamaddas[t],null!=i))return i;let l=window[t];return null==l&&(l=window[t+"Repository"]),l&&(i=new Object,l.call(i,n,r)),null==i&&(i=new RamaddaRepository(t),null!=n&&(i.name=n)),addRepository(i),i}function addRepository(t){null==window.globalRamaddas&&(window.globalRamaddas={}),window.globalRamaddas[t.repositoryRoot]=t}function getGlobalRamadda(t){return getRamadda(ramaddaBaseUrl,t)}function Repository(t){let e=null,a=t.match("^(http.?://[^/]+)/");a&&a.length>0&&(e=a[1]),RamaddaUtil.defineMembers(this,{repositoryRoot:t,baseEntry:null,hostname:e,name:null,getId:function(){return this.repositoryRoot},getSearchMessage:function(){return"Searching "+this.getName()},getSearchLinks:function(t){return null},getSearchUrl:function(t){return null},getId:function(){return this.repositoryRoot},getIconUrl:function(t){return RamaddaUtil.getCdnUrl("/icons/page.png")},getEntryTypes:function(t){return new Array},getEntryType:function(t){return null},getMetadataCount:function(t,e){return 0},getEntryUrl:function(t,e){return null},getBaseEntry:function(t){if(null!=this.baseEntry)return this.baseEntry},getRoot:function(){return this.repositoryRoot},getHostname:function(){return this.hostname},canSearch:function(){return!0},getName:function(){if(this.children)return"Search all repositories";if(null!=this.name)return this.name;if(0==this.repositoryRoot.indexOf("/"))return this.name="This RAMADDA";let t=this.repositoryRoot,e=document.createElement(TAG_A);e.href=t;let a=e.hostname,n=e.pathname;return"/repository"==n?a:this.name=a+": "+n}})}function RepositoryContainer(t,e){let a;this._id="CONTAINER",RamaddaUtil.inherit(this,a=new Repository(t)),RamaddaUtil.defineMembers(this,{name:e,children:[],canSearch:function(){return!1},getSearchMessage:function(){return"Searching "+this.children.length+" repositories"},addRepository:function(t){this.children.push(t)},getEntryTypes:function(t){if(null!=this.entryTypes)return this.entryTypes;this.entryTypes=[];let e={};for(let t=0;t<this.children.length;t++){let a=this.children[t].getEntryTypes();if(null!=a)for(let t=0;t<a.length;t++){let n=a[t];if(null==e[n.getId()]){let t={};t=$.extend(t,n),e[n.getId()]=t,this.entryTypes.push(t)}else e[n.getId()].entryCount+=n.getEntryCount()}}return this.entryTypes}})}function RamaddaRepository(t){let e;null==t&&(t=ramaddaBaseUrl),RamaddaUtil.inherit(this,e=new Repository(t)),RamaddaUtil.defineMembers(this,{entryCache:{},entryTypes:null,entryTypeMap:{},toString:function(){return"ramadda:"+this.getId()},canSearch:function(){return!0},getJsonUrl:function(t){return HU.url(this.repositoryRoot+URL_ENTRY_SHOW,ARG_ENTRYID,t,ARG_OUTPUT,"json")},createEntriesFromJson:function(t){let e=new Array;for(let a=0;a<t.length;a++){let n=t[a];n.baseUrl=this.getRoot();let i=new Entry(n);this.addEntry(i),e.push(i)}return e},getEntryType:function(t){return this.entryTypeMap[t]},entryTypeCallPending:!1,entryTypeCallbacks:null,entryTypesMap:{},getEntryTypes:function(t,e,a){if(a||(a=""),null!=this.entryTypesMap[a])return this.entryTypesMap[a];if(this.entryTypeCallPending){let e=this.entryTypeCallbacks;return null==e&&(e=[]),e.push(t),this.entryTypeCallbacks=e,this.entryTypesMap[a]}let n=this,i=this.repositoryRoot+"/entry/types?forsearch=true";e&&(i=i+"&types="+e),Utils.stringDefined(a)&&(i=i+"&"+a),this.entryTypeCallPending=!0,this.entryTypeCallbacks=null;$.getJSON(i,(function(e){if(GuiUtils.isJsonError(e))return;n.entryTypesMap[a]=[];for(let t=0;t<e.length;t++){let i=new EntryType(e[t]);n.entryTypeMap[i.getId()]=i,n.entryTypesMap[a].push(i)}null!=t&&t(n,n.entryTypesMap[a]);let i=n.entryTypeCallbacks;if(n.entryTypeCallPending=!1,n.entryTypeCallbacks=null,i)for(let t=0;t<i.length;t++)i[t](n,n.entryTypesMap[a])})).done((function(t,e,a){n.entryTypeCallPending=!1})).always((function(t,e,a){n.entryTypeCallPending=!1})).fail((function(t,e,a){n.entryTypeCallPending=!1;let r="";a&&a.length>0&&(r+=":  "+a),GuiUtils.handleError("An error has occurred reading entry types"+r,"URL: "+i,!1)}));return this.entryTypesMap[a]},metadataCache:{},metadataCachePending:{},metadataCacheCallbacks:{},getMetadataCount:function(t,e){let a=t.getType(),n=this.metadataCache[a];if(null!=n)return e(t,n),null;if(this.metadataCachePending[a]){let t=this.metadataCacheCallbacks[a];return null==t&&(t=[]),t.push(e),this.metadataCacheCallbacks[a]=t,null}this.metadataCacheCallbacks[a]=null,this.metadataCachePending[a]=!0;let i=this.repositoryRoot+"/metadata/list?metadata_type="+t.getType()+"&response=json",r=this;$.getJSON(i,(function(n){let i=r.metadataCacheCallbacks[a];if(r.metadataCachePending[a]=!1,!GuiUtils.isJsonError(n)&&(r.metadataCache[a]=n,e(t,n),i))for(let e=0;e<i.length;e++)i[e](t,n)})).fail((function(t,e,n){r.metadataCachePending[a]=!1;let s=e+", "+n;GuiUtils.handleError("Error getting metadata count: "+s,i,!1)}));return null},getEntryUrl:function(t,e){let a;a="string"==typeof t?t:t.id;let n=HU.url(this.getRoot()+URL_ENTRY_SHOW,ARG_ENTRYID,a);return null!=e&&(StringUtil.startsWith(e,"&")||(n+="&"),n+=e),n},getEntryDownloadUrl:function(t,e){let a;if(a="string"==typeof t?t:t.id,a.startsWith("http"))return a.indexOf("ramadda.org")>=0?HU.url(Ramadda.getUrl("/proxy"),"url",a):a;let n=HU.url(this.getRoot()+URL_ENTRY_GET,ARG_ENTRYID,a);return null!=e&&(StringUtil.startsWith(e,"&")||(n+="&"),n+=e),n},getSearchLinks:function(t,e,a){let n=[];for(let i=0;i<OUTPUTS.length;i++){let r=OUTPUTS[i];a&&!a(r)||(e?n.push(HU.span([ATTR_CLASS,HU.classes("ramadda-search-link",CLASS_CLICKABLE),ATTR_TITLE,Utils.delimMsg("Click to download")+"; "+Utils.delimMsg("Shift-click to copy URL"),ATTR_DATA_NAME,r.name,"data-format",r.id,"data-url",this.getSearchUrl(t,r.id)],r.name)):n.push(HU.href(this.getSearchUrl(t,r.id),r.name,[ATTR_CLASS,"ramadda-search-link"])))}return n},getUrlRoot:function(){return this.repositoryRoot},getSearchUrl:function(t,e,a){let n=this.repositoryRoot+"/search/do?forsearch=true";e&&(n+="&output="+e);for(let e=0;e<t.types.length;e++){let a=t.types[e];a!=VALUE_ANY_TYPE&&(n+="&type="+a)}null!=t.parent&&t.parent.length>0&&(n+="&group="+t.parent),t.providers&&t.providers.forEach((t=>{n+="&provider="+t}));let i=(t,e)=>{Utils.stringDefined(e)&&(n+="&"+t+"="+e)};i("text",t.text),i("name",t.name),i("description",t.description),i("datadate.from",t.startDate),i("datadate.to",t.endDate),i("createdate.from",t.createstartDate),i("createdate.to",t.createendDate),i("changedate.from",t.changestartDate),i("changedate.to",t.changeendDate),t.entries&&t.entries.length>0&&(n+="&entries="+t.entries),t.orderBy&&(n+="&orderby="+t.orderBy,Utils.isDefined(t.ascending)&&(n+="&ascending="+(t.ascending?"true":"false"))),t.getAreaContains()&&(n+="&areamode=contains"),isNaN(t.getNorth())||(n+="&maxlatitude="+t.getNorth()),isNaN(t.getWest())||(n+="&minlongitude="+t.getWest()),isNaN(t.getSouth())||(n+="&minlatitude="+t.getSouth()),isNaN(t.getEast())||(n+="&maxlongitude="+t.getEast()),t.ancestor&&(n=HU.url(n,ARG_ANCESTOR,t.ancestor));for(let e=0;e<t.metadata.length;e++){let a=t.metadata[e],i=a.index;Utils.isDefined(i)||(i=1),n=HU.url(n,"metadata_attr"+i+"_"+a.type,a.value)}return n=HU.url(n,"max",t.getMax(),"skip",t.getSkip()),t.rootEntry&&(n=HU.url(n,"rootEntry",t.rootEntry)),n+=t.getExtra(),n},isLocal(){return this.repositoryRoot&&this.repositoryRoot.startsWith("/")},addEntry:function(t){this.entryCache[t.getId()]=t},getEntry:async function(t,e){let a=!1;if(null==t)return console.log("Error in getEntry: entry id is null"),console.trace(),null;let n=this.entryCache[t];if(null!=n)return Utils.call(e,n);if(window.globalRamaddas)for(let a=0;a<window.globalRamaddas.length;a++){let n=window.globalRamaddas[a].entryCache[t];if(null!=n)return Utils.call(e,n)}if(null==e)return null;let i=this,r=this.getJsonUrl(t)+"&ancestors=true";await $.getJSON(r,(function(t){if(GuiUtils.isJsonError(t))return void 0;let a=createEntriesFromJson(t,i),n=null;a.length>0&&(n=a[0]),Utils.call(e,n,a)})).fail((function(t,e,a){let n=e+", "+a;GuiUtils.handleError("Error getting entry information: "+n,r,!1)}))}})}function createEntriesFromJson(t,e){return null==e&&(e=getGlobalRamadda()),e.createEntriesFromJson(t)}var metadataTypeCount=-1,metadataColorPalette=["#FDF5E6","#F0FFFF","#FFE3D5","#a7d0cd","#fbeeac","#dbe3e5","#e8e9a1"],metadataColors={};function getMetadataColor(t){return t.color?t.color:metadataColors[t]?metadataColors[t]:metadataColorPalette[0]}function MetadataType(t,e,a){$.extend(this,{type:t,label:e,value:a}),this.color=Utils.getEnumColor(t),$.extend(this,{getType:function(){return this.type},getColor:function(){return this.color},getAddNot:function(){return this.addNot},getLabel:function(){return null!=this.label?this.label:this.type},getSearchLabel:function(){return null!=this.searchLabel?this.searchLabel:this.getLabel()},getValue:function(){return this.value}})}var COLUMN_TYPE_STRING="string",COLUMN_TYPE_LIST="list";function EntryTypeColumn(t){$.extend(this,t),RamaddaUtil.defineMembers(this,{getName:function(){return this.name},getLabel:function(){return this.label},getGroup:function(){return this.group},getSearchGroup:function(){return this.searchGroup??this.group},getSearchLabel:function(){return null!=this.searchLabel?this.searchLabel:this.getLabel()},getType:function(){return this.type},getValues:function(){return this.values},getSuffix:function(){return this.suffix},getSearchArg:function(){return"search."+this.namespace+"."+this.name},getCanSearch:function(){return this.cansearch},getCanShow:function(){return this.canshow},isEnumeration:function(){return"enumeration"==this.getType()||"enumerationplus"==this.getType()},isLatLon:function(){return"latlon"==this.getType()},isDate:function(){return"date"==this.getType()},isEntry:function(){return"entry"==this.getType()},showCheckboxes:function(){return this.searchShowCheckboxes},getSearchMultiples:function(){return this.searchMultiples},isNumeric:function(){return"double"==this.getType()||"int"==this.getType()},isUrl:function(){return"url"==this.getType()}})}function EntryType(t){let e=t.columns;null==e&&(e=[]);let a=[];for(let t=0;t<e.length;t++)a.push(new EntryTypeColumn(e[t]));t.columns=a,$.extend(this,t),RamaddaUtil.defineMembers(this,{getIsGroup:function(){return this.isgroup},getIcon:function(){return this.icon},getLabel:function(){return this.label||this.name},getId:function(){return null!=this.type?this.type:this.id},getCategory:function(){return this.category},getSuperCategory:function(){return this.superCategory},getEntryCount:function(){return this.entryCount},getIncludeInSearch:function(){return this.includeInSearch},getColumns:function(){return this.columns}})}function Entry(t){null==t.repositoryId&&(t.repositoryId=t.baseUrl),null==t.repositoryId&&(t.repositoryId=ramaddaBaseUrl);let e=ENTRY_NONGEO;if(t.typeObject)t.type=new EntryType(t.typeObject);else if(t.type){let e={id:t.type,name:null!=t.typeName?t.typeName:t.type};t.type=new EntryType(e)}if($.extend(this,{id:null,name:null,description:null,bbox:null,geometry:null,services:[],properties:[],childrenEntries:null,startDate:null,endDate:null,embedWikiText:null}),$.extend(this,t),this.domId=Utils.cleanId(this.id),this.createDate=Utils.parseDate(t.createDate),this.startDate=Utils.parseDate(t.startDate),this.endDate=Utils.parseDate(t.endDate),this.endDate&&this.startDate&&this.endDate.getTime()<this.startDate.getTime()){let t=this.startDate;this.startDate=this.endDate,this.endDate=t}this.attributes=[],this.metadata=[];for(let t=0;t<this.properties.length;t++){let e=this.properties[t];"attribute"==e.type?this.attributes.push(e):this.metadata.push(e)}RamaddaUtil.defineMembers(this,{getId:function(){return this.id},getIdForDom:function(){return this.domId},canEdit:function(){return this.canedit},isSynth:function(){return this.id.startsWith("synth:")},getFullId:function(){return this.getRamadda().getRoot()+","+this.id},doSave:function(t,e,a,n){RamaddaUtil.doSave(this.getId(),t,e,a,n)},getDisplayName:function(t){return this.displayName?this.displayName:this.getName(t)},getCreateDate:function(){return this.createCreate},getStartDate:function(){return this.startDate},getEndDate:function(){return this.endDate},getIsGroup:function(){return this.isGroup},getProperty:function(t,e,a){if(e=e??{},"name"==t)return this.canEdit()&&a?HU.input(null,this.getName(),[ATTR_SIZE,30,ATTR_ENTRYID,this.getId(),ATTR_TITLE,"Edit name",ATTR_CLASS,"ramadda-entry-inlineedit",ATTR_DATA_FIELD,"name"]):this.getName();if("fromdate"==t)return HU.span([ATTR_CLASS,CLASS_DATETIME,ATTR_TITLE,this.startDate],this.startDateFormat);if("time"==t)return HU.span([ATTR_CLASS,CLASS_DATETIME,ATTR_TITLE,this.startDate],this.hhmm);if("download"==t){if(!this.getIsFile())return"";let t=this.getResourceUrl(),e=HU.getIconImage("fas fa-download");return this.getFilesize()&&(e+=" "+this.getFormattedFilesize()),HU.href(t,e)}if("entryorder"==t)return this.canEdit()&&a?HU.input(null,this.order,[ATTR_SIZE,3,ATTR_ENTRYID,this.getId(),ATTR_TITLE,"Edit order",ATTR_CLASS,"ramadda-entry-inlineedit ramadda-entry-inlineedit-entryorder",ATTR_DATA_FIELD,"entryorder"]):this.order;if("creator"==t){let t=HU.url(RamaddaUtil.getUrl("/search/do"),"user_id",this.creator,"search.submit","true");return HU.href(t,Utils.stringDefined(this.creatorName)?this.creatorName:this.creator,[ATTR_TITLE,"Search for entries of this type created by this user"])}if("latitude"==t)return this.getLatitude();if("longitude"==t)return this.getLongitude();if("altitude"==t)return this.getAltitude();if("createdate"==t)return HU.span([ATTR_CLASS,CLASS_DATETIME,ATTR_TITLE,this.createDate],this.createDateFormat);if("changedate"==t)return HU.span([ATTR_CLASS,CLASS_DATETIME,ATTR_TITLE,this.changeDate],this.changeDateFormat);if("size"==t)return this.getFilesize()?this.getFormattedFilesize():"---";if("type"==t)return this.typeName;if("editcolumns"==t){if(!this.attributes)return"";let t="";return this.attributes.forEach((e=>{if(this.canEdit()&&e.caninlineedit){let a;""==t&&(t=HU.formTable());let n=[ATTR_ENTRYID,this.getId(),ATTR_DATA_FIELD,e.id,ATTR_TITLE,"Edit "+e.label,ATTR_CLASS,"ramadda-entry-inlineedit ramadda-entry-inlineedit-entryorder"];!0===e.value||!1===e.value?a=HU.checkbox("",n,e.value):(n.push(ATTR_SIZE,8),a=HU.input(null,e.value,n)),t+=HU.formEntryLabel(e.label,a)}})),""!=t&&(t+=HU.formTableClose()),t}return"Unknown:"+t},getTypeName:function(){return this.typeName},getRoot:async function(t,e){let a=this;for(;;){let e;if(await a.getParentEntry((t=>e=t)),!e)return Utils.call(t,a);a=e}},map:async function(t,e){let a;await this.getChildrenEntries((t=>{a=t})),a.map(t),Utils.call(e)},getEmbedWikiText:function(){return this.embedWikiText},getParentName:function(){return this.parentName},getParentEntry:async function(t,e){return this.parent?this.parentEntry?Utils.call(t,this.parentEntry):void await this.getRamadda().getEntry(this.remoteParent||this.parent,(e=>{this.parentEntry=e,Utils.call(t,e)})):Utils.call(t,null)},getChildrenEntries:async function(t,e){if(null!=this.childrenEntries)return Utils.call(t,this.childrenEntries);new EntrySearchSettings({parent:this.getId()});let a=this.getRamadda().getJsonUrl(this.getAbsoluteId())+"&justchildren=true";null!=e&&(a+="&"+e);let n={entryListChanged:function(e){t(e.getEntries())}},i=new EntryList(this.getRamadda(),a,n,!1);await i.doSearch()},getType:function(){return this.typeObject,this.type},getThumbnail:function(){if(!this.metadata)return null;let t,e=t=>{if(t.value.attr1.startsWith("http"))return t.value.attr1;return HU.url(this.getRamadda().getRoot()+"/metadata/view/"+t.value.attr1,ARG_ELEMENT,1,ARG_ENTRYID,this.getAbsoluteId(),"metadata_id",t.id)};for(let a=0;a<this.metadata.length;a++){let n=this.metadata[a];if("content.thumbnail"==n.type&&Utils.stringDefined(n.value.attr1)&&(t=n,"true"==n.attr3))return e(n)}return t?e(t):null},getImageProperties:function(){let t=[];if(!this.metadata)return t;let e=t=>{let e=t.value.attr1.replace(/.*_file_/,"");return t.value.attr1.startsWith("http")?t.value.attr1:HU.url(this.getRamadda().getRoot()+"/metadata/view/"+e,ARG_ELEMENT,1,ARG_ENTRYID,this.getAbsoluteId(),"metadata_id",t.id)};for(let a=0;a<this.metadata.length;a++){let n=this.metadata[a];"content.thumbnail"!=n.type&&"content.attachment"!=n.type||Utils.stringDefined(n.value.attr1)&&t.push({metadata:n,label:n.value.attr3,url:e(n)})}return t},getMetadata:function(){return this.metadata},getRamadda:function(){return this.remoteRepository?getRamadda(this.remoteRepository.url):getRamadda(this.repositoryId)},checkGeo:function(t){return t==ENTRY_NONGEO?NaN:t},getLocationLabel:function(){return"n: "+this.getNorth()+" w:"+this.getWest()+" s:"+this.getSouth()+" e:"+this.getEast()},getServices:function(){return this.services},getService:function(t){for(let e=0;e<this.services.length;e++)if(this.services[e].relType==t)return this.services[e];return null},goodLoc:function(t){return!isNaN(t)&&t!=e},hasBounds:function(){return this.goodLoc(this.getNorth())&&this.goodLoc(this.getWest())&&this.goodLoc(this.getSouth())&&this.goodLoc(this.getEast())},hasLocation:function(){return this.goodLoc(this.getNorth())},getNorth:function(){return this.bbox?this.checkGeo(this.bbox[3]):this.geometry?this.checkGeo(this.geometry.coordinates[1]):NaN},getWest:function(){return this.bbox?this.checkGeo(this.bbox[0]):this.geometry?this.checkGeo(this.geometry.coordinates[0]):NaN},getSouth:function(){return this.bbox?this.checkGeo(this.bbox[1]):this.geometry?this.checkGeo(this.geometry.coordinates[1]):NaN},getEast:function(){return this.bbox?this.checkGeo(this.bbox[2]):this.geometry?this.checkGeo(this.geometry.coordinates[0]):NaN},getAltitude:function(){return Utils.isDefined(this.altitudeTop)?this.altitudeTop:Utils.isDefined(this.altitudeBottom)?this.altitudeBottom:NaN},getLatitude:function(){return this.geometry?this.checkGeo(this.geometry.coordinates[1]):this.getNorth()},getLongitude:function(){return this.geometry?this.checkGeo(this.geometry.coordinates[0]):this.getWest()},getIconUrl:function(){if(null==this.icon)return this.getRamadda().getIconUrl(this);if(this.icon.match("^http.*"))return this.icon;let t,e=this.getRamadda().getHostname();return t=e?e+this.icon:this.icon,t},getIconImage:function(t){return(t=t??[]).includes(ATTR_WIDTH)||t.push(ATTR_WIDTH,ramaddaGlobals.iconWidth),this.iconRelative?HU.image(this.iconRelative,t):HU.image(this.getIconUrl(),t)},getColumns:function(){return null==this.type.getColumns()?new Array:this.type.getColumns()},getAttributes:function(){return this.attributes},getAttribute:function(t){for(let e=0;e<this.attributes.length;e++){let a=this.attributes[e];if(a.id==t)return a}return null},getAttributeValue:function(t){let e=this.getAttribute(t);return null==e?null:e.value},getAttributeNames:function(){let t=[];for(let e=0;e<this.attributes.length;e++){let a=this.attributes[e];t.push(a.id)}return t},getAttributeLabels:function(){let t=[];for(let e=0;e<this.attributes.length;e++){let a=this.attributes[e];a.label?t.push(a.label):t.push(a.id)}return t},getName:function(t){let e;return e=null==this.name||""==this.name?"no name":this.name,t&&Utils.stringDefined(this.repositorySlug)&&(this.getRamadda().isLocal()||(e=this.repositorySlug+"-"+e)),e},getSnippet:function(t){return null==this.snippet?t:this.snippet},getDescription:function(t){return null==this.description?t:this.description},getFilesize:function(){let t=parseInt(this.filesize);return t==t?t:0},getFormattedFilesize:function(){return GuiUtils.size_format(this.getFilesize())},getEntryUrl:function(t){return this.remoteUrl?this.remoteUrl:this.getRamadda().getEntryUrl(this,t)},getFilename:function(){return this.filename},getIsEntryImage:function(){return this.isImage},getIsImage:function(){return!!(this.url&&this.url.search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)||(!!(this.hasResource()&&this.getFilename().search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)||!!this.getThumbnail())},getImageUrl:function(){if(this.url&&this.url.search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)return this.url;if(this.hasResource()&&this.getFilename().search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)return this.getResourceUrl();let t=this.getThumbnail();return t||null},getIsUrl:function(){return this.isurl},getIsFile:function(){return this.isfile},hasResource:function(){return null!=this.getFilename()},getAbsoluteId:function(){if(this.remoteRepository&&this.remoteUrl){let t=this.remoteUrl.match("entryid=(.*)");if(t&&t.length>1)return t[1]}return this.id},getResourceUrl:function(){if(this.url)return this.url;if(this.remoteRepository)return HU.url(this.remoteRepository.url+URL_ENTRY_GET,ARG_ENTRYID,this.getAbsoluteId());let t=this.getRamadda().getRoot()+URL_ENTRY_GET;return null!=this.getFilename()&&(t+="/"+this.getFilename()),HU.url(t,ARG_ENTRYID,this.id)},getLink:function(t,e,a){return t||(t=this.getName()),(a=a||[]).push("href",this.getEntryUrl()),e&&(t=this.getIconImage()+SPACE+t),HU.tag(TAG_A,a,t)},getResourceLink:function(t){return t||(t=this.getName()),HU.tag(TAG_A,["href",this.getResourceUrl()],t)},toString:function(){return"entry:"+this.getName()+" id:"+this.getId()}})}function EntryList(t,e,a,n){$.extend(this,{repository:t,url:e,listener:a,haveLoaded:!1,entries:[],map:{},getRepository:function(){return this.repository},setEntries:function(t){this.entries=t,this.haveLoaded=!0},getEntry:async function(t,e){let a=this.map[t];if(null!=a)return Utils.call(e,a);await this.getRepository().getEntry(t,(t=>{Utils.call(e,t)}))},getEntries:function(){return this.entries},createEntries:function(t,e,a){this.entries=createEntriesFromJson(t,this.getRepository());for(let t=0;t<this.entries.length;t++){let e=this.entries[t];this.map[e.getId()]=e}null==e&&(e=this.listener),a?a(this):e&&e.entryListChanged&&e.entryListChanged(this)},doSearch:async function(t,e,a){null==t&&(t=this.listener);let n=this;await $.getJSON(this.url,(function(a,i,r){GuiUtils.isJsonError(a)||(n.haveLoaded=!0,n.createEntries(a,t,e))})).fail((function(e,i,r){GuiUtils.handleError("An error occurred doing search: "+r,n.url,!0),a?a(r):t&&t.handleSearchError&&t.handleSearchError(n.url,r)}))}}),n&&this.doSearch()}function EntrySearchSettings(t){$.extend(this,{types:[],parent:null,max:DEFAULT_MAX,skip:0,metadata:[],extra:"",orderBy:"",entries:null,startDate:null,endDate:null,north:NaN,west:NaN,north:NaN,east:NaN,areaContains:!1,clearProviders:function(t){this.providers=null},getProvider:function(t){return this.providers?this.providers[0]:null},setProvider:function(t){null!=t?(Array.isArray(t)||(t=[t]),this.providers=t):this.providers=null},getMax:function(){return this.max},setMax:function(t){this.max=parseInt(t)},getSkip:function(){return this.skip},toString:function(){return"n:"+this.north+" w:"+this.west+" s:"+this.south+" e:"+this.east},getAreaContains:function(){return this.areaContains},setAreaContains:function(t){this.areaContains=t},getNorth:function(){return this.north},getSouth:function(){return this.south},getWest:function(){return this.west},getEast:function(){return this.east},setDateRange:function(t,e){this.startDate=t,this.endDate=e},setCreateDateRange:function(t,e){this.createstartDate=t,this.createendDate=e},setChangeDateRange:function(t,e){this.changestartDate=t,this.changeendDate=e},setBounds:function(t,e,a,n){this.north=null==t||0==t.toString().length?NaN:parseFloat(t),this.west=null==e||0==e.toString().length?NaN:parseFloat(e),this.south=null==a||0==a.toString().length?NaN:parseFloat(a),this.east=null==n||0==n.toString().length?NaN:parseFloat(n)},getTypes:function(){return this.types},hasType:function(t){return this.types.indexOf(t)>=0},getExtra:function(){return this.extra},setExtra:function(t){this.extra=t},clearAndAddType:function(t){return this.types=[],this.addType(t),this},addType:function(t){if(null!=t&&0!=t.length&&!this.hasType(t))return this.types.push(t),this}}),null!=t&&$.extend(this,t)}function EntryListHolder(t){let e;RamaddaUtil.inherit(this,e=new EntryList(t,null)),$.extend(this,{entryLists:[],addEntryList:function(t){this.entryLists.push(t)},doSearch:function(t){let e=this;null==t&&(t=this.listener);for(let a=0;a<this.entryLists.length;a++){let n=this.entryLists[a];if(!n.getRepository().canSearch())continue;let i={entryListChanged:function(a){t&&t.entryListChanged(e,a)}};n.doSearch(i)}},getEntry:async function(t){for(let e=0;e<this.entryLists.length;e++){let a,n=this.entryLists[e];if(await n.getEntry(t,(t=>{a=t})),null!=a)return a}return null},getEntries:function(){let t=[];for(let e=0;e<this.entryLists.length;e++){let a=this.entryLists[e].getEntries();for(let e=0;e<a.length;e++)t.push(a[e])}return t}})}
