var popupObject;var popupSrcId;var popupTime;document.onmousemove=mouseMove;document.onmousedown=mouseDown;document.onmouseup=mouseUp;var mouseIsDown=0;var dragSource;var draggedEntry;var draggedEntryName;var draggedEntryIcon;var mouseMoveCnt=0;var objectToHide;function hidePopupObject(){if(objectToHide!=popupObject){}if(popupObject){hideObject(popupObject);popupObject=null;popupSrcId=null}}function mouseDown(a){if(popupObject){if(checkToHidePopup()){theObjectToHide=popupObject;thePopupSrcId=popupSrcId;var b=function(){var c=(popupObject==theObjectToHide);hideObject(theObjectToHide);if(c){popupSrcId=null;popupObject=null}};setTimeout(b,250)}}a=GuiUtils.getEvent(a);mouseIsDown=1;mouseMoveCnt=0;return true}var ramaddSearchLastInput="";function ramaddaSearchSuggestInit(b,a){let searching=false;let input=$("#"+b);ramaddSearchLastInput=input.val();input.keyup(function(f){f.stopPropagation();if(searching){return}var d=input.val();if(d!=ramaddSearchLastInput){ramaddSearchLastInput=d;searching=true;var c=ramaddaBaseUrl+"/search/suggest?string="+encodeURIComponent(d);if(a){c+="&type="+a}var g=$.getJSON(c,function(m){var e=$("#searchpopup");searching=false;if(m.values.length==0){e.hide();return}var k="";for(var j=0;j<m.values.length;j++){var l=m.values[j];var h=l.replace(/\"/g,"_quote_");k+=HtmlUtil.div(["class","ramadda-search-suggestion","suggest",h],l)}e.html(HtmlUtil.div(["style","padding:5px;"],k));e.find(".ramadda-search-suggestion").mousedown(function(n){n.stopPropagation()});e.find(".ramadda-search-suggestion").click(function(o){popupTime=new Date();var n=$(this).attr("suggest");n=n.replace(/_quote_/g,'"');input.val(n);input.focus();o.stopPropagation();e.hide()});e.show();e.position({of:input,my:"left top",at:"left bottom+1",collision:"none none"})}).fail(function(h,j,e){console.log("fail")})}})}function ramaddaSearchPopup(e){var c="<form action='"+ramaddaBaseUrl+"/search/do'><input autocomplete=off autofocus id='searchinput' style='border: 1px #ccc solid;' placeholder=' Search text' name='text'></form><div id=searchpopup class=ramadda-popup></div>";var b=["style","color:#666; font-size:13px;"];c+=HtmlUtil.span(["class","ramadda-links"],HtmlUtil.href(ramaddaBaseUrl+"/search/form","Advanced",b)+"&nbsp;&nbsp; "+HtmlUtil.href(ramaddaBaseUrl+"/search/type","By Type",b));c=HtmlUtil.div(["style","padding:5px;"],c);var a=$("#ramadda-selectdiv");var d=$("#"+e);popupTime=new Date();popupObject=GuiUtils.getDomObject("ramadda-selectdiv");a.html(c);$("#searchinput").focus();$("#searchinput").mousedown(function(f){f.stopPropagation()});a.show();a.position({of:d,my:"right top",at:"right bottom",collision:"none none"});ramaddaSearchSuggestInit("searchinput")}function mouseUp(a){a=GuiUtils.getEvent(a);mouseIsDown=0;draggedEntry=null;GuiUtils.setCursor("default");var f=GuiUtils.getDomObject("ramadda-floatdiv");if(f){var k=GuiUtils.getDomObject(dragSource);if(k){var d=GuiUtils.getLeft(k.obj);var b=GuiUtils.getTop(k.obj);var e=parseInt(f.style.left);var c=parseInt(f.style.top);var g=10;var j=(d-e)/g;var h=(b-c)/g;flyBackAndHide("ramadda-floatdiv",0,g,e,c,j,h)}else{hideObject(f)}}return true}function flyBackAndHide(a,b,g,d,c,k,j){var e=GuiUtils.getDomObject(a);if(!e){return}b=b+1;e.style.left=d+k*b+"px";e.style.top=c+j*b+"px";var f=80*(g-b)/g;if(b<g){var h="flyBackAndHide('"+a+"',"+b+","+g+","+d+","+c+","+k+","+j+");";setTimeout(h,30)}else{setTimeout("finalHide('"+a+"')",150)}}function finalHide(b){var a=GuiUtils.getDomObject(b);if(!a){return}hideObject(a);a.style.filter="alpha(opacity=80)";a.style.opacity="0.8"}function mouseMove(a){a=GuiUtils.getEvent(a);if(draggedEntry&&mouseIsDown){mouseMoveCnt++;var b=GuiUtils.getDomObject("ramadda-floatdiv");if(mouseMoveCnt==6){GuiUtils.setCursor("move")}if(mouseMoveCnt>=6&&b){moveFloatDiv(GuiUtils.getEventX(a),GuiUtils.getEventY(a))}}return false}function moveFloatDiv(a,d){var c=GuiUtils.getDomObject("ramadda-floatdiv");if(c){if(c.style.visibility!="visible"){c.style.visibility="visible";c.style.display="block";var b="";if(draggedEntryIcon){b='<img src="'+draggedEntryIcon+'"/> '}c.obj.innerHTML=b+draggedEntryName+"<br>Drag to a group to copy/move/associate"}c.style.top=d;c.style.left=a+10}}function mouseOverOnEntry(c,b,a){c=GuiUtils.getEvent(c);if(b==draggedEntry){return}if(mouseIsDown){var d=GuiUtils.getDomObject(a);if(!d){return}d.style.borderBottom="2px black solid"}}function mouseOutOnEntry(c,b,a){c=GuiUtils.getEvent(c);if(b==draggedEntry){return}var d=GuiUtils.getDomObject(a);if(!d){return}if(mouseIsDown){d.style.borderBottom=""}}function mouseDownOnEntry(e,d,b,a,c){e=GuiUtils.getEvent(e);dragSource=a;draggedEntry=d;draggedEntryName=b;draggedEntryIcon=c;mouseIsDown=1;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false;return false}}function mouseUpOnEntry(c,b,a){c=GuiUtils.getEvent(c);if(b==draggedEntry){return}var d=GuiUtils.getDomObject(a);if(!d){return}if(mouseIsDown){d.style.borderBottom=""}if(draggedEntry&&draggedEntry!=b){url=ramaddaBaseUrl+"/entry/copy?action=action.move&from="+draggedEntry+"&to="+b;document.location=url}}function getTooltip(){return $("#ramadda-tooltipdiv")}function handleKeyPress(a){getTooltip().hide()}document.onkeypress=handleKeyPress;var groups=new Array();var groupList=new Array();function EntryFormList(d,b,c,a){this.entryRows=new Array();this.lastEntryRowClicked=null;groups[d]=this;groupList[groupList.length]=this;this.formId=d;this.toggleImg=b;this.on=a;this.entries=new Array();this.groupAddEntry=function(e){this.entries[this.entries.length]=e};this.addEntryRow=function(e){this.groupAddEntry(e.cbxWrapperId);this.entryRows[this.entryRows.length]=e;if(!this.on){e.getCbx().hide()}else{e.getCbx().show()}};this.groupAddEntry(c);if(!this.on){hideObject(c)}this.groupToggleVisibility=function(){this.on=!this.on;this.setVisibility()};this.findEntryRow=function(f){var e;for(e=0;e<this.entryRows.length;e++){if(this.entryRows[e].rowId==f){return this.entryRows[e]}}return null};this.checkboxClicked=function(j,m){if(!j){return}var e;for(i=0;i<this.entryRows.length;i++){if(this.entryRows[i].cbxId==m){e=this.entryRows[i];break}}if(!e){return}var k=e.isSelected();if(j.ctrlKey){for(i=0;i<this.entryRows.length;i++){this.entryRows[i].setCheckbox(k)}}if(j.shiftKey){if(this.lastEntryRowClicked){var h=this.lastEntryRowClicked.getCbx().offset().top;var g=e.getCbx().offset().top;if(h>g){var f=h;h=g;g=f}for(i=0;i<this.entryRows.length;i++){var l=this.entryRows[i].getCbx().offset().top;if(l>=h&&l<=g){this.entryRows[i].setCheckbox(k)}}}return}this.lastEntryRowClicked=e};this.setVisibility=function(){if(this.toggleImg){if(this.on){$("#"+this.toggleImg).attr("src",icon_downdart)}else{$("#"+this.toggleImg).attr("src",icon_rightdart)}}var e=GuiUtils.getDomObject(this.formId);if(e){e=e.obj;for(i=0;i<e.elements.length;i++){if(this.on){showObject(e.elements[i],"inline")}else{hideObject(e.elements[i])}}}for(i=0;i<this.entries.length;i++){obj=GuiUtils.getDomObject(this.entries[i]);if(!obj){continue}if(this.on){showObject(obj,"block")}else{hideObject(obj)}}}}function entryRowCheckboxClicked(b,c){var d=GuiUtils.getDomObject(c);if(!d){return}d=d.obj;if(!d.form){return}var a=groups[d.form.id];if(a){a.checkboxClicked(b,c)}}function initEntryListForm(b){var a=groups[b];if(a){a.on=0;a.setVisbility()}}function EntryRow(c,g,f,b,e){this.entryId=c;this.onColor="#FFFFCC";this.overColor="#f6f6f6";this.overColor="#edf5ff";this.overColor="#ffffee";this.overColor="#f4f4f4";this.rowId=g;this.cbxId=f;this.cbxWrapperId=b;this.showDetails=e;this.getRow=function(){return $("#"+this.rowId)};this.getCbx=function(){return $("#"+this.cbxId)};var d=this.getCbx().closest("form");if(d.size()){var a=groups[d.attr("id")];if(a){a.addEntryRow(this)}}else{this.getCbx().hide()}this.setCheckbox=function(h){this.getCbx().prop("checked",h);this.setRowColor()};this.isSelected=function(){return this.getCbx().is(":checked")};this.setRowColor=function(){if(this.isSelected()){this.getRow().css("background-color",this.onColor)}else{this.getRow().css("background-color","#ffffff")}};this.mouseOver=function(h){$("#entrymenuarrow_"+g).attr("src",icon_menuarrow);this.getRow().css("background-color",this.overColor)};this.mouseOut=function(h){$("#entrymenuarrow_"+g).attr("src",icon_blank);this.setRowColor()};this.mouseClick=function(k){eventX=GuiUtils.getEventX(k);var h=this.getRow().offset();if(eventX-h.left<150){return}this.lastClick=eventX;var j=ramaddaBaseUrl+"/entry/show?entryid="+c+"&output=metadataxml";if(this.showDetails){j+="&details=true"}else{j+="&details=false"}GuiUtils.loadXML(j,this.handleTooltip,this)};this.handleTooltip=function(m,s){var u=m.responseXML.documentElement;text=getChildText(u);var n=s.getRow().offset().left;var l=s.lastClick-n;getTooltip().html('<div class=ramadda-tooltip-inner><div id="tooltipwrapper" ><table><tr valign=top><img width="16" class="ramadda-popup-close" onmousedown="hideEntryPopup();" id="tooltipclose"  src='+icon_close+"></td><td>"+text+"</table></div></div>");checkTabs(text);var p=s.getRow().offset();var t=s.getRow().outerWidth();var r=s.getRow().outerHeight();var j=getTooltip().outerWidth();var k=$(window).width();var q=s.lastClick;if(s.lastClick+j>k){q-=(s.lastClick+j-k)}var h=q+"px";var o=(3+p.top+r)+"px";getTooltip().css({position:"absolute",zIndex:5000,left:h,top:o});getTooltip().show()}}function checkTabs(c){while(1){var e=new RegExp('id="(tabId[^"]+)"');var b=e.exec(c);if(!b){break}var d=b[1];if(d.indexOf("-")<0){jQuery(function(){jQuery("#"+d).tabs()})}var a=c.indexOf('id="tabId');if(a<0){break}c=c.substring(a+20)}}function hideEntryPopup(){getTooltip().hide()}function findEntryRow(c){var a;for(a=0;a<groupList.length;a++){var b=groupList[a].findEntryRow(c);if(b){return b}}return null}function entryRowOver(b){var a=findEntryRow(b);if(a){a.mouseOver()}}function entryRowOut(b){var a=findEntryRow(b);if(a){a.mouseOut()}}function entryRowClick(b,c){var a=findEntryRow(c);if(a){a.mouseClick(b)}}function indexOf(b,a){for(i=0;i<=b.length;i++){if(b[i]==a){return i}}return -1}var lastCbxClicked;var lastCbxIdClicked;function checkboxClicked(b,m,c){if(!b){return}var e=GuiUtils.getDomObject(c);if(!e){return}e=e.obj;var f=new Array();if(!e.form){return}var a=e.form.elements;for(i=0;i<a.length;i++){if(a[i].name.indexOf(m)>=0||a[i].id.indexOf(m)>=0){f.push(a[i])}}var l=e.checked;if(b.ctrlKey){for(i=0;i<f.length;i++){f[i].checked=l}}if(b.shiftKey){if(lastCbxClicked){var k=GuiUtils.getTop(e);var j=GuiUtils.getTop(lastCbxClicked);var d=$("#"+lastCbxIdClicked);var n=$("#"+c);if(d.position()){j=d.position().top}if(n.position()){k=n.position().top}if(k>j){var g=k;k=j;j=g}for(i=0;i<f.length;i++){var h=$("#"+f[i].id).position().top;if(h>=k&&h<=j){f[i].checked=l}}}return}lastCbxClicked=e;lastCbxIdClicked=c}function toggleBlockVisibility(d,a,b,c){if(toggleVisibility(d,"block")){$("#"+a).attr("src",b)}else{$("#"+a).attr("src",c)}ramaddaUpdateMaps()}function toggleInlineVisibility(e,a,c,d){var b=GuiUtils.getDomObject(a);if(toggleVisibility(e,"inline")){if(b){b.obj.src=c}}else{if(b){b.obj.src=d}}ramaddaUpdateMaps()}var originalImages=new Array();var changeImages=new Array();function folderClick(b,a,f){changeImages[b]=f;var d=$("#"+b);if(d.size()==0){return}var c=$("#img_"+b);var e=d.css("display")!="none";if(!e){originalImages[b]=c.attr("src");d.show();c.attr("src",icon_progress);GuiUtils.loadXML(a,handleFolderList,b)}else{if(f){if(originalImages[b]){c.attr("src",originalImages[b])}else{c.attr("src",icon_folderclosed)}}d.hide()}}function handleFolderList(request,uid){if(request.responseXML!=null){var xmlDoc=request.responseXML.documentElement;var script;var html;for(i=0;i<xmlDoc.childNodes.length;i++){var childNode=xmlDoc.childNodes[i];if(childNode.tagName=="javascript"){script=getChildText(childNode)}else{if(childNode.tagName=="content"){html=getChildText(childNode)}else{}}}if(!html){html=getChildText(xmlDoc)}if(html){$("#"+uid).html("<div>"+html+"</div>");checkTabs(html)}if(script){eval(script)}}if(changeImages[uid]){$("#img_"+uid).attr("src",icon_folderopen)}else{$("#img_"+uid).attr("src",originalImages[uid])}}var selectors=new Array();function Selector(e,b,a,d,c,g,f){this.id=b;this.elementId=a;this.localeId=g;this.entryType=f;this.allEntries=d;this.selecttype=c;this.textComp=GuiUtils.getDomObject(this.elementId);this.getTextComponent=function(){var h="#"+this.elementId;return $(h)};this.getHiddenComponent=function(){var h="#"+this.elementId+"_hidden";return $(h)};this.clearInput=function(){this.getHiddenComponent().val("");this.getTextComponent().val("")};this.handleClick=function(j){var k=this.id+"_selectlink";this.div=GuiUtils.getDomObject("ramadda-selectdiv");hidePopupObject();var h=$("#ramadda-selectdiv");h.show();var l=$("#"+k);h.position({of:l,my:"left top",at:"left bottom",collision:"none none"});url=ramaddaBaseUrl+"/entry/show?output=selectxml&selecttype="+this.selecttype+"&allentries="+this.allEntries+"&target="+this.id+"&noredirect=true&firstclick=true";if(this.localeId){url=url+"&localeid="+this.localeId}if(this.entryType){url=url+"&entrytype="+this.entryType}GuiUtils.loadXML(url,handleSelect,this.id);return false};this.handleClick(e)}function selectClick(c,a,b){selector=selectors[c];if(selector.selecttype=="wikilink"){insertAtCursor(selector.elementId,selector.textComp.obj,"[["+a+"|"+b+"]]")}else{if(selector.selecttype=="entryid"){insertTagsInner(selector.elementId,selector.textComp.obj,a," ","importtype")}else{if(selector.selecttype=="entry:entryid"){insertTagsInner(selector.elementId,selector.textComp.obj,"entry:"+a," ","importtype")}else{selector.getHiddenComponent().val(a);selector.getTextComponent().val(b)}}}selectCancel()}function selectCancel(){$("#ramadda-selectdiv").hide()}function selectCreate(e,b,a,d,c,g,f){if(!selectors[b]){selectors[b]=new Selector(e,b,a,d,c,g,f)}else{selectors[b].handleClick(e)}}function selectInitialClick(e,b,a,d,c,g,f){selectCreate(e,b,a,d,c,g,f);return false}function clearSelect(c){selector=selectors[c];if(selector){selector.clearInput()}else{var b=GuiUtils.getDomObject(c);var a=GuiUtils.getDomObject(c+"_hidden");if(a){a.obj.value=""}if(b){b.obj.value=""}}}function handleSelect(a,d){selector=selectors[d];var b=a.responseXML.documentElement;text=getChildText(b);var c='<a href="javascript:selectCancel();"><img class="ramadda-popup-close" border=0 src='+icon_close+"></a>";selector.div.obj.innerHTML="<table width=100%><tr><td align=right>"+c+"</table>"+text}function getChildText(a){var b="";for(childIdx=0;childIdx<a.childNodes.length;childIdx++){b=b+a.childNodes[childIdx].nodeValue}return b}function toggleVisibility(c,a){var b=$("#"+c).css("display");$("#"+c).toggle();return b!="block"}function hide(a){$("#"+a).hide()}function hideElementById(a){hideObject(GuiUtils.getDomObject(a))}function checkToHidePopup(){if(popupTime){var a=new Date();timeDiff=a-popupTime;if(timeDiff>1000){return 1}}}function showPopup(g,h,d,f,b,e){if(popupSrcId==h){if(checkToHidePopup()){hidePopupObject();return}}popupTime=new Date();hidePopupObject();var a=GuiUtils.getDomObject(d);var c=GuiUtils.getDomObject(h);if(!a||!c){return}popupObject=a;popupSrcId=h;if(!b){b="left top"}if(!e){e="left bottom"}if(f){b="right top";e="left bottom"}showObject(a);jQuery("#"+d).position({of:jQuery("#"+h),my:b,at:e,collision:"none none"});jQuery("#"+d).position({of:jQuery("#"+h),my:b,at:e,collision:"none none"})}function showStickyPopup(e,f,b,d){var a="left top";var c="left top";$("#"+b).show("slow");$("#"+b).position({of:jQuery("#"+f),my:a,at:c,collision:"none none"});$("#"+b).position({of:jQuery("#"+f),my:a,at:c,collision:"none none"})}function hideObject(a){if(!a){return 0}$("#"+a.id).hide();return 1}function hideMore(b){var a=GuiUtils.getDomObject("morelink_"+b);var c=GuiUtils.getDomObject("morediv_"+b);hideObject(c);showObject(a)}function showMore(b){var a=GuiUtils.getDomObject("morelink_"+b);var c=GuiUtils.getDomObject("morediv_"+b);hideObject(a);showObject(c)}function showObject(b,a){if(!b){return 0}$("#"+b.id).show();return}function toggleVisibilityOnObject(b,a){if(!b){return 0}$("#"+b.id).toggle()}function ramaddaUpdateMaps(){if(!(typeof ramaddaMaps==="undefined")){for(i=0;i<ramaddaMaps.length;i++){var a=ramaddaMaps[i];if(!a.map){continue}a.map.updateSize()}}}var formDialogId;function closeFormLoadingDialog(){var a=$(formDialogId);a.dialog("close")}function popupFormLoadingDialog(a){formDialogId=a;var b=$(a);b.dialog({resizable:false,height:100,modal:true})}function submitEntryForm(a){popupFormLoadingDialog(a);return true}function treeViewClick(d,c,b){var a="<a href='"+c+"'> <img src=\""+ramaddaBaseUrl+'/icons/link.png" border=0> '+b+"</a>";$("#treeview_header").html(a);c=c+"&template=empty";$("#treeview_view").attr("src",c)}function treeViewGoTo(){var b=$("#treeview_view").attr("src");if(b){b=b.replace("template=","notemplate=");var a=$(location);a.attr("href",b)}}function number_format(f,b,m,e){var a=f,l=isNaN(b=Math.abs(b))?2:b;var k=m==undefined?".":m;var o=e==undefined?",":e,p=a<0?"-":"";var h=parseInt(a=Math.abs(+a||0).toFixed(l))+"",g=(g=h.length)>3?g%3:0;return p+(g?h.substr(0,g)+o:"")+h.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+o)+(l?k+Math.abs(a-h).toFixed(l).slice(2):"")}function ramaddaJsonAllOpen(a){$("#"+a+" .ramadda-json-button").each(function(){ramaddaJsonSetVisible(a,$(this),"close")})}function ramaddaJsonAllClose(a){$("#"+a+" .ramadda-json-button").each(function(){ramaddaJsonSetVisible(a,$(this),"open")})}function ramaddaJsonSetVisible(e,a,c,b){var d=a.next(".ramadda-json-block");var d=a.next().next();if(!c){c=d.attr("block-state")}if(c=="close"){if(b){d.find(".ramadda-json-button").each(function(){ramaddaJsonSetVisible(e,$(this),"close")})}c="open";d.css("display","block");a.attr("src",icon_tree_open)}else{if(b){d.find(".ramadda-json-button").each(function(){ramaddaJsonSetVisible(e,$(this),"open")})}c="close";a.attr("src",icon_tree_closed);d.css("display","none")}d.attr("block-state",c)}function ramaddaJsonInit(d){var b=HtmlUtil.image(icon_tree_open,["class","ramadda-json-button","title","shift-click: toggle all"]);var a=HtmlUtil.onClick("ramaddaJsonAllOpen('"+d+"')","All Open",[])+"&nbsp;&nbsp;"+HtmlUtil.onClick("ramaddaJsonAllClose('"+d+"')","All Close",[]);$("#"+d).before(a);var c=$("#"+d+" .ramadda-json-block");c.prev(".ramadda-json-openbracket").before(b+" ");$("#"+d+" .ramadda-json-button").click(function(e){ramaddaJsonSetVisible(d,$(this),null,e.shiftKey)})};