function AreaWidget(f){var d="contains";var c="north";var h="south";var e="east";var b="west";var g="arealink";RamaddaUtil.inherit(this,{display:f,getHtml:function(){var p=this.display.getGet();var o=HtmlUtils.checkbox(this.display.getDomId(d),["title","Search mode: checked - contains, unchecked - overlaps"],false);var m=HtmlUtils.onClick(p+".areaWidget.areaLinkClick();",HtmlUtils.image(root+(this.linkArea?"/icons/link.png":"/icons/link_break.png"),[ATTR_TITLE,"Set bounds from map",ATTR_CLASS,"display-area-link","border","0",ATTR_ID,this.display.getDomId(g)]));var n=HtmlUtils.onClick(p+".areaWidget.useMyLocation();",HtmlUtils.image(root+"/icons/compass.png"),[ATTR_TITLE,"Set my location",ATTR_CLASS,"display-area-link","border","0"]);var l=HtmlUtils.onClick(p+".areaWidget.areaClear();",HtmlUtils.image(root+"/icons/eraser.png",[ATTR_TITLE,"Clear form",ATTR_CLASS,"display-area-link","border","0"]));var k=HtmlUtils.openTag(TAG_TABLE,[ATTR_CLASS,"display-area","border","0","cellpadding","0","cellspacing","0"]);k+=HtmlUtils.tr([],HtmlUtils.td(["align","center"],HtmlUtils.leftCenterRight(n,HtmlUtils.input(c,"",["placeholder"," N",ATTR_CLASS,"input display-area-input","size","5",ATTR_ID,this.display.getDomId(c),ATTR_TITLE,"North"]),m,"20%","60%","20%")));k+=HtmlUtils.tr([],HtmlUtils.td([],HtmlUtils.input(b,"",["placeholder"," W",ATTR_CLASS,"input  display-area-input","size","5",ATTR_ID,this.display.getDomId(b),ATTR_TITLE,"West"])+HtmlUtils.input(e,"",["placeholder"," E",ATTR_CLASS,"input  display-area-input","size","5",ATTR_ID,this.display.getDomId(e),ATTR_TITLE,"East"])));k+=HtmlUtils.tr([],HtmlUtils.td(["align","center"],HtmlUtils.leftCenterRight(l,HtmlUtils.input(h,"",["placeholder"," S",ATTR_CLASS,"input  display-area-input","size","5",ATTR_ID,this.display.getDomId(h),ATTR_TITLE,"South"]),o)));k+=HtmlUtils.closeTag(TAG_TABLE);return k},areaClear:function(){$("#"+this.display.getDomId(c)).val("");$("#"+this.display.getDomId(b)).val("");$("#"+this.display.getDomId(h)).val("");$("#"+this.display.getDomId(e)).val("");this.display.areaClear()},useMyLocation:function(){if(navigator.geolocation){var k=this;navigator.geolocation.getCurrentPosition(function(l){k.setUseMyLocation(l)})}else{}},setUseMyLocation:function(k){var l=k.coords.latitude;var n=k.coords.longitude;var m=5;if(this.display.myLocationOffset){m=parseFloat(this.display.myLocationOffset)}$("#"+this.display.getDomId(c)).val(l+m);$("#"+this.display.getDomId(b)).val(n-m);$("#"+this.display.getDomId(h)).val(l-m);$("#"+this.display.getDomId(e)).val(n+m);if(this.display.submitSearchForm){this.display.submitSearchForm()}},areaLinkClick:function(){this.linkArea=!this.linkArea;var l=root+(this.linkArea?"/icons/link.png":"/icons/link_break.png");$("#"+this.display.getDomId(g)).attr("src",l);if(this.linkArea&&this.lastBounds){var k=this.lastBounds;$("#"+this.display.getDomId(c)).val(formatLocationValue(k.top));$("#"+this.display.getDomId(b)).val(formatLocationValue(k.left));$("#"+this.display.getDomId(h)).val(formatLocationValue(k.bottom));$("#"+this.display.getDomId(e)).val(formatLocationValue(k.right))}},linkArea:false,lastBounds:null,handleEventMapBoundsChanged:function(l,k){bounds=k.bounds;this.lastBounds=bounds;if(!k.force&&!this.linkArea){return}$("#"+this.display.getDomId(c)).val(formatLocationValue(bounds.top));$("#"+this.display.getDomId(b)).val(formatLocationValue(bounds.left));$("#"+this.display.getDomId(h)).val(formatLocationValue(bounds.bottom));$("#"+this.display.getDomId(e)).val(formatLocationValue(bounds.right))},setSearchSettings:function(k){var l=$("#"+this.display.getDomId(d));if(l.is(":checked")){k.setAreaContains(true)}else{k.setAreaContains(false)}k.setBounds(this.display.getFieldValue(this.display.getDomId(c),null),this.display.getFieldValue(this.display.getDomId(b),null),this.display.getFieldValue(this.display.getDomId(h),null),this.display.getFieldValue(this.display.getDomId(e),null))}})}function DateRangeWidget(d){var b="date_start";var c="date_end";RamaddaUtil.inherit(this,{display:d,initHtml:function(){this.display.jq(b).datepicker();this.display.jq(c).datepicker()},setSearchSettings:function(f){var g=this.display.jq(b).val();var e=this.display.jq(b).val();f.setDateRange(g,e)},getHtml:function(){var e=HtmlUtils.input(b,"",["class","display-date-input","placeholder"," start date",ATTR_ID,d.getDomId(b),"size","10"])+" - "+HtmlUtils.input(c,"",["class","display-date-input","placeholder"," end date",ATTR_ID,d.getDomId(c),"size","10"]);return e}})}var ID_FIELDS="fields";var ID_HEADER="header";var ID_TITLE=ATTR_TITLE;var ID_TITLE_EDIT="title_edit";var ID_TOP_RIGHT="topright";var ID_DETAILS="details";var ID_DISPLAY_CONTENTS="contents";var ID_DISPLAY_TOP="top";var ID_DISPLAY_BOTTOM="bottom";var ID_GROUP_CONTENTS="group_contents";var ID_DETAILS_MAIN="detailsmain";var ID_TOOLBAR="toolbar";var ID_TOOLBAR_INNER="toolbarinner";var ID_LIST="list";var ID_DIALOG="dialog";var ID_DIALOG_TABS="dialog_tabs";var ID_DIALOG_BUTTON="dialog_button";var ID_FOOTER="footer";var ID_FOOTER_LEFT="footer_left";var ID_FOOTER_RIGHT="footer_right";var ID_MENU_BUTTON="menu_button";var ID_MENU_OUTER="menu_outer";var ID_MENU_INNER="menu_inner";var ID_REPOSITORY="repository";var displayDebug=false;var PROP_DISPLAY_FILTER="displayFilter";var PROP_EXCLUDE_ZERO="excludeZero";var PROP_DIVID="divid";var PROP_FIELDS="fields";var PROP_LAYOUT_HERE="layoutHere";var PROP_HEIGHT="height";var PROP_WIDTH="width";function initRamaddaDisplays(){ramaddaCheckForResize();if(window.globalDisplaysList==null){return}for(var b=0;b<window.globalDisplaysList.length;b++){window.globalDisplaysList[b].pageHasLoaded()}}function addGlobalDisplayProperty(b,c){if(window.globalDisplayProperties==null){window.globalDisplayProperties={}}window.globalDisplayProperties[b]=c}function getGlobalDisplayProperty(b){if(window.globalDisplayProperties==null){return null}return window.globalDisplayProperties[b]}function addRamaddaDisplay(b){if(window.globalDisplays==null){window.globalDisplays={};window.globalDisplaysList=[]}window.globalDisplaysList.push(b);window.globalDisplays[b.getId()]=b;if(b.displayId){window.globalDisplays[b.displayId]=b}}function ramaddaDisplayCheckLayout(){for(var b=0;b<window.globalDisplaysList.length;b++){if(window.globalDisplaysList[b].checkLayout){window.globalDisplaysList[b].checkLayout()}}}function ramaddaCheckForResize(){var b=false;var c=0;$(window).resize(function(){if(window.globalDisplaysList==null){return}if(b){c++;return}var d=function(f){if(f==c){b=false;c=0;for(var e=0;e<window.globalDisplaysList.length;e++){var g=window.globalDisplaysList[e];if(g.displayData){g.displayData()}}}else{setTimeout(d.bind(null,c),1000)}};b=true;setTimeout(d.bind(null,c),1000)})}function getRamaddaDisplay(b){if(window.globalDisplays==null){return null}return window.globalDisplays[b]}function removeRamaddaDisplay(c){var b=getRamaddaDisplay(c);if(b){b.removeDisplay()}}function DisplayThing(e,c){if(c==null){c={}}for(var d in c){if(typeof c[d]=="string"){if(c[d]=="true"){c[d]=true}else{if(c[d]=="false"){c[d]=false}}}}for(var h in c){var f=h.split(".");if(f.length<=1){continue}var b=c;var g=b;var k=c[h];if(k=="true"){k=true}else{if(k=="false"){k=false}}for(var d=0;d<f.length;d++){var l=f[d];if(d==f.length-1){b[l]=k;break}var m=b[l];if(m==null){b[l]={};b=b[l]}else{b=m}}}this.displayId=null;$.extend(this,c);RamaddaUtil.defineMembers(this,{objectId:e,properties:c,displayParent:null,getId:function(){return this.objectId},setId:function(n){this.objectId=n},getTimeZone:function(){return this.getProperty("timeZone")},formatDate:function(p,o){if(!p.getTime&&p.v){p=p.v}if(!p.toLocaleDateString){return""+p}if(!o){o={}}var q;if(!Utils.isDefined(o.suffix)){q=o.suffix}else{q=this.getProperty("dateSuffix")}var n=this.getTimeZone();if(!q&&n){q=n}return Utils.formatDate(p,o.options,{timeZone:n,suffix:q})},getUniqueId:function(n){return HtmlUtils.getUniqueId(n)},handleError:function(o,n){GuiUtils.handleError("An error has occurred:"+n,true,true)},toString:function(){return"DisplayThing:"+this.getId()},getDomId:function(n){return this.getId()+"_"+n},jq:function(n){return $("#"+this.getDomId(n))},writeHtml:function(o,n){$("#"+this.getDomId(o)).html(n)},getRecordHtml:function(s,t){var B=false;if(Utils.isDefined(this.showGeo)){B=(""+this.showGeo)=="true"}var z="<table class=formtable>";if(false&&s.hasLocation()){var u=s.getLatitude();var n=s.getLongitude();z+="<tr><td align=right><b>Latitude:</b></td><td>"+number_format(u,4,".","")+"</td></tr>";z+="<tr><td align=right><b>Longitude:</b></td><td>"+number_format(n,4,".","")+"</td></tr>"}for(var o=0;o<2;o++){for(var q=0;q<s.getData().length;q++){var w=t[q];if(o==0&&!w.derived){continue}else{if(o==1&&w.derived){continue}}var v=w.getLabel();v=this.formatRecordLabel(v);if(!B){if(w.isFieldGeo()){continue}}var x=s.getValue(q);if(typeof x=="number"){var y=x+"";if(y.indexOf(".")>=0){var p=1;if(Math.abs(x)<1.5){p=3}x=number_format(x,p,".","")}}z+="<tr><td align=right><b>"+v+":</b></td><td>"+x+w.getUnitSuffix()+"</td></tr>"}}if(s.hasElevation()){z+="<tr><td  align=right><b>Elevation:</b></td><td>"+number_format(s.getElevation(),4,".","")+"</td></tr>"}z+="</table>";return z},formatRecordLabel:function(n){n=n.replace(/!!/g," -- ");return n},getFormValue:function(p,o){var n=$("#"+this.getDomId(p)).val();if(n!=null){if(n.length>0){this.setProperty(p,n)}if(n=="none"){this.setProperty(p,null)}return n}return this.getProperty(p,o)},getName:function(){return this.getFormValue("name",this.getId())},getEventSource:function(){return this.getFormValue("eventSource","")},setDisplayParent:function(n){this.displayParent=n},getDisplayParent:function(){if(this.displayParent==null){this.displayParent=this.getLayoutManager()}return this.displayParent},removeProperty:function(n){this.properties[n]=null},setProperty:function(n,o){this[n]=o;this.properties[n]=o},getSelfProperty:function(n,o){if(this[n]!=null){return this[n]}return this.getProperty(n,o)},initTooltip:function(){},formatNumber:function(n){if(!this.getProperty("format",true)){return n}return Utils.formatNumber(n)},propertyDefined:function(n){return Utils.isDefined(this.getProperty(n))},getProperty:function(n,p){if(this[n]){return this[n]}var o=this.properties[n];if(o!=null){return o}if(this.displayParent!=null){return this.displayParent.getProperty(n,p)}if(this.getDisplayManager){return this.getDisplayManager().getProperty(n,p)}o=getGlobalDisplayProperty(n);if(o){return o}return p}})}function RamaddaDisplay(o,h,m,e){RamaddaUtil.initMembers(this,{orientation:"horizontal"});var g;RamaddaUtil.inherit(this,g=new DisplayThing(h,e));this.getSuper=function(){return g};if(this.derived){if(this.derived.indexOf("[")==0){this.derived=JSON.parse(this.derived)}else{this.derived=[JSON.parse(this.derived)]}for(var f=0;f<this.derived.length;f++){var l=this.derived[f];if(!Utils.isDefined(l.isRow)&&!Utils.isDefined(l.isColumn)){l.isRow=true;l.isColumn=false}if(!l.isRow&&!l.isColumn){l.isRow=true}}}else{}RamaddaUtil.defineMembers(this,{displayReady:Utils.getPageLoaded(),type:m,displayManager:o,filters:[],dataCollection:new DataCollection(),selectedCbx:[],entries:[],wikiAttrs:["title","showTitle","showDetails","minDate","maxDate"],getDisplayManager:function(){return this.displayManager},getLayoutManager:function(){return this.getDisplayManager().getLayoutManager()},propagateEvent:function(p,q){var d=this.getDisplayManager();d[p](this,q)},displayError:function(d){this.displayHtml(HtmlUtils.getErrorDialog(d))},clearHtml:function(){this.displayHtml("")},displayHtml:function(d){this.jq(ID_DISPLAY_CONTENTS).html(d)},notifyEvent:function(d,q,p){if(this[d]==null){return}this[d].apply(this,[q,p])},displayColorTable:function(q,s,p,d){Utils.displayColorTable(q,this.getDomId(s),p,d)},getColorTableName:function(d){var p;if(d){p=this.getProperty(d)}else{p=this.getProperty("colorBar",this.getProperty("colorTable"))}if(p=="none"){return null}return p},getColorTable:function(t,q,u){var p=this.getColorTableName(q);if(!p){p=u}if(p){var s=Utils.ColorTables[p];if(s&&t){return s.colors}if(!s&&q){return p.split(",")}return s}if(this.getProperty("colors")){var d=this.getProperty("colors");if((typeof d)=="object"){return d}return d.split(",")}return null},getColorByColors:function(q,z){var D=this.getProperty("colorBy");if(!D){return null}var p=this.getFieldById(fields,D);if(!p){return null}var v=this.getColumnValues(q,p);var d=this.getColorTable();if(!d){d=Utils.getColorTable(z||"blue_white_red")}if(!d){return null}var t=parseFloat(this.getProperty("colorByMin",v.min));var B=parseFloat(this.getProperty("colorByMax",v.max));if(d.colors){d=d.colors}var w=B-t;var s=[];for(var u=0;u<v.values.length;u++){var C=v.values[u];var y=(C-t)/w;var x=parseInt(y*d.length);if(x>=d.length){x=d.length-1}else{if(x<0){x=0}}s.push(d[x])}return{colors:s,min:t,max:B}},toString:function(){return"RamaddaDisplay:"+this.type+" - "+this.getId()},getType:function(){return this.type},getClass:function(d){if(d==null){return this.getBaseClass()}return this.getBaseClass()+"-"+d},getBaseClass:function(){return"display-"+this.getType()},setDisplayManager:function(d){this.displayManager=d;this.setDisplayParent(d.getLayoutManager())},setContents:function(d){d=HtmlUtils.div([ATTR_CLASS,"display-contents-inner display-"+this.getType()+"-inner"],d);this.writeHtml(ID_DISPLAY_CONTENTS,d)},addEntry:function(d){this.entries.push(d)},clearCachedData:function(){},setEntry:function(p){this.entries=[];this.addEntry(p);this.entry=p;this.entryId=p.getId();this.clearCachedData();if(this.properties.data){this.dataCollection=new DataCollection();var d={entryId:this.entryId,lat:this.getProperty("latitude"),lon:this.getProperty("longitude")};this.properties.data=this.data=new PointData(p.getName(),null,null,this.getRamadda().getRoot()+"/entry/show?entryid="+p.getId()+"&output=points.product&product=points.json&max=5000",d);this.data.loadData(this)}this.updateUI();var q="";if(this.getShowTitle()){q=p.getName();q=HtmlUtils.href(this.getRamadda().getEntryUrl(this.entryId),q);this.jq(ID_TITLE).html(q)}},handleEventFieldValueSelected:function(p,d){this.setProperty("filterPattern",d.value);this.setProperty("patternFilterField",d.field.getId());this.updateUI()},handleEventPropertyChanged:function(d,p){if(p.property=="filterPattern"){this.jq("filterValueMenu").val(p.value)}this.setProperty(p.property,p.value);this.updateUI()},handleEventRecordSelection:function(u,p){if(!u.getEntries){return}var d=u.getEntries();for(var q=0;q<d.length;q++){var t=d[q];var s=this.getEntries().indexOf(t)>=0;if(s){this.highlightEntry(t);break}}},areaClear:function(){this.getDisplayManager().notifyEvent("handleEventAreaClear",this)},handleEventEntryMouseover:function(p,d){},handleEventEntryMouseout:function(p,d){},handleEventEntrySelection:function(q,d){var p=this.getEntries().indexOf(d.entry)>=0;if(!p){return}if(d.selected){$("#"+this.getDomId(ID_TITLE)).addClass("display-title-select")}else{$("#"+this.getDomId(ID_TITLE)).removeClass("display-title-select")}},highlightEntry:function(d){$("#"+this.getDomId(ID_TITLE)).addClass("display-title-select")},getEntries:function(){return this.entries},getDisplayEntry:function(){var d=this.getEntries();if(d!=null&&d.length>0){return d[0]}if(this.entryId){var p={call:function(q){console.log("got entry "+q)}};return this.getRamadda().getEntry(this.entryId,p)}return null},hasEntries:function(){return this.entries!=null&&this.entries.length>0},getWaitImage:function(){return HtmlUtils.image(ramaddaBaseUrl+"/icons/progress.gif")},getLoadingMessage:function(d){if(!d){d="Loading data..."}return HtmlUtils.div(["text-align","center"],this.getMessage("&nbsp;"+d))},getMessage:function(d){return HtmlUtils.div([ATTR_CLASS,"display-message"],d)},getFieldValue:function(q,d){var p=$("#"+q);if(p.size()>0){return p.val()}return d},getFooter:function(){return HtmlUtils.div([ATTR_ID,this.getDomId(ID_FOOTER),ATTR_CLASS,"display-footer"],HtmlUtils.leftRight(HtmlUtils.div([ATTR_ID,this.getDomId(ID_FOOTER_LEFT),ATTR_CLASS,"display-footer-left"],""),HtmlUtils.div([ATTR_ID,this.getDomId(ID_FOOTER_RIGHT),ATTR_CLASS,"display-footer-right"],"")))},checkFixedLayout:function(){if(this.getIsLayoutFixed()){var p=this.getProperty(PROP_DIVID);if(p!=null){var d=this.getHtml();$("#"+p).html(d)}}},shouldSkipField:function(d){if(this.skipFields&&!this.skipFieldsList){this.skipFieldsList=this.skipFields.split(",")}if(this.skipFieldsList){return this.skipFieldsList.indexOf(d.getId())>=0}return false},fieldSelected:function(p){this.userHasSelectedAField=true;this.selectedFields=null;this.overrideFields=null;this.removeProperty(PROP_FIELDS);this.fieldSelectionChanged();if(p.shiftKey){var d=this.getSelectedFields();this.propagateEvent("handleEventFieldsSelected",d)}},addFieldsCheckboxes:function(E){if(!this.hasData()){return}var P=this.getProperty(PROP_FIELDS);if(P!=null){if(P.length==0){P=null}}var D="";var u=this.getId()+"_checkbox";var G=this.getId()+"_groupby";var B=this.dataCollection.getList();if(E!=null){this.overrideFields=[]}var y={};var L=this.dataCollection.getList()[0].getRecordFields();var K={};var x=null;for(var t=0;t<B.length;t++){var N=B[t];var I=this.getFieldsToSelect(N);if(this.canDoGroupBy()){var L=N.getRecordFields();var M=0;for(f=0;f<L.length;f++){var q=L[f];if(q.getType()!="string"){continue}if(M==0){D+=HtmlUtils.div([ATTR_CLASS,"display-dialog-subheader"],"Group By");D+=HtmlUtils.openTag(TAG_DIV,[ATTR_CLASS,"display-fields"]);var C=this.groupBy==null||this.groupBy=="";D+=HtmlUtils.tag(TAG_DIV,[ATTR_TITLE,"none"],HtmlUtils.radio("none",this.getDomId("groupby"),G,"none",!C)+" None")}M++;var C=this.groupBy==q.getId();var d="groupby_"+t+"_"+f;q.radioId=this.getDomId(d);D+=HtmlUtils.tag(TAG_DIV,[ATTR_TITLE,q.getId()],HtmlUtils.radio(q.radioId,this.getDomId("groupby"),G,q.getId(),C)+" "+q.getUnitLabel()+" ("+q.getId()+")")}if(M>0){D+=HtmlUtils.closeTag(TAG_DIV)}}if(I.length>0){var H=this.getSelectedFields([]);var w=[];for(f=0;f<H.length;f++){w.push(H[f].getId())}var O="";D+=HtmlUtils.div([ATTR_CLASS,"display-dialog-subheader"],"Displayed Fields");D+=HtmlUtils.openTag(TAG_DIV,[ATTR_CLASS,"display-fields"]);for(var s=0;s<I.length;s++){var q=I[s];var d="cbx_"+t+"_"+s;q.checkboxId=this.getDomId(d);var C=false;var F=(x?x[q.getIndex()]:true);if(E!=null){for(var p=0;p<E.length;p++){if(E[p].getId()==q.getId()){C=true;this.overrideFields.push(q.getId());break}}}else{if(w.length>0){C=w.indexOf(q.getId())>=0}else{if(P!=null){C=(P.indexOf(q.getId())>=0);if(!C){C=(P.indexOf("#"+(s+1))>=0)}}else{if(this.overrideFields!=null){C=this.overrideFields.indexOf(q.getId())>=0;if(!C){C=(this.overrideFields.indexOf("#"+(s+1))>=0)}}else{if(this.selectedCbx.indexOf(q.getId())>=0){C=true}else{if(this.selectedCbx.length==0){C=(f==0)}}}}}}var z=q.getUnitLabel();if(y[z]){z=z+" "+y[z];y[z]++}else{y[z]=1}if(!F){O+=HtmlUtils.div([],z)}else{if(q.derived){z+=" (derived)"}var v;if(this.canDoMultiFields()){v=HtmlUtils.checkbox(q.checkboxId,["class",u],C)}else{v=HtmlUtils.radio(q.checkboxId,"field_radio",u,"",C)}D+=HtmlUtils.tag(TAG_DIV,[ATTR_TITLE,q.getId()],v+" "+z)}}}if(O!=""){D+=HtmlUtils.div(["style","border-top:1px #888  solid;"],"<b>No Data Available</b>"+O)}D+=HtmlUtils.closeTag(TAG_DIV)}this.writeHtml(ID_FIELDS,D);this.userHasSelectedAField=false;var J=this;$("."+u).click(function(Q){J.fieldSelected(Q)});$("."+G).change(function(Q){J.groupBy=$(this).val();if(J.displayData){J.displayData()}})},fieldSelectionChanged:function(){var d="the display";this.setDisplayTitle();if(this.displayData){this.clearCachedData();this.displayData()}},defaultSelectedToAll:function(){return false},setSelectedFields:function(d){this.clearCachedData();this.selectedFields=d;this.addFieldsCheckboxes(d)},getSelectedFields:function(p){this.debugSelected=false;this.lastSelectedFields=this.getSelectedFieldsInner(p);var d=this.getProperty(PROP_FIELDS);if(d){d.length=0}this.setDisplayTitle();return this.lastSelectedFields},getSelectedFieldsInner:function(C){if(this.debugSelected){console.log("getSelectedFields dflt:"+(C?C.length:"null"))}if(this.selectedFields){if(this.debugSelected){console.log("\tgot this.selectedFields")}return this.selectedFields}var G=[];var u=this.dataCollection.getList();var H=this.getProperty(PROP_FIELDS);for(var s=0;s<u.length;s++){var E=u[s];var y=this.getFieldsToSelect(E);if(H!=null&&H.length>0){if(this.debugSelected){console.log("\thave fixed fields:"+H.length)}for(var B=0;B<H.length;B++){var t=H[B];if(this.debugSelected){console.log("\t\tfield:"+t)}for(var z=0;z<y.length;z++){var q=y[z];var x=q.getId();if(this.debugSelected){console.log("\t\t\tid:"+x)}if(x==t||("#"+(z+1))==t){if(this.debugSelected){console.log("\t\t\tgot:"+q.getLabel())}G.push(q);break}}}}}if(H!=null&&H.length>0){if(this.debugSelected){console.log("\tfrom fixed:"+G.length)}return G}var d=null;var F=null;this.selectedCbx=[];var v=false;for(var s=0;s<u.length;s++){var E=u[s];d=this.getFieldsToSelect(E);for(B=0;B<d.length;B++){var q=d[B];if(F==null&&q.isNumeric){F=q}var p="cbx_"+s+"_"+B;var D=this.getDomId(p);var w=$("#"+D);if(w.size()){v=true}else{continue}if(w.is(":checked")){this.selectedCbx.push(q.getId());G.push(q)}}}if(G.length==0&&!v){if(this.lastSelectedFields&&this.lastSelectedFields.length>0){if(this.debugSelected){console.log("\tlastSelectedFields")}return this.lastSelectedFields}}if(G.length==0){G=this.getDefaultSelectedFields(d,C);if(this.debugSelected){console.log("\tgetDefault:"+G.length)}}return G},getDefaultSelectedFields:function(d,s){if(this.defaultSelectedToAll()&&this.allFields!=null){var p=[];for(f=0;f<this.allFields.length;f++){var q=this.allFields[f];if(!q.isFieldGeo()){p.push(q)}}return p}if(s!=null){return s}for(f=0;f<d.length;f++){var q=d[f];if(q.isNumeric&&!q.isFieldGeo()){return[q]}}return[]},getFieldById:function(p,t){if(!t){return null}if(!p){var d=this.getData();if(d==null){return null}p=d.getRecordFields()}for(var q=0;q<p.length;q++){var s=p[q];if(s.getId()==t||t==("#"+q)){return s}}return null},getFieldsByIds:function(p,s){var d=[];if(!s){return d}if((typeof s)=="string"){s=s.split(",")}for(var q=0;q<s.length;q++){var t=this.getFieldById(p,s[q]);if(t){d.push(t)}}return d},getFieldOfType:function(d,p){d=this.getFieldsOfType(d,p);if(d.length==0){return null}return d[0]},getFieldsOfType:function(p,s){if(!p){var d=this.getData();if(d==null){return null}p=d.getRecordFields()}var t=[];var q=(s=="numeric");for(a in p){var u=p[a];if(s==null){return u}if(q){if(u.isFieldNumeric()){t.push(u)}}else{if(u.getType()==s){t.push(u)}}}return t},getColumnValues:function(p,u){var w=[];var q=Number.MAX_VALUE;var t=Number.MIN_VALUE;for(var d=0;d<p.length;d++){var s=p[d];var x=s.getData();var v=x[u.getIndex()];w.push(v);if(Utils.isNumber(v)){q=Math.min(q,v);t=Math.max(t,v)}}return{values:w,min:q,max:t}},filterData:function(t,B){if(!t){var K=this.getData();if(K==null){return null}t=K.getRecords()}if(!B){B=K.getRecordFields()}var u=this.getProperty("patternFilterField");var P=this.getProperty("numericFilterField");var L=this.getProperty("filterPattern");var G=this.getProperty("filterPatternPrefix");if(G){L=G+L}var p=this.getProperty("filterPatternSuffix");if(p){L=L+p}var D=false;if(L){D=L.startsWith("!");if(D){L=L.substring(1)}}var J=this.getProperty("numericFilterValue");var z=this.getProperty("numericFilterOperator","<");if((P||u)&&(L||(J&&z))){var H=this.getFieldsByIds(B,u);var d=null;for(var I=0;I<B.length;I++){if(!d&&(B[I].getId()==P||P=="#"+(I+1))){d=B[I]}if(y&&d){break}}if(H.length||d){var M=[];var N;if(J){N=parseFloat(J)}var v=false;if(t.length>0){v=t[0].isPointRecord}for(var I=0;I<t.length;I++){var x=t[I];var q=this.getDataValues(x);var s=q;if(!v&&I==0){M.push(x);continue}var w=false;if(d&&J&&z){var E=parseFloat(s[d.getIndex()]);var N=parseFloat(J);if(z=="<"){w=E<N}else{if(z=="<="){w=E<=N}else{if(z=="=="){w=E==N}else{if(z==">"){w=E>N}else{if(z==">="){w=E>=N}}}}}if(!w){continue}}if(H.length&&L){for(var O=0;O<H.length;O++){var y=H[O];var E=""+s[y.getIndex()];w=E.match(L);if(D){w=!w}if(w){break}}}if(w){M.push(x)}}t=M}}var C=parseInt(this.getProperty("stride",-1));if(C>0){var M=[];var F=0;for(var I=0;I<t.length;I+=(C+1)){M.push(t[I])}t=M}return t},canDoGroupBy:function(){return false},canDoMultiFields:function(){return true},useChartableFields:function(){return true},getFieldsToSelect:function(d){if(this.useChartableFields()){return d.getChartableFields(this)}return d.getRecordFields()},getGet:function(){return"getRamaddaDisplay('"+this.getId()+"')"},publish:function(w){if(w==null){w="wikipage"}var v=[];var p=prompt("Name","");if(p==null){return}v.push("name");v.push(p);v.push("type");v.push(w);var t="";var z="";if(w=="wikipage"){z+='+section label="{{name}}"\n${extra}\n'}else{if(w=="blogentry"){z="<wiki>\n"}}z+=t;z+=this.getWikiText();for(var q=0;q<this.displays.length;q++){var u=this.displays[q];if(u.getIsLayoutFixed()){continue}z+=u.getWikiText()}if(w=="wikipage"){z+="-section\n\n"}else{if(w=="blogentry"){}}var y="";var s=this.getChildEntries();for(var q=0;q<s.length;q++){var x=s[q];y+=x.getId()+","}if(s.length>0){v.push("entries");v.push(y)}if(w=="media_photoalbum"){z=""}v.push("description_encoded");v.push(window.btoa(z));var d=HtmlUtils.getUrl(ramaddaBaseUrl+"/entry/publish",v);window.open(d,"_blank")},getChildEntries:function(v){var p={};var t=[];for(var s=0;s<this.displays.length;s++){var u=this.displays[s];if(!v&&u.getIsLayoutFixed()){continue}if(u.getEntries){var d=u.getEntries();if(d){for(var q=0;q<d.length;q++){if(p[d[q].getId()]!=null){continue}p[d[q].getId()]=true;t.push(d[q])}}}}return t},copyDisplayedEntries:function(){var s=[];for(var q=0;q<this.displays.length;q++){var t=this.displays[q];if(t.getIsLayoutFixed()){continue}if(t.getEntries){var d=t.getEntries();if(d){for(var p=0;p<d.length;p++){s.push(d[p])}}}}return this.copyEntries(s)},defineWikiAttributes:function(p){for(var d=0;d<p.length;d++){if(this.wikiAttrs.indexOf(p[d])<0){this.wikiAttrs.push(p[d])}}},getWikiAttributes:function(p){for(var q=0;q<this.wikiAttrs.length;q++){var d=this[this.wikiAttrs[q]];if(Utils.isDefined(d)){p.push(this.wikiAttrs[q]);p.push(d)}}},getWikiText:function(){var q=["layoutHere","false","type",this.type,"column",this.getColumn(),"row",this.getRow()];this.getWikiAttributes(q);var s=null;if(this.getEntries){var d=this.getEntries();if(d&&d.length>0){s=d[0].getId()}}if(!s){s=this.entryId}if(s){q.push("entry");q.push(s)}var p="{{display "+HtmlUtils.attrs(q)+"}}\n\n";return p},copyEntries:function(d){var u=[];var p={};for(var t=0;t<d.length;t++){var v=d[t];if(p[v.getId()]!=null){continue}p[v.getId()]=v;u.push(v)}var w="";for(var s=0;s<u.length;s++){var v=u[s];w+=v.getId()+","}var q=ramaddaBaseUrl+"/entry/copy?action.force=copy&from="+w;window.open(q,"_blank")},entryHtmlHasBeenDisplayed:function(q){if(q.getIsGroup()){var p=this;var s=function(t){var u=HtmlUtils.openTag(TAG_OL,[ATTR_CLASS,"display-entrylist-list",ATTR_ID,p.getDomId(ID_LIST)]);u+=p.getEntriesTree(t);u+=HtmlUtils.closeTag(TAG_OL);p.jq(ID_GROUP_CONTENTS+q.getIdForDom()).html(u);p.addEntrySelect()};var d=q.getChildrenEntries(s)}},getEntryHtml:function(q,t){var x={showHeader:true,headerRight:false,showDetails:this.getShowDetails()};$.extend(x,t);t=x;var d=this.getEntryMenuButton(q);var z="";if(t.showHeader){var u=d+" "+q.getLink(q.getIconImage()+" "+q.getName());if(t.headerRight){z+=HtmlUtils.leftRight(u,t.headerRight)}else{z+=u}}var v=HtmlUtils.getUniqueId("entry_");z+=HtmlUtils.div(["id",v],"");if(false){var w=this.getRamadda().getRoot()+"/entry/show?entryid="+q.getId()+"&decorate=false&output=metadataxml&details=true";console.log(w);$("#"+v).load(w,function(){alert("Load was performed.")})}z+=q.getDescription();var B=q.getMetadata();if(q.isImage()){var H=HtmlUtils.tag(TAG_IMG,["src",q.getResourceUrl(),ATTR_CLASS,"display-entry-image"]);z+=HtmlUtils.href(q.getResourceUrl(),H)+"<br>"}else{for(var F=0;F<B.length;F++){if(B[F].type=="content.thumbnail"){var D=B[F].value.attr1;var w;if(D.indexOf("http")==0){w=D}else{w=ramaddaBaseUrl+"/metadata/view/"+D+"?element=1&entryid="+q.getId()+"&metadata.id="+B[F].id+"&thumbnail=false"}z+=HtmlUtils.image(w,[ATTR_CLASS,"display-entry-thumbnail"])}}}if(q.getIsGroup()){z+=HtmlUtils.div([ATTR_ID,this.getDomId(ID_GROUP_CONTENTS+q.getIdForDom())],"")}z+=HtmlUtils.formTable();if(t.showDetails){if(q.url){z+=HtmlUtils.formEntry("URL:",HtmlUtils.href(q.url,q.url))}if(q.remoteUrl){z+=HtmlUtils.formEntry("URL:",HtmlUtils.href(q.remoteUrl,q.remoteUrl))}if(q.remoteRepository){z+=HtmlUtils.formEntry("From:",HtmlUtils.href(q.remoteRepository.url,q.remoteRepository.name))}}var p=q.getAttributes();if(q.getFilesize()>0){z+=HtmlUtils.formEntry("File:",q.getFilename()+" "+HtmlUtils.href(q.getResourceUrl(),HtmlUtils.image(ramaddaBaseUrl+"/icons/download.png"))+" "+q.getFormattedFilesize())}for(var C=0;C<p.length;C++){var s=p[C];var y=s.value;if(s.getCanShow&&!s.getCanShow()){continue}if(Utils.isFalse(s.canshow)){continue}if(s.isUrl&&s.isUrl()){var G="";var E=y.split("\n");for(var F=0;F<E.length;F++){var w=E[F].trim();if(w.length==0){continue}G+=HtmlUtils.href(w,w);G+="<br>"}y=G}z+=HtmlUtils.formEntry(s.label+":",y)}z+=HtmlUtils.closeTag(TAG_TABLE);return z},getEntriesTree:function(K,x){if(!x){x={}}var d=this.getProperty("entryColumns",null);if(d!=null){var v=this.getProperty("columnNames",null);if(v!=null){v=v.split(",")}d=d.split(",");var Q=[];var L=[];for(var R=0;R<d.length;R++){var O=d[R].split(":");var M=null,W=null;if(O.length>1){if(O[0]=="property"){W="property";M=d[R]}else{M=O[0];W=O[1]}}else{M=d[R];W=M}Q.push(M);L.push(W)}d=Q;if(v==null){v=L}return this.getEntriesTable(K,d,v)}var t=x.suffix;var N="";if(!t){t="null"}else{N=t;t="'"+t+"'"}var S=x.showIndex;var H="";var P="entryrow_"+this.getId();var E=true;if(this.entriesMap==null){this.entriesMap={}}for(var R=0;R<K.length;R++){E=!E;var q=K[R];this.entriesMap[q.getId()]=q;var I=this.makeEntryToolbar(q);var T=this.getEntryMenuButton(q);var F=q.getDisplayName();if(F.length>100){F=F.substring(0,99)+"..."}var V=q.getIconImage([ATTR_TITLE,"View entry"]);var D=HtmlUtils.tag(TAG_A,[ATTR_HREF,q.getEntryUrl()],V+" "+F);F="";var B=q.getIdForDom()+N;var w=q.getId();var u=HtmlUtils.image(icon_tree_closed,[ATTR_BORDER,"0","tree-open","false",ATTR_ID,this.getDomId(ID_TREE_LINK+B)]);var C=this.getGet()+".toggleEntryDetails(event, '"+w+"',"+t+");";var z=this.getGet()+".entryHeaderClick(event, '"+w+"',"+t+"); ";var J=HtmlUtils.onClick(C,u);var p="";if(S){p="#"+(R+1)+" "}var y=HtmlUtils.div([ATTR_CLASS,"display-entrylist-name"],T+" "+J+" "+p+D+" "+F);var U=HtmlUtils.div([ATTR_ID,this.getDomId(ID_DETAILS+B),ATTR_CLASS,"display-entrylist-details"],HtmlUtils.div([ATTR_CLASS,"display-entrylist-details-inner",ATTR_ID,this.getDomId(ID_DETAILS_INNER+B)],""));var G;if(this.getProperty("showToolbar",true)){G=HtmlUtils.leftCenterRight(y,"",I,"80%","1%","19%")}else{G=y}var s=HtmlUtils.div(["onclick",z,ATTR_ID,this.getDomId(ID_DETAILS_MAIN+B),ATTR_CLASS,"display-entrylist-entry-main entry-main-display-entrylist-"+(E?"even":"odd"),ATTR_ENTRYID,w],G);var G=HtmlUtils.div(["class",(E?"ramadda-row-even":"ramadda-row-odd"),ATTR_ID,this.getDomId("entryinner_"+B)],s+U);H+=HtmlUtils.tag(TAG_DIV,[ATTR_ID,this.getDomId("entry_"+B),ATTR_ENTRYID,w,ATTR_CLASS,"display-entrylist-entry"+P],G);H+="\n"}return H},addEntrySelect:function(){var d=this;var p=$("#"+this.getDomId(ID_DISPLAY_CONTENTS)+"  ."+this.getClass("entry-main"));p.unbind();p.mouseover(function(w){var u=$(this).attr(ATTR_ENTRYID);entry=d.getEntry(u);if(!entry){console.log("no entry:"+u);return}d.propagateEvent("handleEventEntryMouseover",{entry:entry});if(true){return}var y=Utils.cleanId(u);var t=d.getEntryToolbarId(y);var v=$("#"+t);v.show();var q="right top+1";var s="right top";var x=d.getDomId(ID_DETAILS_MAIN+y);v.position({of:$("#"+x),my:q,at:s,collision:"none none"})});p.mouseout(function(u){var s=$(this).attr(ATTR_ENTRYID);entry=d.getEntry(s);if(!entry){return}d.propagateEvent("handleEventEntryMouseout",{entry:entry});var v=Utils.cleanId(s);var q=d.getEntryToolbarId(s);var t=$("#"+q)});if(this.madeList){}this.madeList=true;if(false){this.jq(ID_LIST).selectable({cancel:"a",selected:function(u,v){var q=v.selected.getAttribute(ATTR_ENTRYID);d.toggleEntryDetails(u,q);if(true){return}d.hideEntryDetails(q);var t=d.getEntry(q);if(t==null){return}var s=null;if(u.shiftKey){s={zoomIn:true}}d.selectedEntries.push(t);d.propagateEvent("handleEventEntrySelection",{entry:t,selected:true,zoom:s});d.lastSelectedEntry=t},unselected:function(u,v){if(true){return}var s=v.unselected.getAttribute(ATTR_ENTRYID);var t=d.getEntry(s);var q=d.selectedEntries.indexOf(t);if(q>-1){d.selectedEntries.splice(q,1);d.propagateEvent("handleEventEntrySelection",{entry:t,selected:false})}}})}},getEntriesTable:function(x,t,B){if(this.entriesMap==null){this.entriesMap={}}var d=this.getProperty("columnWidths",null);if(d!=null){d=d.split(",")}var w=HtmlUtils.openTag(TAG_TABLE,[ATTR_WIDTH,"100%","cellpadding","0","cellspacing","0"]);w+=HtmlUtils.openTag(TAG_TR,["valign","top"]);for(var v=0;v<B.length;v++){w+=HtmlUtils.td([ATTR_ALIGN,"center",ATTR_CLASS,"display-entrytable-header"],B[v])}w+=HtmlUtils.closeTag(TAG_TR);for(var v=0;v<x.length;v++){w+=HtmlUtils.openTag(TAG_TR,["valign","top"]);var D=x[v];this.entriesMap[D.getId()]=D;for(var u=0;u<t.length;u++){var p=null;if(d!=null){p=d[u]}var s=t[u];var C="";if(s=="name"){C=HtmlUtils.tag(TAG_A,[ATTR_HREF,D.getEntryUrl()],D.getName())}else{if(s.match(".*property:.*")){var y=s.substring("property:".length);var z=D.getMetadata();C="";for(var u=0;u<z.length;u++){var q=z[u];if(q.type==y){if(C!=""){C+="<br>"}C+=q.value.attr1}}}else{if(s=="description"){C=D.getDescription()}else{if(s=="date"){C=D.ymd;if(C==null){C=D.startDate}}else{C=D.getAttributeValue(s)}}}}var E=[ATTR_CLASS,"display-entrytable-cell"];if(p!=null){E.push(ATTR_WIDTH);E.push(p)}w+=HtmlUtils.td(E,C)}w+=HtmlUtils.closeTag(TAG_TR)}w+=HtmlUtils.closeTag(TAG_TABLE);return w},makeEntryToolbar:function(v){var p=this.getGet();var w=[];if(v.getType().getId()=="type_wms_layer"){w.push(HtmlUtils.tag(TAG_A,["onclick",p+".addMapLayer("+HtmlUtils.sqt(v.getId())+");"],HtmlUtils.image(ramaddaBaseUrl+"/icons/map.png",["border",0,ATTR_TITLE,"Add Map Layer"])))}if(v.getType().getId()=="geo_shapefile"){w.push(HtmlUtils.tag(TAG_A,["onclick",p+".addMapLayer("+HtmlUtils.sqt(v.getId())+");"],HtmlUtils.image(ramaddaBaseUrl+"/icons/map.png",["border",0,ATTR_TITLE,"Add Map Layer"])))}var u=this.getPointUrl(v);if(u!=null){u=u.replace(/\'/g,"_");w.push(HtmlUtils.tag(TAG_A,["onclick",p+".createDisplay("+HtmlUtils.sqt(v.getFullId())+","+HtmlUtils.sqt("table")+","+HtmlUtils.sqt(u)+");"],HtmlUtils.image(ramaddaBaseUrl+"/icons/table.png",["border",0,ATTR_TITLE,"Create Tabular Display"])));var d;w.push(d=HtmlUtils.tag(TAG_A,["onclick",p+".createDisplay("+HtmlUtils.sqt(v.getFullId())+","+HtmlUtils.sqt("linechart")+","+HtmlUtils.sqt(u)+");"],HtmlUtils.image(ramaddaBaseUrl+"/icons/chart_line_add.png",["border",0,ATTR_TITLE,"Create Chart"])))}w.push(HtmlUtils.tag(TAG_A,["onclick",p+".createDisplay("+HtmlUtils.sqt(v.getFullId())+","+HtmlUtils.sqt("entrydisplay")+","+HtmlUtils.sqt(u)+");"],HtmlUtils.image(ramaddaBaseUrl+"/icons/layout_add.png",["border",0,ATTR_TITLE,"Show Entry"])));if(v.getFilesize()>0){w.push(HtmlUtils.tag(TAG_A,[ATTR_HREF,v.getResourceUrl()],HtmlUtils.image(ramaddaBaseUrl+"/icons/download.png",["border",0,ATTR_TITLE,"Download ("+v.getFormattedFilesize()+")"])))}var t=this.getEntryMenuButton(v);var s=[];for(var q=0;q<w.length;q++){s.push(HtmlUtils.div([ATTR_CLASS,"display-entry-toolbar-item"],w[q]))}w=s;return HtmlUtils.div([ATTR_CLASS,"display-entry-toolbar",ATTR_ID,this.getEntryToolbarId(v.getIdForDom())],HtmlUtils.join(w,""))},getEntryToolbarId:function(d){var p=d.replace(/:/g,"_");p=p.replace(/=/g,"_");return this.getDomId(ID_TOOLBAR+"_"+p)},hideEntryDetails:function(d){},entryHeaderClick:function(p,d,s){var q=p.target;if(q.outerHTML){if(q.outerHTML.indexOf("<div")!=0){return}}this.toggleEntryDetails(p,d)},toggleEntryDetails:function(p,s,D){var z=this.getEntry(s);if(D==null){D=""}var y=this.jq(ID_TREE_LINK+z.getIdForDom()+D);var q=ID_DETAILS+z.getIdForDom()+D;var d=this.jq(q);var w=this.jq(ID_DETAILS_INNER+z.getIdForDom()+D);if(p&&p.shiftKey){var q=Utils.cleanId(s);var E=this.jq(ID_DETAILS_MAIN+q);if(!this.selectedEntriesFromTree){this.selectedEntriesFromTree={}}var t=E.attr("ramadda-selected")=="true";if(t){E.removeClass("display-entrylist-entry-main-selected");E.attr("ramadda-selected","false");this.selectedEntriesFromTree[z.getId()]=null}else{E.addClass("display-entrylist-entry-main-selected");E.attr("ramadda-selected","true");this.selectedEntriesFromTree[z.getId()]=z}this.propagateEvent("handleEventEntrySelection",{entry:z,selected:!t});return}var v=y.attr("tree-open")=="true";if(v){y.attr("src",icon_tree_closed)}else{y.attr("src",icon_tree_open)}y.attr("tree-open",v?"false":"true");var x=d.attr("has-content")!=null;d.attr("has-content","true");if(x){}else{if(z.getIsGroup()){w.html(HtmlUtils.image(icon_progress));var C=this;var B=function(F){C.displayChildren(z,F,D)};var u=z.getChildrenEntries(B)}else{w.html(this.getEntryHtml(z,{showHeader:false}))}}if(v){d.hide()}else{d.show()}if(p&&p.stopPropagation){p.stopPropagation()}},getSelectedEntriesFromTree:function(){var d=[];if(this.selectedEntriesFromTree){for(var q in this.selectedEntriesFromTree){var p=this.selectedEntriesFromTree[q];if(p!=null){d.push(p)}}}return d},displayChildren:function(t,d,u){if(!u){u=""}var p=this.jq(ID_DETAILS_INNER+t.getIdForDom()+u);var q=this.getEntryHtml(t,{showHeader:false});if(d.length==0){p.html(q)}else{var s="";if(this.showDetailsForGroup){s+=q}s+=this.getEntriesTree(d);p.html(s);this.addEntrySelect()}},getEntryMenuButton:function(p){var d=HtmlUtils.onClick(this.getGet()+".showEntryMenu(event, '"+p.getId()+"');",HtmlUtils.image(ramaddaBaseUrl+"/icons/menu.png",[ATTR_CLASS,"display-entry-toolbar-item",ATTR_ID,this.getDomId(ID_MENU_BUTTON+p.getIdForDom())]));return d},setRamadda:function(d){this.ramadda=d},getRamadda:function(){if(this.ramadda!=null){return this.ramadda}if(this.ramaddaBaseUrl!=null){this.ramadda=getRamadda(this.ramaddaBaseUrl);return this.ramadda}return getGlobalRamadda()},getEntry:function(d,t){if(this.entriesMap&&this.entriesMap[d]){return this.entriesMap[d]}var q=this.getRamadda();var s=d.split(",");if(s.length==2){d=s[1];q=getRamadda(s[0])}var p=null;if(this.entryList!=null){p=this.entryList.getEntry(d)}if(p==null){p=q.getEntry(d)}if(p==null){console.log("Display.getEntry: entry not found id="+d+" repository="+q.getRoot());p=this.getRamadda().getEntry(d,t)}return p},addMapLayer:function(d){var p=this.getEntry(d);if(p==null){console.log("No entry:"+d);return}this.getDisplayManager().addMapLayer(this,p)},doit:function(){console.log("doit")},createDisplay:function(s,d,q){console.log("createDisplay: "+s+" "+d+" "+q);var t=this.getEntry(s);if(t==null){console.log("No entry:"+s);return null}var p={showMenu:true,sourceEntry:t,entryId:t.getId(),showTitle:true,showDetails:true,title:t.getName()};if(d!=DISPLAY_ENTRYLIST){if(q==null){q=this.getPointUrl(t)}var u={entry:t,entryId:t.getId()};p.data=new PointData(t.getName(),null,null,q,u)}if(this.lastDisplay!=null){p.column=this.lastDisplay.getColumn();p.row=this.lastDisplay.getRow()}else{p.column=this.getProperty("newColumn",this.getColumn());p.row=this.getProperty("newRow",this.getRow())}this.lastDisplay=this.getDisplayManager().createDisplay(d,p)},getPointUrl:function(p){var d=p.getService("points.json");if(d!=null){return d.url}d=p.getService("grid.point.json");if(d!=null){return d.url}return null},getEntryMenu:function(s){var D=this.getEntry(s);if(D==null){return"null entry"}var q=this.getGet();var t=[];var u=[];var z=[];var d=[];z.push(HtmlUtils.tag(TAG_LI,[],HtmlUtils.tag(TAG_A,["href",D.getEntryUrl(),"target","_"],"View Entry")));if(D.getFilesize()>0){u.push(HtmlUtils.tag(TAG_LI,[],HtmlUtils.tag(TAG_A,["href",D.getResourceUrl()],"Download "+D.getFilename()+" ("+D.getFormattedFilesize()+")")))}if(this.jsonUrl!=null){u.push(HtmlUtils.tag(TAG_LI,[],"Data: "+HtmlUtils.onClick(q+".fetchUrl('json');","JSON")+HtmlUtils.onClick(q+".fetchUrl('csv');","CSV")))}var B="<a>New</a><ul>";B+=HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(q+".createDisplay('"+D.getFullId()+"','entrydisplay');","New Entry Display"));d.push(HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(q+".createDisplay('"+D.getFullId()+"','entrydisplay');","New Entry Display")));var y=this.getPointUrl(D);if(y!=null){var w=window.globalDisplayTypes;var C={};if(w){for(var v=0;v<w.length;v++){var x=w[v];if(!x.requiresData||!x.forUser){continue}if(!Utils.isDefined(C[x.category])){C[x.category]="<li> <a>"+x.category+"</a><ul>\n"}y=y.replace(/\'/g,"_");var G=q+".createDisplay("+HtmlUtils.sqt(D.getFullId())+","+HtmlUtils.sqt(x.type)+","+HtmlUtils.sqt(y)+");";var E=HtmlUtils.tag(TAG_LI,[],HtmlUtils.tag(TAG_A,["onclick",G],x.label));C[x.category]+=E+"\n";d.push(E)}}for(a in C){B+=C[a]+"</li></ul>"}}if(u.length>0){t.push("<a>File</a>"+HtmlUtils.tag(TAG_UL,[],HtmlUtils.join(u)))}if(z.length>0){t.push("<a>View</a>"+HtmlUtils.tag(TAG_UL,[],HtmlUtils.join(z)))}if(d.length>0){t.push(B)}var F="";for(var v=0;v<t.length;v++){F+=HtmlUtils.tag(TAG_LI,[],t[v])}var p=HtmlUtils.tag(TAG_UL,[ATTR_ID,this.getDomId(ID_MENU_INNER+D.getIdForDom()),ATTR_CLASS,"sf-menu"],F);return p},showEntryMenu:function(p,d){var s=this.getEntryMenu(d);this.writeHtml(ID_MENU_OUTER,s);var q=this.getDomId(ID_MENU_BUTTON+Utils.cleanId(d));showPopup(p,q,this.getDomId(ID_MENU_OUTER),false,"left top","left bottom");$("#"+this.getDomId(ID_MENU_INNER+Utils.cleanId(d))).superfish({speed:"fast",delay:300})},fetchUrl:function(d,p){if(p==null){p=this.jsonUrl}p=this.getDisplayManager().getJsonUrl(p,this);if(p==null){return}if(d!=null&&d!="json"){p=p.replace("points.json","points."+d)}window.open(p,"_blank")},getMenuItems:function(d){},getDisplayMenuSettings:function(){var q="getRamaddaDisplay('"+this.getId()+"')";var t=HtmlUtils.onClick(q+".moveDisplayRight();","Right");var u=HtmlUtils.onClick(q+".moveDisplayLeft();","Left");var p=HtmlUtils.onClick(q+".moveDisplayTop();","Top");var d=HtmlUtils.onClick(q+".moveDisplayUp();","Up");var w=HtmlUtils.onClick(q+".moveDisplayDown();","Down");var v="<table class=formtable><tr><td align=right><b>Move:</b></td><td>"+p+" "+d+" "+w+" "+t+" "+u+"</td></tr><tr><td align=right><b>Row:</b></td><td> "+HtmlUtils.input("",this.getProperty("row",""),["size","7",ATTR_ID,this.getDomId("row")])+" &nbsp;&nbsp;<b>Col:</b> "+HtmlUtils.input("",this.getProperty("column",""),["size","7",ATTR_ID,this.getDomId("column")])+"</td></tr><tr><td align=right><b>Width:</b></td><td> "+HtmlUtils.input("",this.getProperty("width",""),["size","7",ATTR_ID,this.getDomId("width")])+"  <b>Height:</b> "+HtmlUtils.input("",this.getProperty("height",""),["size","7",ATTR_ID,this.getDomId("height")])+"</td></tr></table>";var s=HtmlUtils.checkbox(this.getDomId("showtitle"),[],this.showTitle)+" Title  "+HtmlUtils.checkbox(this.getDomId("showdetails"),[],this.showDetails)+" Details &nbsp;&nbsp;&nbsp;"+HtmlUtils.onClick(q+".askSetTitle();","Set Title");v+=HtmlUtils.formTable()+HtmlUtils.formEntry("Show:",s)+"</table>";return v},isLayoutHorizontal:function(){return this.orientation=="horizontal"},loadInitialData:function(){if(!this.needsData()||this.properties.data==null){return}if(this.getProperty("latitude")){this.data.lat=this.getProperty("latitude");this.data.lon=this.getProperty("longitude","-105")}if(this.properties.data.hasData()){this.addData(this.properties.data);return}this.properties.data.derived=this.derived;this.properties.data.loadData(this)},getData:function(){if(!this.hasData()){return null}var d=this.dataCollection.getList();return d[0]},hasData:function(){if(this.dataCollection==null){return false}return this.dataCollection.hasData()},getCreatedInteractively:function(){return this.createdInteractively==true},needsData:function(){return false},getShowMenu:function(){if(Utils.isDefined(this.showMenu)){return this.showMenu}return this.getProperty(PROP_SHOW_MENU,true)},askSetTitle:function(){var p=this.getTitle(false);var d=prompt("Title",p);if(d!=null){this.title=d;this.setProperty(ATTR_TITLE,d);this.setDisplayTitle(this.title)}},getShowDetails:function(){return this.getSelfProperty("showDetails",true)},setShowDetails:function(d){this.showDetails=d;if(this.showDetails){this.jq(ID_DETAILS).show()}else{this.jq(ID_DETAILS).hide()}},setShowTitle:function(d){this.showTitle=d;if(this.showTitle){this.jq(ID_TITLE).show()}else{this.jq(ID_TITLE).hide()}},getShowTitle:function(){return this.getSelfProperty("showTitle",true)},setDisplayProperty:function(d,p){this.setProperty(d,p);$("#"+this.getDomId(d)).val(p)},deltaColumn:function(p){var d=parseInt(this.getProperty("column",0));d+=p;if(d<0){d=0}this.setDisplayProperty("column",d);this.getLayoutManager().layoutChanged(this)},deltaRow:function(p){var d=parseInt(this.getProperty("row",0));d+=p;if(d<0){d=0}this.setDisplayProperty("row",d);this.getLayoutManager().layoutChanged(this)},moveDisplayRight:function(){if(this.getLayoutManager().isLayoutColumns()){this.deltaColumn(1)}else{this.getLayoutManager().moveDisplayDown(this)}},moveDisplayLeft:function(){if(this.getLayoutManager().isLayoutColumns()){this.deltaColumn(-1)}else{this.getLayoutManager().moveDisplayUp(this)}},moveDisplayUp:function(){if(this.getLayoutManager().isLayoutRows()){this.deltaRow(-1)}else{this.getLayoutManager().moveDisplayUp(this)}},moveDisplayDown:function(){if(this.getLayoutManager().isLayoutRows()){this.deltaRow(1)}else{this.getLayoutManager().moveDisplayDown(this)}},moveDisplayTop:function(){this.getLayoutManager().moveDisplayTop(this)},getDialogContents:function(p,u){var d=this.getGet();var s=[];this.getMenuItems(s);var t="<form>";t+=this.getDisplayMenuSettings();for(var q=0;q<s.length;q++){t+=HtmlUtils.div([ATTR_CLASS,"display-menu-item"],s[q])}t+="</form>";p.push("Display");u.push(t)},popup:function(u,s){var p=GuiUtils.getDomObject(s);var q=GuiUtils.getDomObject(u);if(!p||!q){return}var d="left top";var t="left bottom";showObject(p);jQuery("#"+s).position({of:jQuery("#"+u),my:d,at:t,collision:"none none"});jQuery("#"+s).position({of:jQuery("#"+u),my:d,at:t,collision:"none none"});$("#"+s).draggable()},checkLayout:function(){console.log("display.checkLayout")},displayData:function(){},createUI:function(){this.checkFixedLayout()},setDisplayReady:function(){this.displayReady=true},getDisplayReady:function(){return this.displayReady},pageHasLoaded:function(){this.setDisplayReady(true)},initDisplay:function(){this.createUI();this.checkFilterValueMenu()},checkFilterValueMenu:function(){if(!this.getProperty("showFilterWidget",true)){return}var s=this.getProperty("filterValues");var d=this.getProperty("filterValuesLabel","");if(!s){var y=this.getProperty("patternFilterField");if(y){var v=this.getFieldById(null,y);if(v){var x=this.getData();if(x==null){return}if(d==""){d=v.getLabel()+": "}s=this.getColumnValues(x.getRecords(),v).values;s=Utils.getUniqueValues(s);s.unshift("")}}}var w=this.getProperty("filterPattern");if(s){var u;if((typeof s)=="string"){s=Utils.getMacro(s);u=s.split(",")}else{u=s}var p="<select class='ramadda-pulldown' id='"+this.getDomId("filterValueMenu")+"'>";for(var t=0;t<u.length;t++){var q="";if(w==u[t]){q="selected "}if(u[t]==""){p+="<option value='' "+q+">All</option>\n"}else{p+="<option "+q+">"+u[t]+"</option>\n"}}p+="</select>";let _this=this;this.writeHtml(ID_TOP_RIGHT,d+p);this.jq("filterValueMenu").change(function(){var z=$(this).val();if(_this.getProperty("filterPattern")==z){return}if(z==""){z=null}_this.setProperty("filterPattern",z);_this.updateUI();_this.propagateEvent("handleEventPropertyChanged",{property:"filterPattern",value:z})})}},updateUI:function(){},getDoBs:function(){if(!(typeof this.dobs==="undefined")){return dobs}if(this.displayParent){return this.displayParent.getDoBs()}return false},cnt:0,getHtml:function(){var B=this.getDoBs();var v="";var d=this.getWidth();if(B){v+=HtmlUtils.openDiv(["class","minitron"])}if(d>0){v+=HtmlUtils.openDiv(["class","display-contents","style","width:"+d+"px;"])}else{v+=HtmlUtils.openDiv(["class","display-contents"])}v+=HtmlUtils.div([ATTR_CLASS,"ramadda-popup",ATTR_ID,this.getDomId(ID_MENU_OUTER)],"");var p=HtmlUtils.div([ATTR_CLASS,"display-dialog",ATTR_ID,this.getDomId(ID_DIALOG)],"");var s=this.getGet();var w="";if(this.getShowMenu()){w=HtmlUtils.onClick(s+".showDialog();",HtmlUtils.image(ramaddaBaseUrl+"/icons/downdart.png",[ATTR_CLASS,"display-dialog-button",ATTR_ID,this.getDomId(ID_DIALOG_BUTTON)]))}var y="";if(this.getShowTitle()){y=this.getTitle(false).trim()}var u="";if(w!=""||y!=""){this.cnt++;var q="";var x=y;if(y!=""&&this.entryId){x=HtmlUtils.href(this.getRamadda().getEntryUrl(this.entryId),y)}q=HtmlUtils.tag("span",[ATTR_CLASS,"display-title",ATTR_ID,this.getDomId(ID_TITLE)],this.getDisplayTitle(y));if(w==""){u=q}else{u="<div class=display-header>"+w+"&nbsp;"+q+"</div>"}}var z=HtmlUtils.div(["id",this.getDomId(ID_TOP_RIGHT)],"");v+=HtmlUtils.leftRightTable(u,z,{valign:"bottom"});var t=this.getContentsDiv();v+=t;v+=p;v+=HtmlUtils.closeTag(TAG_DIV);if(B){v+=HtmlUtils.closeTag(TAG_DIV)}return v},makeToolbar:function(t){var v="";var p=this.getGet();var d=t.addLabel;var u=[];var x=[];var s=[];if(!this.getIsLayoutFixed()){x.push("removeRamaddaDisplay('"+this.getId()+"')");u.push(ramaddaBaseUrl+"/icons/page_delete.png");s.push("Delete display")}x.push(p+".copyDisplay();");u.push(ramaddaBaseUrl+"/icons/page_copy.png");s.push("Copy Display");if(this.jsonUrl!=null){x.push(p+".fetchUrl('json');");u.push(ramaddaBaseUrl+"/icons/json.png");s.push("Download JSON");x.push(p+".fetchUrl('csv');");u.push(ramaddaBaseUrl+"/icons/csv.png");s.push("Download CSV")}for(var q=0;q<x.length;q++){var w=HtmlUtils.image(u[q],[ATTR_TITLE,s[q],ATTR_CLASS,"display-dialog-header-icon"]);if(d){w+=" "+s[q]+"<br>"}v+=HtmlUtils.onClick(x[q],w)}return v},makeDialog:function(){var u="";u+=HtmlUtils.div([ATTR_ID,this.getDomId(ID_HEADER),ATTR_CLASS,"display-header"]);var z=HtmlUtils.onClick("$('#"+this.getDomId(ID_DIALOG)+"').hide();",HtmlUtils.image(ramaddaBaseUrl+"/icons/close.gif",[ATTR_CLASS,"display-dialog-close",ATTR_TITLE,"Close Dialog"]));var y=z;var q="";var t=HtmlUtils.div([ATTR_CLASS,"display-dialog-header"],HtmlUtils.leftRight(q,y));var w=[];var B=[];this.getDialogContents(w,B);w.push("Edit");B.push(this.makeToolbar({addLabel:true}));var v="<ul>";var x="";for(var s=0;s<w.length;s++){var d=this.getDomId("tabs")+s;v+=HtmlUtils.tag("li",[],HtmlUtils.tag("a",["href","#"+d],w[s]));v+="\n";var p=HtmlUtils.div([ATTR_CLASS,"display-dialog-tab"],B[s]);x+=HtmlUtils.div(["id",d],p);x+="\n"}v+="</ul>\n";var x=HtmlUtils.div(["id",this.getDomId(ID_DIALOG_TABS)],v+x);dialogContents=t+x;return dialogContents},initDialog:function(){var p=this;var d=function(q){if(q&&q.which!=13){return}p.column=p.jq("column").val();p.row=p.jq("row").val();p.getLayoutManager().doLayout()};this.jq("column").keypress(d);this.jq("row").keypress(d);this.jq("showtitle").change(function(){p.setShowTitle(p.jq("showtitle").is(":checked"))});this.jq("showdetails").change(function(){p.setShowDetails(p.jq("showdetails").is(":checked"))});this.jq(ID_DIALOG_TABS).tabs()},showDialog:function(){var d=this.getDomId(ID_DIALOG);this.writeHtml(ID_DIALOG,this.makeDialog());this.popup(this.getDomId(ID_DIALOG_BUTTON),d);this.initDialog()},getWidthForStyle:function(p){var d=this.getProperty("width",-1);if(d==-1){return p}if(!d.endsWith("px")&&!d.endsWith("%")){d=d+"px"}return d},getHeightForStyle:function(p){var d=this.getProperty("height",-1);if(d==-1){return p}if(!d.endsWith("px")&&!d.endsWith("%")){d=d+"px"}return d},getContentsStyle:function(){var q="";var d=this.getHeightForStyle();if(d){q+=" height:"+d+";"}var p=this.getWidthForStyle();if(p){q+=" width:"+p+";"}return q},getContentsDiv:function(){var t=this.getContentsStyle();if(this.getProperty("background")){t+="background: "+this.getProperty("background")+";"}var q="";var p=this.getWidthForStyle();if(p){q+=" width:"+p+";"}var s=HtmlUtils.div([ATTR_STYLE,q,ATTR_ID,this.getDomId(ID_DISPLAY_TOP)],"");var d=HtmlUtils.div([ATTR_STYLE,q,ATTR_ID,this.getDomId(ID_DISPLAY_BOTTOM)],"");return s+HtmlUtils.div([ATTR_CLASS,"display-contents-inner display-"+this.type,"style",t,ATTR_ID,this.getDomId(ID_DISPLAY_CONTENTS)],"")+d},copyDisplay:function(){var d={};$.extend(true,d,this);d.setId(d.getId()+this.getUniqueId("display"));addRamaddaDisplay(d);this.getDisplayManager().addDisplay(d)},removeDisplay:function(){this.getDisplayManager().removeDisplay(this)},prepareToLayout:function(){this.getColumn();this.getWidth();this.getHeight();this.getName();this.getEventSource()},getColumn:function(){return this.getFormValue("column",0)},getRow:function(){return this.getFormValue("row",0)},getWidth:function(){return this.getFormValue("width",0)},getHeight:function(){return this.getFormValue("height",0)},getDisplayTitle:function(q){if(!q){q=this.title!=null?this.title:""}var p=q;var d=this.lastSelectedFields;if(d&&d.length>0){p=p.replace("{field}",d[0].getLabel())}else{p=p.replace("{field}","")}return p},setDisplayTitle:function(p){if(!Utils.stringDefined(p)){p=this.getTitle(false).trim()}var d=this.getDisplayTitle(p);if(this.entryId){d=HtmlUtils.href(this.getRamadda().getEntryUrl(this.entryId),d)}if(this.getShowTitle()){this.jq(ID_TITLE).show()}else{this.jq(ID_TITLE).hide()}this.writeHtml(ID_TITLE,d)},getTitle:function(p){var s="";if(p&&this.hasEntries()){s=this.getEntryMenuButton(this.getEntries()[0])+" "}var u=this.getProperty(ATTR_TITLE);if(u!=null){return s+u}if(this.dataCollection==null){return s}var q=this.dataCollection.getList();u="";for(var t=0;t<q.length;t++){var d=q[t];if(t>0){u+="/"}u+=d.getName()}return s+u},getIsLayoutFixed:function(){return this.getProperty(PROP_LAYOUT_HERE,false)},doingQuickEntrySearch:false,doQuickEntrySearch:function(t,w){if(this.doingQuickEntrySearch){return}var u=t.term;if(u==null||u.length<=1){return}this.doingQuickEntrySearch=true;var d=new EntrySearchSettings({name:u,max:10});if(this.searchSettings){d.clearAndAddType(this.searchSettings.entryType)}var p=this;var s=this.getRamadda().getSearchUrl(d,OUTPUT_JSON);var q={entryListChanged:function(x){p.doneQuickEntrySearch(x,w)}};var v=new EntryList(this.getRamadda(),s,q,true)},doneQuickEntrySearch:function(t,s){var q=[];var d=t.getEntries();for(var p=0;p<d.length;p++){q.push(d[p].getName())}s(q);this.doingQuickEntrySearch=false},addData:function(d){var p=d.getRecords();if(p&&p.length>0){this.hasElevation=p[0].hasElevation()}else{this.hasElevation=false}this.dataCollection.addData(d);var q=d.entry;if(q==null){q=this.getRamadda().getEntry(d.entryId)}if(q){d.entry=q;this.addEntry(q)}},pointDataLoadFailed:function(d){this.inError=true;errorMessage=this.getProperty("errorMessage",null);if(errorMessage!=null){this.setContents(errorMessage);return}var p="";if(d&&d.errorcode&&d.errorcode=="warning"){p=d.error}else{p="<b>Sorry, but an error has occurred:</b>";if(!d){d="No data returned from server"}p+=HtmlUtils.tag("div",["style","background:#fff;margin:10px;padding:10px;border:1px #ccc solid;   border-radius: 0px;"],(d.error?d.error:d))}this.setContents(this.getMessage(p))},clearCache:function(){},pointDataLoaded:function(d,p,q){this.inError=false;this.clearCache();if(!q){this.addData(d);this.checkFilterValueMenu()}if(p!=null){this.jsonUrl=p}else{this.jsonUrl=null}if(!this.getDisplayReady()){return}this.updateUI();if(!q){this.lastPointData=d;this.propagateEvent("handleEventPointDataLoaded",d)}},getDateFormatter:function(){var d=null;if(this.googleLoaded()){var p=this.getProperty("dateFormat",null);if(p){var q=0;this.timezone=this.getProperty("timezone");if(Utils.isDefined(this.timezone)){q=parseFloat(this.timezone)}d=new google.visualization.DateFormat({pattern:p,timeZone:q})}}return d},getHasDate:function(p){var s=null;this.hasDate=false;for(j=0;j<p.length;j++){var d=p[j];var q=d.getDate();if(q==null){continue}if(s!=null&&s.getTime()!=q.getTime()){this.hasDate=true;break}s=q}return this.hasDate},dateInRange:function(d){if(d!=null){if(this.minDateObj!=null&&d.getTime()<this.minDateObj.getTime()){return false}if(this.maxDateObj!=null&&d.getTime()>this.maxDateObj.getTime()){return false}}return true},getPointData:function(){if(this.dataCollection.getList().length==0){return null}return this.dataCollection.getList()[0]},getDataValues:function(d){if(d.tuple){return d.tuple}else{if(d.getData){return d.getData()}}return d},makeDataArray:function(p){if(p.length==0){return p}var q=[];if(p[0].getData){for(var d=0;d<p.length;d++){q.push(p[d].getData())}}else{if(p[0].tuple){for(var d=0;d<p.length;d++){q.push(p[d].tuple)}}else{q=p}}return q},printFields:function(p,d){console.log(p);if(!d){console.log("   null fields");return}for(a in d){console.log("   "+d[a].getId())}},getStandardData:function(p,W){var H=this.getPointData();var V=this.getProperty(PROP_EXCLUDE_ZERO,false);if(p==null){p=H.getRecordFields()}props={makeObject:true,includeIndex:true,includeIndexIfDate:false,groupByIndex:-1,raw:false};if(W!=null){$.extend(props,W)}var ac=props.groupByIndex;var N=[];var Q=[];var E=[];for(aa=0;aa<p.length;aa++){var w=p[aa];if(w.isFieldNumeric()&&w.isFieldDate()){}var C=w.getLabel();if(w.getUnit()!=null){C+=" ("+w.getUnit()+")"}C=C.replace(/!!/g," -- ");E.push(C)}if(props.makeObject){Q.push({tuple:E,record:null})}else{Q.push(E)}N.push("");this.minDateObj=Utils.parseDate(this.minDate,false);this.maxDateObj=Utils.parseDate(this.maxDate,true,this.minDateObj);if(this.minDateObj==null&&this.maxDateObj!=null){this.minDateObj=Utils.parseDate(this.minDate,false,this.maxDateObj)}var v=(this.minDateObj!=null?this.minDateObj.getTime():-1);var B=(this.maxDateObj!=null?this.maxDateObj.getTime():-1);if(this.minDateObj!=null||this.maxDateObj!=null){}var S=0;if(Utils.isDefined(this.offset)){S=parseFloat(this.offset)}var Z=0;var O=this.indexField;var X=H.getRecords();var K=H.getRecordFields();this.hasDate=this.getHasDate(X);var F=this.getDateFormatter();var G=-1;for(Y=0;Y<X.length;Y++){var R=X[Y];var ab=R.getDate();if(!this.dateInRange(ab)){continue}G++;var af=[];if(props&&(props.includeIndex||props.includeIndexIfDate)){var q=null;if(O>=0){var w=K[O];af.push(R.getValue(O)+S);q=w.getLabel()}else{if(this.hasDate){af.push(this.getDateValue(ab,F));q="Date"}else{if(!props.includeIndexIfDate){af.push(Y);q="Index"}}}if(q!=null&&G==0){E.unshift(q)}}var J=true;var D=true;var P=false;for(var aa=0;aa<p.length;aa++){var w=p[aa];if(w.isFieldNumeric()&&w.isFieldDate()){}var T=R.getValue(w.getIndex());if(S!=0){T+=S}if(T!=null){J=false}if(typeof T=="number"){P=true;if(T!=0){D=false}}if(w.isFieldDate()){T=this.getDateValue(T,F)}af.push(T)}if(P&&D&&V){continue}if(this.filters!=null){if(!this.applyFilters(R,af)){console.log(" skipping due to filters");continue}}if(ac>=0){N.push(R.getValue(ac))}if(props.makeObject){Q.push({tuple:af,record:R})}else{Q.push(af)}if(!J){Z++}}if(Z==0){return[]}if(ac>=0){var x={};var y=[];var u=[];var M=[];M.push(props.groupByField.getLabel());for(var Y=0;Y<p.length;Y++){var w=p[Y];if(w.getIndex()!=ac){M.push(w.getLabel())}}u.push(M);for(var ae=0;ae<Q.length;ae++){var ad=this.getDataValues(Q[ae]);if(ae==0){continue}var ag=N[ae];var d=x[ag];if(d==null){y.push(ag);d=new Array();u.push(d);d.push(ag);for(var I=0;I<p.length;I++){var w=p[I];if(w.getIndex()==ac){continue}d.push(0)}x[ag]=d}var L=0;for(var I=0;I<p.length;I++){var w=p[I];if(w.getIndex()==ac){continue}var t=ad[I];L++;if(Utils.isNumber(t)){if(typeof d[L]=="string"){d[L]=0}d[L]+=parseFloat(t)}else{if(d[L]==0){d[L]=""}var U=d[L];if(!Utils.isDefined(U)){U=""}if(U.length<150){if(!Utils.isDefined(t)){t=""}var z=(""+t);if(U.indexOf(z)<0){if(U!=""){U+=", "}U+=z;d[L]=U}}}}}return u}return Q},googleLoaded:function(){if((typeof google==="undefined")||(typeof google.visualization==="undefined")||(typeof google.visualization.DateFormat==="undefined")){return false}return true},initDateFormats:function(){if(!this.googleLoaded()){return false}if(this.fmt_yyyy){return true}var d=0;this.timezone=this.getProperty("timezone");if(Utils.isDefined(this.timezone)){d=parseFloat(this.timezone)}this.fmt_yyyymmddhhmm=new google.visualization.DateFormat({pattern:"yyyy-MM-dd HH:mm Z",timeZone:d});this.fmt_yyyymmdd=new google.visualization.DateFormat({pattern:"yyyy-MM-dd",timeZone:d});this.fmt_yyyy=new google.visualization.DateFormat({pattern:"yyyy",timeZone:d});return true},getDateValue:function(d,p){if(!this.initDateFormats()){return d}if(!(typeof d=="object")){date=new Date(d)}else{date=d}if(!p){p=this.fmt_yyyymmddhhmm}var q=p.formatValue(date);date={v:date,f:q};return date},applyFilters:function(d,p){for(var q=0;q<this.filters.length;q++){if(!this.filters[q].recordOk(this,d,p)){return false}}return true}});var b=this.getProperty(PROP_DISPLAY_FILTER);if(b!=null){var c=b.split(";");for(var f=0;f<c.length;f++){b=c[f];var k=b.split(":");var n=k[0];if(n=="month"){this.filters.push(new MonthFilter(k[1]))}else{console.log("unknown filter:"+n)}}}}function DisplayGroup(b,g,c,f){var h=TAG_TABLE;var e="tabs";var d="columns";var k="rows";if(!f){f="group"}let SUPER=new RamaddaDisplay(b,g,f,c);RamaddaUtil.inherit(this,SUPER);RamaddaUtil.defineMembers(this,{layout:this.getProperty(PROP_LAYOUT_TYPE,h)});RamaddaUtil.defineMembers(this,{displays:[],layout:this.getProperty(PROP_LAYOUT_TYPE,h),columns:this.getProperty(PROP_LAYOUT_COLUMNS,1),isLayoutColumns:function(){return this.layout==d},getDoBs:function(){return this.dobs},getWikiText:function(){var m=["layoutType",this.layout,"layoutColumns",this.columns,"showMenu","false","divid","$entryid_maindiv"];var l="";l+='<div id="{{entryid}}_maindiv"></div>\n\n';l+="{{group "+HtmlUtils.attrs(m)+"}}\n\n";return l},walkTree:function(m,n){for(var l=0;l<this.displays.length;l++){var o=this.displays[l];if(o.walkTree!=null){o.walkTree(m,n)}else{m.call(n,o)}}},collectEntries:function(l){if(l==null){l=[]}for(var m=0;m<this.displays.length;m++){var o=this.displays[m];if(o.collectEntries!=null){o.collectEntries(l)}else{var n=o.getEntries();if(n!=null&&n.length>0){l.push({source:o,entries:n})}}}return l},isLayoutRows:function(){return this.layout==k},getPosition:function(){for(var l=0;l<this.displays.length;l++){var m=this.displays[l];if(m.getPosition){return m.getPosition()}}},getDisplays:function(){return this.display},notifyEvent:function(n,q,p){var l=this.getDisplays();for(var m=0;m<this.displays.length;m++){var s=this.displays[m];if(s==q){continue}var o=s.getEventSource();if(o!=null&&o.length>0){if(o!=q.getId()&&o!=q.getName()){continue}}s.notifyEvent(n,q,p)}},getDisplaysToLayout:function(){var l=[];for(var m=0;m<this.displays.length;m++){if(this.displays[m].getIsLayoutFixed()){continue}l.push(this.displays[m])}return l},pageHasLoaded:function(m){for(var l=0;l<this.displays.length;l++){this.displays[l].setDisplayReady(true)}this.doLayout()},addDisplay:function(l){this.displays.push(l);if(Utils.getPageLoaded()){this.doLayout()}},layoutChanged:function(l){this.doLayout()},removeDisplay:function(m){var l=this.displays.indexOf(m);if(l>=0){this.displays.splice(l,1)}this.doLayout()},doLayout:function(){var v="";var y=100;var I=this.getDisplaysToLayout();var n=this.displays;for(var E=0;E<n.length;E++){var B=n[E];if(B.prepareToLayout!=null){B.prepareToLayout()}}var q=0;var G=null;if(typeof this.weights!="undefined"){G=this.weights.split(",")}if(this.layout==h){if(I.length==1){v+=HtmlUtils.div(["class"," display-wrapper"],I[0].getHtml())}else{var w=12/this.columns;var E=0;var J={};for(;E<I.length;E++){var H=I[E];if(Utils.isDefined(H.column)&&Utils.isDefined(H.row)&&H.columns>=0&&H.row>=0){var M=H.column+"_"+H.row;if(J[M]==null){J[M]=[]}J[M].push(H)}}E=0;for(;E<I.length;E++){y++;if(y>=this.columns){if(E>0){v+=HtmlUtils.closeTag(TAG_DIV)}v+=HtmlUtils.openTag("div",["class","row"]);y=0}var K=w;if(G!=null){if(q>=G.length){q=0}K=G[q];q++}v+=HtmlUtils.div(["class","col-md-"+K+" display-wrapper display-cell"],I[E].getHtml())}if(E>0){v+=HtmlUtils.closeTag(TAG_DIV)}}}else{if(this.layout==e){var L=HtmlUtils.getUniqueId("tabs_");v+=HtmlUtils.openTag(TAG_DIV,["id",L,"class","ui-tabs"]);v+=HtmlUtils.openTag(TAG_UL,[]);var D="";var C=0;for(var E=0;E<I.length;E++){var B=I[E];var s=B.getTitle(false);if(s.length>20){s=s.substring(0,19)+"..."}v+=HtmlUtils.tag(TAG_LI,[],HtmlUtils.tag(TAG_A,["href","#"+L+"-"+C],s));D+=HtmlUtils.div(["id",L+"-"+C,"class","ui-tabs-hide"],B.getHtml());C++}v+=HtmlUtils.closeTag(TAG_UL);v+=D;v+=HtmlUtils.closeTag(TAG_DIV)}else{if(this.layout==k){var t=[];for(var E=0;E<I.length;E++){var B=I[E];var p=B.getRow();if((""+p).length==0){p=0}while(t.length<=p){t.push([])}t[p].push(B.getHtml())}for(var E=0;E<t.length;E++){var u=t[E];var x=Math.round(100/u.length)+"%";v+=HtmlUtils.openTag(TAG_TABLE,["border","0","width","100%","cellpadding","0","cellspacing","0"]);v+=HtmlUtils.openTag(TAG_TR,["valign","top"]);for(var o=0;o<u.length;o++){var l=u[o];l=HtmlUtils.div(["class","display-cell"],l);v+=HtmlUtils.tag(TAG_TD,["width",x],l)}v+=HtmlUtils.closeTag(TAG_TR);v+=HtmlUtils.closeTag(TAG_TABLE)}}else{if(this.layout==d){var u=[];for(var E=0;E<I.length;E++){var B=I[E];var m=B.getColumn();if((""+m).length==0){m=0}while(u.length<=m){u.push([])}u[m].push(B.getHtml())}v+=HtmlUtils.openTag(TAG_DIV,["class","row"]);var x=Math.round(100/u.length)+"%";var w=12/u.length;for(var E=0;E<u.length;E++){var t=u[E];var F="";for(var z=0;z<t.length;z++){F+=t[z]}var K=w;if(G!=null){if(q>=G.length){q=0}K=G[q];q++}v+=HtmlUtils.div(["class","col-md-"+K],F)}v+=HtmlUtils.closeTag(TAG_DIV)}else{v+="Unknown layout:"+this.layout}}}}this.writeHtml(ID_DISPLAYS,v);if(this.layout==e){$("#"+L).tabs({})}this.initDisplays()},initDisplays:function(){for(var l=0;l<this.displays.length;l++){try{this.displays[l].initDisplay()}catch(m){this.displays[l].displayError("Error creating display:<br>"+m);console.log("error creating display: "+this.displays[l].getType());console.log(m.stack)}}},displayData:function(){},setLayout:function(m,l){this.layout=m;if(l){this.columns=l}this.doLayout()},askMinZAxis:function(){var l=prompt("Minimum axis value","0");if(l!=null){l=parseFloat(l);for(var m=0;m<this.displays.length;m++){var n=this.displays[m];if(n.setMinZAxis){n.setMinZAxis(l)}}}},askMaxZAxis:function(){var l=prompt("Maximum axis value","0");if(l!=null){l=parseFloat(l);for(var m=0;m<this.displays.length;m++){var n=this.displays[m];if(n.setMaxZAxis){n.setMaxZAxis(l)}}}},askMinDate:function(){var n=this.minDate;if(!n){n="1950-0-0"}this.minDate=prompt("Minimum date",n);if(this.minDate!=null){for(var l=0;l<this.displays.length;l++){var m=this.displays[l];if(m.setMinDate){m.setMinDate(this.minDate)}}}},askMaxDate:function(){var n=this.maxDate;if(!n){n="2020-0-0"}this.maxDate=prompt("Maximum date",n);if(this.maxDate!=null){for(var l=0;l<this.displays.length;l++){var m=this.displays[l];if(m.setMaxDate){m.setMaxDate(this.maxDate)}}}},titlesOff:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowTitle(false)}},titlesOn:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowTitle(true)}},detailsOff:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowDetails(false)}this.doLayout()},detailsOn:function(){for(var l=0;l<this.displays.length;l++){this.displays[l].setShowDetails(true)}this.doLayout()},deleteAllDisplays:function(){this.displays=[];this.doLayout()},moveDisplayUp:function(m){var l=this.displays.indexOf(m);if(l<=0){return}this.displays.splice(l,1);this.displays.splice(l-1,0,m);this.doLayout()},moveDisplayDown:function(m){var l=this.displays.indexOf(m);if(l>=this.displays.length){return}this.displays.splice(l,1);this.displays.splice(l+1,0,m);this.doLayout()},moveDisplayTop:function(m){var l=this.displays.indexOf(m);if(l>=this.displays.length){return}this.displays.splice(l,1);this.displays.splice(0,0,m);this.doLayout()}})}var pointDataCache={};function DataCollection(){RamaddaUtil.defineMembers(this,{data:[],hasData:function(){for(var b=0;b<this.data.length;b++){if(this.data[b].hasData()){return true}}return false},getList:function(){return this.data},addData:function(b){this.data.push(b)},handleEventMapClick:function(f,d,g,e){var c=false;for(var b=0;b<this.data.length;b++){if(this.data[b].handleEventMapClick(f,d,g,e)){c=true}}return c}})}function BasePointData(b,c){if(c==null){c={}}RamaddaUtil.defineMembers(this,{recordFields:null,records:null,entryId:null,entry:null});$.extend(this,c);RamaddaUtil.defineMembers(this,{name:b,properties:c,initWith:function(d){this.recordFields=d.recordFields;this.records=d.records},handleEventMapClick:function(f,d,g,e){return false},hasData:function(){return this.records!=null},clear:function(){this.records=null;this.recordFields=null},getProperties:function(){return this.properties},getProperty:function(d,f){var e=this.properties[d];if(e==null){return f}return e},getRecordFields:function(){return this.recordFields},addRecordField:function(d){this.recordFields.push(d)},getRecords:function(){return this.records},getNumericFields:function(){var e=this.getRecordFields();var d=[];for(var f=0;f<e.length;f++){var g=e[f];if(g.isNumeric){d.push(g)}}return d},getChartableFields:function(l){var f=this.getRecordFields();var e=[];var h=/(TIME|HOUR|MINUTE|SECOND|YEAR|MONTH|DAY|LATITUDE|LONGITUDE|^ELEVATION$)/g;var h=/(xxxnoskip)/g;for(var g=0;g<f.length;g++){var k=f[g];if(!k.isNumeric||!k.isChartable()){continue}var d=k.getId().toUpperCase();if(d.match(h)){continue}e.push(k)}return RecordUtil.sort(e)},getNonGeoFields:function(k){var e=this.getRecordFields();var d=[];var g=false;for(var f=0;f<e.length;f++){var h=e[f];if(h.isFieldGeo()){continue}if(h.isFieldDate()){if(g&&h.getId()=="recordDate"){continue}g=true}d.push(h)}return d},loadData:function(d){},getName:function(){return this.name},getTitle:function(){if(this.records!=null&&this.records.length>0){return this.name+" - "+this.records.length+" points"}return this.name}})}function PointData(e,d,b,c,f){RamaddaUtil.inherit(this,new BasePointData(e,f));RamaddaUtil.defineMembers(this,{recordFields:d,records:b,url:c,loadingCnt:0,equals:function(g){return this.url==g.url},getIsLoading:function(){return this.loadingCnt>0},handleEventMapClick:function(k,g,l,h){this.lon=l;this.lat=h;if(k.getDisplayManager().hasGeoMacro(this.url)){this.loadData(k,true);return true}return false},startLoading:function(){this.loadingCnt++},stopLoading:function(){this.loadingCnt--},loadData:function(l,k){if(this.url==null){console.log("No URL");return}var h={lat:this.lat,lon:this.lon};var g=l.displayManager.getJsonUrl(this.url,l,h);this.loadPointJson(g,l,k)},loadPointJson:function(h,m,k){var g=this;this.startLoading();var o=this;var l=pointDataCache[h];if(l==null){l={pointData:null,pending:[]};pointDataCache[h]=l}if(l.pointData!=null){m.pointDataLoaded(l.pointData,h,k);return}l.pending.push(m);if(l.pending.length>1){return}console.log("load data:"+h);var n=$.getJSON(h,function(t){if(GuiUtils.isJsonError(t)){m.pointDataLoadFailed(t);return}var s=makePointData(t,o.derived,m);l.pointData=g.initWith(s);var q=l.pending;l.pending=[];for(var p=0;p<q.length;p++){q[p].pointDataLoaded(g,h,k)}g.stopLoading()}).fail(function(s,t,p){var q=t+": "+p;console.log("JSON error:"+q);m.pointDataLoadFailed(q);g.stopLoading()})}})}function DerivedPointData(e,d,c,b){RamaddaUtil.inherit(this,new BasePointData(d));RamaddaUtil.defineMembers(this,{displayManager:e,operation:b,pointDataList:c,loadDataCalls:0,display:null,pointDataLoaded:function(f){this.loadDataCalls--;if(this.loadDataCalls<=0){this.initData()}},equals:function(g){if(g.pointDataList==null){return false}if(this.pointDataList.length!=g.pointDataList.length){return false}for(var f in this.pointDataList){if(!this.pointDataList[f].equals(g.pointDataList[f])){return false}}return true},initData:function(){var f=this.pointDataList[0];if(this.pointDataList.length==1){this.records=f.getRecords();this.recordFields=f.getRecordFields()}else{if(this.pointDataList.length>1){var g=this.combineData(f,this.pointDataList[1]);this.records=g.records;this.recordFields=g.recordFields}}this.display.pointDataLoaded(this)},combineData:function(o,n){var t=o.getRecords();var q=n.getRecords();var l=[];var u;if(t.length!=q.length){console.log("bad records:"+t.length+" "+q.length)}if(this.operation=="average"){for(var s=0;s<t.length;s++){var g=t[s];var f=q[s];if(g.getDate()!=f.getDate()){console.log("Bad record date:"+g.getDate()+" "+f.getDate());break}var p=$.extend(true,{},g);var k=p.getData();var h=f.getData();for(var m=0;m<k.length;m++){k[m]=(k[m]+h[m])/2}l.push(p)}u=o.getRecordFields()}else{if(this.operation=="other func"){}}if(u==null){l=t;u=o.getRecordFields()}return{records:l,recordFields:u}},loadData:function(h){this.display=h;this.loadDataCalls=0;for(var g in this.pointDataList){var f=this.pointDataList[g];if(!f.hasData()){this.loadDataCalls++;f.loadData(this)}if(this.loadDataCalls==0){this.initData()}}}})}function RecordField(b){$.extend(this,{isDate:b.type=="date",isLatitude:false,isLongitude:false,isElevation:false});$.extend(this,b);$.extend(this,{isNumeric:b.type=="double"||b.type=="integer",properties:b});RamaddaUtil.defineMembers(this,{getIndex:function(){return this.index},isFieldGeo:function(){return this.isFieldLatitude()||this.isFieldLongitude()||this.isFieldElevation()},isFieldLatitude:function(){return this.isLatitude||this.id.toLowerCase()=="latitude"},isFieldLongitude:function(){return this.isLongitude||this.id.toLowerCase()=="longitude"},isFieldElevation:function(){return this.isElevation||this.id.toLowerCase()=="elevation"||this.id.toLowerCase()=="altitude"},isFieldNumeric:function(){return this.isNumeric},isFieldDate:function(){return this.isDate},isChartable:function(){return this.chartable},getSortOrder:function(){return this.sortorder},getId:function(){return this.id},getUnitLabel:function(){var c=this.getLabel();if(this.unit&&this.unit!=""){c=c+" ["+this.unit+"]"}return c},getUnitSuffix:function(){if(this.unit&&this.unit!=""){return" ["+this.unit+"]"}return""},getLabel:function(){if(this.label==null||this.label.length==0){return this.id}return this.label},setLabel:function(c){this.label=c},getType:function(){return this.type},getMissing:function(){return this.missing},setUnit:function(c){this.unit=c},getUnit:function(){return this.unit}})}function PointRecord(e,f,b,d,c){this.isPointRecord=true;RamaddaUtil.defineMembers(this,{latitude:e,longitude:f,elevation:b,recordTime:d,data:c,getData:function(){return this.data},allZeros:function(){var g=this.getData();var k=false;var m=0;var l=0;for(var h=0;h<g.length;h++){if(typeof g[h]=="number"){m++;if(!isNaN(g[h])&&g[h]!=0){l++;break}}}if(m>0&&l==0){return true}return false},getValue:function(g){return this.data[g]},push:function(g){this.data.push(g)},hasLocation:function(){return !isNaN(this.latitude)},hasElevation:function(){return !isNaN(this.elevation)},getLatitude:function(){return this.latitude},getLongitude:function(){return this.longitude},getTime:function(){return this.recordTime},getElevation:function(){return this.elevation},getDate:function(){return this.recordTime}})}function makePointData(X,I,D){var c=[];var y=-1;var g=-1;var w=-1;var M=-1;var l=[];var t=[];var O=null;for(var ac=0;ac<X.fields.length;ac++){var q=X.fields[ac];var E=new RecordField(q);if(E.isFieldNumeric()){if(D.getProperty){var n=D.getProperty(E.getId()+".offset1",D.getProperty("offset1"));var m=D.getProperty(E.getId()+".offset2",D.getProperty("offset2"));var L=D.getProperty(E.getId()+".scale",D.getProperty("scale"));if(n||m||L){var V=D.getProperty(E.getId()+".unit",D.getProperty("unit"));if(V){E.unit=V}var Z={offset1:0,offset2:0,scale:1};if(n){Z.offset1=parseFloat(n)}if(m){Z.offset2=parseFloat(m)}if(L){Z.scale=parseFloat(L)}E.offset=Z;t.push(E)}}}O=E;c.push(E);if(E.isFieldLatitude()){y=E.getIndex()}else{if(E.isFieldLongitude()){g=E.getIndex()}else{if(E.isFieldElevation()){w=E.getIndex()}else{if(E.isFieldDate()){M=E.getIndex();l.push(M)}}}}}if(!I){I=[]}if(I){var J=O.getIndex()+1;for(var N=0;N<I.length;N++){var ah=I[N];var Y=ah.label;if(!Y){Y=ah.name}var E=new RecordField({type:"double",index:(J+N),chartable:true,id:ah.name,label:Y});E.derived=ah;c.push(E)}}var x=[];var ae=[];for(var ac=0;ac<X.data.length;ac++){var b=X.data[ac];var aj=b.values;var ad=null;if((typeof b.date==="undefined")){if(M>=0){ad=new Date(aj[M])}}else{if(b.date!=null&&b.date!=0){ad=new Date(b.date)}}if((typeof b.latitude==="undefined")){if(y>=0){b.latitude=aj[y]}else{b.latitude=NaN}}if((typeof b.longitude==="undefined")){if(g>=0){b.longitude=aj[g]}else{b.longitude=NaN}}if((typeof b.elevation==="undefined")){if(w>=0){b.elevation=aj[w]}else{b.elevation=NaN}}for(var ab=0;ab<l.length;ab++){aj[l[ab]]=new Date(aj[l[ab]])}if(I){for(var N=0;N<I.length;N++){var ah=I[N];if(!ah.isRow){continue}if(!ah.compiledFunction){var B=[];var h=(ah.columns.indexOf(";")>=0?ah.columns.split(";"):ah.columns.split(","));ah.fieldsToUse=[];for(var ac=0;ac<h.length;ac++){var p=h[ac].trim();B.push("v"+(ac+1));var C=null;for(var G=0;G<c.length;G++){var af=c[G];if(af.getId()==p){C=af;break}}ah.fieldsToUse.push(C)}var k="";for(var ac=0;ac<B.length;ac++){k+="var v"+(ac+1)+"=args["+ac+"];\n"}var W=ah["function"];if(W.indexOf("return")<0){W="return "+W}k+=W+"\n";ah.compiledFunction=new Function("args",k)}var U=[];var aa=false;for(var G=0;G<ah.fieldsToUse.length;G++){var af=ah.fieldsToUse[G];var S=NaN;if(af!=null){S=aj[af.getIndex()];if(S==null){S=NaN}}if(!isNaN(S)){aa=true}else{}U.push(S)}try{var z=NaN;if(aa){z=ah.compiledFunction(U);if(ah.decimals>=0){z=z.toFixed(ah.decimals)}z=parseFloat(z)}else{}aj.push(z)}catch(ag){console.log("Error evaluating function:"+ah["function"]+"\n"+ag);aj.push(NaN)}}}for(var F=0;F<t.length;F++){var q=t[F];var R=q.offset;var T=aj[q.getIndex()];T=(T+R.offset1)*R.scale+R.offset2;aj[q.getIndex()]=T}ae.push(aj);var Q=new PointRecord(b.latitude,b.longitude,b.elevation,ad,aj);x.push(Q)}for(var N=0;N<I.length;N++){var ah=I[N];if(!ah.isColumn){continue}var af=ah["function"];var B=[];var h=ah.columns.split(",");for(var ac=0;ac<h.length;ac++){var J=-1;for(var G=0;G<c.length;G++){var af=c[G];if(af.getId()==h[ac]||af.getLabel()==h[ac]){J=af.getIndex();break}}if(J<0){console.log("Could not find column index for field: "+h[ac]);continue}B.push("c"+(ac+1))}var H=RecordUtil.slice(ae,J);var s=new Function(B,ah["function"]);console.log("daFunk - "+s);var K=s(H);console.log("got new:"+K+" "+(typeof K));if((typeof K)=="number"){for(var ai=0;ai<x.length;ai++){var Q=x[ai];Q.push(K)}}else{if(Utils.isDefined(K.length)){console.log("newData.length:"+K.length+" records.length:"+x.length);for(var ai=0;ai<K.length;ai++){var Q=x[ai];if(!Q){console.log("bad record: "+ai);Q.push(NaN)}else{var S=K[ai];if(ah.decimals>=0){S=parseFloat(S.toFixed(ah.decimals))}Q.push(S)}}}}}if(D!=null){for(var ac=0;ac<c.length;ac++){var q=c[ac];var P="field."+q.getId()+".";if(Utils.isDefined(D[P+"unit"])){q.setUnit(D[P+"unit"])}if(Utils.isDefined(D[P+"label"])){q.setLabel(D[P+"label"])}if(Utils.isDefined(D[P+"scale"])||Utils.isDefined(D[P+"offset1"])||Utils.isDefined(D[P+"offset2"])){var n=Utils.isDefined(D[P+"offset1"])?parseFloat(D[P+"offset1"]):0;var m=Utils.isDefined(D[P+"offset2"])?parseFloat(D[P+"offset2"]):0;var L=Utils.isDefined(D[P+"scale"])?parseFloat(D[P+"scale"]):1;var J=q.getIndex();for(var ai=0;ai<x.length;ai++){var Q=x[ai];var aj=Q.getData();var T=aj[J];aj[J]=(T+n)*L+m}}}}var u=X.name;if((typeof u==="undefined")){u="Point Data"}x.sort(function(e,d){if(e.getDate()&&d.getDate()){if(e.getDate().getTime()<d.getDate().getTime()){return -1}if(e.getDate().getTime()>d.getDate().getTime()){return 1}return 0}});return new PointData(u,c,x)}function makeTestPointData(){var b={fields:[{index:0,id:"field1",label:"Field 1",type:"double",missing:"-999.0",unit:"m"},{index:1,id:"field2",label:"Field 2",type:"double",missing:"-999.0",unit:"c"}],data:[[-64.77,-64.06,45,null,[8,1000]],[-65.77,-64.06,45,null,[9,500]],[-65.77,-64.06,45,null,[10,250]]]};return makePointData(b)}function RecordFilter(b){if(b==null){b={}}RamaddaUtil.defineMembers(this,{properties:b,recordOk:function(e,c,d){return true}})}function MonthFilter(b){RamaddaUtil.inherit(this,new RecordFilter());RamaddaUtil.defineMembers(this,{months:b.split(","),recordOk:function(g,c,d){for(i in this.months){var f=this.months[i];var e=c.getDate();if(e==null){return false}if(e.getMonth==null){return false}if(e.getMonth()==f){return true}}return false}})}var A={add:function(c,b){if(isNaN(c)||isNaN(b)){return NaN}return c+b},average:function(b){var d=0;if(b.length==0){return 0}for(var c=0;c<b.length;c++){d+=b[c]}return d/b.length},percentIncrease:function(d){var b=[];var g=0;if(d.length==0){return 0}var e;for(var f=0;f<d.length;f++){var c=d[f];var h=NaN;if(f>0&&e!=0){h=(c-e)/e}e=c;b.push(h*100)}return b},movingAverage:function(k,f){if(!f){f={}}if(!f.step){f.step=5}var l=[];console.log("STEP:"+f.step);for(var e=f.step;e<k.length;e++){var g=0;var b=0;for(var d=e-f.step;d<e;d++){if(k[d]==k[d]){g+=k[d];b++}}var h=(b>0?g/b:NaN);if(l.length==0){for(var c=0;c<f.step;c++){l.push(h)}}l.push(h)}console.log("MovingAverage: values:"+k.length+" new:"+l.length);return l},expMovingAverage:function(l,g){if(!g){g={}}if(!g.step){g.step=5}var m=A.movingAverage(l,g);var e=(2/(g.step+1));var n=[];console.log("STEP:"+g.step);for(var f=g.step;f<l.length;f++){var h=0;var b=0;for(var d=f-g.step;d<f;d++){if(l[d]==l[d]){h+=l[d];b++}}var k=(b>0?h/b:NaN);if(n.length==0){for(var c=0;c<g.step;c++){n.push(k)}}n.push(k)}console.log("MovingAverage: values:"+l.length+" new:"+n.length);return n},max:function(c){var b=NaN;for(var d=0;d<c.length;d++){if(d==0||c[d]>b){b=c[d]}}return b},min:function(b){var d=NaN;for(var c=0;c<b.length;c++){if(c==0||b[c]<d){d=b[c]}}return d}};var RecordUtil={getRanges:function(g,e){var h=[];var c=[];for(var f=0;f<g.length;f++){h.push(NaN);c.push(NaN)}for(var l=0;l<e.length;l++){for(var d=0;d<g.length;d++){var k=e[l].getValue(d);if(isNaN(k)){continue}h[d]=(isNaN(h[d])?k:Math.max(k,h[d]));c[d]=(isNaN(c[d])?k:Math.min(k,c[d]))}}var b=[];for(var d=0;d<g.length;d++){b.push([c[d],h[d]])}return b},getElevationRange:function(b,c){var f=NaN;var e=NaN;for(var g=0;g<c.length;g++){if(c[g].hasElevation()){var d=c[g].getElevation();f=(isNaN(f)?d:Math.max(d,f));e=(isNaN(e)?d:Math.min(d,e))}}return[e,f]},slice:function(c,d){var b=[];for(var e=0;e<c.length;e++){var f=c[e];if(f.getValue){b.push(f.getValue(d))}else{b.push(f[d])}}return b},sort:function(b){b=b.slice(0);b.sort(function(d,c){var f=d.getSortOrder();var e=c.getSortOrder();return f<e});return b},getPoints:function(d,h){var g=[];var k=NaN,c=NaN,f=NaN,e=NaN;if(d!=null){for(j=0;j<d.length;j++){var b=d[j];if(!isNaN(b.getLatitude())&&!isNaN(b.getLongitude())){if(j==0){k=b.getLatitude();f=b.getLatitude();c=b.getLongitude();e=b.getLongitude()}else{k=Math.max(k,b.getLatitude());f=Math.min(f,b.getLatitude());c=Math.min(c,b.getLongitude());e=Math.max(e,b.getLongitude())}if(b.getLongitude()<-180||b.getLatitude()>90){console.log("Bad index="+j+" "+b.getLatitude()+" "+b.getLongitude())}g.push(new OpenLayers.Geometry.Point(b.getLongitude(),b.getLatitude()))}}}h.north=k;h.west=c;h.south=f;h.east=e;return g},findClosest:function(e,c,h,l){if(e==null){return null}var d=null;var k=1000000000;var g=-1;for(j=0;j<e.length;j++){var f=e[j];if(isNaN(f.getLatitude())){continue}var b=Math.sqrt((c-f.getLongitude())*(c-f.getLongitude())+(h-f.getLatitude())*(h-f.getLatitude()));if(b<k){k=b;d=f;g=j}}if(l!=null){l.index=g}return d},clonePoints:function(e){var c=[];for(var d=0;d<e.length;d++){var b=e[d];c.push(new OpenLayers.Geometry.Point(b.x,b.y))}return c}};var DISPLAY_FILTER="filter";var DISPLAY_ANIMATION="animation";var DISPLAY_LABEL="label";var DISPLAY_SHELL="shell";addGlobalDisplayType({type:DISPLAY_FILTER,label:"Filter",requiresData:false,category:"Controls"});addGlobalDisplayType({type:DISPLAY_ANIMATION,label:"Animation",requiresData:false,category:"Controls"});addGlobalDisplayType({type:DISPLAY_LABEL,label:"Text",requiresData:false,category:"Misc"});function RamaddaFilterDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaDisplay(d,c,b));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{html:"<p>&nbsp;&nbsp;&nbsp;Nothing selected&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<p>",initDisplay:function(){this.createUI();this.setContents(this.html)}})}function RamaddaAnimationDisplay(g,f,d){var c="start";var b="stop";var e="time";RamaddaUtil.inherit(this,new RamaddaDisplay(g,f,DISPLAY_ANIMATION,d));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{running:false,timestamp:0,index:0,sleepTime:500,iconStart:ramaddaBaseUrl+"/icons/display/control.png",iconStop:ramaddaBaseUrl+"/icons/display/control-stop-square.png",iconBack:ramaddaBaseUrl+"/icons/display/control-stop-180.png",iconForward:ramaddaBaseUrl+"/icons/display/control-stop.png",iconFaster:ramaddaBaseUrl+"/icons/display/plus.png",iconSlower:ramaddaBaseUrl+"/icons/display/minus.png",iconBegin:ramaddaBaseUrl+"/icons/display/control-double-180.png",iconEnd:ramaddaBaseUrl+"/icons/display/control-double.png",deltaIndex:function(h){this.stop();this.setIndex(this.index+h)},setIndex:function(h){if(h<0){h=0}this.index=h;this.applyStep(true,!Utils.isDefined(h))},toggle:function(){if(this.running){this.stop()}else{this.start()}},tick:function(){if(!this.running){return}this.index++;this.applyStep();var h=this;setTimeout(function(){h.tick()},this.sleepTime)},applyStep:function(h,p){if(!Utils.isDefined(h)){h=true}var o=this.displayManager.getDefaultData();if(o==null){return}var l=o.getRecords();if(l==null){$("#"+this.getDomId(e)).html("no records");return}if(p){this.index=l.length-1}if(this.index>=l.length){this.index=0}var k=l[this.index];var m="";if(k.getDate()!=null){var n=this.formatDate(k.getDate(),{suffix:this.getTimeZone()});m+=HtmlUtils.b("Date:")+" "+n}else{m+=HtmlUtils.b("Index:")+" "+this.index}$("#"+this.getDomId(e)).html(m);if(h){this.displayManager.propagateEventRecordSelection(this,o,{index:this.index})}},handleEventRecordSelection:function(l,h){var k=this.displayManager.getDefaultData();if(k==null){return}if(k!=h.data){return}if(!k){return}this.index=h.index;this.applyStep(false)},faster:function(){this.sleepTime=this.sleepTime/2;if(this.sleepTime==0){this.sleepTime=100}},slower:function(){this.sleepTime=this.sleepTime*1.5},start:function(){if(this.running){return}this.running=true;this.timestamp++;$("#"+this.getDomId(c)).attr("src",this.iconStop);this.tick()},stop:function(){if(!this.running){return}this.running=false;this.timestamp++;$("#"+this.getDomId(c)).attr("src",this.iconStart)},initDisplay:function(){this.createUI();this.stop();var h=this.getGet();var k="";k+=HtmlUtils.onClick(h+".setIndex(0);",HtmlUtils.image(this.iconBegin,[ATTR_TITLE,"beginning",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtils.onClick(h+".deltaIndex(-1);",HtmlUtils.image(this.iconBack,[ATTR_TITLE,"back 1",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtils.onClick(h+".toggle();",HtmlUtils.image(this.iconStart,[ATTR_TITLE,"play/stop",ATTR_CLASS,"display-animation-button","xwidth","32",ATTR_ID,this.getDomId(c)]));k+=HtmlUtils.onClick(h+".deltaIndex(1);",HtmlUtils.image(this.iconForward,[ATTR_TITLE,"forward 1",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtils.onClick(h+".setIndex();",HtmlUtils.image(this.iconEnd,[ATTR_TITLE,"end",ATTR_CLASS,"display-animation-button","xwidth","32"]));k+=HtmlUtils.onClick(h+".faster();",HtmlUtils.image(this.iconFaster,[ATTR_CLASS,"display-animation-button",ATTR_TITLE,"faster","xwidth","32"]));k+=HtmlUtils.onClick(h+".slower();",HtmlUtils.image(this.iconSlower,[ATTR_CLASS,"display-animation-button",ATTR_TITLE,"slower","xwidth","32"]));k+=HtmlUtils.div(["style","display:inline-block; min-height:24px; margin-left:10px;",ATTR_ID,this.getDomId(e)],"&nbsp;");this.setDisplayTitle("Animation");this.setContents(k)}})}function RamaddaLabelDisplay(g,f,c){var e="text";var d="edit";var b;if(c&&!Utils.isDefined(c.showTitle)){c.showTitle=false}RamaddaUtil.inherit(this,b=new RamaddaDisplay(g,f,DISPLAY_LABEL,c));addRamaddaDisplay(this);this.text="";this.editMode=c.editMode;if(c.text){this.text=c.text}else{if(c.label){this.text=c.label}else{if(c.html){this.text=c.html}else{if(c.title){this.text=c.title}}}}if(c["class"]){this["class"]=c["class"]}else{this["class"]="display-text"}RamaddaUtil.defineMembers(this,{initDisplay:function(){var l=this;this.createUI();var h=this["class"];if(this.editMode){h+=" display-text-edit "}var m=HtmlUtils.div([ATTR_CLASS,h,ATTR_ID,this.getDomId(e)],this.text);if(this.editMode){m+=HtmlUtils.textarea(d,this.text,["rows",5,"cols",120,ATTR_SIZE,"120",ATTR_CLASS,"display-text-input",ATTR_ID,this.getDomId(d)])}this.setContents(m);if(this.editMode){var k=this.jq(d);k.blur(function(){l.text=k.val();k.hide();l.initDisplay()});this.jq(e).click(function(){var o=l.jq(e);var n=l.jq(d);n.show();n.css("z-index","9999");n.position({of:o,my:"left top",at:"left top",collision:"none none"});l.jq(e).html("hello there")})}},getWikiAttributes:function(h){b.getWikiAttributes(h);h.push("text");h.push(this.text)}})}function RamaddaShellDisplay(h,g,d){var f="input";var e="output";var c="message";var b;RamaddaUtil.inherit(this,b=new RamaddaDisplay(h,g,DISPLAY_SHELL,d));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{history:[],historyIndex:-1,rootEntry:null,currentEntry:null,currentEntries:[],currentOutput:null,currentInput:null,initDisplay:function(){var o=this;this.createUI();var n=HtmlUtils.div([ATTR_CLASS,"display-shell-message",ATTR_ID,this.getDomId(c)],"");var l=HtmlUtils.div([ATTR_CLASS,"display-shell-output",ATTR_ID,this.getDomId(e)],"");var k=HtmlUtils.tag(TAG_INPUT,["placeholder","Enter JS here",ATTR_CLASS,"display-shell-input",ATTR_ID,this.getDomId(f)]);var m=n+l+k;this.setContents(m);if(this.currentOutput){this.getOutput().html(this.currentOutput)}if(this.currentInput){this.getInput().val(this.currentInput)}this.jq(f).keypress(function(q){if(q.which==0){return}if(q.ctrlKey){o.handleControlKey(q);return}if(q.which!=13){return}if(q.preventDefault){q.preventDefault()}var p=o.jq(f).val();o.processInput(p)})},writeStatusMessage:function(k){var l=this.jq(c);if(!k){l.hide();l.html("")}else{l.show();l.position({of:this.getOutput(),my:"left top",at:"left+4 top+4",collision:"none none"});l.html(k)}},clearInput:function(){this.jq(f).val("")},clearOutput:function(){this.writeStatusMessage(null);this.jq(e).html("")},handleControlKey:function(p){var m=p.which;var o=this.history;if(o.length<=0){return}var n=this.historyIndex;var l=-1;if(n<0||n>=o.length){n=o.length}if(m==112){l=n-1}else{if(m==110){l=n+1}}if(l>=0&&l<o.length){this.historyIndex=l;this.writeInput(o[l])}},writeInput:function(l){var k=this.getInput();if(k.val()==l){return}k.val(l).focus();this.currentInput=this.getInput().val()},getOutput:function(){return this.jq(e)},getInput:function(){return this.jq(f)},writeResult:function(l){this.writeStatusMessage(null);l=HtmlUtils.div([ATTR_CLASS,"display-shell-result"],l);var k=this.jq(e);k.append(l);k.animate({scrollTop:k.prop("scrollHeight")},1000);this.currentOutput=k.html();this.currentInput=this.getInput().val()},addHistory:function(k){if(this.history.length>0&&this.history[this.history.length-1]==k){return}this.history.push(k);this.historyIndex=-1},writeError:function(k){this.writeStatusMessage(k)},header:function(k){return HtmlUtils.div([ATTR_CLASS,"display-shell-header"],k)},processCommand_help:function(k,n,m){var l="";if(m!=null){l+=m}l+=this.header("RAMADDA Data Explorer Shell Help");l+="Navigation commands:<pre>pwd, ls, cd</pre>";l+="UI commands:<pre>history: ctrl-p, ctrl-n, !!  \nUI: clear, taller, shorter</pre>";this.writeResult(l)},uniqueCnt:0,displayEntries:function(k){this.currentEntries=k;var l=this.getEntriesTree(k,{showIndex:true,suffix:"_shell_"+(this.uniqueCnt++)});this.writeResult(l)},getEntryFromArgs:function(m,o){var p=this.currentEntries;if(p==null){return o}for(var n=0;n<m.length;n++){var k=m[n];if(k.match("^\d+$")){var l=parseInt(k);break}if(k=="-entry"){n++;var l=parseInt(m[n])-1;if(l<0||l>=p){this.writeError("Bad entry index:"+l+" should be between 1 and "+p.length);return}return p[l]}}return o},getCurrentEntry:function(){if(this.currentEntry==null){this.rootEntry=new Entry({id:ramaddaBaseEntry,name:"Root",type:"group"});this.currentEntry=this.rootEntry}return this.currentEntry},processCommand_pwd:function(k,o){var n=this.getCurrentEntry();var m=n.getIconImage([ATTR_TITLE,"View entry"]);var l=this.getEntriesTree([n],{suffix:"_YYY"});this.writeResult("Current entry:<br>"+l)},createPointDisplay:function(k,o,l){var n=this.getEntryFromArgs(o,this.getCurrentEntry());console.log("createDisplay got:"+n.getName());var m=this.getPointUrl(n);if(m==null){this.writeError("Not a point type:"+n.getName());return}this.createDisplay(n.getId(),l,m)},processCommand_table:function(k,l){this.createPointDisplay(k,l,DISPLAY_TABLE)},processCommand_linechart:function(k,l){this.createPointDisplay(k,l,DISPLAY_LINECHART)},processCommand_barchart:function(k,l){this.createPointDisplay(k,l,DISPLAY_BARCHART)},processCommand_bartable:function(k,l){this.createPointDisplay(k,l,DISPLAY_BARTABLE)},processCommand_hello:function(k,l){this.writeResult("Hello, how are you?")},processCommand_scatterplot:function(k,l){this.createPointDisplay(k,l,DISPLAY_SCATTERPLOT)},processCommand_blog:function(k,l){this.getLayoutManager().publish("blogentry")},processCommand_cd:function(k,m){if(m.length==0){this.currentEntry=this.rootEntry;this.processCommand_pwd("pwd",[]);return}var l=parseInt(m[1])-1;if(l<0||l>=this.currentEntries.length){this.writeError("Out of bounds: between 1 and "+this.currentEntries.length);return}this.currentEntry=this.currentEntries[l];this.processCommand_pwd("pwd",[])},processCommand_ls:function(k,o){var n=this;var m=function(p){n.displayEntries(p)};var l=this.getCurrentEntry().getChildrenEntries(m,"");if(l!=null){this.displayEntries(l)}else{this.writeStatusMessage("Listing entries...")}},entryListChanged:function(l){var k=l.getEntries();if(k.length==0){this.writeStatusMessage("Sorry, nothing found")}else{this.displayEntries(k)}},processCommand_search:function(l,q){var p="";for(var m=1;m<q.length;m++){p+=q[m]+" "}p=p.trim();var k=new EntrySearchSettings({text:p});var o=this.getRamadda();this.writeStatusMessage("Searching...");var n=o.getSearchUrl(k,OUTPUT_JSON);this.entryList=new EntryList(o,n,this,true)},processCommand_taller:function(k,l){if(!this.outputHeight){this.outputHeight=300}this.outputHeight+=parseInt(this.outputHeight*0.3);this.jq(e).css("max-height",this.outputHeight);this.jq(e).css("height",this.outputHeight)},processCommand_shorter:function(k,l){if(!this.outputHeight){this.outputHeight=300}this.outputHeight-=parseInt(this.outputHeight*0.3);this.jq(e).css("max-height",this.outputHeight);this.jq(e).css("height",this.outputHeight)},processCommand_clear:function(k){this.clearOutput();this.clearInput()},processInput:function(o){o=o.trim();if(o==""){return}var m=this.jq(f);var l=this.jq(e);var k=o.split(";");for(var n=0;n<k.length;n++){o=k[n];if(o=="!!"){if(this.history.length==0){this.writeError("No commands in history");return}o=this.history[this.history.length-1]}var q=o.split(" ");var p=q[0].trim();if(this["processCommand_"+p]){this["processCommand_"+p](o,q);this.addHistory(o);this.clearInput()}else{this.processCommand_help(o,q,"Unknown command: <i>"+o+"</i>");return}}}})}var CATEGORY_CHARTS="Charts";var CATEGORY_OTHER="Other Charts";var CATEGORY_MISC="Misc";var DISPLAY_LINECHART="linechart";var DISPLAY_AREACHART="areachart";var DISPLAY_BARCHART="barchart";var DISPLAY_BARTABLE="bartable";var DISPLAY_BARSTACK="barstack";var DISPLAY_PIECHART="piechart";var DISPLAY_TIMELINECHART="timelinechart";var DISPLAY_SANKEY="sankey";var DISPLAY_CALENDAR="calendar";var DISPLAY_SCATTERPLOT="scatterplot";var DISPLAY_HISTOGRAM="histogram";var DISPLAY_BUBBLE="bubble";var DISPLAY_GAUGE="gauge";var DISPLAY_STATS="stats";var DISPLAY_RECORDS="records";var DISPLAY_TABLE="table";var DISPLAY_CROSSTAB="crosstab";var DISPLAY_CORRELATION="correlation";var DISPLAY_HEATMAP="heatmap";var DISPLAY_WORDTREE="wordtree";var DISPLAY_TREEMAP="treemap";var ID_CHART="chart";var googleChartsLoaded=false;function googleChartsHaveLoaded(){googleChartsLoaded=true}google.charts.setOnLoadCallback(googleChartsHaveLoaded);function haveGoogleChartsLoaded(){if(!googleChartsLoaded){if(Utils.isDefined(google.visualization)){if(Utils.isDefined(google.visualization.Gauge)){googleChartsLoaded=true}}}return googleChartsLoaded}addGlobalDisplayType({type:DISPLAY_LINECHART,label:"Line Chart",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_BARCHART,label:"Bar Chart",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_BARSTACK,label:"Stacked Bar Chart",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_AREACHART,label:"Area Chart",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_BARTABLE,label:"Bar Table",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_SCATTERPLOT,label:"Scatter Plot",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_HISTOGRAM,label:"Histogram",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_BUBBLE,label:"Bubble Chart",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_PIECHART,label:"Pie Chart",requiresData:true,forUser:true,category:CATEGORY_CHARTS});addGlobalDisplayType({type:DISPLAY_GAUGE,label:"Gauge",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_TIMELINECHART,label:"Timeline",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_SANKEY,label:"Sankey Chart",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_CALENDAR,label:"Calendar Chart",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_STATS,label:"Stats Table",requiresData:false,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_RECORDS,label:"Records",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_TABLE,label:"Table",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_CORRELATION,label:"Correlation",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_HEATMAP,label:"Heatmap",requiresData:true,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_WORDTREE,label:"Word Tree",requiresData:true,forUser:true,category:"Text"});addGlobalDisplayType({type:DISPLAY_TREEMAP,label:"Tree Map",requiresData:true,forUser:true,category:CATEGORY_MISC});var PROP_CHART_MIN="chartMin";var PROP_CHART_MAX="chartMax";var DFLT_WIDTH="600px";var DFLT_HEIGHT="200px";function RamaddaFieldsDisplay(e,d,c,b){let _this=this;this.TYPE="RamaddaFieldsDisplay";let SUPER=new RamaddaDisplay(e,d,c,b);RamaddaUtil.inherit(this,this.RamaddaDisplay=SUPER);RamaddaUtil.defineMembers(this,{needsData:function(){return true},handleEventMapClick:function(k,g){if(!this.dataCollection){return}var f=this.dataCollection.getList();for(var h=0;h<f.length;h++){f[h].handleEventMapClick(this,k,g.lon,g.lat)}},initDisplay:function(){SUPER.initDisplay.call(this);if(this.needsData()){this.setContents(this.getLoadingMessage())}this.updateUI()},updateUI:function(){this.addFieldsCheckboxes()},checkLayout:function(){var h=this;var g=h.jq(ID_DISPLAY_CONTENTS);if(this.lastWidth!=g.width()){h.displayData()}if(true){return}if(g.width()==0){var f=function(){h.checkWidth(cnt+1)};setTimeout(f,5000)}else{h.displayData()}},getWikiAttributes:function(g){SUPER.getWikiAttributes.call(this,g);if(this.lastSelectedFields){g.push("fields");var f="";for(var h=0;h<this.lastSelectedFields.length;h++){f+=this.lastSelectedFields[h].getId();f+=","}g.push(f)}},initDialog:function(){SUPER.initDialog.call(this);this.addFieldsCheckboxes()},getDialogContents:function(g,k){var f="600";var h=HtmlUtils.div([ATTR_ID,this.getDomId(ID_FIELDS),"style","overflow-y: auto;    max-height:"+f+"px;"]," FIELDS ");g.push("Fields");k.push(h);SUPER.getDialogContents.call(this,g,k)},handleEventFieldsSelected:function(g,f){this.userHasSelectedAField=true;this.overrideFields=null;this.removeProperty(PROP_FIELDS);this.setSelectedFields(f);this.fieldSelectionChanged()},getFieldsToSelect:function(f){return f.getRecordFields()},canDoMultiFields:function(){return true}})}function RamaddaGoogleChart(displayManager,id,chartType,properties){var ID_TRENDS_CBX="trends_cbx";var ID_PERCENT_CBX="percent_cbx";var ID_COLORS="colors";var _this=this;$.extend(this,{indexField:-1,colorList:["blue","red","green","orange","fuchsia","teal","navy","silver"],curveType:"none",fontSize:0,vAxisMinValue:NaN,vAxisMaxValue:NaN,showPercent:false,percentFields:null});if(properties.colors){this.colorList=(""+properties.colors).split(",")}let SUPER=new RamaddaFieldsDisplay(displayManager,id,chartType,properties);RamaddaUtil.inherit(this,SUPER);RamaddaUtil.defineMembers(this,{clearCachedData:function(){SUPER.clearCachedData();this.computedData=null},updateUI:function(){SUPER.updateUI.call(this);if(!this.getDisplayReady()){return}this.displayData()},getWikiAttributes:function(attrs){this.defineWikiAttributes(["vAxisMinValue","vAxisMaxValue"]);SUPER.getWikiAttributes.call(this,attrs);if(this.colorList.join(",")!="blue,red,green"){attrs.push("colors");attrs.push(this.colorList.join(", "))}},initDialog:function(){SUPER.initDialog.call(this);var _this=this;var updateFunc=function(){_this.vAxisMinValue=Utils.toFloat(_this.jq("vaxismin").val());_this.vAxisMaxValue=Utils.toFloat(_this.jq("vaxismax").val());_this.minDate=_this.jq("mindate").val();_this.maxDate=_this.jq("maxdate").val();_this.displayData()};this.jq("vaxismin").blur(updateFunc);this.jq("vaxismax").blur(updateFunc);this.jq("mindate").blur(updateFunc);this.jq("maxdate").blur(updateFunc);this.jq(ID_COLORS).keypress(function(e){if(e.which!=13){return}var v=_this.jq(ID_COLORS).val();_this.colorList=v.split(",");_this.displayData();var pointData=_this.dataCollection.getList();_this.getDisplayManager().handleEventPointDataLoaded(_this,_this.lastPointData)});this.jq(ID_TRENDS_CBX).click(function(){_this.showTrendLines=_this.jq(ID_TRENDS_CBX).is(":checked");_this.displayData()});this.jq(ID_PERCENT_CBX).click(function(){_this.showPercent=_this.jq(ID_PERCENT_CBX).is(":checked");_this.displayData()})},setColor:function(){var v=prompt("Enter comma separated list of colors to use",this.colorList.join(","));if(v!=null){this.colorList=v.split(",");this.displayData();var pointData=this.dataCollection.getList();this.getDisplayManager().handleEventPointDataLoaded(this,this.lastPointData)}},getMenuItems:function(menuItems){SUPER.getMenuItems.call(this,menuItems);var get=this.getGet();var min="0";if(!isNaN(this.vAxisMinValue)){min=""+this.vAxisMinValue}var max="";if(!isNaN(this.vAxisMaxValue)){max=""+this.vAxisMaxValue}var tmp=HtmlUtils.formTable();tmp+=HtmlUtils.formEntry("Axis Range:",HtmlUtils.input("",min,["size","7",ATTR_ID,this.getDomId("vaxismin")])+" - "+HtmlUtils.input("",max,["size","7",ATTR_ID,this.getDomId("vaxismax")]));tmp+=HtmlUtils.formEntry("Date Range:",HtmlUtils.input("",this.minDate,["size","10",ATTR_ID,this.getDomId("mindate")])+" - "+HtmlUtils.input("",this.maxDate,["size","10",ATTR_ID,this.getDomId("maxdate")]));tmp+=HtmlUtils.formEntry("Colors:",HtmlUtils.input("",this.colorList.join(","),["size","35",ATTR_ID,this.getDomId(ID_COLORS)]));tmp+="</table>";menuItems.push(tmp)},getChartType:function(){return this.getType()},askMinZAxis:function(){this.setMinZAxis(prompt("Minimum axis value","0"))},setMinZAxis:function(v){if(v!=null){this.vAxisMinValue=parseFloat(v);this.displayData()}},askMaxZAxis:function(){this.setMaxZAxis(prompt("Maximum axis value","100"))},setMaxZAxis:function(v){if(v!=null){this.vAxisMaxValue=parseFloat(v);this.displayData()}},askMinDate:function(){var ex=this.minDate;if(ex==null||ex==""){ex="1800-01-01"}var v=prompt("Minimum date",ex);if(v==null){return}this.setMinDate(v)},setMinDate:function(v){this.minDate=v;this.displayData()},askMaxDate:function(){var ex=this.maxDate;if(ex==null||ex==""){ex="2100-01-01"}var v=prompt("Maximum date",ex);if(v==null){return}this.setMaxDate(v)},setMaxDate:function(v){this.maxDate=v;this.displayData()},trendLineEnabled:function(){return false},getDialogContents:function(tabTitles,tabContents){var height="600";var html=HtmlUtils.div([ATTR_ID,this.getDomId(ID_FIELDS),"style","overflow-y: auto;    max-height:"+height+"px;"]," FIELDS ");if(this.trendLineEnabled()){html+=HtmlUtils.div([ATTR_CLASS,"display-dialog-subheader"],"Other");html+=HtmlUtils.checkbox(this.getDomId(ID_TRENDS_CBX),[],this.getProperty("showTrendLines",false))+"  Show trend line";html+=" ";html+=HtmlUtils.checkbox(this.getDomId(ID_PERCENT_CBX),[],this.showPercent)+"  Show percent of displayed total<br>";html+="<br>"}tabTitles.push("Fields");tabContents.push(html);SUPER.RamaddaDisplay.getDialogContents.call(this,tabTitles,tabContents)},okToHandleEventRecordSelection:function(){return true},handleEventRecordSelection:function(source,args){if(source==this){return}if(!this.okToHandleEventRecordSelection()){return}var data=this.dataCollection.getList()[0];if(data!=args.data){return}this.setChartSelection(args.index)},getFieldsToSelect:function(pointData){return pointData.getChartableFields()},canDoGroupBy:function(){return false},clearCache:function(){this.computedData=null},googleChartCallbackPending:false,includeIndexInData:function(){return false},getGroupBy:function(){return this.groupBy},getIncludeIndexIfDate:function(){return false},displayData:function(){var _this=this;if(!this.getDisplayReady()){return}if(this.inError){return}if(!haveGoogleChartsLoaded()){if(!this.googleChartCallbackPending){this.googleChartCallbackPending=true;var func=function(){_this.googleChartCallbackPending=false;_this.displayData()};this.setContents(this.getLoadingMessage());setTimeout(func,500)}return}if(this.inError){return}if(!this.hasData()){this.clearChart();this.setContents(this.getLoadingMessage());return}this.setContents(HtmlUtils.div([ATTR_CLASS,"display-message"],"Building display..."));this.allFields=this.dataCollection.getList()[0].getRecordFields();var pointData=this.dataCollection.getList()[0];var selectedFields=this.getSelectedFields();if(selectedFields.length==0&&this.lastSelectedFields!=null){selectedFields=this.lastSelectedFields}if(selectedFields==null||selectedFields.length==0){if(this.getChartType()==DISPLAY_TABLE||this.getChartType()==DISPLAY_TREEMAP){selectedFields=this.dataCollection.getList()[0].getNonGeoFields()}else{selectedFields=this.getSelectedFields()}}if(selectedFields.length==0){this.setContents("No fields selected");return}var tmpFields=[];for(var i=0;i<selectedFields.length;i++){if(!this.shouldSkipField(selectedFields[i])){tmpFields.push(selectedFields[i])}}selectedFields=tmpFields;this.lastSelectedFields=selectedFields;var props={includeIndex:this.includeIndexInData()};props.groupByIndex=-1;var groupBy=this.getGroupBy();if(groupBy){for(var i=0;i<this.allFields.length;i++){var field=this.allFields[i];if(field.getId()==groupBy){props.groupByIndex=field.getIndex();props.groupByField=field;this.groupByField=field;break}}}var fieldsToSelect=selectedFields;if(this.raw){fieldsToSelect=this.dataCollection.getList()[0].getRecordFields();props.raw=true}props.includeIndexIfDate=this.getIncludeIndexIfDate();var dataHasIndex=props.includeIndex;var dataList=this.computedData;if(this["function"]&&this.computedData==null){var pointData=this.dataCollection.getList()[0];var allFields=pointData.getRecordFields();var records=pointData.getRecords();var indexField=this.indexField;var chartableFields=this.getFieldsToSelect(pointData);this.hasDate=this.getHasDate(records);var date_formatter=this.getDateFormatter();var setVars="";for(var i=0;i<chartableFields.length;i++){var field=chartableFields[i];setVars+="\tvar "+field.getId()+"=args."+field.getId()+";\n"}var code="function displayChartEval(args) {\n"+setVars+"\treturn  "+this["function"]+"\n}";eval(code);var newList=[];var fieldNames=null;var rowCnt=-1;var indexField=this.indexField;for(var rowIdx=0;rowIdx<records.length;rowIdx++){var record=records[rowIdx];var row=record.getData();var date=record.getDate();if(!this.dateInRange(date)){continue}rowCnt++;var values=[];var indexName=null;if(indexField>=0){var field=allFields[indexField];values.push(record.getValue(indexField)+offset);indexName=field.getLabel()}else{if(this.hasDate){values.push(this.getDateValue(date,date_formatter));indexName="Date"}else{values.push(rowIdx);indexName="Index"}}if(fieldNames==null){fieldNames=[indexName,this.functionName?this.functionName:"value"];newList.push(fieldNames)}var args={};for(var j=0;j<chartableFields.length;j++){var field=chartableFields[j];var value=row[field.getIndex()];args[field.getId()]=value}var value=displayChartEval(args);values.push(value);newList.push(values)}dataList=newList}if(dataList==null){dataList=this.getStandardData(fieldsToSelect,props)}this.computedData=dataList;if(this.rotateTable&&dataList.length){var header=dataList[0];var flipped=[];for(var rowIdx=1;rowIdx<dataList.length;rowIdx++){var row=dataList[rowIdx]}}if(dataList.length==0&&!this.userHasSelectedAField){var pointData=this.dataCollection.getList()[0];var chartableFields=this.getFieldsToSelect(pointData);for(var i=0;i<chartableFields.length;i++){var field=chartableFields[i];dataList=this.getStandardData([field],props);if(dataList.length>0){this.setSelectedFields([field]);break}}}if(dataList.length==0){this.setContents(HtmlUtils.div([ATTR_CLASS,"display-message"],"No data available"));return}if(this.showPercent){var newList=[];var isNumber=[];var isOk=[];var headerRow=null;var fields=null;if(this.percentFields!=null){fields=this.percentFields.split(",")}for(var i=0;i<dataList.length;i++){var row=this.getDataValues(dataList[i]);if(i==0){headerRow=row;continue}if(i==1){var seenIndex=false;for(var j=0;j<row.length;j++){var valueIsNumber=(typeof row[j]=="number");var valueIsDate=(typeof row[j]=="object");if(valueIsNumber){if(dataHasIndex&&!seenIndex){valueIsNumber=false;seenIndex=true}}if(valueIsDate){seenIndex=true}if(valueIsNumber&&fields!=null){valueIsNumber=fields.indexOf(fieldsToSelect[j].getId())>=0||fields.indexOf("#"+(j+1))>=0}isNumber.push(valueIsNumber)}var newHeader=[];for(var j=0;j<headerRow.length;j++){var v=headerRow[j];if(!isNumber[j]){newHeader.push(v)}else{newHeader.push("% "+v)}}newList.push(newHeader)}var total=0;var cnt=0;for(var j=0;j<row.length;j++){if(isNumber[j]){total+=parseFloat(row[j]);cnt++}}var newRow=[];for(var j=0;j<row.length;j++){if(isNumber[j]){if(total!=0){var v=parseFloat(((row[j]/total)*100).toFixed(1));newRow.push(v)}else{newRow.push(NaN)}}else{newRow.push(row[j])}}newList.push(newRow)}dataList=newList}try{this.makeChart(dataList,props,selectedFields)}catch(e){console.log(e.stack);this.displayError(""+e);return}var d=_this.jq(ID_CHART);this.lastWidth=d.width()},printDataList:function(dataList){console.log("data list:"+dataList.length);for(var i=0;i<dataList.length;i++){var row=dataList[i];var s="";for(var j=0;j<row.length;j++){if(j>0){s+=", "}s+=row[j]}console.log("row: "+i+"  "+s)}},clearChart:function(){if(this.chart!=null){this.chart.clearChart()}},setChartSelection:function(index){if(this.chart!=null){if(this.chart.setSelection){this.chart.setSelection([{row:index,column:null}])}}},tableHeaderMouseover:function(i,tooltip){},makeDataTable:function(dataList,props,selectedFields){dataList=this.filterData(dataList,selectedFields);if(dataList.length==1){return google.visualization.arrayToDataTable(this.makeDataArray(dataList))}var justData=[];var begin=props.includeIndex?1:0;var tooltipFields=[];var toks=this.getProperty("tooltipFields","").split(",");for(var i=0;i<toks.length;i++){var tooltipField=this.getFieldById(null,toks[i]);if(tooltipField){tooltipFields.push(tooltipField)}}var dataTable=new google.visualization.DataTable();var header=this.getDataValues(dataList[0]);var sample=this.getDataValues(dataList[1]);for(var j=0;j<header.length;j++){var value=sample[j];if(j==0&&props.includeIndex){if((typeof value)=="object"){dataTable.addColumn("date",header[j])}else{dataTable.addColumn((typeof value),header[j])}}else{dataTable.addColumn("number",header[j]);dataTable.addColumn({type:"string",role:"tooltip",p:{html:true}})}}for(var i=1;i<dataList.length;i++){var row=this.getDataValues(dataList[i]);row=row.slice(0);var label="";if(dataList[i].record){for(var j=0;j<tooltipFields.length;j++){label+="<b>"+tooltipFields[j].getLabel()+"</b>: "+dataList[i].record.getValue(tooltipFields[j].getIndex())+"<br>"}}var tooltip="<div style='padding:8px;'>";tooltip+=label;for(var j=0;j<row.length;j++){if(j>0){tooltip+="<br>"}label=header[j].replace(/ /g,"&nbsp;");value=row[j];if(!value){value="NA"}if(value&&(typeof value)=="object"){if(value.f){value=value.f}}if(Utils.isNumber(value)){value=this.formatNumber(value)}value=""+value;value=value.replace(/ /g,"&nbsp;");tooltip+="<b>"+label+"</b>:&nbsp;"+value}tooltip+="</div>";newRow=[];for(var j=0;j<row.length;j++){var value=row[j];newRow.push(value);if(j==0&&props.includeIndex){}else{newRow.push(tooltip)}}justData.push(newRow)}dataTable.addRows(justData);return dataTable},makeChartOptions:function(dataList,props,selectedFields){var chartOptions={tooltip:{isHtml:true}};$.extend(chartOptions,{lineWidth:1,colors:this.colorList,curveType:this.curveType,vAxis:{}});if(this.lineWidth){chartOptions.lineWidth=this.lineWidth}if(this.fontSize>0){chartOptions.fontSize=this.fontSize}var defaultRange=this.getDisplayManager().getRange(selectedFields[0]);var range=[NaN,NaN];if(!isNaN(this.vAxisMinValue)){range[0]=parseFloat(this.vAxisMinValue)}else{if(defaultRange!=null){range[0]=defaultRange[0]}}if(!isNaN(this.vAxisMaxValue)){range[1]=parseFloat(this.vAxisMaxValue)}else{if(defaultRange!=null){range[1]=defaultRange[1]}}if(!isNaN(range[0])){chartOptions.vAxis.minValue=range[0]}if(!isNaN(range[1])){chartOptions.vAxis.maxValue=range[1]}this.chartDimensions={width:"90%",left:"10%"};useMultipleAxes=this.getProperty("useMultipleAxes",true);if((selectedFields.length>1&&useMultipleAxes)||this.getProperty("padRight",false)===true){this.chartDimensions.width="80%"}if(this.getProperty("showTrendLines",false)){chartOptions.trendlines={0:{type:"linear",color:"green"}}}this.setContents(this.getChartDiv());return chartOptions},getChartDiv:function(){var chartId=this.getDomId(ID_CHART);var divAttrs=[ATTR_ID,chartId];divAttrs.push("style");divAttrs.push("height:100%;width:100%;");return HtmlUtils.div(divAttrs,"")},makeGoogleChart:function(dataList,props,selectedFields){if(typeof google=="undefined"){this.setContents("No google");return}this.chartOptions=this.makeChartOptions(dataList,props,selectedFields);this.chart=this.doMakeGoogleChart(dataList,props,selectedFields,this.chartOptions);if(this.chart!=null){var dataTable=this.makeDataTable(dataList,props,selectedFields);if(!dataTable){return}if(!Utils.isDefined(this.chartOptions.height)){this.chartOptions.height="100%"}this.chart.draw(dataTable,this.chartOptions);var theDisplay=this;google.visualization.events.addListener(this.chart,"onmouseover",function(event){mapVar=theDisplay.getProperty("mapVar",null);if(!Utils.stringDefined(mapVar)){return}row=event.row;pointData=theDisplay.dataCollection.getList()[0];var fields=pointData.getRecordFields();var records=pointData.getRecords();var record=records[row];map=ramaddaMapMap[mapVar];if(map){if(theDisplay.mouseOverPoint){map.removePoint(theDisplay.mouseOverPoint)}}else{}if(record&&map){latField=null;lonField=null;for(i=0;i<fields.length;i++){if(fields[i].isFieldLatitude()){latField=fields[i]}else{if(fields[i].isFieldLongitude()){lonField=fields[i]}}}if(latField&&lonField){lat=record.getValue(latField.getIndex());lon=record.getValue(lonField.getIndex());theDisplay.mouseOverPoint=map.addPoint(chartId,new OpenLayers.LonLat(lon,lat))}}});theDisplay.displayManager.propagateEventRecordSelection(theDisplay,theDisplay.dataCollection.getList()[0],{index:0});google.visualization.events.addListener(this.chart,"select",function(event){if(theDisplay.chart.getSelection){var selected=theDisplay.chart.getSelection();if(selected&&selected.length>0){var index=selected[0].row;theDisplay.displayManager.propagateEventRecordSelection(theDisplay,theDisplay.dataCollection.getList()[0],{index:index})}}})}},getChartId:function(){return this.getDomId(ID_CHART)},doMakeGoogleChart:function(dataList,props,selectedFields,chartOptions){throw new Error("doMakeGoogleChart undefined")}});this.makeChart=this.makeGoogleChart}function RamaddaAxisChart(e,d,c,b){let SUPER=new RamaddaGoogleChart(e,d,c,b);RamaddaUtil.inherit(this,SUPER);$.extend(this,{makeChartOptions:function(g,h,f){chartOptions=SUPER.makeChartOptions.call(this,g,h,f);var k=this.getProperty("useMultipleAxes",true);chartOptions.height=this.getProperty("chartHeight",this.getProperty("height","150"));$.extend(chartOptions,{legend:{position:"bottom"},chartArea:{left:this.getProperty("chartLeft",this.chartDimensions.left),top:this.getProperty("chartTop","10"),height:this.getProperty("chartHeight","70%"),width:this.getProperty("chartWidth",this.chartDimensions.width)}});if(k){$.extend(chartOptions,{series:[{targetAxisIndex:0},{targetAxisIndex:1}]})}if(this.hAxis){if(chartOptions.hAxis){chartOptions.hAxis.title=this.hAxis}else{chartOptions.hAxis={title:this.hAxis}}}if(this.vAxis){if(chartOptions.vAxis){chartOptions.vAxis.title=this.vAxis}else{chartOptions.vAxis={title:this.vAxis}}}if(Utils.isDefined(this.chartHeight)){chartOptions.height=this.chartHeight}return chartOptions}})}function RamaddaSeriesChart(e,d,c,b){let SUPER=new RamaddaGoogleChart(e,d,c,b);RamaddaUtil.inherit(this,SUPER);$.extend(this,{includeIndexInData:function(){return true},trendLineEnabled:function(){return true}})}function LinechartDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaSeriesChart(d,c,DISPLAY_LINECHART,b));addRamaddaDisplay(this);$.extend(this,{doMakeGoogleChart:function(f,g,e,h){return new google.visualization.LineChart(document.getElementById(this.getChartId()))}})}function AreachartDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaSeriesChart(d,c,DISPLAY_AREACHART,b));addRamaddaDisplay(this);$.extend(this,{doMakeGoogleChart:function(f,g,e,h){if(this.isStacked){h.isStacked=true}return new google.visualization.AreaChart(document.getElementById(this.getChartId()))}})}function RamaddaBaseBarchart(e,d,c,b){RamaddaUtil.inherit(this,new RamaddaSeriesChart(e,d,c,b));$.extend(this,{doMakeGoogleChart:function(g,k,f,l){var h=this.getChartType();if(h==DISPLAY_BARSTACK){l.isStacked=true}if(this.getProperty("barWidth")){l.bar={groupWidth:this.getProperty("barWidth")}}l.orientation="horizontal";return new google.visualization.BarChart(document.getElementById(this.getChartId()))}})}function BarchartDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaBaseBarchart(d,c,DISPLAY_BARCHART,b));addRamaddaDisplay(this)}function BarstackDisplay(d,c,b){b=$.extend({isStacked:true},b);RamaddaUtil.inherit(this,new RamaddaBaseBarchart(d,c,DISPLAY_BARSTACK,b));addRamaddaDisplay(this)}function HistogramDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaGoogleChart(d,c,DISPLAY_HISTOGRAM,b));addRamaddaDisplay(this);RamaddaUtil.inherit(this,{okToHandleEventRecordSelection:function(){return false},makeDataTable:function(f,g,e){return google.visualization.arrayToDataTable(this.makeDataArray(f))},doMakeGoogleChart:function(f,g,e,k){if(this.legendPosition){if(!k.legend){k.legend={}}k.legend.position=this.legendPosition}var h=this.getProperty("isStacked",null);if(h){k.isStacked=h=="true"?true:h=="false"?false:h}k.vAxis={};k.vAxis.viewWindow={};if(Utils.isDefined(this.logScale)){k.vAxis.logScale=(""+this.logScale)==true}if(this.textPosition){k.vAxis.textPosition=this.textPosition}if(Utils.isDefined(this.minValue)){k.vAxis.viewWindow.min=parseFloat(this.minValue)}if(Utils.isDefined(this.maxValue)){k.vAxis.viewWindow.max=parseFloat(this.maxValue)}if(!isNaN(this.vAxisMaxValue)){k.vAxis.maxValue=parseFloat(this.vAxisMaxValue)}if(!isNaN(this.vAxisMinValue)){k.vAxis.minValue=parseFloat(this.vAxisMinValue)}return new google.visualization.Histogram(document.getElementById(this.getChartId()))}})}function RamaddaTextChart(e,d,c,b){let SUPER=new RamaddaGoogleChart(e,d,c,b);RamaddaUtil.inherit(this,SUPER);$.extend(this,{getFieldsToSelect:function(f){return f.getNonGeoFields()}})}function PiechartDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaTextChart(d,c,DISPLAY_PIECHART,b));addRamaddaDisplay(this);$.extend(this,{canDoGroupBy:function(){return true},getGroupBy:function(){if(!this.groupBy&&this.groupBy!=""){var e=this.getFieldOfType(this.allFields,"string");if(e){this.groupBy=e.getId()}}return this.groupBy},getChartDiv:function(){var k=this.getDomId(ID_CHART);var h=[ATTR_ID,k];h.push("style");var g="";if(this.getProperty("width")){var f=this.getProperty("width");if(f>0){g+="width:"+f+"px;"}else{if(f<0){g+="width:"+(-f)+"%;"}else{g+="width:"+f}}}else{g+="width:100%;"}if(this.getProperty("height")){var e=this.getProperty("height");if(e>0){g+="height:"+e+"px;"}else{if(e<0){g+="height:"+(-e)+"%;"}else{g+="height:"+e}}}else{g+="height:100%;"}h.push(g);return HtmlUtils.div(h,"")},doMakeGoogleChart:function(f,g,e,h){h.tooltip={textStyle:{color:"#000000"},showColorCode:true};if(this.getProperty("bins",null)){h.title="Bins: "+this.getDataValues(f[0])[1]}else{h.title=this.getDataValues(f[0])[0]+" - "+this.getDataValues(f[0])[1]}if(this.is3D){h.is3D=true}if(this.pieHole){h.pieHole=this.pieHole}if(this.sliceVisibilityThreshold){h.sliceVisibilityThreshold=this.sliceVisibilityThreshold}return new google.visualization.PieChart(document.getElementById(this.getChartId()))},makeDataTable:function(h,f,o){var p=new google.visualization.DataTable();var G=[];var x=this.groupByField;var E=this.getDataValues(h[0]);p.addColumn("string",E[0]);p.addColumn("number",E[1]);if(this.getProperty("bins",null)){var z=parseInt(this.getProperty("bins",null));var C=Number.MAX_VALUE;var D=Number.MIN_VALUE;var k=false;var q=false;if(this.getProperty("binMin")){C=parseFloat(this.getProperty("binMin"));k=true}if(this.getProperty("binMax")){D=parseFloat(this.getProperty("binMax"));q=true}var u=[];for(var F=1;F<h.length;F++){var w=this.getDataValues(h[F]);var B=w[1];if(!Utils.isRealNumber(B)){continue}if(!k){C=Math.min(B,C)}if(!q){D=Math.max(B,D)}u.push(B)}var n=[];var g=(D-C)/z;for(var H=0;H<z;H++){n.push({min:C+H*g,max:C+(H+1)*g,values:[]})}for(var e=0;e<u.length;e++){var B=u[e];var m=false;for(var H=0;H<n.length;H++){if(B<n[H].min||(B>=n[H].min&&B<=n[H].max)){n[H].values.push(B);m=true;break}}if(!m){n[n.length-1].values.push(B)}}for(var H=0;H<z;H++){var y=n[H];G.push(["Bin:"+this.formatNumber(y.min)+"-"+this.formatNumber(y.max),y.values.length])}}else{for(var F=1;F<h.length;F++){var w=this.getDataValues(h[F]);var t=""+(w.length==1?"#"+F:w[0]);var l=w.length==1?w[0]:w[1];G.push([t,l])}}p.addRows(G);return p}})}function SankeyDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaTextChart(d,c,DISPLAY_SANKEY,b));addRamaddaDisplay(this);$.extend(this,{doMakeGoogleChart:function(f,g,e,h){h.height=parseInt(this.getProperty("chartHeight",this.getProperty("height","400")));h.sankey={node:{colors:this.colors,width:5},link:{colorMode:"source",colors:this.colors,color:{}}};return new google.visualization.Sankey(document.getElementById(this.getChartId()))},defaultSelectedToAll:function(){return true},makeDataTable:function(n,m,g){n=this.filterData(n,g);if(!this.getProperty("doCategories",false)){var t=this.makeDataArray(n);return google.visualization.arrayToDataTable(t)}var u=[];for(var k=0;k<g.length;k++){var q=g[k];if(q.getType()=="string"){u.push(q)}}var t=[];t.push(["characteristic 1","characteristic 2","value"]);for(var k=1;k<u.length;k++){var h=u[k-1];var f=u[k];var p={};for(var e=1;e<n.length;e++){var v=this.getDataValues(n[e]);var o=v[k-1];var l=v[k];var s=o+"-"+l;if(!p[s]){p[s]={v1:o,v2:l,cnt:0}}p[s].cnt++}for(a in p){t.push([p[a].v1,p[a].v2,p[a].cnt])}}return google.visualization.arrayToDataTable(t)}})}function WordtreeDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaTextChart(d,c,DISPLAY_WORDTREE,b));addRamaddaDisplay(this);$.extend(this,{handleEventRecordSelection:function(f,e){},doMakeGoogleChart:function(k,l,e,m){if(this.getProperty("chartHeight")){m.height=parseInt(this.getProperty("chartHeight"))}if(this.getProperty("wordColors")){var h=this.getProperty("wordColors").split(",");var f=[];for(var g=0;g<3&&g<h.length;g++){f.push(h[g])}if(f.length==3){m.colors=f}}if(this.getProperty("chartWidth")){m.width=parseInt(this.getProperty("chartWidth"))}m.wordtree={format:"implicit",wordSeparator:"_SEP_",word:this.getProperty("treeRoot","root")};if(this.getProperty("maxFontSize")){m.maxFontSize=parseInt(this.getProperty("maxFontSize"))}return new google.visualization.WordTree(document.getElementById(this.getChartId()))},makeDataTable:function(E,x,z){var u=this.getProperty("treeRoot","root");var M=this.filterData(null,z);var e=this.getSelectedFields(this.getData().getRecordFields());var D=this.getFieldById(null,this.getProperty("colorBy"));var T=[];var g=["phrases"];T.push(g);var I=this.getProperty("fixedSize");if(D){I=1}if(I){g.push("size")}if(D){g.push("value")}var f={};var h="";for(var O=0;O<e.length;O++){var k=e[O];if(h!=""){h+=" -&gt;"}h+=k.getLabel();if(!k.isFieldNumeric()){continue}var J=this.getColumnValues(M,k);var F=[];var q=this.getProperty("buckets."+k.getId(),this.getProperty("buckets",null));var R,t;if(q){var s=this.getProperty("bucketLabels."+k.getId(),this.getProperty("bucketLabels",null));var U;if(s){U=s.split(",")}var N=q.split(",");var o=0;for(var V=0;V<N.length;V++){var G=parseFloat(N[V]);if(V==0){R=G;t=G}R=Math.min(R,G);t=Math.max(t,G);if(V>0){var K;if(U&&O<=U.length){K=U[V-1]}else{K=Utils.formatNumber(o,true)+"-"+Utils.formatNumber(G,true)}F.push({min:o,max:G,label:K})}o=G}}else{var L=parseInt(this.getProperty("numBuckets."+k.getId(),this.getProperty("numBuckets",10)));R=J.min;t=J.max;var C=(J.max-J.min)/L;for(var V=0;V<L;V++){var n=J.min+(V*C);var m=J.min+((V+1)*C);var K=Utils.formatNumber(n,true)+"-"+Utils.formatNumber(m,true);F.push({min:n,max:m,label:K})}}f[k.getId()]={min:R,max:t,buckets:F}}var y="_SEP_";for(var S=0;S<M.length;S++){var p=this.getDataValues(M[S]);var l=u;for(var w=0;w<e.length;w++){var k=e[w];l+=y;var H=p[k.getIndex()];if(k.isFieldNumeric()){var P=f[k.getId()];for(var V=0;V<P.buckets.length;V++){var B=P.buckets[V];if(H>=B.min&&H<=B.max){H=B.label;break}}}l+=H}var Q=[l.trim()];if(I){Q.push(parseInt(I))}if(D){Q.push(p[D.getIndex()])}T.push(Q)}if(this.getProperty("header")){h=this.getProperty("header","")}else{h="<b>Fields: </b>"+h;if(this.getProperty("headerPrefix")){h=this.getProperty("headerPrefix")+" "+h}}this.writeHtml(ID_DISPLAY_TOP,h);return google.visualization.arrayToDataTable(T)}})}function TableDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaTextChart(d,c,DISPLAY_TABLE,b));addRamaddaDisplay(this);$.extend(this,{canDoGroupBy:function(){return true},defaultSelectedToAll:function(){return true},doMakeGoogleChart:function(g,h,f,k){k.height=null;if(this.chartHeight){k.height=this.chartHeight}if(k.height==null){var e=this.getProperty("height",null);if(e){k.height=e}}if(k.height==null){k.height="300px"}k.allowHtml=true;if(g.length&&this.getDataValues(g[0]).length>4){k.cssClassNames={headerCell:"display-table-header-max"}}else{k.cssClassNames={headerCell:"display-table-header"}}return new google.visualization.Table(document.getElementById(this.getChartId()))},makeDataTable:function(f,g,e){f=this.filterData(f,e);var l=this.makeDataArray(f);var k=[];for(var h=0;h<l.length;h++){var m=l[h];for(var n=0;n<m.length;n++){if((typeof m[n])=="string"){m[n]=m[n].replace(/\n/g,"<br>")}}k.push(m)}return google.visualization.arrayToDataTable(k)}})}function BubbleDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaTextChart(d,c,DISPLAY_BUBBLE,b));addRamaddaDisplay(this);$.extend(this,{makeDataTable:function(f,g,e){return google.visualization.arrayToDataTable(this.makeDataArray(f))},doMakeGoogleChart:function(g,h,e,k){var f=this.getColorTable(true);if(f){k.colors=f}else{if(!this.colors){k.colors=this.colorList}}if(k.colors){k.colors=Utils.getColorTable("rainbow",true)}k.chartArea={left:100,top:10,width:"98%",height:"90%"};k.colorAxis={legend:{position:"in"}};k.bubble={textStyle:{auraColor:"none"},stroke:"#666"};k.hAxis={};k.vAxis={};header=this.getDataValues(g[0]);k.hAxis.format=this.getProperty("hAxisFormat",null);k.vAxis.format=this.getProperty("vAxisFormat",null);k.hAxis.title=this.getProperty("hAxisTitle",header.length>1?header[1]:null);k.vAxis.title=this.getProperty("vAxisTitle",header.length>2?header[2]:null);return new google.visualization.BubbleChart(document.getElementById(this.getChartId()))}})}function BartableDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaSeriesChart(d,c,DISPLAY_BARTABLE,b));addRamaddaDisplay(this);$.extend(this,{xgetIncludeIndexIfDate:function(){return true},doMakeGoogleChart:function(h,k,f,l){var e="";if(Utils.isDefined(this.chartHeight)){e=this.chartHeight}else{if(h.length>1){var g=h.length;if(this.isStacked){e=g*22}else{e=g*22+g*14*(this.getDataValues(h[0]).length-2)}}}$.extend(l,{title:"the title",bars:"horizontal",colors:this.colorList,width:(Utils.isDefined(this.chartWidth)?this.chartWidth:"100%"),chartArea:{left:"30%",top:0,width:"70%",height:"80%"},height:e,bars:"horizontal",tooltip:{showColorCode:true},legend:{position:"none"}});if(Utils.isDefined(this.isStacked)){l.isStacked=this.isStacked}if(this.hAxis){l.hAxis={title:this.hAxis}}if(this.vAxis){l.vAxis={title:this.vAxis}}return new google.charts.Bar(document.getElementById(this.getChartId()))},getDefaultSelectedFields:function(e,k){var g=[];for(i=0;i<e.length;i++){var h=e[i];if(!h.isNumeric){g.push(h);break}}for(i=0;i<e.length;i++){var h=e[i];if(h.isNumeric){g.push(h);break}}return g}})}function TreemapDisplay(d,c,b){let SUPER=new RamaddaTextChart(d,c,DISPLAY_TREEMAP,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);$.extend(this,{handleEventRecordSelection:function(f,e){},getFieldsToSelect:function(e){return e.getRecordFields()},tooltips:{},makeChartOptions:function(f,g,e){let _this=this;var h=function(n,l,m){if(_this.tooltips[n]){return _this.tooltips[n]}return"<div class='display-treemap-tooltip-outer'><div class='display-treemap-tooltip''><i>left-click: go down<br>right-click: go up</i></div></div>";return null};var k=SUPER.makeChartOptions.call(this,f,g,e);$.extend(k,{highlightOnMouseOver:true,generateTooltip:h,maxDepth:parseInt(this.getProperty("maxDepth",2)),maxPostDepth:parseInt(this.getProperty("maxPostDepth",3))});return k},defaultSelectedToAll:function(){return true},doMakeGoogleChart:function(f,g,e,k){var h=this.makeDataTable(f,g,e);if(!h){return}return new google.visualization.TreeMap(document.getElementById(this.getChartId()))},addTuple:function(h,e,f,n,o,l,k){var p=n;var g=0;if(Utils.isDefined(f[n])&&o){n=o+":"+n}while(true){if(!Utils.isDefined(f[n])){f[n]=true;break}n=p+" "+(++g)}var m=[n,o,l];if(e){m.push(k)}h.push(m);return n},valueClicked:function(f,e){var g=this.getData().getRecordFields();f=this.getFieldById(g,f);this.propagateEvent("handleEventFieldValueSelect",{field:f,value:e})},makeDataTable:function(J,C,F){var M=this.filterData();if(!M){return null}var E=this.getData().getRecordFields();var e=this.getSelectedFields(E);if(e.length==0){e=E}var z=this.getFieldsOfType(e,"string");if(z.length<2){this.displayError("No string fields specified");return null}var G=this.getProperty("addPrefix",true);var H=this.getFieldById(E,this.getProperty("sizeBy"));var t=this.getFieldById(E,this.getProperty("colorBy"));var T=this.getFieldsOfType(e,"numeric");if(!H&&T.length>0){H=T[0]}if(!t&&T.length>1){t=T[1]}var x=[];var I=this.getProperty("tooltipFields","").split(",");for(var N=0;N<I.length;N++){var k=this.getFieldById(null,I[N]);if(k){x.push(k)}}if(x.length==0){x=E}this.tooltips={};var p=[];for(var h=0;h<z.length;h++){var n=z[h];p.push(this.getColumnValues(M,n).values)}var Q=[];var l=[];var R=[];var w={};this.addTuple(Q,t,{},"Node","Parent","Value","Color");var y=z[0].getLabel();this.addTuple(Q,t,w,y,null,0,0);var B={};var g=this.getGet();for(var S=0;S<M.length;S++){var s=this.getDataValues(M[S]);var u="";var q="";for(var h=0;h<z.length-1;h++){var T=p[h];if(u!=""){u+=":"}u+=T[S];if(!Utils.isDefined(B[u])){var o=Utils.isDefined(B[q])?B[q]:y;var L=T[S];if(G&&h>0){L=o+":"+L}B[u]=this.addTuple(Q,t,w,L,o,0,0)}q=u}var o=Utils.isDefined(B[q])?B[q]:y;var L=s[z[z.length-1].getIndex()];var m=H?s[H.getIndex()]:1;var D=t?s[t.getIndex()]:0;L=this.addTuple(l,t,w,L,o,m,D);var P="<div class='display-treemap-tooltip-outer'><div class='display-treemap-tooltip''>";for(var O=0;O<x.length;O++){var K=s[x[O].getIndex()];var n=x[O];K=HtmlUtils.onClick(g+".valueClicked('"+n.getId()+"','"+K+"')",K,[]);P+="<b>"+n.getLabel()+"</b>: "+K+"<br>"}P+="</div></div>";R.push(P)}for(var N=0;N<l.length;N++){Q.push(l[N]);this.tooltips[Q.length-2]=R[N]}return google.visualization.arrayToDataTable(Q)}})}function TimelinechartDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaTextChart(d,c,DISPLAY_TIMELINECHART,b));addRamaddaDisplay(this);$.extend(this,{doMakeGoogleChart:function(f,g,e,h){return new google.visualization.Timeline(document.getElementById(this.getChartId()))},makeDataTable:function(q,m,s){var D=this.filterData();var n=[];var w=this.getFieldOfType(s,"string");if(!w){w=this.getFieldOfType(null,"string")}var F=this.getProperty("showLabel",true);var k=[];var e=this.getProperty("labelFieldsTemplate");var y=this.getProperty("labelFields","").split(",");for(var C=0;C<y.length;C++){var g=this.getFieldById(null,y[C]);if(g){k.push(g)}}var u=this.getFieldsOfType(s,"date");if(u.length==0){u=this.getFieldsOfType(null,"date")}var h=[];var t=new google.visualization.DataTable();if(u.length<2){throw new Error("Need to have at least 2 date fields")}if(w){t.addColumn({type:"string",id:w.getLabel()})}else{t.addColumn({type:"string",id:"Index"})}if(k.length>0){t.addColumn({type:"string",id:"Label"})}t.addColumn({type:"date",id:u[0].getLabel()});t.addColumn({type:"date",id:u[1].getLabel()});for(var x=0;x<D.length;x++){var o=this.getDataValues(D[x]);var v=[];h.push(v);if(w&&F){v.push(o[w.getIndex()])}else{v.push("#"+(x+1))}if(k.length>0){var p="";if(e){p=e}for(var B=0;B<k.length;B++){var E=k[B];var z=o[E.getIndex()];if(e){p=p.replace("{"+E.getId()+"}",z)}else{p+=z+" "}}v.push(p)}v.push(o[u[0].getIndex()]);v.push(o[u[1].getIndex()])}t.addRows(h);return t}})}function CalendarDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaGoogleChart(d,c,DISPLAY_CALENDAR,b));addRamaddaDisplay(this);RamaddaUtil.inherit(this,{doMakeGoogleChart:function(f,g,e,h){h.calendar={cellSize:parseInt(this.getProperty("cellSize",15))};if(this.jq(ID_CHART).width()==0){return}return new google.visualization.Calendar(document.getElementById(this.getChartId()))},defaultSelectedToAll:function(){return true},xgetContentsStyle:function(){var e=this.getProperty("height",200);if(e>0){return" height:"+e+"px;  max-height:"+e+"px; overflow-y: auto;"}return""},canDoMultiFields:function(){return false},makeDataTable:function(p,o,h){var f=new google.visualization.DataTable();var m=this.getDataValues(p[0]);f.addColumn({type:"date",id:"Date"});f.addColumn({type:"number",id:m[1]});f.addColumn({type:"string",role:"tooltip",p:{html:true}});var q=false;var l=this.getProperty("missingValue",null);if(l){q=true;l=parseFloat(l)}var n=[];var g=0;var u={weekday:"long",year:"numeric",month:"long",day:"numeric"};for(var k=1;k<p.length;k++){var s=this.getDataValues(p[k])[1];if(s==NaN){continue}if(q&&s==l){continue}g++;var e=this.formatDate(this.getDataValues(p[k])[0],{options:u});e=e.replace(/ /g,"&nbsp;");var t="<center><b>"+e+"</b></center><b>"+m[1].replace(/ /g,"&nbsp;")+"</b>:&nbsp;"+this.formatNumber(s);t=HtmlUtils.tag("div",["style","padding:5px;"],t);n.push([this.getDataValues(p[k])[0],s,t])}f.addRows(n);return f}})}function GaugeDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaGoogleChart(d,c,DISPLAY_GAUGE,b));addRamaddaDisplay(this);RamaddaUtil.inherit(this,{doMakeGoogleChart:function(m,l,k,g){this.dataList=m;this.chartOptions=g;var h=Number.MAX_VALUE;var n=Number.MIN_VALUE;var e=true;for(var q=1;q<m.length;q++){var o=this.getDataValues(m[q]);for(var f=0;f<o.length;f++){if(!Utils.isNumber(o[f])){continue}var p=o[f];h=Math.min(h,p);n=Math.max(n,p)}}h=Utils.formatNumber(h,true);n=Utils.formatNumber(n,true);if(Utils.isDefined(this.gaugeMin)){e=true;h=parseFloat(this.gaugeMin)}if(Utils.isDefined(this.gaugeMax)){e=true;n=parseFloat(this.gaugeMax)}if(e){g.min=h;g.max=n}return new google.visualization.Gauge(document.getElementById(this.getChartId()))},makeDataTable:function(o,n,e){o=this.makeDataArray(o);if(!Utils.isDefined(this.index)){this.index=o.length-1}var l=this.index+1;var m=[];m.push(["Label","Value"]);var k=this.getDataValues(o[0]);if(l>=o.length){l=o.length-1}var q=this.getDataValues(o[l]);for(var f=0;f<q.length;f++){if(!Utils.isNumber(q[f])){continue}var g=k[f];if(g.length>20){var l=g.indexOf("(");if(l>0){g=g.substring(0,l)}}if(g.length>20){g=g.substring(0,19)+"..."}if(this.getProperty("gaugeLabel")){g=this.getProperty("gaugeLabel")}else{if(this["gaugeLabel"+(f+1)]){g=this["gaugeLabel"+(f+1)]}}var p=q[f];m.push([g,Utils.formatNumber(p,true)])}return google.visualization.arrayToDataTable(m)},setChartSelection:function(e){if(this.chart){this.index=e;var f=this.makeDataTable(this.dataList);this.chart.draw(f,this.chartOptions)}}})}function ScatterplotDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaGoogleChart(d,c,DISPLAY_SCATTERPLOT,b));$.extend(this,{doMakeGoogleChart:function(g,k,f,l){var e=400;if(Utils.isDefined(this.chartHeight)){e=this.chartHeight}var h="100%";if(Utils.isDefined(this.chartWidth)){h=this.chartWidth}var m=this.getChartId();$("#"+m).css("width",h);$("#"+m).css("height",e);this.chartOptions={title:"",tooltip:{isHtml:true},legend:"none",chartArea:{left:"10%",top:10,height:"80%",width:"90%"}};if(this.getShowTitle()){this.chartOptions.title=this.getTitle(true)}if(g.length>0&&this.getDataValues(g[0]).length>1){this.chartOptions.hAxis={title:this.getDataValues(g[0])[0]};this.chartOptions.vAxis={title:this.getDataValues(g[0])[1]};if(!isNaN(this.vAxisMinValue)){l.hAxis.minValue=this.vAxisMinValue;l.vAxis.minValue=this.vAxisMinValue}if(!isNaN(this.vAxisMaxValue)){l.hAxis.maxValue=this.vAxisMaxValue;l.vAxis.maxValue=this.vAxisMaxValue}}return new google.visualization.ScatterChart(document.getElementById(this.getChartId()))},getDefaultSelectedFields:function(e,k){var g=[];for(i=0;i<e.length;i++){var h=e[i];if(h.isNumeric){g.push(h);if(g.length>=2){break}}}return g}});addRamaddaDisplay(this)}function RamaddaStatsDisplay(f,e,b,c){var d=Utils.isDefined(b.showDefault)?b.showDefault:true;$.extend(this,{showMin:d,showMax:d,showAverage:d,showStd:d,showPercentile:d,showCount:d,showTotal:d,showPercentile:d,showMissing:d,showUnique:d,showType:d,showText:d});let SUPER=new RamaddaFieldsDisplay(f,e,c||DISPLAY_STATS,b);RamaddaUtil.inherit(this,SUPER);if(!c){addRamaddaDisplay(this)}RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},handleEventPointDataLoaded:function(h,g){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=h.dataCollection;this.updateUI()}}},getDefaultSelectedFields:function(g,o){if(o!=null&&o.length>0){return o}var k=this.getStandardData(null,{includeIndex:false});var p=(k.length==2);var h=[];for(i=0;i<g.length;i++){var n=g[i];if(!p&&(!this.showText&&!n.isNumeric)){continue}var m=n.getLabel().toLowerCase();if(m.indexOf("latitude")>=0||m.indexOf("longitude")>=0){continue}h.push(n)}return h},getFieldsToSelect:function(g){return g.getRecordFields()},defaultSelectedToAll:function(){return true},fieldSelectionChanged:function(){SUPER.fieldSelectionChanged.call(this);this.updateUI()},updateUI:function(){SUPER.updateUI.call(this);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var s=this.getStandardData(null,{includeIndex:false});var H=this.dataCollection.getList()[0].getRecordFields();this.allFields=H;var E=this.getSelectedFields([]);var n={};var O=[];var K=(s.length==2);for(var h=1;h<s.length;h++){var C=this.getDataValues(s[h]);if(h==1){for(var m=0;m<C.length;m++){O.push({isNumber:false,count:0,min:Number.MAX_SAFE_INTEGER,uniqueMap:{},unique:0,std:0,max:Number.MIN_SAFE_INTEGER,total:0,numMissing:0,numNotMissing:0,type:null,values:[]})}}for(var N=0;N<E.length;N++){var g=E[N];var m=g.getIndex();O[m].type=g.getType();var y=C[m];if(y){if(!Utils.isDefined(O[m].uniqueMap[y])){O[m].uniqueMap[y]=1;O[m].unique++}else{O[m].uniqueMap[y]++}}O[m].isNumber=g.isNumeric;O[m].count++;if(y==null){O[m].numMissing++}else{O[m].numNotMissing++}if(y&&(typeof y=="number")){var q=g.getLabel().toLowerCase();if(q.indexOf("latitude")>=0||q.indexOf("longitude")>=0){continue}O[m].total+=y;O[m].max=Math.max(O[m].max,y);O[m].min=Math.min(O[m].min,y);O[m].values.push(y)}}}if(this.showUnique){for(var N=0;N<E.length;N++){var g=E[N];var m=g.getIndex();O[m].uniqueMax=0;O[m].uniqueValue="";for(var y in O[m].uniqueMap){var p=O[m].uniqueMap[y];if(p>O[m].uniqueMax){O[m].uniqueMax=p;O[m].uniqueValue=y}}}}if(this.showStd){for(var N=0;N<E.length;N++){var g=E[N];var m=g.getIndex();var k=O[m].values;if(k.length>0){var l=O[m].total/k.length;var t=0;for(var J=0;J<k.length;J++){var z=k[J]-l;t+=z*z}var L=t/k.length;O[m].std=Math.sqrt(L)}}}var G=(K?"0":"1");var x=HtmlUtils.openTag("table",["border",G,"bordercolor","#ccc","class","display-stats","cellspacing","1","cellpadding","5"]);var P=["&nbsp;"];if(!K){header=[""];if(this.showCount){header.push("Count");P.push("&nbsp;")}if(this.showMin){header.push("Min");P.push("&nbsp;")}if(this.showPercentile){header.push("25%");P.push("&nbsp;");header.push("50%");P.push("&nbsp;");header.push("75%");P.push("&nbsp;")}if(this.showMax){header.push("Max");P.push("&nbsp;")}if(this.showTotal){header.push("Total");P.push("&nbsp;")}if(this.showAverage){header.push("Average");P.push("&nbsp;")}if(this.showStd){header.push("Std");P.push("&nbsp;")}if(this.showUnique){header.push("# Unique");P.push("&nbsp;");header.push("Top");P.push("&nbsp;");header.push("Freq.");P.push("&nbsp;")}if(this.showMissing){header.push("Not&nbsp;Missing");P.push("&nbsp;");header.push("Missing");P.push("&nbsp;")}if(this.showType){header.push("Type");P.push("&nbsp;")}x+=HtmlUtils.tr(["valign","bottom"],HtmlUtils.tds(["class","display-stats-header","align","center"],header))}var w=[];var u={};for(var N=0;N<E.length;N++){var g=E[N];var m=g.getIndex();var g=H[m];var M="";var R="&nbsp;";var q=g.getLabel().toLowerCase();var D=O[m].numNotMissing==0?"NA":this.formatNumber(O[m].total/O[m].numNotMissing);if(q.indexOf("%")<0&&q.indexOf("percent")<0&&q.indexOf("median")<0){R=this.formatNumber(O[m].total)}if(K){M=HtmlUtils.tds(["xalign","right"],[this.formatNumber(O[m].min)]);continue}var k=[];if(!O[m].isNumber&&this.showText){if(this.showCount){k.push(O[m].count)}if(this.showMin){k.push("-")}if(this.showPercentile){k.push("-");k.push("-");k.push("-")}if(this.showMax){k.push("-")}k.push("-");if(this.showAverage){k.push("-")}if(this.showStd){k.push("-")}if(this.showUnique){k.push(O[m].unique);k.push(O[m].uniqueValue);k.push(O[m].uniqueMax)}if(this.showMissing){k.push(O[m].numNotMissing);k.push(O[m].numMissing)}}else{if(this.showCount){k.push(O[m].count)}if(this.showMin){k.push(this.formatNumber(O[m].min))}if(this.showPercentile){var B=O[m].max-O[m].min;k.push(this.formatNumber(O[m].min+B*0.25));k.push(this.formatNumber(O[m].min+B*0.5));k.push(this.formatNumber(O[m].min+B*0.75))}if(this.showMax){k.push(this.formatNumber(O[m].max))}if(this.showTotal){k.push(R)}if(this.showAverage){k.push(D)}if(this.showStd){k.push(this.formatNumber(O[m].std))}if(this.showUnique){k.push(O[m].unique);if(Utils.isNumber(O[m].uniqueValue)){k.push(this.formatNumber(O[m].uniqueValue))}else{k.push(O[m].uniqueValue)}k.push(O[m].uniqueMax)}if(this.showMissing){k.push(O[m].numNotMissing);k.push(O[m].numMissing)}}if(this.showType){k.push(O[m].type)}M=HtmlUtils.tds(["align","right"],k);var I=(K?"right":"left");var q=g.getLabel();var F=q.split("!!");var Q=g.getId();q=F[F.length-1];if(K){q+=":"}q=q.replace(/ /g,"&nbsp;");var o=HtmlUtils.tr([],HtmlUtils.td(["align",I],"<b>"+HtmlUtils.tag("div",["title",Q],q)+"</b>")+M);if(K){x+=o}else{x+=o}}x+="</table>";this.setContents(x);this.initTooltip();this.displayManager.propagateEventRecordSelection(this,this.dataCollection.getList()[0],{index:0})},handleEventRecordSelection:function(h,g){}})}function RamaddaRecordsDisplay(e,d,b,c){let SUPER=new RamaddaFieldsDisplay(e,d,DISPLAY_RECORDS,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{needsData:function(){return true},handleEventPointDataLoaded:function(g,f){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=g.dataCollection;this.updateUI()}}},getFieldsToSelect:function(f){return f.getRecordFields()},defaultSelectedToAll:function(){return true},fieldSelectionChanged:function(){SUPER.fieldSelectionChanged.call(this);this.updateUI()},updateUI:function(){SUPER.updateUI.call(this);var g=this.filterData();if(!g){this.setContents(this.getLoadingMessage());return}var k=this.getSelectedFields(this.getData().getRecordFields());var h="";for(var f=0;f<g.length;f++){var m=this.getDataValues(g[f]);for(var p=0;p<k.length;p++){var l=k[p];var n=m[l.getIndex()];h+=HtmlUtil.b(l.getLabel())+": "+n+"</br>"}h+="<p>"}var o=this.getProperty("maxHeight","400px");if(!o.endsWith("px")){o=o+"px"}this.setContents(HtmlUtil.div(["style","max-height:"+o+";overflow-y:auto;"],h))},handleEventRecordSelection:function(g,f){}})}function RamaddaCrosstabDisplay(d,c,b){let SUPER=new RamaddaFieldsDisplay(d,c,DISPLAY_CROSSTAB,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);this.columns=this.getProperty("columns","").split(",");this.rows=this.getProperty("rows","").split(",");RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},handleEventPointDataLoaded:function(f,e){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=f.dataCollection;this.updateUI()}}},fieldSelectionChanged:function(){this.updateUI()},updateUI:function(w){SUPER.updateUI.call(this,w);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var q=this.getStandardData(null,{includeIndex:false});var t=this.dataCollection.getList()[0].getRecordFields();var l={};cols=[];rows=[];for(var m=0;m<this.columns.length;m++){var f=this.columns[m];for(var n=0;n<t.length;n++){field=t[n];if(f==field.getLabel()||f==("#"+(n+1))){cols.push(t[n]);break}}}for(var m=0;m<this.rows.length;m++){var f=this.rows[m];for(var n=0;n<t.length;n++){if(f==t[n].getLabel()||f==("#"+(n+1))){rows.push(t[n]);break}}}var o=HtmlUtils.openTag("table",["border","1px","bordercolor","#ccc","class","display-stats","cellspacing","1","cellpadding","5"]);var u={};var e={};for(var m=0;m<cols.length;m++){var k=cols[m];var v=k.getLabel();for(var h=1;h<q.length;h++){var s=this.getDataValues(q[h]);var g=s[k.getIndex()];if(!(v in u)){u[v]=[]}var p=u[v];if(p.indexOf(g)<0){console.log(g);p.push(g)}}}for(v in u){u[v].sort();console.log(u[v])}for(var m=0;m<cols.length;m++){var k=cols[m];for(var h=1;h<q.length;h++){var s=this.getDataValues(q[h]);for(var n=0;n<rows.length;n++){var x=rows[m]}}}o+="</table>";this.setContents(o);this.initTooltip()}})}function RamaddaCorrelationDisplay(e,d,b){var c="bottom";$.extend(this,{colorTable:"red_white_blue",colorByMin:"-1",colorByMax:"1"});let SUPER=new RamaddaFieldsDisplay(e,d,DISPLAY_CORRELATION,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},getMenuItems:function(l){SUPER.getMenuItems.call(this,l);var g=this.getGet();var k=HtmlUtils.formTable();var f=this.getColorTableName();var h="<select id="+this.getDomId("colortable")+">";for(table in Utils.ColorTables){if(table==f){h+="<option selected>"+table+"</option>"}else{h+="<option>"+table+"</option>"}}h+="</select>";k+=HtmlUtils.formEntry("Color Bar:",h);k+=HtmlUtils.formEntry("Color By Range:",HtmlUtils.input("",this.colorByMin,["size","7",ATTR_ID,this.getDomId("colorbymin")])+" - "+HtmlUtils.input("",this.colorByMax,["size","7",ATTR_ID,this.getDomId("colorbymax")]));k+="</table>";l.push(k)},initDialog:function(){SUPER.initDialog.call(this);var h=this;var g=function(){h.colorByMin=h.jq("colorbymin").val();h.colorByMax=h.jq("colorbymax").val();h.updateUI()};var f=function(){h.colorTable=h.jq("colortable").val();h.updateUI()};this.jq("colorbymin").blur(g);this.jq("colorbymax").blur(g);this.jq("colortable").change(f)},handleEventPointDataLoaded:function(g,f){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=g.dataCollection;this.updateUI()}}},fieldSelectionChanged:function(){this.updateUI()},updateUI:function(F){SUPER.updateUI.call(this,F);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var o=this.getStandardData(null,{includeIndex:false});var z=this.dataCollection.getList()[0].getRecordFields();var x=this.getSelectedFields([]);if(x.length==0){x=z}var u=HtmlUtils.openTag("table",["border","0","class","display-correlation"]);u+="<tr valign=bottom><td class=display-heading>&nbsp;</td>";for(var K=0;K<x.length;K++){var g=x[K];if(!g.isFieldNumeric()||g.isFieldGeo()){continue}u+="<td align=center class=top-heading>"+HtmlUtils.tag("div",["class","top-heading"],g.getLabel())+"</td>"}u+="</tr>";var s=null;colorByMin=parseFloat(this.colorByMin);colorByMax=parseFloat(this.colorByMax);s=this.getColorTable(true);var y=0;for(var L=0;L<x.length;L++){var g=x[L];if(!g.isFieldNumeric()||g.isFieldGeo()){continue}y++;u+="<tr><td>"+HtmlUtils.tag("div",["class","side-heading"],g.getLabel().replace(/ /g,"&nbsp;"))+"</td>";var p=g.getLabel();for(var I=0;I<x.length;I++){var f=x[I];if(!f.isFieldNumeric()||f.isFieldGeo()){continue}var w=f.getLabel();var t=0;var q=0;var D=0;for(var k=1;k<o.length;k++){var v=this.getDataValues(o[k]);var m=v[g.getIndex()];var l=v[f.getIndex()];t+=m;q+=l;D++}var C=t/D;var B=q/D;var J=0;var H=0;var G=0;for(var k=1;k<o.length;k++){var v=this.getDataValues(o[k]);var m=v[g.getIndex()];var l=v[f.getIndex()];J+=(m-C)*(l-B);H+=(m-C)*(m-C);G+=(l-B)*(l-B)}r=J/Math.sqrt(H*G);var E="";if(s!=null){var h=(r-colorByMin)/(colorByMax-colorByMin);var n=parseInt(h*s.length);if(n>=s.length){n=s.length-1}else{if(n<0){n=0}}E="background-color:"+s[n]}u+='<td align=right style="'+E+'">'+HtmlUtils.tag("div",["class","display-correlation-element","title","&rho;("+p+","+w+")"],r.toFixed(3))+"</td>"}u+="</tr>"}u+="<tr><td></td><td colspan = "+y+">"+HtmlUtils.div(["id",this.getDomId(c)],"")+"</td></tr>";u+="</table>";this.setContents(u);this.displayColorTable(s,c,colorByMin,colorByMax);this.initTooltip();this.displayManager.propagateEventRecordSelection(this,this.dataCollection.getList()[0],{index:0})}})}function RamaddaHeatmapDisplay(d,c,b){$.extend(this,{colorTable:"red_white_blue"});let SUPER=new RamaddaFieldsDisplay(d,c,DISPLAY_HEATMAP,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{"map-display":false,needsData:function(){return true},getMenuItems:function(k){SUPER.getMenuItems.call(this,k);var f=this.getGet();var h=HtmlUtils.formTable();var e=this.getColorTableName();var g="<select id="+this.getDomId("colortable")+">";for(table in Utils.ColorTable){if(table==e){g+="<option selected>"+table+"</option>"}else{g+="<option>"+table+"</option>"}}g+="</select>";h+=HtmlUtils.formEntry("Color Table:",g);h+=HtmlUtils.formEntry("Color By Range:",HtmlUtils.input("",this.colorByMin,["size","7",ATTR_ID,this.getDomId("colorbymin")])+" - "+HtmlUtils.input("",this.colorByMax,["size","7",ATTR_ID,this.getDomId("colorbymax")]));h+="</table>";k.push(h)},initDialog:function(){SUPER.initDialog.call(this);var g=this;var f=function(){g.colorByMin=g.jq("colorbymin").val();g.colorByMax=g.jq("colorbymax").val();g.updateUI()};var e=function(){g.colorTable=g.jq("colortable").val();g.updateUI()};this.jq("colorbymin").blur(f);this.jq("colorbymax").blur(f);this.jq("colortable").change(e)},handleEventPointDataLoaded:function(f,e){if(!this.needsData()){if(this.dataCollection==null){this.dataCollection=f.dataCollection;this.updateUI()}}},fieldSelectionChanged:function(){this.updateUI()},getContentsStyle:function(){var e=this.getProperty("height",-1);if(e>0){return" height:"+e+"px;  max-height:"+e+"px; overflow-y: auto;"}return""},updateUI:function(C){var g=this;if(!haveGoogleChartsLoaded()){var v=function(){g.updateUI()};this.setContents(this.getLoadingMessage());setTimeout(v,1000);return}SUPER.updateUI.call(this,C);if(!this.hasData()){this.setContents(this.getLoadingMessage());return}var J=this.getStandardData(null,{includeIndex:true});var h=this.getDataValues(J[0]);var p=this.getProperty("showIndex",true);var u=this.getProperty("showValue",true);var O=this.getProperty("textColor","black");var Q=this.getProperty("cellHeight",null);var w="";if(this.getProperty("showBorder","false")=="true"){w="border-bottom:1px #666 solid;"}var q="";if(Q){q+="height:"+Q+"px; max-height:"+Q+"px; min-height:"+Q+"px;"}var E=this.dataCollection.getList()[0].getRecordFields();var e=this.getSelectedFields([]);if(e.length==0){e=E}var F="";var N=null;var K=null;var m=null;if(Utils.stringDefined(this.getProperty("colorByMins"))){K=[];var S=this.getProperty("colorByMins").split(",");for(var R=0;R<S.length;R++){K.push(parseFloat(S[R]))}}if(Utils.stringDefined(this.getProperty("colorByMaxes"))){m=[];var S=this.getProperty("colorByMaxes").split(",");for(var R=0;R<S.length;R++){m.push(parseFloat(S[R]))}}if(Utils.stringDefined(this.getProperty("colorTables"))){var S=this.getProperty("colorTables").split(",");N=[];for(var R=0;R<S.length;R++){var s=S[R];if(s=="none"){N.push(null);continue}var y=Utils.getColorTable(s,true);N.push(y)}}else{N=[this.getColorTable(true)]}var z=null;var k=null;for(var U=1;U<J.length;U++){var t=this.getDataValues(J[U]);if(z==null){z=[];k=[];for(var L=1;L<t.length;L++){z.push(Number.MAX_VALUE);k.push(Number.MIN_VALUE)}}for(var L=0;L<e.length;L++){var n=e[L];var H=n.getIndex()+1;if(!n||!n.isFieldNumeric()||n.isFieldGeo()){continue}var M=t[H];if(M==Number.POSITIVE_INFINITY||isNaN(M)||!Utils.isNumber(M)||!Utils.isDefined(M)||M==null){continue}z[L]=Math.min(z[L],M);k[L]=Math.max(k[L],M)}}F+=HtmlUtils.openTag("table",["border","0","class","display-heatmap"]);F+="<tr valign=bottom>";if(p){F+="<td align=center class=top-heading>"+HtmlUtils.tag("div",["class","top-heading"],h[0])+"</td>"}for(var D=0;D<e.length;D++){var n=e[D];if((!n.isFieldNumeric()||n.isFieldGeo())){continue}F+="<td align=center class=top-heading>"+HtmlUtils.tag("div",["class","top-heading"],n.getLabel())+"</td>"}F+="</tr>\n";for(var U=1;U<J.length;U++){var t=this.getDataValues(J[U]);var H=t[0];if(H.f){H=H.f}var o=H;F+="<tr valign='center'>\n";if(p){F+=HtmlUtils.td(["class","side-heading","style",q],o)}var l=0;for(var L=0;L<e.length;L++){var n=e[L];var H=n.getIndex()+1;if(!n||!n.isFieldNumeric()||n.isFieldGeo()){continue}var P="";var M=t[H];var T=z[L];var x=k[L];if(K&&l<K.length){T=K[l]}if(m&&l<m.length){x=m[l]}var I=T!=x&&!(M==Number.POSITIVE_INFINITY||isNaN(M)||!Utils.isNumber(M)||!Utils.isDefined(M)||M==null);var G=h[0]+": "+o+" - "+n.getLabel()+": "+M;if(I&&N!=null){var y=N[Math.min(l,N.length-1)];if(y){var f=(M-T)/(x-T);var B=parseInt(f*y.length);if(B>=y.length){B=y.length-1}else{if(B<0){B=0}}P="background-color:"+y[B]+";"}}var V;if(!I){V="-"}else{V=Utils.formatNumber(M)}if(!u){V=""}F+=HtmlUtils.td(["valign","center","align","right","style",P+q+w,"class","display-heatmap-cell"],HtmlUtils.div(["title",G,"style",q+"color:"+O],V));l++}F+="</tr>"}F+="</table>";this.setContents(F);this.initTooltip()}})}var DISPLAY_D3_GLIDER_CROSS_SECTION="GliderCrossSection";var DISPLAY_D3_PROFILE="profile";var DISPLAY_D3_LINECHART="D3LineChart";var DISPLAY_SKEWT="skewt";var DISPLAY_VENN="venn";addGlobalDisplayType({type:DISPLAY_D3_LINECHART,forUser:false,label:"D3 LineChart",requiresData:true,category:"Charts"});addGlobalDisplayType({type:DISPLAY_D3_PROFILE,forUser:false,label:"Profile",requiresData:true,category:"Charts"});addGlobalDisplayType({type:DISPLAY_D3_GLIDER_CROSS_SECTION,forUser:false,label:"Glider cross section",requiresData:true,category:"Charts"});addGlobalDisplayType({type:DISPLAY_VENN,forUser:true,label:"Venn Diagram",requiresData:true,category:"Misc"});addGlobalDisplayType({type:DISPLAY_SKEWT,forUser:false,label:"SkewT",requiresData:true,category:"Charts"});var FIELD_TIME="time";var FIELD_DEPTH="depth";var FIELD_VALUE="value";var FIELD_SELECTEDFIELD="selectedfield";var TYPE_LATITUDE="latitude";var TYPE_LONGITUDE="longitude";var TYPE_TIME="time";var TYPE_VALUE="value";var TYPE_ELEVATION="elevation";var FUNC_MOVINGAVERAGE="movingAverage";var D3Util={foo:"bar",getAxis:function(b,c){var d;if(b==FIELD_TIME){d=d3.time.scale().range(c)}else{d=d3.scale.linear().range(c)}return d},getDataValue:function(d,b,c){var e;if(d.fieldIdx>=0){e=b.getData()[d.fieldIdx]}else{switch(d.type){case TYPE_TIME:e=new Date(b.getDate());break;case TYPE_ELEVATION:e=b.getElevation();break;case TYPE_LATITUDE:e=b.getLatitude();case TYPE_LONGITUDE:e=b.getLongitude();default:e=b.getData()[c]}}if(d.reverse==true){return -1*e}else{return e}},getColorFromColorBar:function(e,c){var b=["#00008B","#0000CD","#0000FF","#00FFFF","#7CFC00","#FFFF00","#FFA500","#FF4500","#FF0000","#8B0000"];var d=d3.scale.linear().domain([0,b.length-1]).range(c);var f=d3.scale.linear().range(b).domain(d3.range(0,b.length).map(d));color=f(e);return color},addColorBar:function(e,c,f,d){var b=e.append("g").attr({id:"colorBarG",transform:"translate("+(d-40)+",0)"});b.append("g").append("defs").append("linearGradient").attr({id:"colorBarGradient",x1:"0%",y1:"100%",x2:"0%",y2:"0%"}).selectAll("stop").data(c).enter().append("stop").attr({offset:function(h,g){return f*(g)+"%"},"stop-color":function(h,g){return c[g]},"stop-opacity":1});return b}};function RamaddaSkewtDisplay(f,e,d){var b;var c="skewt";RamaddaUtil.inherit(this,b=new RamaddaDisplay(f,e,DISPLAY_SKEWT,d));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){this.createUI();var g="<p><script src='/repository/skewt/d3skewt.js'><\/script>\n";g+="<link rel='stylesheet' type='text/css' href='/skewt/sounding.css'>\n";var h=this.getDomId(c);g+=HtmlUtils.div(["id",h],"");this.writeHtml(ID_DISPLAY_CONTENTS,g);var l=this;var k=function(){if(!window.D3Skewt){console.log("no skewt yet");setTimeout(k,1000);return}var m={};if(l.propertyDefined("showHodograph")){m.showHodograph=l.getProperty("showHodograph",true)}if(l.propertyDefined("showText")){m.showText=l.getProperty("showText",true)}if(l.propertyDefined("chartWidth")){m.width=parseInt(l.getProperty("chartWidth"))}if(l.propertyDefined("chartHeight")){m.height=parseInt(l.getProperty("chartHeight"))}l.skewt1=new D3Skewt(h,m)};setTimeout(k,1000)}})}function RamaddaD3Display(f,e,c){testProperties=c;var d="svg";var b;RamaddaUtil.inherit(this,b=new RamaddaDisplay(f,e,"d3",c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){this.createUI();this.setDisplayTitle(c.graph.title);var k=this.getProperty("innerWidth",600);var q=this.getProperty("innerHeight",300);var m={top:20,right:50,bottom:30,left:50};var l="height:"+q+"px;width:"+k+"px;";var n=HtmlUtils.div([ATTR_ID,this.getDomId(d),ATTR_STYLE,l],"");this.setContents(n);this.displayHeight=parseInt((d3.select("#"+this.getDomId(d)).style("height")).split("px")[0])-m.top-m.bottom;this.displayWidth=parseInt((d3.select("#"+this.getDomId(d)).style("width")).split("px")[0])-m.left-m.right;var h=this;var s=d3.behavior.zoom().on("zoom",function(){h.zoomBehaviour()});this.zoom=s;this.svg=d3.select("#"+this.getDomId(d)).append("svg").attr("width",this.displayWidth+m.left+m.right).attr("height",this.displayHeight+m.top+m.bottom).attr(ATTR_CLASS,"D3graph").call(s).on("click",function(){h.click(d3.event)}).on("dblclick",function(){h.dbclick(d3.event)}).append("g").attr("transform","translate("+m.left+","+m.top+")");this.x=D3Util.getAxis(c.graph.axis.x.type,[0,this.displayWidth-100]);this.y=D3Util.getAxis(c.graph.axis.y.type,[this.displayHeight,0]);this.xAxis=d3.svg.axis().scale(this.x).orient("bottom");this.yAxis=d3.svg.axis().scale(this.y).orient("left");this.svg.append("g").attr(ATTR_CLASS,"x axis").attr("transform","translate(0,"+this.displayHeight+")").call(this.xAxis);this.svg.append("g").attr(ATTR_CLASS,"y axis").call(this.yAxis);var g=["#00008B","#0000CD","#0000FF","#00FFFF","#7CFC00","#FFFF00","#FFA500","#FF4500","#FF0000","#8B0000"];var p=100/(g.length-1);var o=D3Util.addColorBar(this.svg,g,p,this.displayWidth);this.color=d3.scale.category10();this.updateUI()},needsData:function(){return true},initDialog:function(){this.addFieldsCheckboxes()},getDialogContents:function(){var g=this.getProperty(PROP_HEIGHT,"400");var h=HtmlUtils.div([ATTR_ID,this.getDomId(ID_FIELDS),ATTR_CLASS,"display-fields"]);h+=b.getDialogContents.apply(this);return h},fieldSelectionChanged:function(){this.updateUI()},updateUI:function(){var D=false;if(!this.hasData()){return}test=this;var u=this.getSelectedFields();if(u.length==0){return}this.addFieldsCheckboxes();pointData=this.getData();if(pointData==null){console.log("no data");return}var w=pointData.getNumericFields();var B=pointData.getRecords();var k=RecordUtil.getRanges(w,B);var n=RecordUtil.getElevationRange(w,B);var m=(n[1]-n[0])*0.05;var q=this.x;var p=this.y;var z=this.color;var h=c.graph.axis;if(D){this.zoom.x(this.x);this.zoom.y(this.y)}else{this.x.domain(d3.extent(B,function(x){return D3Util.getDataValue(h.x,x,u[0].getIndex())}));this.y.domain(d3.extent(B,function(x){return D3Util.getDataValue(h.y,x,u[0].getIndex())}));this.zoom.x(this.x);this.zoom.y(this.y)}this.svg.selectAll(".y.axis").call(this.yAxis);this.svg.selectAll(".x.axis").call(this.xAxis);this.svg.selectAll(".line").remove();this.svg.selectAll(".legendElement").remove();var o=this;for(var C=0;C<u.length;C++){var E=u[C].getIndex();var v=k[E];var s=d3.svg.line().x(function(x){return q(D3Util.getDataValue(h.x,x,u[C].getIndex()))}).y(function(x){return p(D3Util.getDataValue(h.y,x,u[C].getIndex()))});displayLine=this.svg.append("path").datum(B).attr(ATTR_CLASS,"line").attr("d",s).on("mousemove",function(){o.mouseover(d3.event)}).attr("fill","none").attr("stroke",function(x){return z(C)}).attr("stroke-width","0.5px");if(c.graph.axis.z==FIELD_SELECTEDFIELD){displayLine.attr("stroke","url(#colorBarGradient)")}if(c.graph.derived!=null){var t=c.graph.derived.split(",");for(funcIdx=0;funcIdx<t.length;funcIdx++){var l=t[funcIdx];if(l==FUNC_MOVINGAVERAGE){var g=d3.svg.line().x(function(x){return q(D3Util.getDataValue(h.x,x,u[C].getIndex()))}).y(function(y,x){if(x==0){return _movingSum=D3Util.getDataValue(h.y,y,u[C].getIndex())}else{_movingSum+=D3Util.getDataValue(h.y,y,u[C].getIndex())}return p(_movingSum/x)}).interpolate("basis");this.svg.append("path").attr(ATTR_CLASS,"line").attr("d",g(B)).attr("fill","none").attr("stroke",function(x){return z(C)}).attr("stroke-width","1.5px").attr("viewBox","50 50 100 100 ").style("stroke-dasharray",("3, 3"))}else{console.log("Error: Unknown derived function:"+l)}}}this.svg.append("svg:rect").attr(ATTR_CLASS,"legendElement").attr("x",this.displayWidth-100).attr("y",(50+50*C)).attr("stroke",function(x){return z(C)}).attr("height",2).attr("width",40);this.svg.append("svg:text").attr(ATTR_CLASS,"legendElement").attr("x",this.displayWidth-100+40+10).attr("y",(55+55*C)).attr("stroke",function(x){return z(C)}).attr("style","font-size:50%").text(u[C].getLabel())}},zoomBehaviour:function(){this.updateUI(true)},handleEventRecordSelection:function(h,g){},mouseover:function(){testing=d3.event;console.log("mouseover")},click:function(g){console.log("click:"+g)},dbclick:function(g){this.zoom();this.updateUI()},getSVG:function(){return this.svg}})}function RamaddaD3LineChartDisplay(e,d,b){var c={};c.graph={title:"Line chart",derived:FUNC_MOVINGAVERAGE,axis:{y:{type:TYPE_VALUE,fieldname:FIELD_SELECTEDFIELD},x:{type:TYPE_TIME,fieldname:FIELD_TIME}}};b=$.extend(c,b);return new RamaddaD3Display(e,d,b)}function RamaddaProfileDisplay(e,d,b){var c={};c.graph={title:"Profile chart",derived:null,axis:{y:{type:TYPE_ELEVATION,fieldname:FIELD_DEPTH,fieldIdx:3,reverse:true},x:{type:TYPE_VALUE,fieldname:FIELD_VALUE}}};b=$.extend(c,b);return new RamaddaD3Display(e,d,b)}function RamaddaGliderCrossSectionDisplay(e,d,b){var c={};c.graph={title:"Glider cross section",derived:null,axis:{y:{type:TYPE_ELEVATION,fieldname:FIELD_DEPTH,reverse:true},x:{type:TYPE_TIME,fieldname:FIELD_TIME},z:FIELD_SELECTEDFIELD}};b=$.extend(c,b);return new RamaddaD3Display(e,d,b)}function RamaddaVennDisplay(e,d,c){var b="venn";let SUPER=new RamaddaFieldsDisplay(e,d,DISPLAY_VENN,c);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);$.extend(this,{getContentsStyle:function(){return""},checkLayout:function(){this.updateUIInner()},updateUI:function(){var f="<script src='"+ramaddaBaseUrl+"/lib/venn.js'><\/script>";this.writeHtml(ID_DISPLAY_TOP,f);let _this=this;var g=function(){_this.updateUIInner()};setTimeout(g,10)},updateUIInner:function(){let records=this.filterData();if(!records){return}var y=this.getData().getRecordFields();var v=this.getSelectedFields(y);if(v.length==0){v=y}var n=this.getFieldsOfType(v,"string");if(n.length==0){this.displayError("No string fields specified");return}var p={};var B=0;for(var l=0;l<records.length;l++){var o=this.getDataValues(records[l]);var s=[];var G="";for(var E=0;E<n.length;E++){var k=n[E];var w=o[k.getIndex()];var f=k.getId()+"--"+w;s.push(f);G+="--"+f;if(!Utils.isDefined(p[f])){p[f]={count:0,setIds:[B],label:w};B++}p[f].count++}var x=[];if(!Utils.isDefined(p[G])){for(var C=0;C<s.length;C++){x.push(p[s[C]].setIds[0])}p[G]={count:0,setIds:x,label:null}}p[G].count++}var g=[];for(var F in p){var m=p[F];var q={sets:m.setIds,size:m.count};if(m.label){q.label=m.label}g.push(q)}this.writeHtml(ID_DISPLAY_CONTENTS,HtmlUtils.div(["id",this.getDomId(b),"style","height:300px;"],""));var t=venn.VennDiagram().width(600).height(400);var u="#"+this.getDomId(b);var z=this.getColorTable(true,"strokeColors","nice");var h=this.getColorTable(true,"fillColors","nice");var D=this.getColorTable(true,"textColors");if(!D){D=z}d3.select(u).datum(g).call(t);d3.selectAll(u+" .venn-circle path").style("fill-opacity",parseFloat(this.getProperty("fillOpacity",0.5))).style("stroke-width",parseInt(this.getProperty("strokeWidth",1))).style("stroke-opacity",parseFloat(this.getProperty("strokeOpacity",0.5))).style("stroke",function(I,H){return H<z.length?z[H]:z[H%z.length]}).style("fill",function(I,H){return H<h.length?h[H]:h[H%h.length]});d3.selectAll(u+" .venn-circle text").style("fill",function(I,H){return H<D.length?D[H]:D[H%D.length]}).style("font-size",this.getProperty("fontSize","16px")).style("font-weight",this.getProperty("fontWeight","100"))}})}var DISPLAY_WORDCLOUD="wordcloud";var DISPLAY_TEXTSTATS="textstats";var DISPLAY_TEXTANALYSIS="textanalysis";var DISPLAY_TEXTRAW="textraw";var DISPLAY_TEXT="text";addGlobalDisplayType({type:DISPLAY_TEXT,label:"Text Readout",requiresData:false,forUser:true,category:CATEGORY_MISC});addGlobalDisplayType({type:DISPLAY_WORDCLOUD,forUser:true,label:"Word Cloud",requiresData:true,category:"Text"});addGlobalDisplayType({type:DISPLAY_TEXTSTATS,forUser:true,label:"Text Stats",requiresData:true,category:"Text"});addGlobalDisplayType({type:DISPLAY_TEXTRAW,forUser:true,label:"Text Raw",requiresData:true,category:"Text"});addGlobalDisplayType({type:DISPLAY_TEXTANALYSIS,forUser:true,label:"Text Analysis",requiresData:true,category:"Text"});function RamaddaBaseTextDisplay(f,e,d,c){var b="textblock";let SUPER=new RamaddaFieldsDisplay(f,e,d,c);RamaddaUtil.inherit(this,SUPER);$.extend(this,{processText:function(B){let records=this.filterData();if(!records){return null}var z=this.getData().getRecordFields();var w=this.getSelectedFields(z);if(w.length==0){w=z}var q=this.getFieldsOfType(w,"string");if(q.length==0){this.displayError("No string fields specified");return null}var F={};var D=parseInt(this.getProperty("minLength",0));var s=parseInt(this.getProperty("maxLength",100));var y=this.getProperty("stopWords");if(y){if(y=="default"){y=Utils.stopWords}else{y=y.split(",")}}var o=this.getProperty("extraStopWords");if(o){o=o.split(",")}var n=this.getProperty("stripTags",false);var g=this.getProperty("tokenize",false);var v=this.getProperty("lowerCase",false);var h=this.getProperty("removeArticles",false);if(B){B.count=0;B.total=0;B.lengths={}}for(var l=0;l<records.length;l++){var t=this.getDataValues(records[l]);for(var C=0;C<q.length;C++){var k=q[C];if(!F[k.getId()]){F[k.getId()]={field:k,words:[],counts:{},divId:this.getDomId(b+(k.getIndex()))}}var u=F[k.getId()];var x=t[k.getIndex()];if(n){x=Utils.stripTags(x)}var m=[x];if(g){m=Utils.tokenizeWords(m[0],y,o,h)}for(var E=0;E<m.length;E++){var x=m[E];var p=x.toLowerCase();if(B){B.count++;B.total+=x.length;if(!Utils.isDefined(B.lengths[x.length])){B.lengths[x.length]=0}B.lengths[x.length]++}if(!g){if(y&&y.includes(p)){continue}if(o&&o.includes(p)){continue}}if(x.length>s){continue}if(x.length<D){continue}if(v){x=x.toLowerCase()}if(!Utils.isDefined(u.counts[x])){u.counts[x]=0}u.counts[x]++}}}return F}})}function RamaddaWordcloudDisplay(e,d,c){var b;RamaddaUtil.inherit(this,b=new RamaddaBaseTextDisplay(e,d,DISPLAY_WORDCLOUD,c));addRamaddaDisplay(this);$.extend(this,{getContentsStyle:function(){return""},checkLayout:function(){this.updateUIInner()},updateUI:function(){var f="<link rel='stylesheet' href='"+ramaddaBaseUrl+"/lib/jqcloud.min.css'>";f+="<script src='"+ramaddaBaseUrl+"/lib/jqcloud.min.js'><\/script>";this.writeHtml(ID_DISPLAY_TOP,f);let _this=this;var g=function(){_this.updateUIInner()};setTimeout(g,10)},updateUIInner:function(){var E=this.processText();if(E==null){return}let records=this.filterData();var u=this.getData().getRecordFields();var q=this.getSelectedFields(u);if(q.length==0){q=u}var h=this.getFieldsOfType(q,"string");let _this=this;var v="";var p=[];var z=parseInt(this.getProperty("maxWords",-1));var g=parseInt(this.getProperty("minCount",0));var t=(100*1/h.length)+"%;";for(a in E){var n=E[a];let field=n.field;var s=null;if(this.getProperty("handleClick",true)){s={click:function(F){var G=F.target.innerText;_this.showRows(records,field,G)}}}var C=[];for(B in n.counts){var k=n.counts[B];C.push({word:B,count:k})}C.sort(function(G,F){if(G.count<F.count){return -1}if(G.count>F.count){return 1}return 0});if(g>0){var D=[];for(var x=0;x<C.length;x++){if(C[x].count>=g){D.push(C[x])}}C=D}if(z>0){var D=[];for(var x=0;x<=z&&x<C.length;x++){if(C[x].count>=g){D.push(C[x])}}C=D}for(var o=0;o<C.length;o++){var B=C[o];var y={weight:B.count,handlers:s,text:B.word};var w={weight:B.count,handlers:s,text:field.getLabel()+":"+B.word};n.words.push(y);p.push(w)}var l="";if(this.getProperty("showFieldLabel",true)){l="<b>"+n.field.getLabel()+"</b>"}v+="<div style='display:inline-block;width:"+t+"'>"+l+HtmlUtils.div(["style","border: 1px #ccc solid;height:300px;","id",n.divId],"")+"</div>"}this.writeHtml(ID_DISPLAY_CONTENTS,"");var f={autoResize:true};var m=this.getColorTable(true);if(m){f.colors=m,f.classPattern=null;f.fontSize={from:0.1,to:0.02}}if(this.getProperty("shape")){f.shape=this.getProperty("shape")}if(this.getProperty("combined",false)){this.writeHtml(ID_DISPLAY_CONTENTS,HtmlUtils.div(["id",this.getDomId("words"),"style","height:300px;"],""));$("#"+this.getDomId("words")).jQCloud(p,f)}else{this.writeHtml(ID_DISPLAY_CONTENTS,v);for(a in E){var n=E[a];$("#"+n.divId).jQCloud(n.words,f)}}},showRows:function(B,k,C){var h=this.getProperty("tokenize",false);if(C.startsWith(k.getLabel()+":")){C=C.replace(k.getLabel()+":","")}var g;if(this.getProperty("tableFields")){g={};var E=this.getProperty("tableFields").split(",");for(a in E){g[E[a]]=true}}var t=this.getData().getRecordFields();var o="";var G=[];var z=[];G.push(z);for(var F=0;F<t.length;F++){var D=t[F];if(g&&!g[D.getId()]){continue}z.push(t[F].getLabel())}var x=this.getProperty("showRecords",false);if(x){o+="<br>"}var u=new RegExp("(\\b"+C+"\\b)","i");for(var l=0;l<B.length;l++){var n=this.getDataValues(B[l]);var w=""+n[k.getIndex()];if(h){if(!w.match(u)){continue}}else{if(C!=w){continue}}var s=[];G.push(s);for(var m=0;m<t.length;m++){var D=t[m];if(g&&!g[D.getId()]){continue}var p=n[D.getIndex()];if(h){p=p.replace(u,"<span style=background:yellow;>$1</span>")}if(x){o+=HtmlUtil.b(D.getLabel())+": "+p+"</br>"}else{s.push(p)}}if(x){o+="<p>"}}if(x){this.writeHtml(ID_DISPLAY_BOTTOM,o)}else{var y="";if(!h){y=k.getLabel()+"="+C}this.writeHtml(ID_DISPLAY_BOTTOM,y+HtmlUtils.div(["id",this.getDomId("table"),"style","height:300px"],""));var q=google.visualization.arrayToDataTable(G);this.chart=new google.visualization.Table(document.getElementById(this.getDomId("table")));this.chart.draw(q,{allowHtml:true})}}})}function RamaddaTextstatsDisplay(d,c,b){let SUPER=new RamaddaBaseTextDisplay(d,c,DISPLAY_TEXTSTATS,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);$.extend(this,{updateUI:function(){var E={};var M=this.processText(E);if(M==null){return}let records=this.filterData();var z=this.getData().getRecordFields();var v=this.getSelectedFields(z);if(v.length==0){v=z}var k=this.getFieldsOfType(v,"string");let _this=this;var B="";var u=[];var o="";var J=[];var H=parseInt(this.getProperty("maxWords",-1));var h=parseInt(this.getProperty("minCount",0));var g=this.getProperty("showBars",true);var K=this.getProperty("barsScale",10);var w=this.getProperty("barColor","blue");var s=parseInt(this.getProperty("barWidth","400"));for(a in M){var p=M[a];let field=p.field;for(word in p.counts){var m=p.counts[word];J.push({word:word,count:m})}J.sort(function(O,N){if(O.count<N.count){return -1}if(O.count>N.count){return 1}return 0});if(h>0){var I=[];for(var G=0;G<J.length;G++){if(J[G].count>=h){I.push(J[G])}}J=I}if(H>0){var I=[];for(var G=0;G<=H&&G<J.length;G++){if(J[G].count>=h){I.push(J[G])}}J=I}var y=0;var F=0;if(J.length>0){F=J[0].count;y=J[J.length-1].count}var I=[];for(a in E.lengths){I.push({length:parseInt(a),count:E.lengths[a]})}I.sort(function(O,N){if(O.length<N.length){return -1}if(O.length>N.length){return 1}return 0});var y=0;var F=0;for(var G=0;G<I.length;G++){F=(G==0?I[G].count:Math.max(F,I[G].count));y=(G==0?I[G].count:Math.min(y,I[G].count))}if(this.getProperty("showFieldLabel",true)){o+="<b>"+p.field.getLabel()+"</b><br>"}var t="20%";var D="10%";if(this.getProperty("showSummary",true)){o+=HtmlUtils.openTag("table",["class","ramadda-table","id",this.getDomId("table_summary")]);o+=HtmlUtils.openTag("thead",[]);o+=HtmlUtils.tr([],HtmlUtils.th(["width",t],"Summary")+HtmlUtils.th([],"&nbsp;"));o+=HtmlUtils.closeTag("thead");o+=HtmlUtils.openTag("tbody",[]);o+=HtmlUtils.tr([],HtmlUtils.td([],"Total words:")+HtmlUtils.td([],E.count));o+=HtmlUtils.tr([],HtmlUtils.td([],"Average word length:")+HtmlUtils.td([],Math.round(E.total/E.count)));o+=HtmlUtils.closeTag("tbody");o+=HtmlUtils.closeTag("table");o+="<br>"}if(this.getProperty("showCounts",true)){o+=HtmlUtils.openTag("table",["class","ramadda-table","id",this.getDomId("table_counts")]);o+=HtmlUtils.openTag("thead",[]);o+=HtmlUtils.tr([],HtmlUtils.th(["width",t],"Word Length")+HtmlUtils.th(["width",D],"Count")+(g?HtmlUtils.th([],""):""));o+=HtmlUtils.closeTag("thead");o+=HtmlUtils.openTag("tbody",[]);for(var G=0;G<I.length;G++){var l=HtmlUtils.td([],I[G].length)+HtmlUtils.td([],I[G].count);if(g){var n=(I[G].count-y)/F;var x=2+n*s;var C=w;var q=HtmlUtils.div(["style","height:10px;width:"+x+"px;background:"+C],"");l+=HtmlUtils.td([],q)}o+=HtmlUtils.tr([],l)}o+=HtmlUtils.closeTag("tbody");o+=HtmlUtils.closeTag("table");o+="<br>"}if(this.getProperty("showFrequency",true)){o+=HtmlUtils.openTag("table",["class","ramadda-table","id",this.getDomId("table_frequency")]);o+=HtmlUtils.openTag("thead",[]);o+=HtmlUtils.tr([],HtmlUtils.th(["width",t],"Word")+HtmlUtils.th(["width",D],"Frequency")+(g?HtmlUtils.th([],""):""));o+=HtmlUtils.closeTag("thead");o+=HtmlUtils.openTag("tbody",[]);var y=0;var F=0;if(J.length>0){y=J[0].count;F=J[J.length-1].count}var f=0;for(var G=0;G<J.length;G++){f+=J[G].count}for(var G=J.length-1;G>=0;G--){var e=Math.round(10000*(J[G].count/f))/100;var l=HtmlUtils.td([],J[G].word+"&nbsp;:&nbsp;")+HtmlUtils.td([],J[G].count+"&nbsp;&nbsp;("+e+"%)&nbsp;:&nbsp;");if(g){var n=(J[G].count-y)/F;var x=2+n*s;var C=w;var q=HtmlUtils.div(["style","height:10px;width:"+x+"px;background:"+C],"");l+=HtmlUtils.td([],q)}o+=HtmlUtils.tr([],l)}o+=HtmlUtils.closeTag("tbody");o+=HtmlUtils.closeTag("table")}}this.writeHtml(ID_DISPLAY_CONTENTS,o);var L=this.getProperty("tableHeight","200");HtmlUtils.formatTable(this.getDomId("table_summary"),{scrollY:L});HtmlUtils.formatTable(this.getDomId("table_counts"),{scrollY:L});HtmlUtils.formatTable(this.getDomId("table_frequency"),{scrollY:L,searching:true})}})}function RamaddaTextanalysisDisplay(d,c,b){let SUPER=new RamaddaBaseTextDisplay(d,c,DISPLAY_TEXTANALYSIS,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);$.extend(this,{checkLayout:function(){this.updateUIInner()},updateUI:function(){var e="<script src='"+ramaddaBaseUrl+"/lib/compromise.min.js'><\/script>";this.writeHtml(ID_DISPLAY_TOP,e);let _this=this;var f=function(){_this.updateUIInner()};setTimeout(f,10)},updateUIInner:function(){let records=this.filterData();if(!records){return null}var u=this.getData().getRecordFields();var s=this.getSelectedFields(u);if(s.length==0){s=u}var k=this.getFieldsOfType(s,"string");if(k.length==0){this.displayError("No string fields specified");return null}var z="";for(var e=0;e<records.length;e++){var m=this.getDataValues(records[e]);var n="";for(var l=0;l<s.length;l++){var x=s[l];n+=" ";n+=m[x.getIndex()]}z+=n;z+="\n"}var h=window.nlp(z);var g=[];var o=[];if(this.getProperty("showPeople",true)){g.push("<b>People<b>");o.push(this.printList(h.people().out("topk")))}if(this.getProperty("showPlaces",true)){g.push("<b>Places<b>");o.push(this.printList(h.places().out("topk")))}if(this.getProperty("showOrganizations",true)){g.push("<b>Organizations<b>");o.push(this.printList(h.organizations().out("topk")))}if(this.getProperty("showTopics",false)){g.push("<b>Topics<b>");o.push(this.printList(h.topics().out("topk")))}if(this.getProperty("showNouns",false)){g.push("<b>Nouns<b>");o.push(this.printList(h.nouns().out("topk")))}if(this.getProperty("showVerbs",false)){g.push("<b>Verbs<b>");o.push(this.printList(h.verbs().out("topk")))}if(this.getProperty("showAdverbs",false)){g.push("<b>Adverbs<b>");o.push(this.printList(h.adverbs().out("topk")))}if(this.getProperty("showAdjectives",false)){g.push("<b>Adjectives<b>");o.push(this.printList(h.adjectives().out("topk")))}if(this.getProperty("showClauses",false)){g.push("<b>Clauses<b>");o.push(this.printList(h.clauses().out("topk")))}if(this.getProperty("showContractions",false)){g.push("<b>Contractions<b>");o.push(this.printList(h.contractions().out("topk")))}if(this.getProperty("showPhoneNumbers",false)){g.push("<b>Phone Numbers<b>");o.push(this.printList(h.phoneNumbers().out("topk")))}if(this.getProperty("showValues",false)){g.push("<b>Values<b>");o.push(this.printList(h.values().out("topk")))}if(this.getProperty("showAcronyms",false)){g.push("<b>Acronyms<b>");o.push(this.printList(h.acronyms().out("topk")))}if(this.getProperty("showNGrams",false)){g.push("<b>NGrams<b>");o.push(this.printList(h.ngrams().out("topk")))}if(this.getProperty("showDates",false)){g.push("<b>Dates<b>");o.push(this.printList(h.dates().out("topk")))}if(this.getProperty("showQuotations",false)){g.push("<b>Quotations<b>");o.push(this.printList(h.quotations().out("topk")))}if(this.getProperty("showUrls",false)){g.push("<b>URLs<b>");o.push(this.printList(h.urls().out("topk")))}if(this.getProperty("showStatements",false)){g.push("<b>Statements<b>");o.push(this.printList(h.statements().out("topk")))}if(this.getProperty("showTerms",false)){g.push("<b>Terms<b>");o.push(this.printList(h.terms().out("topk")))}if(this.getProperty("showPossessives",false)){g.push("<b>Possessives<b>");o.push(this.printList(h.possessives().out("topk")))}var q=this.getProperty("height","400");var p="";var t=0;var m="";var v="";for(var w=0;w<o.length;w++){if(t>=3){var y="<table width=100%>";y+=HtmlUtil.tr([],v);y+=HtmlUtil.tr(["valign","top"],m);y+="</table>";p+=HtmlUtils.div(["style","margin-top:10px;padding:4px;border-top:1px #ccc solid; max-height:"+q+"px;overflow-y:auto;"],y);t=0;m="";v=""}m+=HtmlUtils.td(["width","33%"],o[w]);v+=HtmlUtils.td(["width","33%"],g[w]);t++}if(m!=""){var y="<table width=100%>";y+=HtmlUtil.tr([],v);y+=HtmlUtil.tr(["valign","top"],m);y+="</table>";p+=HtmlUtils.div(["style","margin-top:10px;padding:4px;border-top:1px #ccc solid;"+q+"px;overflow-y:auto;"],y)}this.writeHtml(ID_DISPLAY_CONTENTS,p)},printList:function(e){var n=parseInt(this.getProperty("maxWords",10));var k=parseInt(this.getProperty("minCount",0));var h="<table>";var g=0;for(var f=0;f<e.length;f++){if(e[f].count<k){continue}var m=HtmlUtils.td([],e[f].normal+"&nbsp;&nbsp;")+HtmlUtils.td([],e[f].count+" ("+e[f].percent+"%)");h+=HtmlUtils.tr([],m);if(g++>n){break}}h+="</table>";return h}})}function RamaddaTextrawDisplay(e,d,b){var c="text";let SUPER=new RamaddaBaseTextDisplay(e,d,DISPLAY_TEXTRAW,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);$.extend(this,{checkLayout:function(){this.updateUI()},updateUI:function(){let records=this.filterData();if(!records){return null}var f=this.getProperty("pattern");if(f&&f.length==0){f=null}this.writeHtml(ID_TOP_RIGHT,HtmlUtils.input("pattern",(f?f:""),["placeholder","Search text","id",this.getDomId("search")]));let _this=this;this.jq("search").keypress(function(g){if(g.which==13){_this.setProperty("pattern",$(this).val());_this.updateUI()}});this.writeHtml(ID_DISPLAY_CONTENTS,HtmlUtils.div(["id",this.getDomId(c)],""));this.showText()},showText:function(){let records=this.filterData();if(!records){return null}var C=this.getProperty("pattern");if(C&&C.length==0){C=null}var t=this.getProperty("asHtml",true);var m=this.getProperty("addLineNumbers",true);if(m){t=true}var k=parseInt(this.getProperty("maxLines",100000));var B=parseInt(this.getProperty("lineLength",10000));var v=this.getProperty("breakLines",true);var g=this.getProperty("includeEmptyLines",false);var z=this.getData().getRecordFields();var x=this.getSelectedFields(z);if(x.length==0){x=z}var n=this.getFieldsOfType(x,"string");if(n.length==0){this.displayError("No string fields specified");return null}var E="";if(m){E="<table width=100%>"}var p=0;var u=0;var y;if(C){y=new RegExp("("+C+")")}for(var h=0;h<records.length;h++){var o=this.getDataValues(records[h]);var s="";for(var l=0;l<x.length;l++){var D=x[l];s+=" ";s+=o[D.getIndex()]}s=s.trim();if(!g&&s.length==0){continue}s=s.replace(/</g,"&lt;").replace(/>/g,"&gt;");p++;if(y){if(!s.toLowerCase().match(y)){continue}s=s.replace(y,"<span style=background:yellow;>$1</span>")}u++;if(u>k){break}if(m){E+=HtmlUtils.tr(["valign","top"],HtmlUtils.td(["width","10px"],"<a name=line_"+p+"></a><a href=#line_"+p+">#"+p+"</a>&nbsp;  ")+HtmlUtils.td([],s))}else{E+=s;if(t){if(v){E+="<p>"}else{E+="<br>"}}else{E+="\n";if(v){E+="\n"}}}}if(m){E+="</table>"}var w=this.getProperty("height","600");if(!t){E=HtmlUtils.tag("pre",[],E)}var q=HtmlUtils.div(["style","padding:4px;border:1px #ccc solid;border-top:1px #ccc solid; max-height:"+w+"px;overflow-y:auto;"],E);this.writeHtml(c,q)}})}function RamaddaTextDisplay(e,d,c){var b;$.extend(this,b=new RamaddaDisplay(e,d,DISPLAY_TEXT,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{lastHtml:"<p>&nbsp;<p>&nbsp;<p>",initDisplay:function(){b.initDisplay.call(this);this.setContents(this.lastHtml)},handleEventRecordSelection:function(g,f){this.lastHtml=f.html;this.setContents(f.html)}})}var DISPLAY_ENTRYLIST="entrylist";var DISPLAY_TESTLIST="testlist";var DISPLAY_ENTRYDISPLAY="entrydisplay";var DISPLAY_ENTRY_GALLERY="entrygallery";var DISPLAY_ENTRY_GRID="entrygrid";var DISPLAY_OPERANDS="operands";var DISPLAY_METADATA="metadata";var DISPLAY_TIMELINE="timeline";var DISPLAY_REPOSITORIES="repositories";var ID_RESULTS="results";var ID_ENTRIES="entries";var ID_DETAILS="details";var ID_DETAILS_INNER="detailsinner";var ID_PROVIDERS="providers";var ID_SEARCH_SETTINGS="searchsettings";var ATTR_ENTRYID="entryid";var ID_TREE_LINK="treelink";addGlobalDisplayType({type:DISPLAY_ENTRYLIST,label:"Entry List",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_TESTLIST,label:"Test  List",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_ENTRYDISPLAY,label:"Entry Display",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_ENTRY_GALLERY,label:"Entry Gallery",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_ENTRY_GRID,label:"Entry Date Grid",requiresData:false,category:"Entry Displays"});addGlobalDisplayType({type:DISPLAY_METADATA,label:"Metadata Table",requiresData:false,category:"Entry Displays"});function RamaddaEntryDisplay(l,c,k,h){var e;RamaddaUtil.inherit(this,e=new RamaddaDisplay(l,c,k,h));this.ramaddas=new Array();var f=this.getProperty("repositories",this.getProperty("repos",null));if(f!=null){var g=f.split(",");for(var d=0;d<g.length;d++){var m=g[d];m=m.trim();this.ramaddas.push(getRamadda(m))}if(this.ramaddas.length>0){var b=new RepositoryContainer("all","All entries");addRepository(b);for(var d=0;d<this.ramaddas.length;d++){b.addRepository(this.ramaddas[d])}this.ramaddas.push(b);this.setRamadda(this.ramaddas[0])}}RamaddaUtil.defineMembers(this,{searchSettings:new EntrySearchSettings({parent:h.entryParent,provider:h.provider,text:h.entryText,entryType:h.entryType,orderBy:h.orderBy}),entryList:h.entryList,entryMap:{},getSearchSettings:function(){if(this.providers!=null){var o=this.searchSettings.provider;var n=this.jq(ID_PROVIDERS).val();if(n!=null){o=n}this.searchSettings.provider=o}return this.searchSettings},getEntries:function(){if(this.entryList==null){return[]}return this.entryList.getEntries()}});if(h.entryType!=null){this.searchSettings.addType(h.entryType)}}function RamaddaSearcher(w,n,d,f){var h="-- None --";var l="textfield";var b="typefield";var m="typediv";var o="typefields";var s="metadatafield";var v="search";var k="form";var c="column";RamaddaUtil.initMembers(this,{showForm:true,showSearchSettings:true,showEntries:true,showType:true,doSearch:true,formOpen:true,fullForm:true,showMetadata:true,showToggle:true,showArea:true,showText:true,showDate:true,fields:null,formWidth:0,entriesWidth:0,types:null,entryTypes:null,metadataTypeList:[],showDetailsForGroup:false});var x;RamaddaUtil.inherit(this,x=new RamaddaEntryDisplay(w,n,d,f));if(this.showMetadata&&this.showSearchSettings){var t=this.getProperty("metadataTypes","enum_tag:Tag");var p=t.split(",");for(var u=0;u<p.length;u++){var d=p[u];var g=d;var q=null;var e=d.split(":");if(e.length>1){d=e[0];if(e.length>=3){q=e[1];g=e[2]}else{g=e[1]}}this.metadataTypeList.push(new MetadataType(d,g,q))}}RamaddaUtil.defineMembers(this,{haveSearched:false,haveTypes:false,metadata:{},metadataLoading:{},getDefaultHtml:function(){var D="";var z=this.isLayoutHorizontal();var G=this.getFooter();if(!this.getProperty("showFooter",true)){G=""}displayDebug=false;var B=[ATTR_ID,this.getDomId(ID_ENTRIES),ATTR_CLASS,this.getClass("content")];var y=this.getProperty("innerHeight",null);if(y==null){y=this.getProperty("entriesHeight",null)}if(y!=null){B.push(ATTR_STYLE);B.push("margin: 0px; padding: 0px;  min-height:"+y+"px; max-height:"+y+"px; overflow-y: auto;")}var E="";if(this.getProperty("showHeader",true)){E=HtmlUtils.div([ATTR_CLASS,"display-entries-results",ATTR_ID,this.getDomId(ID_RESULTS)],"&nbsp;")}var F=E+HtmlUtils.div(B,this.getLoadingMessage());if(z){D+=HtmlUtils.openTag(TAG_DIV,["class","row"]);var C=["class","col-md-12"];if(this.showForm){var H=[];if(this.formWidth===""){H=[]}else{if(this.formWidth!=0){H=[ATTR_WIDTH,this.formWidth]}}D+=HtmlUtils.tag(TAG_DIV,["class","col-md-4"],this.makeSearchForm());C=["class","col-md-8"]}if(this.showEntries){var H=[ATTR_WIDTH,"75%"];if(this.entriesWidth===""){H=[]}else{if(this.entriesWidth!=0){H=[ATTR_WIDTH,this.entriesWidth]}}D+=HtmlUtils.tag(TAG_DIV,C,F)}D+=HtmlUtils.closeTag("row");D+=HtmlUtils.openTag(TAG_DIV,["class","row"]);if(this.showForm){D+=HtmlUtils.tag(TAG_DIV,["class","col-md-6"],"")}if(this.showEntries){if(this.getProperty("showFooter",true)){D+=HtmlUtils.tag(TAG_DIV,["class","col-md-6"],G)}}D+=HtmlUtils.closeTag(TAG_DIV)}else{if(this.showForm){D+=this.makeSearchForm()}if(this.showEntries){D+=F;D+=G}}D+=HtmlUtils.div([ATTR_CLASS,"display-entry-popup",ATTR_ID,this.getDomId(ID_DETAILS)],"&nbsp;");return D},initDisplay:function(){var y=this;this.jq(v).button().click(function(C){y.submitSearchForm();C.preventDefault()});this.jq(l).autocomplete({source:function(C,D){}});this.jq(ID_REPOSITORY).selectBoxIt({});this.jq(ID_REPOSITORY).change(function(){var C=y.jq(ID_REPOSITORY).val();var D=getRamadda(C);y.setRamadda(D);y.addTypes(null);y.typeChanged()});this.jq(k).submit(function(C){y.submitSearchForm();C.preventDefault()});this.addTypes(this.entryTypes);for(var z=0;z<this.metadataTypeList.length;z++){var B=this.metadataTypeList[z];this.addMetadata(B,null)}if(!this.haveSearched){if(this.doSearch){this.submitSearchForm()}}},showEntryDetails:function(z,D,y,G){if(true){return}var F=this.getEntry(D);var B="#"+this.getDomId(ID_DETAILS+D);if(this.currentPopupEntry==F){this.hideEntryDetails(D);return}var E="right top";var H="right bottom";if(G){E="left top";H="left bottom"}this.currentPopupEntry=F;if(y==null){y=this.getDomId("entry_"+F.getIdForDom())}var I=HtmlUtils.onClick(this.getGet()+".hideEntryDetails('"+D+"');",HtmlUtils.image(ramaddaBaseUrl+"/icons/close.gif"));var C=this.getEntryHtml(F,{headerRight:I});$(B).html(C);$(B).show()},getResultsHeader:function(z){var F="Showing "+(this.searchSettings.skip+1)+"-"+(this.searchSettings.skip+Math.min(this.searchSettings.max,z.length));var y=[];var E=[];if(this.searchSettings.skip>0){y.push(HtmlUtils.onClick(this.getGet()+".loadPrevUrl();",HtmlUtils.image(ramaddaBaseUrl+"/icons/arrow_left.png",[ATTR_TITLE,"Previous","border","0"]),[ATTR_CLASS,"display-link"]))}var D=false;if(z.length==this.searchSettings.getMax()){y.push(HtmlUtils.onClick(this.getGet()+".loadNextUrl();",HtmlUtils.image(ramaddaBaseUrl+"/icons/arrow_right.png",[ATTR_TITLE,"Next","border","0"]),[ATTR_CLASS,"display-link"]));D=true}E.push(HtmlUtils.onClick(this.getGet()+".loadLess();",HtmlUtils.image(ramaddaBaseUrl+"/icons/greenminus.png",[ATTR_ALT,"View less",ATTR_TITLE,"View less","border","0"]),[ATTR_CLASS,"display-link"]));if(D){E.push(HtmlUtils.onClick(this.getGet()+".loadMore();",HtmlUtils.image(ramaddaBaseUrl+"/icons/greenplus.png",[ATTR_ALT,"View more",ATTR_TITLE,"View more","border","0"]),[ATTR_CLASS,"display-link"]))}var C="";var B="&nbsp;&nbsp;&nbsp;";C=F+B+HtmlUtils.join(y,"&nbsp;")+B+HtmlUtils.join(E,"&nbsp;");return C},submitSearchForm:function(){if(this.fixedEntries){return}this.haveSearched=true;var C=this.getSearchSettings();C.text=this.getFieldValue(this.getDomId(l),C.text);if(this.textRequired&&(C.text==null||C.text.trim().length==0)){this.writeHtml(ID_ENTRIES,"");return}if(this.haveTypes){C.entryType=this.getFieldValue(this.getDomId(b),C.entryType)}C.clearAndAddType(C.entryType);if(this.areaWidget){this.areaWidget.setSearchSettings(C)}if(this.dateRangeWidget){this.dateRangeWidget.setSearchSettings(C)}C.metadata=[];for(var z=0;z<this.metadataTypeList.length;z++){var y=this.metadataTypeList[z];var F=y.getValue();if(F==null){F=this.getFieldValue(this.getMetadataFieldId(y),null)}if(F!=null){C.metadata.push({type:y.getType(),value:F})}}var E=this.getRamadda();if(E.children){console.log("Searching  multiple ramaddas");this.entryList=new EntryListHolder(E,this);this.multiSearch={count:0};for(var z=0;z<E.children.length;z++){var D=E.children[z];var B=this.makeSearchUrl(D);this.updateForSearching(B);this.entryList.addEntryList(new EntryList(D,B,null,false));this.multiSearch.count++}this.entryList.doSearch(this)}else{this.multiSearch=null;var B=this.makeSearchUrl(this.getRamadda());console.log(B);this.entryList=new EntryList(this.getRamadda(),B,this,true);this.updateForSearching(B)}},handleSearchError:function(y,z){this.writeHtml(ID_ENTRIES,"");this.writeHtml(ID_RESULTS,"");console.log("Error performing search:"+z)},updateForSearching:function(y){var C=this.getRamadda().getSearchLinks(this.getSearchSettings());this.footerRight=C==null?"":"Links: "+HtmlUtils.join(C," - ");this.writeHtml(ID_FOOTER_RIGHT,this.footerRight);var B=this.searchMessage;if(B==null){B=this.getRamadda().getSearchMessage()}var z=this.getSearchSettings().provider;if(z!=null){B=null;if(this.providerMap!=null){B=this.providerMap[z]}if(B==null){B=z}B="Searching "+B}this.showMessage(this.getWaitImage()+" "+B,HtmlUtils.div([ATTR_STYLE,"margin:20px;"],""));this.hideEntryDetails()},showMessage:function(z,y){this.writeHtml(ID_RESULTS,z);this.writeHtml(ID_ENTRIES,y)},prepareToLayout:function(){x.prepareToLayout.apply(this);this.savedValues={};var C=this.getSearchableColumns();for(var z=0;z<C.length;z++){var y=C[z];var D=this.getDomId(c+y.getName());var B=$("#"+D).val();if(B==null||B.length==0){continue}this.savedValues[D]=B}},makeSearchUrl:function(D){var y="";var F=this.getSearchableColumns();for(var B=0;B<F.length;B++){var z=F[B];var E=this.jq(c+z.getName()).val();if(E==null||E.length==0){continue}y+="&"+z.getSearchArg()+"="+encodeURI(E)}this.getSearchSettings().setExtra(y);var C=D.getSearchUrl(this.getSearchSettings(),OUTPUT_JSON);return C},makeSearchForm:function(){var B=HtmlUtils.openTag("form",[ATTR_ID,this.getDomId(k),"action","#"]);var C="";var M=this.getSearchSettings().text;if(M==null){var D=Utils.getUrlArgs(document.location.search);M=D.text}if(M==null){M=""}var G=" search text";if(this.eg){G=" "+this.eg}var L=HtmlUtils.image(ramaddaBaseUrl+"/icons/magnifier.png",[ATTR_BORDER,"0",ATTR_TITLE,"Search"]);var I=[];var C="";C+=HtmlUtils.formTable();if(this.showArea){this.areaWidget=new AreaWidget(this);C+=HtmlUtils.formEntry("Area:",this.areaWidget.getHtml())}var ad=HtmlUtils.div([ATTR_ID,this.getDomId(v),ATTR_CLASS,"display-button"],L);if(this.ramaddas.length>0){var Q=HtmlUtils.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(ID_REPOSITORY),ATTR_CLASS,"display-repositories-select"]);var Z=ramaddaBaseUrl+"/icons/favicon.png";for(var W=0;W<this.ramaddas.length;W++){var ae=this.ramaddas[W];var S=[ATTR_TITLE,"",ATTR_VALUE,ae.getId(),"data-iconurl",Z];if(this.getRamadda().getId()==ae.getId()){S.push("selected");S.push(null)}var J=Q+=HtmlUtils.tag(TAG_OPTION,S,ae.getName())}Q+=HtmlUtils.closeTag(TAG_SELECT);I.push(Q)}this.providerMap={};if(this.providers!=null){var F="";var R=Utils.getUrlArgs(document.location.search).provider;var T=this.providers.split(",");var H=null;var Y={};var K=[];for(var W=0;W<T.length;W++){var O=T[W].split(":");var P=O[0];P=P.replace(/_COLON_/g,":");var J=O.length>1?O[1]:P;if(J.length>40){J=J.substring(0,39)+"..."}this.providerMap[P]=J;var X="";if(P==R){X+=" selected "}var V="";if(O.length>3){V=O[3]}var ab=Y[V];if(ab==null){K.push(V);Y[V]="";ab=""}if(O.length>2){var af=O[2];af=af.replace(/\${urlroot}/g,ramaddaBaseUrl);af=af.replace(/\${root}/g,ramaddaBaseUrl);X+=' data-iconurl="'+af+'" '}ab+="<option "+X+' value="'+P+'">'+J+"</option>\n";Y[V]=ab}for(var z=0;z<K.length;z++){var V=K[z];if(V!=""){F+='<optgroup label="'+V+'">\n'}F+=Y[V];if(V!=""){F+="</optgroup>"}}I.push(HtmlUtils.tag("select",["id",this.getDomId(ID_PROVIDERS),ATTR_CLASS,"display-search-providers"],F))}if(this.showType){I.push(HtmlUtils.span([ATTR_ID,this.getDomId(m)],HtmlUtils.span([ATTR_CLASS,"display-loading"],"Loading types...")))}var N=HtmlUtils.input("",M,["placeholder",G,ATTR_CLASS,"display-search-input",ATTR_SIZE,"30",ATTR_ID,this.getDomId(l)]);if(this.showText){I.push(N)}var aa=this.isLayoutHorizontal();if(aa){var ac=HtmlUtils.join(I,"<br>");B+="<table><tr valign=top><td>"+ad+"</td><td>"+ac+"</td></tr></table>"}else{B+=ad+" "+HtmlUtils.join(I," ")}if(this.showDate){this.dateRangeWidget=new DateRangeWidget(this);C+=HtmlUtils.formEntry("Date Range:",this.dateRangeWidget.getHtml())}if(this.showMetadata){for(var W=0;W<this.metadataTypeList.length;W++){var E=this.metadataTypeList[W];var U=E.getValue();var y;if(U!=null){y=U}else{y=HtmlUtils.tag(TAG_SELECT,[ATTR_ID,this.getMetadataFieldId(E),ATTR_CLASS,"display-metadatalist"],HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],h))}C+=HtmlUtils.formEntry(E.getLabel()+":",y)}}C+=HtmlUtils.closeTag(TAG_TABLE);C+=HtmlUtils.div([ATTR_ID,this.getDomId(o)],"");if(this.showSearchSettings){var P=this.getDomId(ID_SEARCH_SETTINGS);if(this.showToggle){B+=HtmlUtils.div([ATTR_CLASS,"display-search-extra",ATTR_ID,P],HtmlUtils.toggleBlock("Search Settings",HtmlUtils.div([ATTR_CLASS,"display-search-extra-inner"],C),this.formOpen))}else{B+=HtmlUtils.div([ATTR_CLASS,"display-search-extra",ATTR_ID,P],HtmlUtils.div([ATTR_CLASS,"display-search-extra-inner"],C))}}B+='<input type="submit" style="position:absolute;left:-9999px;width:1px;height:1px;"/>';B+=HtmlUtils.closeTag("form");return B},handleEventMapBoundsChanged:function(z,y){if(this.areaWidget){this.areaWidget.handleEventMapBoundsChanged(z,y)}},typeChanged:function(){var y=this.getSearchSettings();y.skip=0;y.max=50;y.entryType=this.getFieldValue(this.getDomId(b),y.entryType);y.clearAndAddType(y.entryType);this.addExtraForm();this.submitSearchForm()},addMetadata:function(B,D){if(D==null){D=this.metadata[B.getType()]}if(D==null){var I=this;if(!this.metadataLoading[B.getType()]){this.metadataLoading[B.getType()]=true;D=this.getRamadda().getMetadataCount(B,function(J,K){I.addMetadata(J,K)})}}if(D==null){return}this.metadata[B.getType()]=D;var F=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],h);for(var z=0;z<D.length;z++){var C=D[z].count;var H=D[z].value;var E=D[z].label;var G=[ATTR_VALUE,H,ATTR_CLASS,"display-metadatalist-item"];var y=false;if(y){G.push("selected");G.push(null)}F+=HtmlUtils.tag(TAG_OPTION,G,E+" ("+C+")")}$("#"+this.getMetadataFieldId(B)).html(F)},getMetadataFieldId:function(y){var z=y.getType();z=z.replace(".","_");return this.getDomId(s+z)},findEntryType:function(y){if(this.entryTypes==null){return null}for(var z=0;z<this.entryTypes.length;z++){var B=this.entryTypes[z];if(B.getId()==y){return B}}return null},addTypes:function(L){if(!this.showType){return}if(L==null){var M=this;L=this.getRamadda().getEntryTypes(function(P,O){M.addTypes(O)})}if(L==null){return}this.entryTypes=L;if(this.types){var C={};var z=this.types.split(",");for(var D=0;D<z.length;D++){var G=z[D];C[G]=true}var E=[];for(var D=0;D<this.entryTypes.length;D++){var G=this.entryTypes[D];if(C[G.getId()]){E.push(G)}else{if(G.getCategory()!=null&&C[G.getCategory()]){E.push(G)}}}this.entryTypes=E}this.haveTypes=true;var N=[];var K={};var I=HtmlUtils.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(b),ATTR_CLASS,"display-typelist","onchange",this.getGet()+".typeChanged();"]);I+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],"Any Type");for(var D=0;D<this.entryTypes.length;D++){var G=this.entryTypes[D];var H=G.getIcon();var J=[ATTR_TITLE,G.getLabel(),ATTR_VALUE,G.getId(),ATTR_CLASS,"display-typelist-type","data-iconurl",H];var B=this.getSearchSettings().hasType(G.getId());if(B){J.push("selected");J.push(null)}var F=HtmlUtils.tag(TAG_OPTION,J,G.getLabel()+" ("+G.getEntryCount()+")");var y=K[G.getCategory()];if(y==null){K[G.getCategory()]=HtmlUtils.tag(TAG_OPTION,[ATTR_CLASS,"display-typelist-category",ATTR_TITLE,"",ATTR_VALUE,""],G.getCategory());N.push(G.getCategory())}K[G.getCategory()]+=F}for(var D in N){I+=K[N[D]]}I+=HtmlUtils.closeTag(TAG_SELECT);this.writeHtml(m,I);this.jq(b).selectBoxIt({});this.addExtraForm()},getSelectedType:function(){if(this.entryTypes==null){return null}for(var y=0;y<this.entryTypes.length;y++){var z=this.entryTypes[y];if(z.getId){if(this.getSearchSettings().hasType(z.getId())){return z}}}return null},getSearchableColumns:function(){var B=[];var C=this.getSelectedType();if(C==null){return B}var D=C.getColumns();if(D==null){return B}for(var z=0;z<D.length;z++){var y=D[z];if(!y.getCanSearch()){continue}B.push(y)}return B},addExtraForm:function(){if(this.savedValues==null){this.savedValues={}}var D="";var G=this.getSearchableColumns();for(var E=0;E<G.length;E++){var C=G[E];if(this.fields!=null&&this.fields.indexOf(C.getName())<0){continue}if(D.length==0){D+=HtmlUtils.formTable()}var I="";var B=this.getDomId(c+C.getName());var z=this.savedValues[B];if(z==null){z=this.jq(c+C.getName()).val()}if(z==null){z=""}if(C.isEnumeration()){I=HtmlUtils.openTag(TAG_SELECT,[ATTR_ID,B,ATTR_CLASS,"display-menu"]);I+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],"-- Select --");var K=C.getValues();for(var y in K){var J=K[y].value;var H=K[y].label;var F="";if(J==z){F=" selected "}I+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,H,ATTR_VALUE,J,F,null],H)}I+=HtmlUtils.closeTag(TAG_SELECT)}else{I=HtmlUtils.input("",z,[ATTR_CLASS,"input",ATTR_SIZE,"15",ATTR_ID,B])}D+=HtmlUtils.formEntry(C.getLabel()+":",I+" "+C.getSuffix())}if(D.length>0){D+=HtmlUtils.closeTag(TAG_TABLE)}this.writeHtml(o,D);$(".display-menu").selectBoxIt({})},getEntries:function(){if(this.entryList==null){return[]}return this.entryList.getEntries()},loadNextUrl:function(){this.getSearchSettings().skip+=this.getSearchSettings().max;this.submitSearchForm()},loadMore:function(){this.getSearchSettings().max=this.getSearchSettings().max+=50;this.submitSearchForm()},loadLess:function(){var y=this.getSearchSettings().max;y=parseInt(0.75*y);this.getSearchSettings().max=Math.max(1,y);this.submitSearchForm()},loadPrevUrl:function(){this.getSearchSettings().skip=Math.max(0,this.getSearchSettings().skip-this.getSearchSettings().max);this.submitSearchForm()},entryListChanged:function(y){this.entryList=y}})}function RamaddaEntrylistDisplay(f,e,c,d){var b;if(d==null){d=DISPLAY_ENTRYLIST}RamaddaUtil.inherit(this,b=new RamaddaSearcher(f,e,DISPLAY_ENTRYLIST,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{haveDisplayed:false,selectedEntries:[],getSelectedEntries:function(){return this.selectedEntries},initDisplay:function(){var g=this;if(this.getIsLayoutFixed()&&this.haveDisplayed){return}this.haveDisplayed=true;this.createUI();this.setContents(this.getDefaultHtml());if(this.dateRangeWidget){this.dateRangeWidget.initHtml()}b.initDisplay.apply(this);if(this.entryList!=null&&this.entryList.haveLoaded){this.entryListChanged(this.entryList)}this.jq(ID_PROVIDERS).selectBoxIt({});this.jq(ID_PROVIDERS).change(function(){g.providerChanged()})},providerChanged:function(){var g=this.jq(ID_PROVIDERS).val();if(g!="this"){this.jq(ID_SEARCH_SETTINGS).hide()}else{this.jq(ID_SEARCH_SETTINGS).show()}},getMenuItems:function(h){b.getMenuItems.apply(this,h);if(this.getSelectedEntriesFromTree().length>0){var g=this.getGet();h.push(HtmlUtils.onClick(g+".makeDisplayList();","Make List"));h.push(HtmlUtils.onClick(g+".makeDisplayGallery();","Make Gallery"))}},makeDisplayList:function(){var g=this.getSelectedEntriesFromTree();if(g.length==0){return}var h={selectedEntries:g,showForm:false,showMenu:true,fixedEntries:true};h.entryList=new EntryList(this.getRamadda(),"",this,false);h.entryList.setEntries(g);this.getDisplayManager().createDisplay(DISPLAY_ENTRYLIST,h)},makeDisplayGallery:function(){var g=this.getSelectedEntriesFromTree();if(g.length==0){return}var h={selectedEntries:g};this.getDisplayManager().createDisplay(DISPLAY_ENTRY_GALLERY,h)},handleEventEntrySelection:function(h,g){this.selectEntry(g.entry,g.selected)},selectEntry:function(k,h){var l=false;if(h){this.jq("entry_"+k.getIdForDom()).addClass("ui-selected");var g=this.selectedEntries.indexOf(k);if(g<0){this.selectedEntries.push(k);l=true}}else{this.jq("entry_"+k.getIdForDom()).removeClass("ui-selected");var g=this.selectedEntries.indexOf(k);if(g>=0){this.selectedEntries.splice(g,1);l=true}}},makeEntriesDisplay:function(g){return this.getEntriesTree(g)},entryListChanged:function(n){if(this.multiSearch){this.multiSearch.count--}b.entryListChanged.apply(this,[n]);var g=this.entryList.getEntries();if(g.length==0){this.getSearchSettings().skip=0;this.getSearchSettings().max=50;var m="Nothing found";if(this.multiSearch){if(this.multiSearch.count>0){m="Nothing found so far. Still searching "+this.multiSearch.count+" repositories"}else{}}this.writeHtml(ID_ENTRIES,this.getMessage(m));this.writeHtml(ID_FOOTER_LEFT,"");this.writeHtml(ID_RESULTS,"&nbsp;");this.getDisplayManager().handleEventEntriesChanged(this,[]);return}this.writeHtml(ID_RESULTS,this.getResultsHeader(g));var h=this.getGet();this.writeHtml(ID_FOOTER_LEFT,"");if(this.footerRight!=null){this.writeHtml(ID_FOOTER_RIGHT,this.footerRight)}var l=this.makeEntriesDisplay(g);var k="";k+=HtmlUtils.openTag(TAG_OL,[ATTR_CLASS,this.getClass("list"),ATTR_ID,this.getDomId(ID_LIST)]);k+=l;k+=HtmlUtils.closeTag(TAG_OL);this.writeHtml(ID_ENTRIES,k);this.addEntrySelect();this.getDisplayManager().handleEventEntriesChanged(this,g)}})}function RamaddaTestlistDisplay(e,d,c){var b;RamaddaUtil.inherit(this,b=new RamaddaEntrylistDisplay(e,d,c,DISPLAY_TESTLIST));RamaddaUtil.defineMembers(this,{makeEntriesDisplay:function(f){return"Overridden display<br>"+this.getEntriesTree(f)}})}var RamaddaListDisplay=RamaddaEntrylistDisplay;function RamaddaEntrygalleryDisplay(f,e,c){var d="gallery";var b;RamaddaUtil.inherit(this,b=new RamaddaEntryDisplay(f,e,DISPLAY_ENTRY_GALLERY,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{entries:c.entries,initDisplay:function(){var o=this;this.createUI();var h=HtmlUtils.div([ATTR_ID,this.getDomId(d)],"Gallery");this.setContents(h);if(this.selectedEntries!=null){this.jq(d).html(this.getEntriesGallery(this.selectedEntries));return}if(this.entries){var l={entries:this.entries};var g=new EntrySearchSettings(l);var k=this.getRamadda().getSearchUrl(g,OUTPUT_JSON,"BAR");console.log(k);var m={entryListChanged:function(q){var p=q.getEntries();o.jq(d).html(o.getEntriesGallery(p));$("a.popup_image").fancybox({titleShow:false})}};var n=new EntryList(this.getRamadda(),k,m,true)}if(this.entryList!=null&&this.entryList.haveLoaded){this.entryListChanged(this.entryList)}},getEntriesGallery:function(n){var u="";var m="";var v=0;var s=[];for(var l=0;l<n.length;l++){var t=n[l];if(t.isImage()){s.push(t);var q=HtmlUtils.tag(TAG_A,[ATTR_HREF,t.getEntryUrl()],t.getName());v++;m+=HtmlUtils.tag(TAG_IMG,["src",t.getResourceUrl(),ATTR_WIDTH,"500",ATTR_ID,this.getDomId("entry_"+t.getIdForDom()),ATTR_ENTRYID,t.getId(),ATTR_CLASS,"display-entrygallery-entry"])+"<br>"+q+"<p>"}else{var p=t.getIconImage([ATTR_TITLE,"View entry"]);var q=HtmlUtils.tag(TAG_A,[ATTR_HREF,t.getEntryUrl()],p+" "+t.getName());u+=q+"<br>"}}if(v>1){var g="";g+='<div class="row">\n';var h=parseInt(this.getProperty("columns","3"));var o="col-md-"+(12/h);for(var l=0;l<s.length;l++){if(l>=h){g+='</div><div class="row">\n'}g+="<div class="+o+">\n";var t=s[l];var q=HtmlUtils.tag(TAG_A,[ATTR_HREF,t.getEntryUrl()],t.getName());var k=HtmlUtils.image(t.getResourceUrl(),[ATTR_WIDTH,"100%",ATTR_ID,this.getDomId("entry_"+t.getIdForDom()),ATTR_ENTRYID,t.getId(),ATTR_CLASS,"display-entrygallery-entry"]);k=HtmlUtils.href(t.getResourceUrl(),k,["class","popup_image"]);g+=HtmlUtils.div(["class","image-outer"],HtmlUtils.div(["class","image-inner"],k)+HtmlUtils.div(["class","image-caption"],q));g+="</div>\n"}g+="</div>\n";m=g}if(u!=""){if(v>0){m+="<hr>"}m+=u}return m}})}function RamaddaEntrygridDisplay(u,m,h){var w;var n="contents";var k="grid";var e="axis_left";var o="axis_bottom";var d="canvas";var l="top";var c="right";var s="gridsettings";var t="yAxisAscending";var y="scaleHeight";var p="xAxisAscending";var v="xAxisType";var g="yAxisType";var q="scaleWidth";var b="showIcon";var f="showName";var x="boxColor";RamaddaUtil.inherit(this,w=new RamaddaEntryDisplay(u,m,DISPLAY_ENTRY_GRID,h));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{entries:h.entries,initDisplay:function(){var G=this;this.createUI();var B=HtmlUtils.div([ATTR_ID,this.getDomId(n)],this.getLoadingMessage("Loading entries..."));this.setContents(B);if(!this.entryIds){G.jq(n).html(this.getLoadingMessage("No entries specified"));return}var D={entries:this.entryIds};var z=new EntrySearchSettings(D);var C=this.getRamadda().getSearchUrl(z,OUTPUT_JSON,"BAR");var E={entryListChanged:function(R){G.entries=R.getEntries();if(G.entries.length==0){G.jq(n).html(G.getLoadingMessage("No entries selected"));return}G.drag=null;G.jq(n).html(G.makeFramework());G.canvas=$("#"+G.getDomId(d));G.gridPopup=$("#"+G.getDomId(k)+" .display-grid-popup");var T=false;var L=G.jq(o);var H=G.jq(e);var K=function(X){if(T){console.log("mouse down")}G.handledClick=false;G.drag={dragging:false,x:GuiUtils.getEventX(X),y:GuiUtils.getEventY(X),X:{minDate:G.axis.X.minDate?G.axis.X.minDate:G.minDate,maxDate:G.axis.X.maxDate?G.axis.X.maxDate:G.maxDate},Y:{minDate:G.axis.Y.minDate?G.axis.Y.minDate:G.minDate,maxDate:G.axis.Y.maxDate?G.axis.Y.maxDate:G.maxDate}}};var I=function(X){if(T){console.log("mouse leave")}G.drag=null;G.handledClick=false};var O=function(X){if(T){console.log("mouse up")}if(G.drag){if(G.drag.dragging){if(T){console.log("mouse up-was dragging")}G.handledClick=true}G.drag=null}};var Q=function(al,Z,Y){if(T){console.log("mouse move")}var af=G.drag;if(!af){return}af.dragging=true;var ak=GuiUtils.getEventX(al);var ac=af.x-ak;var ai=GuiUtils.getEventY(al);var aa=af.y-ai;var X=$(this).width();var am=$(this).height();var ag=(ak-af.x)/X;var ae=(ai-af.y)/am;var ad=G.getXAxisAscending();var ab=G.getXAxisAscending();var aj=(af.X.maxDate.getTime()-af.X.minDate.getTime())*ag;var ah=(af.Y.maxDate.getTime()-af.Y.minDate.getTime())*ae;if(Z){G.axis.X.minDate=new Date(af.X.minDate.getTime()+((ad?-1:1)*aj));G.axis.X.maxDate=new Date(af.X.maxDate.getTime()+((ad?-1:1)*aj))}if(Y){G.axis.Y.minDate=new Date(af.Y.minDate.getTime()+((ab?1:-1)*ah));G.axis.Y.maxDate=new Date(af.Y.maxDate.getTime()+((ab?1:-1)*ah))}G.makeGrid(G.entries)};var J=function(Y,ab,aa){if(G.handledClick){if(T){console.log("mouse click-other click")}G.handledClick=false;return}if(G.drag&&G.drag.dragging){if(T){console.log("mouse click-was dragging")}G.drag=null;return}if(T){console.log("mouse click")}G.drag=null;var Z;if(Y.metaKey||Y.ctrlKey){Z="reset"}else{var X=Y.shiftKey;if(X){Z="zoomout"}else{Z="zoomin"}}G.doZoom(Z,ab,aa)};var S=function(X){Q(X,true,true)};var P=function(X){Q(X,true,false)};var N=function(X){Q(X,false,true)};var M=function(X){J(X,true,true)};var V=function(X){J(X,true,false)};var U=function(X){J(X,false,true)};G.canvas.mousedown(K);G.canvas.mouseleave(I);G.canvas.mouseup(O);G.canvas.mousemove(S);G.canvas.click(M);L.mousedown(K);L.mouseleave(I);L.mouseup(O);L.mousemove(P);L.click(V);H.mousedown(K);H.mouseleave(I);H.mouseup(O);H.mousemove(N);H.click(U);var W=HtmlUtils.image(icon_zoom,["class","display-grid-action","title","reset zoom","action","reset"])+HtmlUtils.image(icon_zoom_in,["class","display-grid-action","title","zoom in","action","zoomin"])+HtmlUtils.image(icon_zoom_out,["class","display-grid-action","title","zoom out","action","zoomout"]);G.jq(l).html(W);$("#"+G.getDomId(k)+" .display-grid-action").click(function(){var X=$(this).attr("action");G.doZoom(X)});G.jq(e).html("");G.jq(o).html("");G.makeGrid(G.entries)}};var F=new EntryList(this.getRamadda(),C,E,true)},initDialog:function(){w.initDialog.call(this);var C=this;var B=this.jq(s+" :checkbox");console.log(B.size());B.click(function(){C.setProperty($(this).attr("attr"),$(this).is(":checked"));C.makeGrid(C.entries)});var z=this.jq(s+" :input");z.blur(function(){C.setProperty($(this).attr("attr"),$(this).val());C.makeGrid(C.entries)});z.keypress(function(E){var D=(E.keyCode?E.keyCode:E.which);if(D==13){C.setProperty($(this).attr("attr"),$(this).val());C.makeGrid(C.entries)}})},getDialogContents:function(B,D){var z="600";var C="";C+=HtmlUtils.openTag("div",["id",this.getDomId(s)]);C+=HtmlUtils.formTable();C+=HtmlUtils.formEntry("",HtmlUtils.checkbox(this.getDomId(b),["attr",b],this.getProperty(b,"true"))+" Show Icon&nbsp;&nbsp;"+HtmlUtils.checkbox(this.getDomId(f),["attr",f],this.getProperty(f,"true"))+" Show Name");C+=HtmlUtils.formEntry("X-Axis:",HtmlUtils.checkbox(this.getDomId(p),["attr",p],this.getXAxisAscending())+" Ascending&nbsp;&nbsp;"+HtmlUtils.checkbox(this.getDomId(q),["attr",q],this.getXAxisScale())+" Scale Width");C+=HtmlUtils.formEntry("Y-Axis:",HtmlUtils.checkbox(this.getDomId(t),["attr",t],this.getYAxisAscending())+" Ascending&nbsp;&nbsp;"+HtmlUtils.checkbox(this.getDomId(y),["attr",y],this.getYAxisScale())+" Scale Height");C+=HtmlUtils.formEntry("Box Color:",HtmlUtils.input(this.getDomId(x),this.getProperty(x,"lightblue"),["attr",x]));C+=HtmlUtils.formTableClose();C+=HtmlUtils.closeTag("div");B.push("Entry Grid");D.push(C);w.getDialogContents.call(this,B,D)},doZoom:function(E,G,D){if(!Utils.isDefined(G)){G=true}if(!Utils.isDefined(D)){D=true}if(E=="reset"){this.axis.Y.minDate=null;this.axis.Y.maxDate=null;this.axis.X.minDate=null;this.axis.X.maxDate=null}else{var z=(E=="zoomout");if(G){var C=this.axis.X.minDate.getTime();var B=this.axis.X.maxDate.getTime();var H=B-C;var F=(z?1:-1)*H*0.1;this.axis.X.minDate=new Date(C-F);this.axis.X.maxDate=new Date(B+F)}if(D){var C=this.axis.Y.minDate.getTime();var B=this.axis.Y.maxDate.getTime();var H=B-C;var F=(z?1:-1)*H*0.1;this.axis.Y.minDate=new Date(C-F);this.axis.Y.maxDate=new Date(B+F)}}this.makeGrid(this.entries)},initGrid:function(z){var C=this;var B=this.canvas.find(".display-grid-entry");B.click(function(D){var F=parseInt($(this).attr("index"));entry=z[F];var E=entry.getEntryUrl();if(C.urlTemplate){E=C.urlTemplate.replace("{url}",E).replace(/{entryid}/g,entry.getId()).replace(/{resource}/g,entry.getResourceUrl())}C.handledClick=true;C.drag=null;window.open(E,"_entry")});B.mouseout(function(){var E=$(this).attr("entryid");if(E){var D=C.canvas.find("[entryid='"+E+"']");D.each(function(){if($(this).attr("itemtype")=="box"){$(this).attr("prevcolor",$(this).css("background"));$(this).css("background",$(this).attr("prevcolor"))}})}C.gridPopup.hide()});B.mouseover(function(L){var E=$(this).attr("entryid");if(E){var J=C.canvas.find("[entryid='"+E+"']");J.each(function(){if($(this).attr("itemtype")=="box"){$(this).attr("prevcolor",$(this).css("background"));$(this).css("background","rgba(0,0,255,0.5)")}})}var K=GuiUtils.getEventX(L);var I=parseInt($(this).attr("index"));entry=z[I];var D=entry.getThumbnail();var H="";if(D){H=HtmlUtils.image(D,["width","300;"])+"<br>"}else{if(entry.isImage()){H+=HtmlUtils.image(entry.getResourceUrl(),["width","300"])+"<br>"}}H+=entry.getIconImage()+" "+entry.getName()+"<br>";var F=entry.getStartDate().getUTCFullYear()+"-"+Utils.padLeft(entry.getStartDate().getUTCMonth()+1,2,"0")+"-"+Utils.padLeft(entry.getStartDate().getUTCDate(),2,"0");var G=entry.getEndDate().getUTCFullYear()+"-"+Utils.padLeft(entry.getEndDate().getUTCMonth()+1,2,"0")+"-"+Utils.padLeft(entry.getEndDate().getUTCDate(),2,"0");H+="Date: "+F+" - "+G+" UTC";C.gridPopup.html(H);C.gridPopup.show();C.gridPopup.position({of:$(this),at:"left bottom",my:"left top",collision:"none none"});C.gridPopup.position({of:$(this),my:"left top",at:"left bottom",collision:"none none"})})},makeFramework:function(z){var B="";var C="click:zoom in;shift-click:zoom out;command/ctrl click: reset";B+=HtmlUtils.openDiv(["class","display-grid","id",this.getDomId(k)]);B+=HtmlUtils.div(["class","display-grid-popup ramadda-popup"],"");B+=HtmlUtils.openTag("table",["border","0","class","","cellspacing","0","cellspacing","0","width","100%","style","height:100%;"]);B+=HtmlUtils.openTag("tr",["valign","bottom"]);B+=HtmlUtils.tag("td");B+=HtmlUtils.tag("td",[],HtmlUtils.div(["id",this.getDomId(l)],""));B+=HtmlUtils.closeTag("tr");B+=HtmlUtils.openTag("tr",["style","height:100%;"]);B+=HtmlUtils.openTag("td",["style","height:100%;"]);B+=HtmlUtils.openDiv(["class","display-grid-axis-left ramadda-noselect","id",this.getDomId(e)]);B+=HtmlUtils.closeDiv();B+=HtmlUtils.closeDiv();B+=HtmlUtils.closeTag("td");B+=HtmlUtils.openTag("td",["style","height:"+this.getProperty("height","400")+"px"]);B+=HtmlUtils.openDiv(["class","display-grid-canvas ramadda-noselect","id",this.getDomId(d)]);B+=HtmlUtils.closeDiv();B+=HtmlUtils.closeDiv();B+=HtmlUtils.closeTag("td");B+=HtmlUtils.closeTag("tr");B+=HtmlUtils.openTag("tr",[]);B+=HtmlUtils.tag("td",["width","100"],"&nbsp;");B+=HtmlUtils.openTag("td",[]);B+=HtmlUtils.div(["class","display-grid-axis-bottom ramadda-noselect","title",C,"id",this.getDomId(o)],"");B+=HtmlUtils.closeTag("table");B+=HtmlUtils.closeTag("td");return B},getXAxisType:function(){return this.getProperty(v,"date")},getYAxisType:function(){return this.getProperty(g,"month")},getXAxisAscending:function(){return this.getProperty(p,true)},getYAxisAscending:function(){return this.getProperty(t,true)},getXAxisScale:function(){return this.getProperty(q,true)},getYAxisScale:function(){return this.getProperty(y,false)},makeGrid:function(K){var H=this.getProperty(b,true);var J=this.getProperty(f,true);if(!this.minDate){var G=null;var I=null;for(var N=0;N<K.length;N++){var B=K[N];G=G==null?B.getStartDate():(G.getTime()>B.getStartDate().getTime()?B.getStartDate():G);I=I==null?B.getEndDate():(I.getTime()<B.getEndDate().getTime()?B.getEndDate():I)}this.minDate=new Date(Date.UTC(G.getUTCFullYear(),0,1));this.maxDate=new Date(Date.UTC(I.getUTCFullYear()+1,0,1))}var C={width:this.canvas.width(),height:this.canvas.height(),Y:{vertical:true,axisType:this.getYAxisType(),ascending:this.getYAxisAscending(),scale:this.getYAxisScale(),skip:1,maxTicks:Math.ceil(this.canvas.height()/80),minDate:this.minDate,maxDate:this.maxDate,ticks:[],lines:"",html:"",minDate:this.minDate,maxDate:this.maxDate},X:{vertical:false,axisType:this.getXAxisType(),ascending:this.getXAxisAscending(),scale:this.getXAxisScale(),skip:1,maxTicks:Math.ceil(this.canvas.width()/80),minDate:this.minDate,maxDate:this.maxDate,ticks:[],lines:"",html:""}};if(!this.axis){this.axis=C}else{if(this.axis.X.minDate){C.X.minDate=this.axis.X.minDate;C.X.maxDate=this.axis.X.maxDate}else{this.axis.X.minDate=C.X.minDate;this.axis.X.maxDate=C.X.maxDate}if(this.axis.Y.minDate){C.Y.minDate=this.axis.Y.minDate;C.Y.maxDate=this.axis.Y.maxDate}else{this.axis.Y.minDate=C.Y.minDate;this.axis.Y.maxDate=C.Y.maxDate}}if(C.Y.axisType=="size"){this.calculateSizeAxis(C.Y)}else{if(C.Y.axisType=="date"){this.calculateDateAxis(C.Y)}else{this.calculateMonthAxis(C.Y)}}for(var N=0;N<C.Y.ticks.length;N++){var O=C.Y.ticks[N];var P=(C.Y.ascending?"bottom:":"top:")+O.percent+"%;";var P="bottom:"+O.percent+"%;";var Q=O.major?"display-grid-hline-major":"display-grid-hline";C.Y.lines+=HtmlUtils.div(["style",P,"class",Q]," ");C.Y.html+=HtmlUtils.div(["style",P,"class","display-grid-axis-left-tick"],O.label+" "+HtmlUtils.div(["class","display-grid-htick"],""))}if(C.X.axisType=="size"){this.calculateSizeAxis(C.X)}else{if(C.X.axisType=="date"){this.calculateDateAxis(C.X)}else{this.calculateMonthAxis(C.X)}}for(var N=0;N<C.X.ticks.length;N++){var O=C.X.ticks[N];if(O.percent>0){var Q=O.major?"display-grid-vline-major":"display-grid-vline";C.X.lines+=HtmlUtils.div(["style","left:"+O.percent+"%;","class",Q]," ")}C.X.html+=HtmlUtils.div(["style","left:"+O.percent+"%;","class","display-grid-axis-bottom-tick"],HtmlUtils.div(["class","display-grid-vtick"],"")+" "+O.label)}var M="";var z={};for(var N=0;N<K.length;N++){var B=K[N];var R=this[C.Y.calculatePercent].call(this,B,C.Y);var D=this[C.X.calculatePercent].call(this,B,C.X);if(R.p1<0){R.p2=R.p2+R.p1;R.p1=0}if(R.p1+R.p2>100){R.p2=100-R.p1}var P="";var F="";if(C.X.ascending){P+="left:"+D.p1+"%;";F+="left:"+D.p1+"%;"}else{P+="right:"+D.p1+"%;";F+="left:"+(100-D.p2)+"%;"}if(C.X.scale){if(D.delta>1){P+="width:"+D.delta+"%;"}else{P+="width:"+this.getProperty("fixedWidth","5")+"px;"}}var E=F;if(C.Y.ascending){P+=" bottom:"+R.p2+"%;";F+=" bottom:"+R.p2+"%;";E+=" bottom:"+R.p2+"%;"}else{P+=" top:"+R.p2+"%;";F+=" top:"+R.p2+"%;";E+=" top:"+R.p2+"%;";E+="margin-top:-15px;"}if(C.Y.scale){if(R.p2>1){P+="height:"+R.delta+"%;"}else{P+="height:"+this.getProperty("fixedHeight","5")+"px;"}}if(B.getName().includes("rilsd")){console.log("pos:"+E)}if(H){M+=HtmlUtils.div(["class","display-grid-entry-icon display-grid-entry","entryid",B.getId(),"index",N,"style",F],B.getIconImage())}var T=Math.round(D.p1)+"---"+Math.round(R.p1);if(J&&!z[T]){z[T]=true;var S=B.getName().replace(/ /g,"&nbsp;");M+=HtmlUtils.div(["class","display-grid-entry-text display-grid-entry","entryid",B.getId(),"index",N,"style",E],S)}var L=P+"background:"+this.getProperty(x,"lightblue");M+=HtmlUtils.div(["class","display-grid-entry-box display-grid-entry","itemtype","box","entryid",B.getId(),"style",L,"index",N],"")}this.jq(e).html(C.Y.html);this.jq(d).html(C.Y.lines+C.X.lines+M);this.jq(o).html(C.X.html);this.initGrid(K)},calculateSizeAxis:function(B){var D=Number.MAX_VALUE;var z=Number.MIN_VALUE;for(var C=0;C<this.entries.length;C++){var E=this.entries[C];D=Math.min(D,E.getSize());z=Math.max(z,E.getSize())}},checkOrder:function(B,z){return{p1:z.p1,p2:z.p2,delta:Math.abs(z.p2-z.p1)}},calculateDatePercent:function(B,z){var D=100*(B.getStartDate().getTime()-z.min)/z.range;var C=100*(B.getEndDate().getTime()-z.min)/z.range;return this.checkOrder(z,{p1:D,p2:C,delta:Math.abs(C-D)})},calculateMonthPercent:function(E,z){var F=E.getStartDate();var D=E.getEndDate();var C=new Date(Date.UTC(1,F.getUTCMonth(),F.getUTCDate()));var B=new Date(Date.UTC(1,D.getUTCMonth(),D.getUTCDate()));var H=100*((C.getTime()-z.min)/z.range);var G=100*((B.getTime()-z.min)/z.range);if(E.getName().includes("rilsd")){console.log("t1:"+C);console.log("t2:"+B);console.log("before:"+H+" "+G)}return this.checkOrder(z,{p1:H,p2:G,delta:Math.abs(G-H)})},calculateMonthAxis:function(B){B.calculatePercent="calculateMonthPercent";B.minDate=new Date(Date.UTC(0,11,15));B.maxDate=new Date(Date.UTC(1,11,31));B.min=B.minDate.getTime();B.max=B.maxDate.getTime();B.range=B.max-B.min;var z=Utils.getMonthShortNames();for(var E=0;E<z.length;E++){var D=new Date(Date.UTC(1,E));var C=(B.maxDate.getTime()-D.getTime())/B.range;if(B.ascending){C=1-C}B.ticks.push({percent:100*C,label:z[E],major:false})}},calculateDateAxis:function(B){B.calculatePercent="calculateDatePercent";var J=B.maxDate.getUTCFullYear()-B.minDate.getUTCFullYear();var G=J;B.type="year";B.skip=Math.max(1,Math.floor(J/B.maxTicks));if((J/B.skip)<=(B.maxTicks/2)){var O=0;var C=new Date(B.minDate.getTime());while(C.getTime()<B.maxDate.getTime()){Utils.incrementMonth(C);O++}B.skip=Math.max(1,Math.floor(O/B.maxTicks));B.type="month";if((O/B.skip)<=(B.maxTicks/2)){var C=new Date(B.minDate.getTime());var D=0;while(C.getTime()<B.maxDate.getTime()){Utils.incrementDay(C);D++}B.skip=Math.max(1,Math.floor(D/B.maxTicks));B.type="day"}}B.min=B.minDate.getTime();B.max=B.maxDate.getTime();B.range=B.max-B.min;var z=Utils.getMonthShortNames();var E=null;var F=null;var M;if(B.type=="year"){M=new Date(Date.UTC(B.minDate.getUTCFullYear()))}else{if(B.type=="month"){M=new Date(Date.UTC(B.minDate.getUTCFullYear(),B.minDate.getUTCMonth()))}else{M=new Date(Date.UTC(B.minDate.getUTCFullYear(),B.minDate.getUTCMonth(),B.minDate.getUTCDate()))}}while(M.getTime()<B.maxDate.getTime()){var I=(M.getTime()-B.minDate.getTime())/B.range;if(!B.ascending){I=(1-I)}I=100*I;if(I>=0&&I<100){var N="";var L=M.getUTCFullYear();var H=M.getUTCMonth();var K=false;if(B.type=="year"){N=L}else{if(B.type=="month"){N=z[M.getUTCMonth()];if(E!=L){N=N+"<br>"+L;E=L;K=true}}else{N=M.getUTCDate();if(E!=L||F!=H){N=N+"<br>"+z[H]+" "+L;E=L;F=H;K=true}}}B.ticks.push({percent:I,label:N,major:K})}if(B.type=="year"){Utils.incrementYear(M,B.skip)}else{if(B.type=="month"){Utils.incrementMonth(M,B.skip)}else{Utils.incrementDay(M,B.skip)}}}}})}function RamaddaMetadataDisplay(e,d,c){if(c.formOpen==null){c.formOpen=false}var b;RamaddaUtil.inherit(this,b=new RamaddaSearcher(e,d,DISPLAY_METADATA,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{haveDisplayed:false,initDisplay:function(){this.createUI();this.setContents(this.getDefaultHtml());b.initDisplay.apply(this);if(this.haveDisplayed&&this.entryList){this.entryListChanged(this.entryList)}this.haveDisplayed=true},entryListChanged:function(s){this.entryList=s;var C=this.entryList.getEntries();if(C.length==0){this.writeHtml(ID_ENTRIES,"Nothing found");this.writeHtml(ID_RESULTS,"&nbsp;");return}var l=[];var q={};var Q={};for(var M=0;M<C.length;M++){var g=C[M];var B=g.getMetadata();for(var L=0;L<B.length;L++){var I=B[L];if(Q[I.type]==null){Q[I.type]="";l.push(I.type)}q[B[L].type]=B[L].label}}var z="";z+=HtmlUtils.openTag(TAG_TABLE,[ATTR_CLASS,"display-metadata-table",ATTR_WIDTH,"100%","cellpadding","5","cellspacing","0"]);var k=this.findEntryType(this.searchSettings.entryType);var y="Entry";if(k!=null){y=k.getLabel()}this.writeHtml(ID_RESULTS,this.getResultsHeader(C));var E=null;var h=this.getProperty("metadataTypes",null);if(h!=null){E=h.split(",")}else{E=l;E.sort()}var H={"content.pagestyle":true,"content.pagetemplate":true,"content.sort":true,"spatial.polygon":true};var p=[];p.push(HtmlUtils.th([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtils.b(y)));for(var M=0;M<E.length;M++){var k=E[M];if(H[k]){continue}var x=q[E[M]];if(x==null){x=E[M]}p.push(HtmlUtils.th([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtils.b(x)))}var N=HtmlUtils.tr(["valign","bottom"],HtmlUtils.join(p,""));z+=N;var F="<div class=display-metadata-divider></div>";var K=this.missingMessage;if(K=null){K="&nbsp;"}for(var t=0;t<C.length;t++){var g=C[t];var B=g.getMetadata();var v=[];var u=this.getDomId("entrylink"+g.getIdForDom());var w=g.getLink(g.getIconImage()+" "+g.getName());v.push(HtmlUtils.td([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtils.div([ATTR_CLASS,"display-metadata-entrylink"],w)));for(var n=0;n<E.length;n++){var P=E[n];if(H[P]){continue}var f=null;for(var L=0;L<B.length;L++){var I=B[L];if(I.type==P){var O=null;if(I.type=="content.thumbnail"||I.type=="content.logo"){var o=this.getRamadda().getRoot()+"/metadata/view/"+I.value.attr1+"?element=1&entryid="+g.getId()+"&metadata.id="+I.id;O=HtmlUtils.image(o,[ATTR_WIDTH,"100"])}else{if(I.type=="content.url"||I.type=="dif.related_url"){var x=I.value.attr2;if(x==null||x==""){x=I.value.attr1}O=HtmlUtils.href(I.value.attr1,x)}else{if(I.type=="content.attachment"){var G=I.value.attr1.split("_file_");var J=G[1];var o=this.getRamadda().getRoot()+"/metadata/view/"+I.value.attr1+"?element=1&entryid="+g.getId()+"&metadata.id="+I.id;O=HtmlUtils.href(o,J)}else{O=I.value.attr1;if(I.value.attr2&&I.value.attr2.trim().length>0){O+=" - "+I.value.attr2}}}}if(O!=null){if(f==null){f=""}else{f+=F}f+=HtmlUtils.div([ATTR_CLASS,"display-metadata-item"],O)}}}if(f==null){f=K}if(f==null){f=""}var D=HtmlUtils.tag(TAG_A,[ATTR_STYLE,"color:#000;",ATTR_HREF,this.getRamadda().getRoot()+"/metadata/addform?entryid="+g.getId()+"&metadata.type="+P,"target","_blank","alt","Add metadata",ATTR_TITLE,"Add metadata"],"+");D=HtmlUtils.div(["class","display-metadata-table-add"],D);var R=D+F;if(f.length>0){R+=f}v.push(HtmlUtils.td([ATTR_CLASS,"display-metadata-table-cell"],HtmlUtils.div([ATTR_CLASS,"display-metadata-table-cell-contents"],R)))}z+=HtmlUtils.tr(["valign","top"],HtmlUtils.join(v,""));if(((t+1)%10)==0){z+=N}}z+=HtmlUtils.closeTag(TAG_TABLE);this.jq(ID_ENTRIES).html(z)}})}function RamaddaTimelineDisplay(e,d,c){if(c.formOpen==null){c.formOpen=false}var b;RamaddaUtil.inherit(this,b=new RamaddaSearcher(e,d,DISPLAY_TIMELINE,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){this.createUI();this.setContents(this.getDefaultHtml());b.initDisplay.apply(this)},entryListChanged:function(m){this.entryList=m;var f=this.entryList.getEntries();var h="";if(f.length==0){this.writeHtml(ID_ENTRIES,"Nothing found");this.writeHtml(ID_RESULTS,"&nbsp;");return}var l={timeline:{headline:"The Main Timeline Headline Goes here",type:"default",text:"<p>Intro body text goes here, some HTML is ok</p>",asset:{media:"http://yourdomain_or_socialmedialink_goes_here.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"},date:[{startDate:"2011,12,10",endDate:"2011,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional",classname:"optionaluniqueclassnamecanbeaddedhere",asset:{media:"http://twitter.com/ArjunaSoriano/status/164181156147900416",thumbnail:"optional-32x32px.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"}},{startDate:"2012,12,10",endDate:"2012,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional",classname:"optionaluniqueclassnamecanbeaddedhere",asset:{media:"http://twitter.com/ArjunaSoriano/status/164181156147900416",thumbnail:"optional-32x32px.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"}},{startDate:"2013,12,10",endDate:"2013,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional",classname:"optionaluniqueclassnamecanbeaddedhere",asset:{media:"http://twitter.com/ArjunaSoriano/status/164181156147900416",thumbnail:"optional-32x32px.jpg",credit:"Credit Name Goes Here",caption:"Caption text goes here"}}],era:[{startDate:"2011,12,10",endDate:"2011,12,11",headline:"Headline Goes Here",text:"<p>Body text goes here, some HTML is OK</p>",tag:"This is Optional"}]}};for(var g=0;g<f.length;g++){var k=f[g]}createStoryJS({type:"timeline",width:"800",height:"600",source:l,embed_id:this.getDomId(ID_ENTRIES)})}})}function RamaddaEntrydisplayDisplay(g,f,c){var b;$.extend(this,{sourceEntry:c.sourceEntry});RamaddaUtil.inherit(this,b=new RamaddaDisplay(g,f,DISPLAY_ENTRYDISPLAY,c));if(c.sourceEntry==null&&c.entryId!=null){var e=this;var d=function(h){var k=h[0];e.sourceEntry=k;e.initDisplay()};c.sourceEntry=this.getEntry(c.entryId,d)}addRamaddaDisplay(this);$.extend(this,{selectedEntry:null,initDisplay:function(){this.createUI();var k=this.title;if(this.sourceEntry!=null){this.addEntryHtml(this.sourceEntry);var h=this.sourceEntry.getEntryUrl();if(k==null){k=this.sourceEntry.getName()}k=HtmlUtils.tag("a",["href",h,"title",this.sourceEntry.getName(),"alt",this.sourceEntry.getName()],k)}else{this.addEntryHtml(this.selectedEntry);if(k==null){k="Entry Display"}}this.setDisplayTitle(k)},handleEventEntrySelection:function(m,h){if(this.sourceEntry!=null){return}var k=h.selected;var l=h.entry;if(!k){if(this.selectedEntry!=l){return}this.selectedEntry=null;this.setContents("");return}this.selectedEntry=l;this.addEntryHtml(this.selectedEntry)},getEntries:function(){return[this.sourceEntry]},addEntryHtml:function(k){if(k==null){this.setContents("&nbsp;");return}var h=this.getEntryHtml(k,{showHeader:false});this.setContents(h);this.entryHtmlHasBeenDisplayed(k)}})}function RamaddaOperandsDisplay(h,g,d){var e=TAG_SELECT;var c="select1";var b="select2";var f="newdisplay";$.extend(this,new RamaddaEntryDisplay(h,g,DISPLAY_OPERANDS,d));addRamaddaDisplay(this);$.extend(this,{baseUrl:null,initDisplay:function(){this.createUI();this.baseUrl=this.getRamadda().getSearchUrl(this.searchSettings,OUTPUT_JSON);if(this.entryList==null){this.entryList=new EntryList(this.getRamadda(),jsonUrl,this)}var k="";k+=HtmlUtils.div([ATTR_ID,this.getDomId(ID_ENTRIES),ATTR_CLASS,this.getClass("entries")],"");this.setContents(k)},entryListChanged:function(k){var o="<form>";o+="<p>";o+=HtmlUtils.openTag(TAG_TABLE,[ATTR_CLASS,"formtable","cellspacing","0","cellspacing","0"]);var p=this.entryList.getEntries();var l=this.getGet();for(var m=1;m<=2;m++){var s=HtmlUtils.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(e+m)]);s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,""],"-- Select --");for(var n=0;n<p.length;n++){var t=p[n];var q=t.getIconImage()+" "+t.getName();s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,t.getName(),ATTR_VALUE,t.getId()],t.getName())}s+=HtmlUtils.closeTag(TAG_SELECT);o+=HtmlUtils.formEntry("Data:",s)}var s=HtmlUtils.openTag(TAG_SELECT,[ATTR_ID,this.getDomId(ID_CHARTTYPE)]);s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"linechart"],"Line chart");s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"barchart"],"Bar chart");s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"barstack"],"Stacked bars");s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"bartable"],"Bar table");s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"piechart"],"Pie chart");s+=HtmlUtils.tag(TAG_OPTION,[ATTR_TITLE,"",ATTR_VALUE,"scatterplot"],"Scatter Plot");s+=HtmlUtils.closeTag(TAG_SELECT);o+=HtmlUtils.formEntry("Chart Type:",s);o+=HtmlUtils.closeTag(TAG_TABLE);o+="<p>";o+=HtmlUtils.tag(TAG_DIV,[ATTR_CLASS,"display-button",ATTR_ID,this.getDomId(f)],"New Chart");o+="<p>";o+="</form>";this.writeHtml(ID_ENTRIES,o);var u=this;this.jq(f).button().click(function(v){u.createDisplay()})},createDisplay:function(){var p=this.getEntry(this.jq(c).val());var o=this.getEntry(this.jq(b).val());if(p==null){alert("No data selected");return}var n=[];n.push(new PointData(p.getName(),null,null,ramaddaBaseUrl+"/entry/show?&output=points.product&product=points.json&numpoints=1000&entryid="+p.getId()));if(o!=null){n.push(new PointData(o.getName(),null,null,ramaddaBaseUrl+"/entry/show?&output=points.product&product=points.json&numpoints=1000&entryid="+o.getId()))}var l="average";var m=new DerivedPointData(this.displayManager,"Derived Data",n,l);var k=m;var q=this.jq(ID_CHARTTYPE).val();h.createDisplay(q,{layoutFixed:false,data:k})}})}function RamaddaRepositoriesDisplay(d,c,b){RamaddaUtil.inherit(this,new RamaddaEntryDisplay(d,c,DISPLAY_REPOSITORIES,b));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){var e=this;this.createUI();var h="";if(this.ramaddas.length==0){h+=this.getMessage("No repositories specified")}else{h+=this.getMessage("Loading repository listing")}this.numberWithTypes=0;this.finishedInitDisplay=false;if(this.ramaddas.length>1){if(this.ramaddas[this.ramaddas.length-1].getRoot()=="all"){this.ramaddas.splice(this.ramaddas.length-1,1)}}for(var g=0;g<this.ramaddas.length;g++){if(g==0){}var k=this.ramaddas[g];var f=k.getEntryTypes(function(m,l){e.gotTypes(m,l)});if(f!=null){this.numberWithTypes++}}this.setDisplayTitle("Repositories");this.setContents(h);this.finishedInitDisplay=true;this.displayRepositories()},displayRepositories:function(){if(!this.finishedInitDisplay||this.numberWithTypes!=this.ramaddas.length){return}var B={};var v=[];var w="";w+=HtmlUtils.openTag(TAG_TABLE,[ATTR_CLASS,"display-repositories-table",ATTR_WIDTH,"100%",ATTR_BORDER,"1","cellspacing","0","cellpadding","5"]);for(var z=0;z<this.ramaddas.length;z++){var C=this.ramaddas[z];var x=C.getEntryTypes();for(var q=0;q<x.length;q++){var g=x[q];if(B[g.getId()]==null){B[g.getId()]=g;v.push(g)}}}w+=HtmlUtils.openTag(TAG_TR,["valign","bottom"]);w+=HtmlUtils.th([ATTR_CLASS,"display-repositories-table-header"],"Type");for(var z=0;z<this.ramaddas.length;z++){var C=this.ramaddas[z];var m=HtmlUtils.href(C.getRoot(),C.getName());w+=HtmlUtils.th([ATTR_CLASS,"display-repositories-table-header"],m)}w+="</tr>";var p=[];if(this.categories!=null){p=this.categories.split(",")}var u={};var t=[];for(var q=0;q<v.length;q++){var g=v[q];var l="";l+="<tr>";l+=HtmlUtils.td([],HtmlUtils.image(g.getIcon())+" "+g.getLabel());for(var z=0;z<this.ramaddas.length;z++){var C=this.ramaddas[z];var e=C.getEntryType(g.getId());var h="";if(e==null){l+=HtmlUtils.td([ATTR_CLASS,"display-repositories-table-type-hasnot"],"")}else{var o=HtmlUtils.tag(TAG_A,["href",C.getRoot()+"/search/type/"+e.getId(),"target","_blank"],e.getEntryCount());l+=HtmlUtils.td([ATTR_ALIGN,"right",ATTR_CLASS,"display-repositories-table-type-has"],o)}}l+="</tr>";var f=u[g.getCategory()];if(f==null){f=[];u[g.getCategory()]=f;t.push(g.getCategory())}f.push(l)}for(var z=0;z<t.length;z++){var k=t[z];if(p.length>0){var y=false;for(var n=0;n<p.length;n++){if(k==p[n]){y=true;break}if(k.match(p[n])){y=true;break}}if(!y){continue}}var s=u[k];w+="<tr>";w+=HtmlUtils.th(["colspan",""+(1+this.ramaddas.length)],k);w+="</tr>";for(var l=0;l<s.length;l++){w+=s[l]}}w+=HtmlUtils.closeTag(HtmlUtils.TAG_TABLE);this.setContents(w)},gotTypes:function(f,e){this.numberWithTypes++;this.displayRepositories()}})}var RamaddaGalleryDisplay=RamaddaEntrygalleryDisplay;function RamaddaExampleDisplay(f,e,c){var b="click";var d="data";RamaddaUtil.inherit(this,new RamaddaDisplay(f,e,"example",c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{initDisplay:function(){this.createUI();var g=this.getGet();var h="<p>";h+=HtmlUtils.onClick(g+".click();",HtmlUtils.div([ATTR_ID,this.getDomId(b)],"Click me"));h+="<p>";h+=HtmlUtils.div([ATTR_ID,this.getDomId(d)],"");this.setContents(h);this.updateUI()},needsData:function(){return true},updateUI:function(){var g=this.getData();if(g==null){return}var k=g.getRecordFields();var h=g.getRecords();var l="";l+="#records:"+h.length;this.jq(d).html(l)},handleEventRecordSelection:function(h,g){},click:function(){this.jq(b).html("Click again")}})}var PROP_LAYOUT_TYPE="layoutType";var PROP_LAYOUT_COLUMNS="layoutColumns";var PROP_SHOW_MAP="showMap";var PROP_SHOW_MENU="showMenu";var PROP_FROMDATE="fromDate";var PROP_TODATE="toDate";var DISPLAY_MULTI="multi";addGlobalDisplayType({type:DISPLAY_MULTI,label:"Multi Chart",requiresData:true,forUser:false,category:"Misc"});function addDisplayManager(b){if(window.globalDisplayManagers==null){window.globalDisplayManagers={}}window.globalDisplayManagers[b.getId()]=b;window.globalDisplayManager=b}function addGlobalDisplayType(b){if(window.globalDisplayTypes==null){window.globalDisplayTypes=[]}window.globalDisplayTypes.push(b)}function getOrCreateDisplayManager(e,b,c){if(!c){var d=getDisplayManager(e);if(d!=null){return d}if(window.globalDisplayManager!=null){return window.globalDisplayManager}}var d=new DisplayManager(e,b);if(window.globalDisplayManager==null){window.globalDisplayManager=d}return d}function getDisplayManager(c){if(window.globalDisplayManagers==null){return null}var b=window.globalDisplayManagers[c];return b}var ID_DISPLAYS="displays";function DisplayManager(argId,argProperties){var ID_MENU_BUTTON="menu_button";var ID_MENU_CONTAINER="menu_container";var ID_MENU_OUTER="menu_outer";var ID_MENU_INNER="menu_inner";RamaddaUtil.inherit(this,this.SUPER=new DisplayThing(argId,argProperties));addRamaddaDisplay(this);RamaddaUtil.initMembers(this,{dataList:[],displayTypes:[],initMapBounds:null});RamaddaUtil.defineMembers(this,{group:new DisplayGroup(this,argId,argProperties),showmap:this.getProperty(PROP_SHOW_MAP,null),setDisplayReady:function(){SUPER.setDisplayReadyCall(this);this.getLayoutManager().setDisplayReady()},getLayoutManager:function(){return this.group},collectEntries:function(){var entries=this.getLayoutManager().collectEntries();return entries},getData:function(){return this.dataList},handleEventFieldValueSelect:function(source,args){this.notifyEvent("handleEventFieldValueSelected",source,args)},handleEventFieldsSelected:function(source,fields){this.notifyEvent("handleEventFieldsSelected",source,fields)},handleEventPropertyChanged:function(source,prop){this.notifyEvent("handleEventPropertyChanged",source,prop)},handleEventEntriesChanged:function(source,entries){this.notifyEvent("handleEventEntriesChanged",source,entries)},handleEventMapBoundsChanged:function(source,bounds,forceSet){var args={bounds:bounds,force:forceSet};this.notifyEvent("handleEventMapBoundsChanged",source,args)},addMapLayer:function(source,entry){this.notifyEvent("addMapLayer",source,{entry:entry})},handleEventMapClick:function(mapDisplay,lon,lat){var indexObj=[];var records=null;for(var i=0;i<this.dataList.length;i++){var pointData=this.dataList[i];records=pointData.getRecords();if(records!=null){break}}var indexObj=[];var closest=RecordUtil.findClosest(records,lon,lat,indexObj);if(closest!=null){this.propagateEventRecordSelection(mapDisplay,pointData,{index:indexObj.index})}this.notifyEvent("handleEventMapClick",mapDisplay,{display:mapDisplay,lon:lon,lat:lat})},propagateEventRecordSelection:function(source,pointData,args){var index=args.index;if(pointData==null&&this.dataList.length>0){pointData=this.dataList[0]}var fields=pointData.getRecordFields();var records=pointData.getRecords();if(records==null){return}if(index<0||index>=records.length){console.log("propagateEventRecordSelection: bad index= "+index);return}var record=records[index];if(record==null){return}var values=this.getRecordHtml(record,fields);if(source.recordSelectionCallback){var func=source.recordSelectionCallback;if((typeof func)=="string"){func=window[func]}func({display:source,pointData:pointData,index:index,pointRecord:record})}var params={index:index,record:record,html:values,data:pointData};this.notifyEvent("handleEventRecordSelection",source,params);var entries=source.getEntries();if(entries!=null&&entries.length>0){this.handleEventEntrySelection(source,{entry:entries[0],selected:true})}},handleEventEntrySelection:function(source,props){this.notifyEvent("handleEventEntrySelection",source,props)},handleEventEntryMouseover:function(source,props){this.notifyEvent("handleEventEntryMouseover",source,props)},handleEventEntryMouseout:function(source,props){this.notifyEvent("handleEventEntryMouseout",source,props)},handleEventPointDataLoaded:function(source,pointData){this.notifyEvent("handleEventPointDataLoaded",source,pointData)},ranges:{},setRange:function(field,range){if(this.ranges[field.getId()]==null){this.ranges[field.getId()]=range}},getRange:function(field){return this.ranges[field.getId()]},makeMainMenu:function(){if(!this.getProperty(PROP_SHOW_MENU,true)){return""}var get="getDisplayManager('"+this.getId()+"')";var layout="getDisplayManager('"+this.getId()+"').getLayoutManager()";var html="";var newMenus={};var cats=[];var chartMenu="";var displayTypes=[];if(window.globalDisplayTypes!=null){displayTypes=window.globalDisplayTypes}for(var i=0;i<displayTypes.length;i++){var type=displayTypes[i];if(Utils.isDefined(type.forUser)&&!type.forUser){continue}var category=type.category;if(!category){category="Misc"}if(newMenus[category]==null){newMenus[category]="";cats.push(category)}newMenus[category]+=HtmlUtils.tag(TAG_LI,[],HtmlUtils.tag(TAG_A,["onclick",get+".userCreateDisplay('"+type.type+"');"],type.label))}var newMenu="";for(var i=0;i<cats.length;i++){var cat=cats[i];if(cat=="Charts"){chartMenu=newMenus[cat]}var subMenu=HtmlUtils.tag("ul",[],newMenus[cat]);var catLabel=HtmlUtils.tag(TAG_A,[],cat);newMenu+=HtmlUtils.tag(TAG_LI,[],catLabel+subMenu)}var publishMenu=HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".publish('media_photoalbum');","New Photo Album"))+"\n"+HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".publish('wikipage');","New Wiki Page"))+"\n"+HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".publish('blogentry');","New Blog Post"))+"\n";var fileMenu=HtmlUtils.tag(TAG_LI,[],"<a>Publish</a>"+HtmlUtils.tag("ul",[],publishMenu))+"\n"+HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".copyDisplayedEntries();","Save entries"))+"\n";var titles=HtmlUtils.tag(TAG_DIV,["class","ramadda-menu-block"],"Titles: "+HtmlUtils.onClick(layout+".titlesOn();","On")+"/"+HtmlUtils.onClick(layout+".titlesOff();","Off"));var dates=HtmlUtils.tag(TAG_DIV,["class","ramadda-menu-block"],"Set date range: "+HtmlUtils.onClick(layout+".askMinDate();","Min")+"/"+HtmlUtils.onClick(layout+".askMaxDate();","Max"));var editMenu=HtmlUtils.tag(TAG_LI,[],HtmlUtils.tag(TAG_DIV,["class","ramadda-menu-block"],"Set axis range :"+HtmlUtils.onClick(layout+".askMinZAxis();","Min")+"/"+HtmlUtils.onClick(layout+".askMaxZAxis();","Max")))+HtmlUtils.tag(TAG_LI,[],dates)+HtmlUtils.tag(TAG_LI,[],titles)+"\n"+HtmlUtils.tag(TAG_LI,[],HtmlUtils.tag(TAG_DIV,["class","ramadda-menu-block"],"Details: "+HtmlUtils.onClick(layout+".detailsOn();","On",[])+"/"+HtmlUtils.onClick(layout+".detailsOff();","Off",[])))+HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".deleteAllDisplays();","Delete all displays"))+"\n";var table=HtmlUtils.tag(TAG_DIV,["class","ramadda-menu-block"],"Table: "+HtmlUtils.onClick(layout+".setLayout('table',1);","1 column")+" / "+HtmlUtils.onClick(layout+".setLayout('table',2);","2 column")+" / "+HtmlUtils.onClick(layout+".setLayout('table',3);","3 column")+" / "+HtmlUtils.onClick(layout+".setLayout('table',4);","4 column"));var layoutMenu=HtmlUtils.tag(TAG_LI,[],table)+HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".setLayout('rows');","Rows"))+"\n"+HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".setLayout('columns');","Columns"))+"\n"+HtmlUtils.tag(TAG_LI,[],HtmlUtils.onClick(layout+".setLayout('tabs');","Tabs"));var menuBar=HtmlUtils.tag(TAG_LI,[],"<a>File</a>"+HtmlUtils.tag("ul",[],fileMenu));if(chartMenu!=""){menuBar+=HtmlUtils.tag(TAG_LI,[],"<a>Charts</a>"+HtmlUtils.tag("ul",[],chartMenu))}menuBar+=HtmlUtils.tag(TAG_LI,[],"<a>Edit</a>"+HtmlUtils.tag("ul",[],editMenu))+HtmlUtils.tag(TAG_LI,[],"<a>New</a>"+HtmlUtils.tag("ul",[],newMenu))+HtmlUtils.tag(TAG_LI,[],"<a>Layout</a>"+HtmlUtils.tag("ul",[],layoutMenu));var menu=HtmlUtils.div([ATTR_CLASS,"ramadda-popup",ATTR_ID,this.getDomId(ID_MENU_OUTER)],HtmlUtils.tag("ul",[ATTR_ID,this.getDomId(ID_MENU_INNER),ATTR_CLASS,"sf-menu"],menuBar));html+=menu;return html},hasGeoMacro:function(jsonUrl){return jsonUrl.match(/(\${latitude})/g)!=null},getJsonUrl:function(jsonUrl,display,props){var fromDate=display.getProperty(PROP_FROMDATE);if(fromDate!=null){jsonUrl+="&fromdate="+fromDate}var toDate=display.getProperty(PROP_TODATE);if(toDate!=null){jsonUrl+="&todate="+toDate}if(this.hasGeoMacro(jsonUrl)){var lon=props.lon;var lat=props.lat;if((lon==null||lat==null)&&this.map!=null){var tuple=this.getPosition();if(tuple!=null){lat=tuple[0];lon=tuple[1]}}if(lon!=null&&lat!=null){jsonUrl=jsonUrl.replace("${latitude}",lat.toString());jsonUrl=jsonUrl.replace("${longitude}",lon.toString())}}jsonUrl=jsonUrl.replace("${numpoints}",1000);return jsonUrl},getDefaultData:function(){for(var i in this.dataList){var data=this.dataList[i];var records=data.getRecords();if(records!=null){return data}}if(this.dataList.length>0){return this.dataList[0]}return null},writeDisplay:function(){if(this.originalLocation==null){this.originalLocation=document.location}var url=this.originalLocation+"#";url+="&display0=linechart";for(var attr in document){}document.location=url},userCreateDisplay:function(type,props){if(props==null){props={}}props.editMode=true;if(type==DISPLAY_LABEL&&props.text==null){var text=prompt("Text");if(text==null){return}props.text=text}return this.createDisplay(type,props)},createDisplay:function(type,props){if(props==null){props={}}if(props.data!=null){var haveItAlready=false;for(var i=0;i<this.dataList.length;i++){var existingData=this.dataList[i];if(existingData.equals(props.data)){props.data=existingData;haveItAlready=true;break}}if(!haveItAlready){this.dataList.push(props.data)}}var proc=type.substring(0,1).toUpperCase()+type.substring(1);var classname=null;var names=["Ramadda"+proc+"Display",proc+"Display",proc];var func=null;var funcName=null;var msg="";for(var i=0;i<names.length;i++){msg+=("trying:"+names[i]+"\n");if(window[names[i]]!=null){funcName=names[i];func=window[names[i]];break}}if(func==null){console.log("Error: could not find display function:"+type);alert("Error: could not find display function:"+type+" msg: "+msg);return}var displayId=this.getUniqueId("display");if(props.data==null&&this.dataList.length>0){props.data=this.dataList[0]}props.createdInteractively=true;if(!props.entryId){props.entryId=this.group.entryId}var display=eval(" new "+funcName+"(this,'"+displayId+"', props);");if(display==null){console.log("Error: could not create display using:"+funcName);alert("Error: could not create display using:"+funcName);return}this.addDisplay(display);return display},pageHasLoaded:function(display){this.getLayoutManager().pageHasLoaded()},addDisplay:function(display){display.setDisplayManager(this);display.loadInitialData();this.getLayoutManager().addDisplay(display)},notifyEvent:function(func,source,data){this.getLayoutManager().notifyEvent(func,source,data)},removeDisplay:function(display){this.getLayoutManager().removeDisplay(display);this.notifyEvent("handleEventRemoveDisplay",this,display)}});addDisplayManager(this);var displaysHtml=HtmlUtils.div([ATTR_ID,this.getDomId(ID_DISPLAYS),ATTR_CLASS,"display-container"]);var html=HtmlUtils.openTag(TAG_DIV);html+=HtmlUtils.div(["id",this.getDomId(ID_MENU_CONTAINER)]);if(this.getProperty(PROP_SHOW_MENU,true)){html+=HtmlUtils.tag(TAG_A,[ATTR_CLASS,"display-menu-button",ATTR_ID,this.getDomId(ID_MENU_BUTTON)],"&nbsp;")}var targetDiv=this.getProperty("target");var _this=this;if(targetDiv!=null){$(document).ready(function(){$("#"+targetDiv).html(displaysHtml);_this.getLayoutManager().doLayout()})}else{html+=displaysHtml}html+=HtmlUtils.closeTag(TAG_DIV);$("#"+this.getId()).html(html);if(this.showmap){this.createDisplay("map")}var theDisplayManager=this;$("#"+this.getDomId(ID_MENU_BUTTON)).button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-s"}}).click(function(event){var html=theDisplayManager.makeMainMenu();theDisplayManager.jq(ID_MENU_CONTAINER).html(html);var id=theDisplayManager.getDomId(ID_MENU_OUTER);showPopup(event,theDisplayManager.getDomId(ID_MENU_BUTTON),id,false,null,"left bottom");theDisplayManager.jq(ID_MENU_INNER).superfish({speed:"fast",delay:300})})}function RamaddaMultiDisplay(d,c,b){this.props=b;let SUPER=new DisplayGroup(d,c,b,DISPLAY_MULTI);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{inInitDisplay:false,haveInited:false,needsData:function(){return true},pointDataLoaded:function(e,f,g){SUPER.pointDataLoaded.call(this,e,f,g);this.initDisplay()},processMacros:function(e,h,g){if((typeof h)!="string"){return null}var k=[];if(h.includes("${fieldLabel}")){for(i=0;i<e.length;i++){var f=h.replace("${fieldLabel}",e[i].getLabel());k.push(f)}}else{if(h.includes("${fieldId}")){for(i=0;i<e.length;i++){var f=h.replace("${fieldId}",e[i].getId());k.push(f)}}else{if(h.includes("${fieldCnt}")){var f=h.replace("${fieldCnt}",e.length);k.push(f)}else{if(h.includes("${")){}else{return null}}}}if(g){return k}return Utils.join(k,",")},initDisplay:function(){try{this.initDisplayInner()}catch(f){this.setContents(this.getMessage("An error occurred:"+f));console.log("An error occurred:"+f);console.log(f.stack)}},useChartableFields:function(){return false},initDisplayInner:function(){SUPER.initDisplay.call(this);let records=this.filterData();if(!records){this.setContents(this.getLoadingMessage());return null}var q=this.getData().getRecordFields();var n=this.getSelectedFields(q);if(n.length==0){this.setContents(this.getMessage("no fields"));return}if(this.inInitDisplay){return}if(this.haveInited){return}this.haveInited=true;this.inInitDisplay=true;var p={};var f={};var t=[];var e=0;for(a in this.props){if(a.startsWith("foreach_")){var s=this.props[a];var o;var l=this.processMacros(n,s,true);if(l){o=l}else{o=s.split(",")}a=a.substring(8);if(o.length>e){e=o.length}f[a]=o;t.push({attr:a,toks:o})}if(a.startsWith("sub_")){var s=this.props[a];a=a.substring(4);var l=this.processMacros(n,s,false);if(l){s=l}p[a]=s}}var m=HtmlUtils.div([ATTR_ID,this.getDomId(ID_DISPLAYS),ATTR_CLASS,"display-container"]);this.writeHtml(ID_DISPLAY_CONTENTS,m);var v={target:this.getDomId(ID_DISPLAYS)};v[PROP_LAYOUT_TYPE]="table";v[PROP_LAYOUT_COLUMNS]=this.getProperty(PROP_LAYOUT_COLUMNS,"2");this.displayManager=new DisplayManager(this.getId()+"_manager",v);p.layoutHere=false;if(this.props.data){p.data=this.props.data}var u=this.getProperty("subType","table");if(e==0){e=1}for(var k=0;k<e;k++){var h={};$.extend(h,p);for(var g=0;g<t.length;g++){if(k<t[g].toks.length){h[t[g].attr]=t[g].toks[k]}}if(h.fields){h.fields=h.fields.split(",")}this.displayManager.createDisplay(u,h)}this.inInitDisplay=false}})}var DISPLAY_MAP="map";var displayMapMarkers=["marker.png","marker-blue.png","marker-gold.png","marker-green.png"];var displayMapCurrentMarker=-1;var displayMapUrlToVectorListeners={};var displayMapMarkerIcons={};function displayMapGetMarkerIcon(){displayMapCurrentMarker++;if(displayMapCurrentMarker>=displayMapMarkers.length){displayMapCurrentMarker=0}return ramaddaBaseUrl+"/lib/openlayers/v2/img/"+displayMapMarkers[displayMapCurrentMarker]}addGlobalDisplayType({type:DISPLAY_MAP,label:"Map"});function MapFeature(c,b){RamaddaUtil.defineMembers(this,{source:c,points:b})}function RamaddaMapDisplay(k,h,d){var f="latfield";var g="lonfield";var c="map";var e="bottom";var b;RamaddaUtil.defineMembers(this,{showLocationReadout:false,showBoxes:true,showPercent:false,percentFields:null,kmlLayer:null,kmlLayerName:"",geojsonLayer:null,geojsonLayerName:"",theMap:null});RamaddaUtil.inherit(this,b=new RamaddaDisplay(k,h,DISPLAY_MAP,d));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{mapBoundsSet:false,features:[],myMarkers:{},mapEntryInfos:{},sourceToLine:{},sourceToPoints:{},snarf:true,initDisplay:function(){b.initDisplay.call(this);var q=this;var m="";var o="min-height:200px;";var n=this.getWidth();if(Utils.isDefined(n)){if(n>0){o+="width:"+n+"px; "}else{if(n<0){o+="width:"+(-n)+"%;"}else{if(n!=""){o+="width:"+n+";"}}}}var l=this.getProperty("height",300);if(l>0){o+=" height:"+l+"px; "}else{if(l<0){o+=" height:"+(-l)+"%; "}}m+=HtmlUtils.div([ATTR_CLASS,"display-map-map","style",o,ATTR_ID,this.getDomId(c)]);m+=HtmlUtils.div([ATTR_CLASS,"",ATTR_ID,this.getDomId(e)]);if(this.showLocationReadout){m+=HtmlUtils.openTag(TAG_DIV,[ATTR_CLASS,"display-map-latlon"]);m+=HtmlUtils.openTag("form");m+="Latitude: "+HtmlUtils.input(this.getDomId(f),"",["size","7",ATTR_ID,this.getDomId(f)]);m+="  ";m+="Longitude: "+HtmlUtils.input(this.getDomId(g),"",["size","7",ATTR_ID,this.getDomId(g)]);m+=HtmlUtils.closeTag("form");m+=HtmlUtils.closeTag(TAG_DIV)}this.setContents(m);if(!this.map){this.createMap()}else{this.map.setMapDiv(this.getDomId(c))}if(!this.haveCalledUpdateUI){var p=function(){q.updateUI()};setTimeout(p,1)}},checkLayout:function(){if(!this.map){return}var l=this.jq(c);if(l.width()>0&&this.lastWidth!=l.width()&&this.map){this.lastWidth=l.width();this.map.getMap().updateSize()}},createMap:function(){var x=this;var n={defaultMapLayer:this.getProperty("defaultMapLayer",map_default_layer)};var v=this.getProperty("displayDiv",null);if(v){n.displayDiv=v}var m=this.getProperty("mapLayers",null);if(m){n.mapLayers=[m]}this.map=this.getProperty("theMap",null);if(this.map){this.map.setMapDiv(this.getDomId(c))}else{this.map=new RepositoryMap(this.getDomId(c),n);this.lastWidth=this.jq(c).width()}if(this.doDisplayMap()){this.map.setDefaultCanSelect(false)}this.map.initMap(false);this.map.addRegionSelectorControl(function(B){x.getDisplayManager().handleEventMapBoundsChanged(this,B,true)});this.map.addClickHandler(this.getDomId(g),this.getDomId(f),null,this);this.map.map.events.register("zoomend","",function(){x.mapBoundsChanged()});this.map.map.events.register("moveend","",function(){x.mapBoundsChanged()});if(this.getProperty("bounds")&&this.getProperty("showBounds",true)){var u=this.getProperty("bounds","").split(",");if(u.length==4){if(this.getProperty("showBounds"),true){var w={};if(this.getProperty("boundsColor")){w.strokeColor=this.getProperty("boundsColor","")}this.map.addRectangle("bounds",parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]),w,"")}this.setInitMapBounds(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]))}}var z=this.features;this.features=[];for(var p=0;p<z.length;p++){this.addFeature(z[p])}var s=this.getDisplayManager().collectEntries();for(var p=0;p<s.length;p++){var o=s[p];this.handleEventEntriesChanged(o.source,o.entries)}if(this.layerEntries){var q=function(B){_this.handleLayerSelect(B)};var t=function(B){_this.handleLayerUnselect(B)};var u=this.layerEntries.split(",");for(var p=0;p<u.length;p++){var y=u[p];var l=ramaddaBaseUrl+"/entry/show?output=shapefile.kml&entryid="+y;this.map.addKMLLayer("layer",l,true,q,t)}}if(x.kmlLayer!=null){var l=ramaddaBaseUrl+"/entry/show?output=shapefile.kml&entryid="+x.kmlLayer;x.addBaseMapLayer(l,true)}if(x.geojsonLayer!=null){l=x.getRamadda().getEntryDownloadUrl(x.geojsonLayer);x.addBaseMapLayer(l,false)}if(this.getProperty("latitude")){this.map.setCenter(createLonLat(parseFloat(this.getProperty("longitude",-105)),parseFloat(this.getProperty("latitude",40))))}},addBaseMapLayer:function(m,n){var l=this;mapLoadInfo=displayMapUrlToVectorListeners[m];if(mapLoadInfo==null){mapLoadInfo={otherMaps:[],layer:null};selectFunc=function(o){l.mapFeatureSelected(o)};if(n){this.map.addKMLLayer(this.kmlLayerName,m,this.doDisplayMap(),selectFunc,null,null,function(p,o){l.baseMapLoaded(o,m)})}else{this.map.addGeoJsonLayer(this.geojsonLayerName,m,this.doDisplayMap(),selectFunc,null,null,function(p,o){l.baseMapLoaded(o,m)})}}else{if(mapLoadInfo.layer){this.cloneLayer(mapLoadInfo.layer)}else{this.map.showLoadingImage();mapLoadInfo.otherMaps.push(this)}}},mapFeatureSelected:function(l){if(!this.getPointData()){return}this.map.onFeatureSelect(l);if(!Utils.isDefined(l.feature.dataIndex)){return}this.getDisplayManager().propagateEventRecordSelection(this,this.getPointData(),{index:l.feature.dataIndex})},doDisplayMap:function(){var l=(this.kmlLayer!=null||this.geojsonLayer!=null)&&((""+this.getProperty("displayAsMap",""))=="true");return l},cloneLayer:function(o){var n=this;this.map.hideLoadingImage();o=o.clone();var p=o.features;var q=[];for(var m=0;m<p.length;m++){feature=p[m];feature=feature.clone();if(feature.style){oldStyle=feature.style;feature.style={};for(var l in oldStyle){feature.style[l]=oldStyle[l]}}feature.layer=o;q.push(feature)}o.removeAllFeatures();this.map.map.addLayer(o);o.addFeatures(q);this.vectorLayer=o;this.applyVectorMap();this.map.addSelectCallback(o,this.doDisplayMap(),function(s){n.mapFeatureSelected(s)})},baseMapLoaded:function(n,l){this.vectorLayer=n;this.applyVectorMap();mapLoadInfo=displayMapUrlToVectorListeners[l];if(mapLoadInfo){mapLoadInfo.layer=n;for(var m=0;m<mapLoadInfo.otherMaps.length;m++){mapLoadInfo.otherMaps[m].cloneLayer(n)}mapLoadInfo.otherMaps=[]}},handleLayerSelect:function(u){var x=this.layerSelectArgs;if(!this.layerSelectPath){if(!x){this.map.onFeatureSelect(u);return}this.layerSelectPath="/search/do"}var l=ramaddaBaseUrl+this.layerSelectPath;if(x){var w=x.split(",");for(var s=0;s<w.length;s++){var D=w[s];var q=D.split(":");var z=q[0];var B=q[1];var C=u.feature.attributes;var m=null;for(var v in C){var y=""+v;if(y==B){var t=null;if(typeof C[v]=="object"||typeof C[v]=="Object"){var n=C[v];t=n.value}else{t=C[v]}l=HtmlUtils.appendArg(l,z,t);l=l.replace("${"+z+"}",t)}}}}l=HtmlUtils.appendArg(l,"output","json");var p=new EntryList(this.getRamadda(),l,null,false);p.doSearch(this);this.getEntryList().showMessage("Searching",HtmlUtils.div([ATTR_STYLE,"margin:20px;"],this.getWaitImage()))},getEntryList:function(){if(!this.entryListDisplay){var l={showMenu:true,showTitle:true,showDetails:true,layoutHere:false,showForm:false,doSearch:false};var m=this.getUniqueId("display");this.entryListDisplay=new RamaddaEntrylistDisplay(this.getDisplayManager(),m,l);this.getDisplayManager().addDisplay(this.entryListDisplay)}return this.entryListDisplay},entryListChanged:function(m){var l=m.getEntries();this.getEntryList().entryListChanged(m)},handleLayerUnselect:function(l){this.map.onFeatureUnselect(l)},addMapLayer:function(l,u){var q=this;var v=u.entry;if(!this.addedLayers){this.addedLayers={}}if(this.addedLayers[v.getId()]){var p=this.addedLayers[v.getId()];if(p){this.map.removeKMLLayer(p);this.addedLayers[v.getId()]=null}return}if(v.getType().getId()=="geo_shapefile"){var m=createBounds(v.getWest(),v.getSouth(),v.getEast(),v.getNorth());if(m.left<-180||m.right>180||m.bottom<-90||m.top>90){console.log("entry has bad bounds:"+v.getName()+" "+m);return}var o=function(w){q.handleLayerSelect(w)};var t=function(w){q.handleLayerUnselect(w)};var n=ramaddaBaseUrl+"/entry/show?output=shapefile.kml&entryid="+v.getId();var p=this.map.addKMLLayer(v.getName(),n,true,o,t);this.addedLayers[v.getId()]=p;m=this.map.transformLLBounds(m);this.map.map.zoomToExtent(m,true);return}var s=v.getAttributeValue("base_url");if(!Utils.stringDefined(s)){console.log("No base url:"+v.getId());return}var p=v.getAttributeValue("layer_name");if(p==null){p=v.getName()}this.map.addWMSLayer(v.getName(),s,p,false)},mapBoundsChanged:function(){var l=this.map.map.calculateBounds();l=l.transform(this.map.sourceProjection,this.map.displayProjection);this.getDisplayManager().handleEventMapBoundsChanged(this,l)},addFeature:function(l){this.features.push(l);l.line=this.map.addPolygon("lines_"+l.source.getId(),RecordUtil.clonePoints(l.points),null)},xloadInitialData:function(){if(this.getDisplayManager().getData().length>0){this.handleEventPointDataLoaded(this,this.getDisplayManager().getData()[0])}},getContentsDiv:function(){return HtmlUtils.div([ATTR_CLASS,"display-contents",ATTR_ID,this.getDomId(ID_DISPLAY_CONTENTS)],"")},handleEventEntryMouseover:function(m,l){if(!this.map){return}h=l.entry.getId()+"_mouseover";attrs={lineColor:"red",fillColor:"red",fillOpacity:0.5,lineOpacity:0.5,doCircle:true,lineWidth:1,fill:true,circle:{lineColor:"black"},polygon:{lineWidth:4}};this.addOrRemoveEntryMarker(h,l.entry,true,attrs)},handleEventEntryMouseout:function(m,l){if(!this.map){return}h=l.entry.getId()+"_mouseover";this.addOrRemoveEntryMarker(h,l.entry,false)},handleEventAreaClear:function(){if(!this.map){return}this.map.clearRegionSelector()},handleClick:function(l,n,m){if(!this.map){return}if(this.doDisplayMap()){return}this.getDisplayManager().handleEventMapClick(this,n,m)},getPosition:function(){var l=$("#"+this.getDomId(f)).val();var m=$("#"+this.getDomId(g)).val();if(l==null){return null}return[l,m]},setInitMapBounds:function(o,l,n,m){if(!this.map){return}this.map.centerOnMarkers(new OpenLayers.Bounds(l,n,m,o))},sourceToEntries:{},handleEventEntriesChanged:function(m,t){if(!this.map){return}if(m==this.lastSource){this.map.clearSelectionMarker()}if((typeof m.forMap)!="undefined"&&!m.forMap){return}var u=this.sourceToEntries[m.getId()];if(u!=null){for(var s=0;s<u.length;s++){var o=m.getId()+"_"+u[s].getId();this.addOrRemoveEntryMarker(o,u[s],false)}}this.sourceToEntries[m.getId()]=t;var p=new OpenLayers.Layer.Markers("Markers");var B=new OpenLayers.Layer.Vector("Lines",{});var q=-90,y=180,v=90,w=-180;var z=false;for(var s=0;s<t.length;s++){var x=t[s];var o=m.getId()+"_"+x.getId();var n=this.addOrRemoveEntryMarker(o,t[s],true);if(x.hasBounds()){if(x.getNorth()>90||x.getSouth()<-90||x.getEast()>180||x.getWest()<-180){console.log("bad bounds on entry:"+x.getName()+" "+x.getNorth()+" "+x.getSouth()+" "+x.getEast()+" "+x.getWest());continue}q=Math.max(q,x.getNorth());v=Math.min(v,x.getSouth());w=Math.max(w,x.getEast());y=Math.min(y,x.getWest());z=true}}var l=(z?createBounds(y,v,w,q):null)},handleEventEntrySelection:function(o,l){if(!this.map){return}var p=this;var n=l.entry;if(n==null){this.map.clearSelectionMarker();return}var m=l.selected;if(!n.hasLocation()){return}},addOrRemoveEntryMarker:function(n,u,y,q){console.log("entry marker");if(!q){q={}}var p={lineColor:u.lineColor,fillColor:u.lineColor,lineWidth:u.lineWidth,doCircle:false,doRectangle:this.showBoxes,fill:false,fillOpacity:0.75,pointRadius:12,polygon:{},circle:{}};dfltPolygon={};dfltCircle={};$.extend(p,q);if(!p.lineColor){p.lineColor="blue"}$.extend(dfltPolygon,p);if(q.polygon){$.extend(dfltPolygon,q.polygon)}$.extend(dfltCircle,p);if(q.circle){$.extend(dfltCircle,q.circle)}var m=this.mapEntryInfos[n];if(!y){if(m!=null){m.removeFromMap(this.map);this.mapEntryInfos[n]=null}}else{if(m==null){m=new MapEntryInfo(u);this.mapEntryInfos[n]=m;if(u.hasBounds()&&p.doRectangle){var w={};m.rectangle=this.map.addRectangle(n,u.getNorth(),u.getWest(),u.getSouth(),u.getEast(),w)}var s=u.getLatitude();var l=u.getLongitude();if(s<-90||s>90||l<-180||l>180){return}var t=new OpenLayers.LonLat(l,s);if(p.doCircle){w={pointRadius:dfltCircle.pointRadius,stroke:true,strokeColor:dfltCircle.lineColor,strokeWidth:dfltCircle.lineWidth,fillColor:dfltCircle.fillColor,fillOpacity:dfltCircle.fillOpacity,fill:dfltCircle.fill};m.circle=this.map.addPoint(n,t,w)}else{m.marker=this.map.addMarker(n,t,u.getIconUrl(),"",this.getEntryHtml(u))}if(u.polygon){var v=[];for(var o=0;o<u.polygon.length;o+=2){v.push(new OpenLayers.Geometry.Point(u.polygon[o+1],u.polygon[o]))}var w={strokeColor:dfltPolygon.lineColor,strokeWidth:Utils.isDefined(dfltPolygon.lineWidth)?dfltPolygon.lineWidth:2};m.polygon=this.map.addPolygon(n,u.getName(),v,w,m.marker)}var x=this;if(m.marker){m.marker.entry=u;m.marker.ramaddaClickHandler=function(z){x.handleMapClick(z)};if(this.handledMarkers==null){this.map.centerToMarkers();this.handledMarkers=true}}}return m}},handleMapClick:function(l){if(this.selectedMarker!=null){this.getDisplayManager().handleEventEntrySelection(this,{entry:this.selectedMarker.entry,selected:false})}this.getDisplayManager().handleEventEntrySelection(this,{entry:l.entry,selected:true});this.selectedMarker=l},getDisplayProp:function(m,n,l){if(Utils.isDefined(this[n])){return this[n]}n="map-"+n;if(Utils.isDefined(m[n])){return m[n]}return m.getProperty(n,l)},applyVectorMap:function(){if(this.vectorMapApplied){return}if(!this.doDisplayMap()){return}if(!this.vectorLayer){return}if(!this.points){return}this.vectorMapApplied=true;var p=this.vectorLayer.features.slice();var u=this.points;for(var s=0;s<u.length;s++){var o=u[s];var n=o.center;var t=null;var v=-1;for(var q=0;q<p.length;q++){var x=p[q];var w=x.geometry;if(!w){break}bounds=w.getBounds();if(!bounds.contains(n.x,n.y)){continue}if(w.components){for(var m=0;m<w.components.length;m++){comp=w.components[m];bounds=comp.getBounds();if(!bounds.contains(n.x,n.y)){continue}if(comp.containsPoint&&comp.containsPoint(n)){t=x;v=q;break}}if(t){break}continue}if(!w.containsPoint){console.log("unknown geometry:"+w.CLASS_NAME);continue}if(w.containsPoint(n)){t=x;v=q;break}}if(t){p.splice(v,1);style=t.style;if(!style){style={stylename:"from display"}}$.extend(style,o.style);t.style=style;t.popupText=o.text;t.dataIndex=s}}if((""+this.getProperty("pruneFeatures",""))=="true"){this.vectorLayer.removeFeatures(p);var l=this.vectorLayer.getDataExtent();bounds=this.map.transformProjBounds(l);this.map.centerOnMarkers(bounds,true)}this.vectorLayer.redraw()},needsData:function(){return true},updateUI:function(){this.haveCalledUpdateUI=true;b.updateUI.call(this);if(!this.getDisplayReady()){return}if(!this.hasData()){return}if(!this.getProperty("showData",true)){return}var J=this.getPointData();var ah=this.filterData();if(ah==null){err=new Error();console.log("null records:"+err.stack);return}var m=J.getRecordFields();var T={};var X=RecordUtil.getPoints(ah,T);if(isNaN(T.north)){console.log("no bounds:"+T);return}this.initBounds=T;this.setInitMapBounds(T.north,T.west,T.south,T.east);if(this.map==null){return}if(X.length==0){console.log("points.legnth==0");return}source=this;var ae=parseFloat(this.getDisplayProp(source,"radius",8));var V=parseFloat(this.getDisplayProp(source,"strokeWidth","1"));var D=this.getDisplayProp(source,"strokeColor","#000");var I=this.getDisplayProp(source,"colorBy",null);var ad=this.getColorTable(true);var M=this.getDisplayProp(source,"sizeBy",null);var av=this.getDisplayProp(source,"isTrajectory",false);if(av){var B={strokeWidth:2,strokeColor:"blue"};this.map.addPolygon("id","",X,B,null);return}if(!ad&&source.colors&&source.colors.length>0){ad=source.colors;if(ad.length==1&&Utils.ColorTables[ad[0]]){ad=Utils.ColorTables[ad[0]].colors}}if(ad==null){ad=Utils.ColorTables.grayscale.colors}var t=this.getFieldById(m,this.getProperty("latField1"));var s=this.getFieldById(m,this.getProperty("latField2"));var w=this.getFieldById(m,this.getProperty("lonField1"));var u=this.getFieldById(m,this.getProperty("lonField2"));var ai=this.getProperty("showSegments",false);var am=this.getProperty("sizeSegments",false);var ak=this.getProperty("sizeEndPoints",true);var E=this.getProperty("showEndPoints",false);var F=parseInt(this.getProperty("endPointSize","4"));var S=F;var U=parseInt(this.getProperty("segmentWidth","1"));var n=U;var G=this.getProperty("showPoints",true);var ar=this.getProperty("lineColor","green");var L={id:I,minValue:0,maxValue:0,field:null,index:-1};var x={id:this.getDisplayProp(source,"sizeBy",null),minValue:0,maxValue:0,field:null,index:-1};for(var al=0;al<m.length;al++){var z=m[al];if(z.getId()==L.id||("#"+(al+1))==L.id){L.field=z}if(z.getId()==x.id||("#"+(al+1))==x.id){x.field=z}}x.index=x.field!=null?x.field.getIndex():-1;L.index=L.field!=null?L.field.getIndex():-1;var af=this.getProperty(PROP_EXCLUDE_ZERO,false);for(var al=0;al<X.length;al++){var ag=ah[al];var l=ag.getData();var Z=l[L.index];if(af&&Z==0){continue}if(al==0||Z>L.maxValue){L.maxValue=Z}if(al==0||Z<L.minValue){L.minValue=Z}Z=l[x.index];if(al==0||Z>x.maxValue){x.maxValue=Z}if(al==0||Z<x.minValue){x.minValue=Z}}if(this.showPercent){L.minValue=0;L.maxValue=100}L.minValue=this.getDisplayProp(source,"colorByMin",L.minValue);L.maxValue=this.getDisplayProp(source,"colorByMax",L.maxValue);if(this.points){for(var al=0;al<this.points.length;al++){this.map.removePoint(this.points[al])}for(var al=0;al<this.lines.length;al++){this.map.removePolygon(this.lines[al])}this.points=[];this.lines=[]}if(!this.points){this.points=[];this.lines=[]}var aq=this.doDisplayMap();var ab=false;var H={};for(var al=0;al<X.length;al++){var ag=ah[al];var Q=X[al];var at=ag.getData();var K={pointRadius:ae,strokeWidth:V,strokeColor:D};if(x.index>=0){var ac=at[x.index];var au=(x.maxValue-x.minValue);var o=(au==0?NaN:(ac-x.minValue)/au);K.pointRadius=6+parseInt(15*o);if(ak){F=S+parseInt(10*o)}if(am){U=n+parseInt(10*o)}}if(L.index>=0){var ac=ag.getData()[L.index];var o=0;var aa="";var C=null;if(this.percentFields!=null){C=this.percentFields.split(",")}if(this.showPercent){var O=0;var ap=ag.getData();var aa="";for(var aj=0;aj<ap.length;aj++){var R=m[aj].isNumeric&&!m[aj].isFieldGeo();if(R&&C!=null){R=C.indexOf(m[aj].getId())>=0||C.indexOf("#"+(aj+1))>=0}if(R){O+=ap[aj];aa+=" "+ap[aj]}}if(O!=0){percent0=o=ac/O*100;o=(o-L.minValue)/(L.maxValue-L.minValue)}}else{o=(ac-L.minValue)/(L.maxValue-L.minValue)}var P=parseInt(o*ad.length);if(P>=ad.length){P=ad.length-1}else{if(P<0){P=0}}K.fillOpacity=0.8;K.fillColor=ad[P];ab=true}var N=this.getRecordHtml(ag,m);if(ai&&t&&s&&w&&u){var Y=at[t.getIndex()];var W=at[s.getIndex()];var q=at[w.getIndex()];var p=at[u.getIndex()];var B={};if(K.fillColor){B.strokeColor=K.fillColor}else{B.strokeColor=ar}B.strokeWidth=U;this.lines.push(this.map.addLine("line-"+al,"",Y,q,W,p,B,N));if(E){var y={};$.extend(y,K);y.fillColor=B.strokeColor;y.strokeColor=B.strokeColor;y.pointRadius=S;y.pointRadius=F;var ao=new OpenLayers.LonLat(q,Y);var an=new OpenLayers.LonLat(p,W);if(!Utils.isDefined(H[ao])){H[ao]=true;this.points.push(this.map.addPoint("endpt-"+al,ao,y,N))}if(!Utils.isDefined(H[an])){H[an]=true;this.points.push(this.map.addPoint("endpt2-"+al,an,y,N))}}}if(G){if(Utils.isDefined(H[Q])){continue}H[Q]=true;Q=this.map.addPoint("pt-"+al,Q,K,N,aq);this.points.push(Q)}}if(ab){this.displayColorTable(ad,e,L.minValue,L.maxValue)}this.applyVectorMap()},handleEventRemoveDisplay:function(n,o){if(!this.map){return}var m=this.mapEntryInfos[o];if(m!=null){m.removeFromMap(this.map)}var l=this.findFeature(o,true);if(l!=null){if(l.line!=null){this.map.removePolygon(l.line)}}},findFeature:function(o,n){for(var m in this.features){var l=this.features[m];if(l.source==o){if(n){this.features.splice(m,1)}return l}}return null},handleEventRecordSelection:function(s,o){if(!this.getProperty("showRecordSelection",true)){return}if(!this.map){return}var n=o.record;if(n.hasLocation()){var t=n.getLatitude();var q=n.getLongitude();if(t<-90||t>90||q<-180||q>180){return}var l=new OpenLayers.LonLat(q,t);var m=this.myMarkers[s];if(m!=null){this.map.removeMarker(m)}var p=displayMapMarkerIcons[s];if(p==null){p=displayMapGetMarkerIcon();displayMapMarkerIcons[s]=p}this.myMarkers[s]=this.map.addMarker(s.getId(),l,p,"",o.html,null,24)}}})}function MapEntryInfo(b){RamaddaUtil.defineMembers(this,{entry:b,marker:null,rectangle:null,removeFromMap:function(c){if(this.marker!=null){c.removeMarker(this.marker)}if(this.rectangle!=null){c.removePolygon(this.rectangle)}if(this.polygon!=null){c.removePolygon(this.polygon)}if(this.circle!=null){c.removePoint(this.circle)}}})}function RamaddaXlsDisplay(x,o,k){var t="xaxis";var s="yaxis";var e="group";var w="search";var g="table";var l="searchextra";var h="searchheader";var p="results";var v="downloadurl";var q="tablecontents";var f="searchdiv";var m="searchform";var b="searchtext";var n="tableholder";var c="table";var d="charttoolbar";var u="chart";RamaddaUtil.inherit(this,new RamaddaDisplay(x,o,"xls",k));addRamaddaDisplay(this);this.url=k.url;this.tableProps={fixedRowsTop:0,fixedColumnsLeft:0,rowHeaders:true,colHeaders:true,headers:null,skipRows:0,skipColumns:0};if(k!=null){$.extend(this.tableProps,k)}RamaddaUtil.defineMembers(this,{initDisplay:function(){this.createUI();this.setDisplayTitle("Table Data");var y=HtmlUtils.div(["id",this.getDomId(h)])+HtmlUtils.div(["id",this.getDomId(n)])+HtmlUtils.div(["id",this.getDomId(d)])+HtmlUtils.div(["id",this.getDomId(u)]);this.setContents(y);this.loadTableData(this.url)}});RamaddaUtil.defineMembers(this,{currentSheet:0,currentData:null,columnLabels:null,startRow:0,groupIndex:-1,xAxisIndex:-1,yAxisIndex:-1,header:null,cellSelected:function(D,z){this.startRow=D;if(this.jq("params-xaxis-select").attr("checked")){this.xAxisIndex=z}else{if(this.jq("params-group-select").attr("checked")){this.groupIndex=z}else{this.yAxisIndex=z}}var y="";var C="";var B="";this.setAxisLabel(t,this.getHeading(this.xAxisIndex,true));this.setAxisLabel(e,this.getHeading(this.groupIndex,true));this.setAxisLabel(s,this.getHeading(this.yAxisIndex,true))},getAxisLabelId:function(y){return"params-"+y+"-label"},setAxisLabel:function(y,z){y=this.getAxisLabelId(y);var B=HtmlUtils.getUniqueId();if(z.length>25){z=z.substring(0,25)+"..."}if(z.trim()!=""){z=HtmlUtils.span(["id",B,"class","ramadda-tag-box"],"&nbsp;&nbsp;"+z+"&nbsp;&nbsp;")}this.jq(y).html(z)},loadSheet:function(D){var H=$("[id^="+this.getDomId("sheet_")+"]");var y=$("#"+this.getDomId("sheet_")+D);H.css("font-weight","normal");y.css("font-weight","bold");H.css("border","1px #ccc solid");y.css("border","1px #666 solid");this.currentSheet=D;var F=this.sheets[D];if(F){var I=F.rows.slice(0);if(I.length>0){this.header=I[0]}}var C="";var E=this;var G={contextMenu:true,stretchH:"all",colHeaders:true,rowHeaders:true,minSpareRows:1,afterSelection:function(){if(arguments.length>2){for(var K=0;K<arguments.length;K++){}var L=arguments[0];var J=arguments[1];E.cellSelected(L,J)}}};$.extend(G,this.tableProps);if(this.tableProps.useFirstRowAsHeader){var z=I[0];G.colHeaders=z;I=I.splice(1)}for(var B=0;B<this.tableProps.skipRows;B++){I=I.splice(1)}if(I.length==0){this.displayMessage("No data found");this.jq(p).html("");return}this.jq(p).html("Found: "+I.length);G.data=I;this.currentData=I;if(this.tableProps.headers!=null){G.colHeaders=this.tableProps.headers}if(this.getProperty("showTable",true)){this.jq(c).handsontable(G)}},getDataForSheet:function(E,y){var B=this.sheets[E];var C=B.rows.slice(0);if(C.length>0){this.header=C[0]}if(this.tableProps.useFirstRowAsHeader){var D=C[0];if(y){y.colHeaders=D}C=C.splice(1)}for(var z=0;z<this.tableProps.skipRows;z++){C=C.splice(1)}return C},makeChart:function(G,E){if(typeof google=="undefined"){this.jq(u).html("No google chart available");return}if(E==null){E={}}var F=Utils.getDefined(E.xAxisIndex,this.xAxisIndex);var D=Utils.getDefined(E.groupIndex,this.groupIndex);var P=Utils.getDefined(E.yAxisIndex,this.yAxisIndex);if(P<0){alert("You must select a y-axis field.\n\nSelect the desired axis with the radio button.\n\nClick the column in the table to chart.");return}var z=this.currentSheet;if(!(typeof E.sheet=="undefined")){z=E.sheet}var I=this.getDataForSheet(z);if(I==null){this.jq(u).html("There is no data");return}var I=I.slice(1);for(var T=0;T<this.startRow-1;T++){I=I.slice(1)}var J=[];console.log("x:"+F+"  y:"+P+" group:"+D);for(var C=0;C<I.length;C++){var H=[];var O=0;if(F>=0){H.push(I[C][F])}else{H.push(C)}if(P>=0){H.push(I[C][P])}J.push(H);if(C<2){console.log("row:"+H)}}I=J;for(var C=0;C<I.length;C++){var L=I[C];for(var N=0;N<L.length;N++){var R=L[N]+"";L[N]=parseFloat(R.trim())}}var y=this.getHeading(F,true);var W=this.getHeading(P,true);var V=this.getHeading(D,true);this.columnLabels=[y,W];var U=this.columnLabels!=null?this.columnLabels:["Field 1","Field 2"];I.splice(0,0,U);var M=google.visualization.arrayToDataTable(I);var S={};var Q="95%";$.extend(S,{legend:{position:"top"}});if(this.header!=null){if(F>=0){S.hAxis={title:this.header[F]}}if(P>=0){S.vAxis={title:this.header[P]}}}var K=HtmlUtils.getUniqueId();var B=["id",K];if(G=="scatterplot"){B.push("style");B.push("width: 450px; height: 450px;")}this.jq(u).append(HtmlUtils.div(B));if(G=="barchart"){S.chartArea={left:75,top:10,height:"60%",width:Q};S.orientation="horizontal";this.chart=new google.visualization.BarChart(document.getElementById(K))}else{if(G=="table"){this.chart=new google.visualization.Table(document.getElementById(K))}else{if(G=="motion"){this.chart=new google.visualization.MotionChart(document.getElementById(K))}else{if(G=="scatterplot"){S.chartArea={left:50,top:30,height:400,width:400};S.legend="none";S.axisTitlesPosition="in";this.chart=new google.visualization.ScatterChart(document.getElementById(K))}else{$.extend(S,{lineWidth:1});S.chartArea={left:75,top:10,height:"60%",width:Q};this.chart=new google.visualization.LineChart(document.getElementById(K))}}}}if(this.chart!=null){this.chart.draw(M,S)}},addNewChartListener:function(z,y){var B=this;$("#"+z+"-"+y).button().click(function(C){console.log("make chart:"+y);B.makeChart(y)})},makeSheetButton:function(B,y){var z=this;$("#"+B).button().click(function(C){z.loadSheet(y)})},clear:function(){this.jq(u).html("");this.startRow=0;this.groupIndex=-1;this.xAxisIndex=-1;this.yAxisIndex=-1;this.setAxisLabel(e,"");this.setAxisLabel(t,"");this.setAxisLabel(s,"")},getHeading:function(B,y){if(B<0){return""}if(this.header!=null&&B>=0&&B<this.header.length){var z=this.header[B];z=z.trim();if(z.length>0){return z}}if(y){return"Field "+(B+1)}return""},showTableData:function(V){var Q=this;this.data=V;this.sheets=this.data.sheets;this.columns=V.columns;var S="";for(var z=0;z<this.sheets.length;z++){var M=this.getDomId("sheet_"+z);S+=HtmlUtils.div(["id",M,"class","ramadda-xls-button-sheet"],this.sheets[z].name);S+="\n"}var J="12";var N='<table width=100% style="max-width:1000px;" > ';if(this.sheets.length>1){J="10"}N+="<tr valign=top>";if(this.sheets.length>1){N+=HtmlUtils.td(["width","110"],HtmlUtils.div(["class","ramadda-xls-buttons"],S));J="10"}var O=HtmlUtils.getUniqueId();var U=this.getProperty("tableWidth","");var W=this.getProperty("tableHeight","300px");var T="";if(U!=""){T+=" width:"+U+";"}T+=" height: "+W+";";T+=" overflow: auto;";N+=HtmlUtils.td([],HtmlUtils.div(["id",this.getDomId(c),"class","ramadda-xls-table","style",T]));N+="</tr>";N+="</table>";var B="";var L=["barchart","linechart","scatterplot"];for(var R=0;R<L.length;R++){B+=HtmlUtils.div(["id",O+"-"+L[R],"class","ramadda-xls-button"],"Make "+L[R]);B+="&nbsp;"}B+="&nbsp;";B+=HtmlUtils.div(["id",this.getDomId("removechart"),"class","ramadda-xls-button"],"Clear Charts");B+="<p>";B+="<form>Fields: ";B+='<input type=radio checked name="param" id="'+this.getDomId("params-yaxis-select")+'"> y-axis:&nbsp;'+HtmlUtils.div(["id",this.getDomId("params-yaxis-label"),"style","border-bottom:1px #ccc dotted;min-width:10em;display:inline-block;"],"");B+="&nbsp;&nbsp;&nbsp;";B+='<input type=radio  name="param" id="'+this.getDomId("params-xaxis-select")+'"> x-axis:&nbsp;'+HtmlUtils.div(["id",this.getDomId("params-xaxis-label"),"style","border-bottom:1px #ccc dotted;min-width:10em;display:inline-block;"],"");B+="&nbsp;&nbsp;&nbsp;";B+='<input type=radio  name="param" id="'+this.getDomId("params-group-select")+'"> group:&nbsp;'+HtmlUtils.div(["id",this.getDomId("params-group-label"),"style","border-bottom:1px #ccc dotted;min-width:10em;display:inline-block;"],"");B+="</form>";if(this.getProperty("showSearch",true)){var P=HtmlUtils.div(["style","display:inline-block;","id",this.getDomId(p)],"");var D=HtmlUtils.div(["style","display:inline-block;","id",this.getDomId(v)]);var H=HtmlUtils.div(["id",this.getDomId(f),"class","ramadda-xls-search-form"]);var I="";I+=HtmlUtils.openTag("form",["action","#","id",this.getDomId(m)]);I+=HtmlUtils.image(icon_tree_closed,["id",this.getDomId(w+"_open")]);I+="\n";I+=HtmlUtils.input(b,this.jq(b).val(),["size","60","id",this.getDomId(b),"placeholder","Search"]);I+="<input type=submit name='' style='display:none;'>";I+=HtmlUtils.openTag("div",["id",this.getDomId(l),"class","ramadda-xls-search-extra"],"");if(this.columns){var C=HtmlUtils.openTag("table",["class","formtable"]);for(var R=0;R<this.columns.length;R++){var G=this.columns[R];var M=g+"_"+G.name;var E=HtmlUtils.input(M,this.jq(M).val(),["id",this.getDomId(M),"placeholder","Search"]);C+=HtmlUtils.formEntry(G.name.replace("_"," ")+":",E)}C+=HtmlUtils.closeTag("table");I+=C}if(this.searchFields){var C=HtmlUtils.openTag("table",["class","formtable"]);for(var R=0;R<this.searchFields.length;R++){var G=this.searchFields[R];var M=g+"_"+G.name;var E=HtmlUtils.input(M,this.jq(M).val(),["id",this.getDomId(M),"placeholder","Search"]);C+=HtmlUtils.formEntry(G.label+":",E)}C+=HtmlUtils.closeTag("table");I+=C}I+="\n";I+=HtmlUtils.closeTag("div");I+="\n";I+=HtmlUtils.closeTag("form");this.jq(h).html(HtmlUtils.leftRight(H,P+" "+D));this.jq(f).html(I);if(!this.extraOpen){this.jq(l).hide()}this.jq(w+"_open").button().click(function(X){Q.jq(l).toggle();Q.extraOpen=!Q.extraOpen;if(Q.extraOpen){Q.jq(w+"_open").attr("src",icon_tree_open)}else{Q.jq(w+"_open").attr("src",icon_tree_closed)}})}if(this.getProperty("showTable",true)){this.jq(n).html(N);B+="<br>";if(this.getProperty("showChart",true)){this.jq(d).html(B)}}if(this.getProperty("showSearch",true)){this.jq(m).submit(function(X){X.preventDefault();Q.loadTableData(Q.url,"Searching...")});this.jq(b).focus();this.jq(b).select()}for(var R=0;R<L.length;R++){this.addNewChartListener(O,L[R])}this.jq("removechart").button().click(function(X){Q.clear()});for(var z=0;z<this.sheets.length;z++){var M=this.getDomId("sheet_"+z);this.makeSheetButton(M,z)}var z=0;var F=/sheet=([^&]+)/g;var y=F.exec(window.location.search);if(y){z=y[1]}this.loadSheet(z);if(this.defaultCharts){for(var R=0;R<this.defaultCharts.length;R++){var K=this.defaultCharts[R];this.makeChart(K.type,K)}}this.setAxisLabel("params-yaxis-label",this.getHeading(this.yAxisIndex,true));this.displayDownloadUrl()},displayMessage:function(B,z){if(!z){z=icon_information}var y=HtmlUtils.hbox(HtmlUtils.image(z,["align","left"]),HtmlUtils.inset(B,10,10,5,10));y=HtmlUtils.div(["class","note"],y);this.jq(n).html(y)},displayDownloadUrl:function(){var z=this.lastUrl;if(z==null){this.jq(v).html("");return}z=z.replace("xls_json","media_tabular_extractsheet");z+="&execute=true";var y=HtmlUtils.image(ramaddaBaseUrl+"/icons/xls.png",["title","Download XLSX"]);this.jq(v).html(HtmlUtils.href(z,y))},loadTableData:function(z,C){this.url=z;if(!C){C=this.getLoadingMessage()}this.displayMessage(C,icon_progress);var G=this;var E=this.jq(b).val();if(E&&E!=""){z=z+"&table.text="+encodeURIComponent(E)}if(this.columns){for(var B=0;B<this.columns.length;B++){var y=this.columns[B];var F=g+"_"+y.name;var E=this.jq(F).val();if(E){z=z+"&table."+y.name+"="+encodeURIComponent(E)}}}if(this.searchFields){for(var B=0;B<this.searchFields.length;B++){var y=this.searchFields[B];var F=g+"_"+y.name;var E=this.jq(F).val();if(E){z=z+"&table."+y.name+"="+encodeURIComponent(E)}}}console.log("url:"+z);this.lastUrl=z;var D=$.getJSON(z,function(H){if(GuiUtils.isJsonError(H)){G.displayMessage("Error: "+H.error);return}G.showTableData(H)}).fail(function(J,K,H){var I=K+", "+H;G.displayMessage("An error occurred: "+H);console.log("JSON error:"+I)})}})}var CATEGORY_PLOTLY="More Charts";var DISPLAY_PLOTLY_RADAR="radar";var DISPLAY_PLOTLY_WINDROSE="windrose";var DISPLAY_PLOTLY_DENSITY="density";var DISPLAY_PLOTLY_DOTPLOT="dotplot";var DISPLAY_PLOTLY_SPLOM="splom";var DISPLAY_PLOTLY_3DSCATTER="3dscatter";var DISPLAY_PLOTLY_3DMESH="3dmesh";var DISPLAY_PLOTLY_TREEMAP="ptreemap";var DISPLAY_PLOTLY_TERNARY="ternary";addGlobalDisplayType({type:DISPLAY_PLOTLY_RADAR,label:"Radar",requiresData:true,forUser:true,category:CATEGORY_PLOTLY});addGlobalDisplayType({type:DISPLAY_PLOTLY_WINDROSE,label:"Wind Rose",requiresData:true,forUser:true,category:CATEGORY_PLOTLY});addGlobalDisplayType({type:DISPLAY_PLOTLY_DENSITY,label:"Density",requiresData:true,forUser:true,category:CATEGORY_PLOTLY});addGlobalDisplayType({type:DISPLAY_PLOTLY_DOTPLOT,label:"Dot Plot",requiresData:true,forUser:true,category:CATEGORY_PLOTLY});addGlobalDisplayType({type:DISPLAY_PLOTLY_SPLOM,label:"Splom",requiresData:true,forUser:true,category:CATEGORY_PLOTLY});addGlobalDisplayType({type:DISPLAY_PLOTLY_3DSCATTER,label:"3D Scatter",requiresData:true,forUser:true,category:CATEGORY_PLOTLY});addGlobalDisplayType({type:DISPLAY_PLOTLY_3DMESH,label:"3D Mesh",requiresData:true,forUser:true,category:CATEGORY_PLOTLY});function RamaddaPlotlyDisplay(e,d,c,b){let SUPER=new RamaddaFieldsDisplay(e,d,c,b);RamaddaUtil.inherit(this,SUPER);RamaddaUtil.defineMembers(this,{needsData:function(){return true},setDimensions:function(g,h){var f=parseInt(this.getProperty("height","400").replace("px","").replace("%",""));g.height=f},pointDataLoaded:function(f,g,h){SUPER.pointDataLoaded.call(this,f,g,h);if(this.dataCollection){this.displayManager.propagateEventRecordSelection(this,this.dataCollection.getList()[0],{index:0})}},displayData:function(){this.updateUI()},pageHasLoaded:function(){SUPER.pageHasLoaded.call(this);this.updateUI()},fieldSelectionChanged:function(){SUPER.fieldSelectionChanged.call(this);this.updateUI()},makeAxis:function(g,f){return{title:g,titlefont:{size:20},tickangle:f,tickfont:{size:15},tickcolor:"rgba(0,0,0,0)",ticklen:5,showline:true,showgrid:true}},getDisplayStyle:function(){return""},makePlot:function(g,f){this.clearHtml();this.jq(ID_DISPLAY_CONTENTS).html(HtmlUtils.div(["id",this.getDomId("tmp"),"style",this.getDisplayStyle()],""));var k=Plotly.plot(this.getDomId("tmp"),g,f);var h=document.getElementById(this.getDomId("tmp"));this.addEvents(k,h)},addEvents:function(g,f){}})}function RamaddaRadialDisplay(f,e,d,c){var b;$.extend(this,{width:"400px",height:"400px"});RamaddaUtil.inherit(this,b=new RamaddaPlotlyDisplay(f,e,d,c));RamaddaUtil.defineMembers(this,{getPlotType:function(){return"barpolar"},updateUI:function(){var h=this.filterData();if(!h){return}var o=this.getSelectedFields(this.getData().getRecordFields());var t=this.getFieldOfType(o,"string");if(!t){this.displayError("No string field specified");return}var u=this.getFieldsOfType(o,"numeric");if(u.length==0){this.displayError("No numeric fields specified");return}var g=this.getColumnValues(h,t).values;var s=[];var m=Number.MAX_VALUE;var p=Number.MIN_VALUE;var l=[];for(var n=0;n<u.length;n++){var q=u[n];var k=this.getColumnValues(h,q);m=Math.min(m,k.min);p=Math.max(p,k.max);l.push({type:this.getPlotType(),r:k.values,theta:g,fill:"toself",name:q.getLabel()})}layout={polar:{radialaxis:{visible:true,range:[m,p]}}};this.setDimensions(layout,2);this.makePlot(l,layout)}})}function RamaddaRadarDisplay(e,d,c){var b;RamaddaUtil.inherit(this,b=new RamaddaRadialDisplay(e,d,DISPLAY_PLOTLY_RADAR,c));RamaddaUtil.defineMembers(this,{getPlotType:function(){return"scatterpolar"}});addRamaddaDisplay(this)}function RamaddaWindroseDisplay(e,d,c){var b;RamaddaUtil.inherit(this,b=new RamaddaRadialDisplay(e,d,DISPLAY_PLOTLY_WINDROSE,c));RamaddaUtil.defineMembers(this,{getPlotType:function(){return"barpolar"}});addRamaddaDisplay(this)}function RamaddaDensityDisplay(e,d,c){var b;$.extend(this,{width:"600px",height:"400px"});RamaddaUtil.inherit(this,b=new RamaddaPlotlyDisplay(e,d,DISPLAY_PLOTLY_DENSITY,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{updateUI:function(){var f=this.filterData();if(!f){return}var l=this.getSelectedFields(this.getData().getRecordFields());var p=this.getFieldsOfType(l,"numeric");if(p.length<2){this.displayError("No numeric fields specified");return}var n=this.getColumnValues(f,p[0]);var m=this.getColumnValues(f,p[1]);var h={x:n.values,y:m.values,mode:"markers",name:"",marker:{color:this.getProperty("pointColor","rgb(102,0,0)"),size:parseInt(this.getProperty("markerSize","4")),opacity:0.4},type:"scatter"};var o={x:n.values,y:m.values,name:"density",ncontours:20,colorscale:"Hot",reversescale:true,type:"histogram2dcontour"};var g=[];if(this.getProperty("showDensity",true)){g.push(o)}if(this.getProperty("showPoints",true)){g.push(h)}var k={showlegend:true,autosize:true,margin:{t:50},hovermode:"closest",bargap:0,xaxis:{domain:[n.min,n.max],showline:this.getProperty("showLines",true),showgrid:this.getProperty("showLines",true),title:l[0].getLabel()},yaxis:{domain:[m.min,m.max],showline:this.getProperty("showLines",true),showgrid:this.getProperty("showLines",true),title:l[1].getLabel()}};this.setDimensions(k,2);this.makePlot(g,k)}})}function RamaddaPlotly3DDisplay(f,e,d,c){var b;$.extend(this,{width:"400px",height:"400px"});RamaddaUtil.inherit(this,b=new RamaddaPlotlyDisplay(f,e,d,c));RamaddaUtil.defineMembers(this,{addEvents:function(h,g){g.on("plotly_click",function(){})},getDisplayStyle:function(){return"border: 1px #ccc solid;"},get3DType:function(){return"scatter3d"},updateUI:function(){var g=this.filterData();if(!g){return}var l=this.getSelectedFields(this.getData().getRecordFields());var q=this.getFieldOfType(l,"string");var l=this.getFieldsOfType(l,"numeric");if(l.length==0){this.displayError("No numeric fields specified");return}if(l.length<3){this.displayError("Don't have 3 numeric fields specified");return}var p=this.getColumnValues(g,l[0]);var o=this.getColumnValues(g,l[1]);var n=this.getColumnValues(g,l[2]);var m={x:p.values,y:o.values,z:n.values,mode:"markers",marker:{size:12,line:{color:"rgba(217, 217, 217, 0.14)",width:0.5},opacity:0.8},type:this.get3DType()};var h=[m];var k={scene:{xaxis:{backgroundcolor:"rgb(200, 200, 230)",gridcolor:"rgb(255, 255, 255)",showbackground:true,zerolinecolor:"rgb(255, 255, 255)",title:l[0].getLabel()},yaxis:{backgroundcolor:"rgb(230, 200,230)",gridcolor:"rgb(255, 255, 255)",showbackground:true,zerolinecolor:"rgb(255, 255, 255)",title:l[1].getLabel()},zaxis:{backgroundcolor:"rgb(230, 230,200)",gridcolor:"rgb(255, 255, 255)",showbackground:true,zerolinecolor:"rgb(255, 255, 255)",title:l[2].getLabel()}},margin:{l:0,r:0,b:50,t:50,pad:4}};this.setDimensions(k,2);this.makePlot(h,k)}})}function Ramadda3dmeshDisplay(e,d,c){var b;$.extend(this,{width:"100%",height:"100%"});RamaddaUtil.inherit(this,b=new RamaddaPlotly3DDisplay(e,d,DISPLAY_PLOTLY_3DMESH,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{get3DType:function(){return"mesh3d"}})}function Ramadda3dscatterDisplay(e,d,c){var b;$.extend(this,{width:"100%",height:"100%"});RamaddaUtil.inherit(this,b=new RamaddaPlotly3DDisplay(e,d,DISPLAY_PLOTLY_3DSCATTER,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{get3DType:function(){return"scatter3d"}})}function RamaddaTernaryDisplay(e,d,c){var b;$.extend(this,{width:"400px",height:"400px"});RamaddaUtil.inherit(this,b=new RamaddaPlotlyDisplay(e,d,DISPLAY_PLOTLY_TERNARY,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{updateUI:function(){var g=this.filterData();if(!g){return}var n=this.getSelectedFields(this.getData().getRecordFields());var s=this.getFieldOfType(n,"string");var n=this.getFieldsOfType(n,"numeric");if(n.length==0){this.displayError("No numeric fields specified");return}if(n.length<3){this.displayError("Don't have 3 numeric fields specified");return}var f=[];var q=this.getColumnValues(g,n[0]);var p=this.getColumnValues(g,n[1]);var o=this.getColumnValues(g,n[2]);for(var l=0;l<q.length;l++){f.push({a:100*q[l]/q.max,b:100*p[l]/p.max,c:100*o[l]/o.max,label:s?s.getLabel():"Point "+(l+1)})}var k=[{a:75,b:25,c:0,label:"point 1"},{a:70,b:10,c:20,label:"point 2"},{a:75,b:20,c:5,label:"point 3"},{a:5,b:60,c:35,label:"point 4"},{a:10,b:80,c:10,label:"point 5"},{a:10,b:90,c:0,label:"point 6"},{a:20,b:70,c:10,label:"point 7"},{a:10,b:20,c:70,label:"point 8"},{a:15,b:5,c:80,label:"point 9"},{a:10,b:10,c:80,label:"point 10"},{a:20,b:10,c:70,label:"point 11"}];var h=[{type:"scatterternary",mode:"markers",a:f.map(function(t){return t.a}),b:f.map(function(t){return t.b}),c:f.map(function(t){return t.c}),text:f.map(function(t){return t.label}),marker:{symbol:100,color:"#DB7365",size:14,line:{width:2}}}];var m={ternary:{sum:100,aaxis:this.makeAxis(n[0].getLabel(),0),baxis:this.makeAxis(n[1].getLabel(),45),caxis:this.makeAxis(n[2].getLabel(),-45),bgcolor:"#fff1e0"},annotations:[{showarrow:false,text:this.getProperty("chartTitle",""),x:1,y:1.3,font:{size:15}}],paper_bgcolor:"#fff1e0"};this.setDimensions(m,2);this.makePlot(h,m)}})}function RamaddaDotplotDisplay(d,c,b){$.extend(this,{width:"600px",height:"400px"});let SUPER=new RamaddaPlotlyDisplay(d,c,DISPLAY_PLOTLY_DOTPLOT,b);RamaddaUtil.inherit(this,SUPER);addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{getDisplayStyle:function(){return"border: 1px #ccc solid;"},updateUI:function(){var f=this.filterData();if(!f){return}var o=this.getSelectedFields(this.getData().getRecordFields());var s=this.getFieldOfType(o,"string");var o=this.getFieldsOfType(o,"numeric");if(o.length==0){this.displayError("No numeric fields specified");return}var n=null;var l="";if(s){n=this.getColumnValues(f,s).values;l=s.getLabel()}var e=this.getColorTable(true);if(!e){e=["rgba(156, 165, 196, 0.95)","rgba(204,204,204,0.95)","rgba(255,255,255,0.85)","rgba(150,150,150,0.95)"]}var g=[];for(i in o){var h=i>=e.length?e[0]:e[i];var p=o[i];var q=this.getColumnValues(f,p).values;if(!n){n=[];for(var k=0;k<q.length;k++){n.push("Point "+(k+1))}}g.push({type:"scatter",x:q,y:n,mode:"markers",name:p.getLabel(),marker:{color:h,line:{color:"rgba(156, 165, 196, 1.0)",width:1},symbol:"circle",size:16}})}var m={title:"",yaxis:{title:this.getProperty("yAxisTitle",l),showline:this.getProperty("yAxisShowLine",true),showgrid:this.getProperty("yAxisShowGrid",true)},xaxis:{title:this.getProperty("xAxisTitle",o[i].getLabel()),showgrid:this.getProperty("xAxisShowGrid",false),showline:this.getProperty("xAxisShowLine",true),linecolor:"rgb(102, 102, 102)",titlefont:{font:{color:"rgb(204, 204, 204)"}},tickfont:{font:{color:"rgb(102, 102, 102)"}},autotick:true,ticks:"outside",tickcolor:"rgb(102, 102, 102)"},margin:{l:this.getProperty("marginLeft",140),r:this.getProperty("marginRight",40),b:this.getProperty("marginBottom",50),t:this.getProperty("marginTop",20)},legend:{font:{size:10},yanchor:"middle",xanchor:"right"},paper_bgcolor:"rgb(254, 247, 234)",plot_bgcolor:"rgb(254, 247, 234)",hovermode:"closest"};this.setDimensions(m,2);this.makePlot(g,m)}})}function RamaddaSplomDisplay(e,d,c){var b;$.extend(this,{width:"600px",height:"600px"});RamaddaUtil.inherit(this,b=new RamaddaPlotlyDisplay(e,d,DISPLAY_PLOTLY_SPLOM,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{setDimensions:function(h,k){var g=parseInt(this.getProperty("width","400").replace("px","").replace("%",""));var f=parseInt(this.getProperty("height","400").replace("px","").replace("%",""));h.width=g-k;h.height=f},makeAxis:function(){return{showline:false,zeroline:false,gridcolor:this.getProperty("gridColor","white"),ticklen:2,tickfont:{size:this.getProperty("tickFontSize",12)},titlefont:{size:this.getProperty("titleFontSize",12)}}},updateUI:function(){var G=this.filterData();if(!G){return}var x=this.getSelectedFields(this.getData().getRecordFields());if(x.length==0){x=this.getData().getRecordFields()}var J;if(this.getProperty("labels")){J=this.getProperty("labels").split(",")}var C={type:"splom",dimensions:[],marker:{size:parseInt(this.getProperty("markerSize",5)),line:{color:this.getProperty("lineColor","white"),width:0.5}}};var m=this.getFieldById(x,this.getProperty("colorBy"));var H=this.getProperty("colorBy");if(H){var m=this.getFieldById(x,H);if(m){var s=this.getColumnValues(G,m);var q=this.getColorTable();if(!q){q=Utils.getColorTable("blue_white_red")}var w=[];var B=parseFloat(this.getProperty("colorByMin",s.min));var E=parseFloat(this.getProperty("colorByMax",s.max));if(Utils.isDefined(q.min)){var o=[];for(var F=0;F<q.colors.length;F++){var f=F/q.colors.length;var y=q.min+(q.max-q.min)*f;if(y>=B&&y<=E){o.push(q.colors[F])}}q=o}if(q.colors){q=q.colors}var t=E-B;var g=[];for(var F=0;F<s.values.length;F++){var y=s.values[F];var f=(y-B)/t;g.push(f)}for(var F=0;F<q.length;F++){var y=F/q.length;var v=(F+1)/q.length;w.push([y,q[F]]);w.push([v,q[F]])}C.marker.color=g;C.marker.colorscale=w}this.displayColorTable(q,ID_DISPLAY_BOTTOM,B,E)}var u=this.getFieldOfType(x,"string");if(u){var z=this.getColumnValues(G,u).values;C.text=[];for(var F=0;F<z.length;F++){C.text.push(u.getLabel()+": "+z[F])}}var n=[C];var I={autosize:false,hovermode:"closest",dragmode:"select",plot_bgcolor:this.getProperty("bgColor","rgba(240,240,240, 0.95)"),margin:{l:this.getProperty("marginLeft",140),r:this.getProperty("marginRight",40),b:this.getProperty("marginBottom",50),t:this.getProperty("marginTop",20)}};var D=0;for(var F=0;F<x.length;F++){var h=x[F];if(!h.isFieldNumeric()){continue}var k=this.getColumnValues(G,h).values;var p;if(J&&F<J.length){p=J[F]}else{p=h.getUnitLabel()}C.dimensions.push({label:p,values:k});var K="axis"+(D==0?"":""+(D+1));I["x"+K]=this.makeAxis();I["y"+K]=this.makeAxis();D++}this.setDimensions(I,2);this.makePlot(n,I)}})}function RamaddaPTreemapDisplay(e,d,c){var b;$.extend(this,{width:"400px",height:"400px"});RamaddaUtil.inherit(this,b=new RamaddaPlotlyDisplay(e,d,DISPLAY_PLOTLY_TREEMAP,c));addRamaddaDisplay(this);RamaddaUtil.defineMembers(this,{updateUI:function(){var x=this.filterData();if(!x){return}var s=this.getSelectedFields(this.getData().getRecordFields());var g=this.getFieldOfType(s,"numeric");if(!g){this.displayError("No numeric field specified");return}var k=this.getColumnValues(x,g).data;var v=[];var f=[];var p=0;var l=[];var u=[];var t=[];var q=this.getColorTable();if(q.colors){q=q.colors}var o=Treemap.generate(k,100,100);for(var w in o){var h={type:"rect",x0:o[w][0],y0:o[w][1],x1:o[w][2],y1:o[w][3],line:{width:2},fillcolor:q[p]};v.push(h);var n={x:(o[w][0]+o[w][2])/2,y:(o[w][1]+o[w][3])/2,text:String(k[p]),showarrow:false};f.push(n);l.push((o[w][0]+o[w][2])/2);u.push((o[w][1]+o[w][3])/2);t.push(String(k[p]));p++}var m={x:l,y:u,text:t,mode:"text",type:"scatter"};var y={height:700,width:700,shapes:v,hovermode:"closest",annotations:f,xaxis:{showgrid:false,zeroline:false},yaxis:{showgrid:false,zeroline:false}};var z={data:[m]};this.setDimensions(y,2);this.makePlot([m],y)}})};