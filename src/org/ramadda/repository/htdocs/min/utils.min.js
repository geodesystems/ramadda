var ramaddaGlobals={iconWidth:"18px"},root=ramaddaBaseUrl,urlroot=ramaddaBaseUrl,icon_close="fas fa-window-close",icon_stop="fas fa-stop",icon_play="fas fa-play",icon_pin="fas fa-thumbtack",icon_help="fas fa-question-circle",icon_command=ramaddaCdn+"/icons/command.png",icon_rightarrow=ramaddaCdn+"/icons/grayrightarrow.gif",icon_downdart=ramaddaCdn+"/icons/downdart.gif",icon_updart=ramaddaCdn+"/icons/updart.gif",icon_rightdart=ramaddaCdn+"/icons/rightdart.gif",icon_progress=ramaddaCdn+"/icons/progress.gif",icon_wait=ramaddaCdn+"/icons/wait.gif",icon_information=ramaddaCdn+"/icons/information.png",icon_folderclosed=ramaddaCdn+"/icons/folderclosed.png",icon_folderopen=ramaddaCdn+"/icons/togglearrowdown.gif",icon_folderclosed="fas fa-caret-right",icon_folderopen="fas fa-caret-down",icon_tree_open=ramaddaCdn+"/icons/togglearrowdown.gif",icon_tree_closed=ramaddaCdn+"/icons/togglearrowright.gif",icon_zoom=ramaddaCdn+"/icons/magnifier.png",icon_zoom_in=ramaddaCdn+"/icons/magnifier_zoom_in.png",icon_zoom_out=ramaddaCdn+"/icons/magnifier_zoom_out.png",icon_menuarrow=ramaddaCdn+"/icons/downdart.gif",icon_blank16=ramaddaCdn+"/icons/blank16.png",icon_blank=ramaddaCdn+"/icons/blank.gif",icon_menu=ramaddaCdn+"/icons/menu.png",icon_trash="fas fa-trash-alt",UNIT_FT="ft",UNIT_MILES="mi",UNIT_KM="km",UNIT_M="m",UNIT_NM="nm",CLASS_DIALOG="ramadda-dialog",CLASS_DIALOG_BUTTON="ramadda-dialog-button",CLASS_CLICKABLE="ramadda-clickable",CLASS_HOVERABLE="ramadda-hoverable",ID="id",BACKGROUND="background",CLASS="class",DIV="div",POSITION="position",WIDTH="width",ALIGN="align",VALIGN="valign",HEIGHT="height",SRC="src",STYLE="style",TABLE="table",TITLE="title",THEAD="thead",TBODY="tbody",TFOOT="tfoot",TR="tr",TD="td",BR="br",PRE="pre",TAG_A="a",TAG_B="b",TAG_DIV="div",SELECT="select",OPTION="option",VALUE="value",TAG_CANVAS="canvas",TAG_IMG="img",TAG_INPUT="input",TAG_LI="li",TAG_SELECT="select",TAG_OPTION="option",TAG_TABLE="table",TAG_TR="tr",TAG_TD="td",TAG_UL="ul",TAG_OL="ol",ATTR_SRC="src",ATTR_TYPE="type",ATTR_WIDTH="width",ATTR_HEIGHT="height",ATTR_HREF="href",ATTR_PLACEHOLDER="placeholder",ATTR_BORDER="border",ATTR_VALUE="value",ATTR_TITLE="title",ATTR_ALT="alt",ATTR_ID="id",ATTR_CLASS="class",ATTR_SIZE="size",ATTR_STYLE="style",ATTR_ALIGN="align",ATTR_VALIGN="valign",SPACE="&nbsp;",SPACE1="&nbsp;",SPACE2="&nbsp;&nbsp;",SPACE3="&nbsp;&nbsp;&nbsp;",SPACE4="&nbsp;&nbsp;&nbsp;&nbsp;";function noop(){}function addHandler(t,e){return null==window.globalHandlers&&(window.globalHandlers={}),e||(e=HtmlUtils.getUniqueId()),window.globalHandlers[e]=t,e}function getHandler(t){return t&&null!=window.globalHandlers?window.globalHandlers[t]:null}var Utils={me:"Utils",pageLoaded:!1,loadFunctions:[],mouseMoveCnt:0,mouseIsDown:!1,entryGroups:new Array,groupList:new Array,tooltipObject:null,entryDragInfo:null,globalEntryRows:{},defineGlobal:function(t,e){Utils.isDefined(window[t])||(window[t]=e)},checkLicense:function(t,e,a){let n={message:"To access this content do you agree with the following license?",showLicense:!0,suffix:"",onlyAnonymous:!1,redirect:ramaddaBaseUrl,logName:!1};a&&$.extend(n,a);let i=jqid(t).html(),l="licenseagree_"+e,r=Utils.getLocalStorage(l);if((!n.onlyAnonymous||Utils.isAnonymous())&&!r){let t=[HU.div(["action","ok","class","ramadda-button "+CLASS_CLICKABLE],"Yes"),HU.div(["action","no","class","ramadda-button "+CLASS_CLICKABLE],"No")],a=HU.buttons(t),r=n.message;r+=(n.showLicense?HU.div([],i):"<br>")+n.suffix,n.logName&&(r+=HU.vspace("1em"),r+=HU.div([],"Please enter your contact information"),r+=HU.formTable(),r+=HU.formEntry("Name:",HU.input("","",["tabindex","1",ATTR_ID,"licenseagreename","size","30"])),r+=HU.formEntry("Email:",HU.input("","",["tabindex","2",ATTR_ID,"licenseagreeemail","size","30"])),r+=HU.formTableClose()),r+=a,r=HU.div([ATTR_CLASS,"ramadda-license-dialog"],r);let o=HU.makeDialog({anchor:$(window),at:"left+100 top+100",my:"left top",content:r,remove:!1,modalStrict:!0,sticky:!0});o.find(".ramadda-button").click((function(){if("ok"!=$(this).attr("action"))return void(window.location.href=n.redirect);let t="",a="";if(n.logName&&(t=jqid("licenseagreename").val().trim(),a=jqid("licenseagreeemail").val().trim(),!Utils.stringDefined(t)||!Utils.stringDefined(a)))return void alert("Please enter your contact information");let i=HU.url(RamaddaUtil.getUrl("/loglicense"),["licenseid",e,"name",t,"email",a,"entryid",n.entryid]);$.getJSON(i,(t=>{})),Utils.setLocalStorage(l,!0),o.remove()}))}},clone:function(){if(0==arguments.length)return{};let t=arguments[0]?$.extend({},arguments[0]):{};for(let e=1;e<arguments.length;e++)arguments[e]&&(t=$.extend(t,arguments[e]));return t},preventSubmit:function(t){return 13!==t.keyCode},bufferedCalls:{},bufferedCall:function(t,e,a){a=Utils.isDefined(a)?a:1,this.bufferedCalls[t]&&clearTimeout(this.bufferedCalls[t]),this.bufferedCalls[t]=setTimeout((()=>{e()}),a)},throttle:function(t,e){let a=0;return function(...n){clearTimeout(a),a=setTimeout((()=>{t.apply(this,n)}),e)}},initCopyable:function(t,e){let a={title:null,ack:null,addLink:!1,removeTags:!1,removeNL:!1,downloadFileName:null,extraStyle:null,textArea:null};e&&$.extend(a,e),$(t).each((function(){$(this).attr("title",a.title??"Click to copy");let t=$(this);if(a.addLink){let e=$(this).parent();e.css("position","relative");let n=HU.css("position","absolute")+(a.extraStyle??HU.css("top","5px","right","5px"));t=$(HU.div([ATTR_CLASS,"ramadda-clickable",ATTR_STYLE,n],HtmlUtils.getIconImage("fa-copy"))).appendTo(e)}else $(this).addClass("ramadda-clickable");t.click((()=>{let t=$(this).attr("data-copy")??$(this).html();if(a.removeTags&&(t=t.replace(/<br>/g,"\n").replace(/<p>/g,"\n\n").replace(/<[^>]+>/g,""),t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">")),a.removeNL&&(t=t.replace(/\n/g," ")),a.addNL&&(t+="\n"),a.textArea)HU.insertIntoTextarea(a.textArea,t);else{if(a.downloadFileName){let e=prompt("Download file name",a.downloadFileName);if(e)return void Utils.makeDownloadFile(e,t)}Utils.copyToClipboard(t),alert($(this).attr("copy-message")??a.ack??"Text copied to clipboard")}}))}))},initPage:function(){this.initContent(),this.pageLoaded=!0,this.initDisplays(),HU.initTooltip(".ramadda-tooltip-element"),document.onmousemove=Utils.handleMouseMove,document.onmousedown=Utils.handleMouseDown,document.onmouseup=Utils.handleMouseUp,document.onkeypress=Utils.handleKeyPress,$(document).delegate("textarea","keydown",(function(t){if(9==(t.keyCode||t.which)){t.preventDefault();var e=this.selectionStart,a=this.selectionEnd;$(this).val($(this).val().substring(0,e)+"\t"+$(this).val().substring(a)),this.selectionStart=this.selectionEnd=e+1}})),Utils.loadFunctions.forEach((t=>{t()}))},addLoadFunction:function(t){Utils.loadFunctions.push(t)},getLocalStorage:function(t,e,a){try{a&&(t=ramaddaBaseEntry+"."+t);let n=localStorage.getItem(t);return null!==n&&e?JSON.parse(n):n}catch(e){return console.log("Error getting local storage. key="+t),null}},setLocalStorage:function(t,e,a,n){if(localStorage)try{if(n&&(t=ramaddaBaseEntry+"."+t),null===e)return void localStorage.removeItem(t);e&&a&&(e=JSON.stringify(e)),localStorage.setItem(t,e)}catch(e){console.log("Error setting local storage. key="+t)}},getFileTail:function(t){try{return new URL(t).pathname.replace(/.*\/([^\/]+)$/g,"$1")}catch(t){return null}},isImage:function(t){return!!t&&t.search(/(\.png|\.jpg|\.jpeg|\.gif|\.webp|\.heic)/i)>=0},initDragAndDrop:function(t,e,a,n,i,l,r){r||t.attr("contenteditable",!0),t.on("dragover",(a=>{a.stopPropagation(),a.preventDefault(),t.addClass("ramadda-drop-active"),e&&e(a)})),t.on("dragleave",(t=>{a&&a(t)})),t.on("drop",(e=>{t.removeClass("ramadda-drop-active"),e.stopPropagation(),e.preventDefault();let a=e.originalEvent.target.files||e.originalEvent.dataTransfer.files;for(let t=0;t<a.length;t++){let e=a[t];if(!e)continue;if(i)if("string"==typeof i){if(!e.type.match(i))continue}else if(!i(e))continue;let l=new FileReader;l.onload=t=>{n&&n(t,e,t.target.result,!0)},l.readAsDataURL(e)}})),t.on("paste",(t=>{let e=(t.clipboardData||t.originalEvent.clipboardData).items;for(let a=0;a<e.length;a++){let i=e[a];if("string"==i.kind){if(!l)continue;if("text/plain"!=i.type)continue;i.getAsString((e=>{n&&n(t,i,e,!1)}));continue}if("file"!=i.kind)continue;t.stopPropagation(),t.preventDefault();let r=new FileReader;r.onload=t=>{n&&n(t,i,t.target.result,!1)};let o=i.getAsFile();r.readAsDataURL(o);break}}))},isPost:function(){let t=$("#request-method");return 0!=t.length&&"POST"==t.attr("content")},max:function(t,e){return Utils.isDefined(t)?Utils.isDefined(e)?isNaN(t)?e:isNaN(e)?t:Math.max(t,e):t:e},min:function(t,e){return Utils.isDefined(t)?Utils.isDefined(e)?isNaN(t)?e:isNaN(e)?t:Math.min(t,e):t:e},toRadians:function(t){return t*Math.PI/180},toDegrees:function(t){return 180*t/Math.PI},distance:function(t,e,a,n){return Math.hypot(a-t,n-e)},reverseBearing:function(t,e,a){a/=6371,e=Utils.toRadians(e);var n=Utils.toRadians(t.lat),i=Utils.toRadians(t.lon),l=Math.asin(Math.sin(n)*Math.cos(a)+Math.cos(n)*Math.sin(a)*Math.cos(e)),r=i+Math.atan2(Math.sin(e)*Math.sin(a)*Math.cos(n),Math.cos(a)-Math.sin(n)*Math.sin(l));return isNaN(l)||isNaN(r)?null:MapUtils.createLonLat(Utils.toDegrees(r),Utils.toDegrees(l))},getBearing:function(t,e){let a=Utils.toRadians(t.lat),n=Utils.toRadians(t.lon),i=Utils.toRadians(e.lat),l=Utils.toRadians(e.lon),r=Math.cos(i)*Math.sin(l-n),o=Math.cos(a)*Math.sin(i)-Math.sin(a)*Math.cos(i)*Math.cos(l-n),s=Math.atan2(r,o);return s=Utils.toDegrees(s),s=(s+360)%360,s},isReturnKey:function(t){return 13==(t.keyCode||t.which)},getBounds:function(t){if(!t)return null;let e=null,a=null,n=null,i=null;return t.forEach((t=>{e=null===e?t[0]:Math.min(e,t[0]),a=null===a?t[0]:Math.max(a,t[0]),n=null===n?t[1]:Math.min(n,t[1]),i=null===i?t[1]:Math.max(i,t[1])})),{getWidth:function(){return this.maxx-this.minx},getHeight:function(){return this.maxy-this.miny},getCenter:function(){return{x:this.minx+(this.maxx-this.minx)/2,y:this.miny+(this.maxy-this.miny)/2}},minx:e,maxx:a,miny:n,maxy:i}},mergeBounds(t,e){if(null==t)return e;if(null==e)return t;let a={};return a=$.extend(a,t),$.extend(a,{minx:Math.min(t.minx,e.minx),maxx:Math.max(t.maxx,e.maxx),miny:Math.min(t.miny,e.miny),maxy:Math.max(t.maxy,e.maxy)}),a},addCopyLink:function(t){let e=jqid(t).html();e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim();let a=jqid(t);a.css("position","relative");let n=t+"_copy",i=t+"_download",l=10;if("true"==a.attr("add-copy")){let e=HU.div(["id",n,TITLE,"Copy to clipboard",CLASS,CLASS_CLICKABLE,STYLE,HU.css("position","absolute","right",l+"px","top","5px")],HU.getIconImage("fas fa-clipboard"));l+=20,jqid(t).append(e)}if("true"==a.attr("add-download")){let e=HU.div(["id",i,TITLE,"Download",CLASS,CLASS_CLICKABLE,STYLE,HU.css("position","absolute","right",l+"px","top","5px")],HU.getIconImage("fas fa-download"));jqid(t).append(e)}jqid(n).click((function(){Utils.copyToClipboard(e);let t=HU.div([ATTR_STYLE,"background:var(--color-mellow-yellow);padding:5px;"],"Ok, result is copied"),a=HU.makeDialog({content:t,anchor:$(this),my:"right top",at:"right bottom"});setTimeout((()=>{a.hide(1e3),setTimeout((()=>{a.remove()}),1100)}),1e3)})),jqid(i).click((()=>{Utils.makeDownloadFile(a.attr("download-file")??"download.txt",e)}))},copyToClipboardOld:function(t){let e=$("<textarea></textarea>");$("body").append(e),e.val(t).select(),document.execCommand("copy")||console.error("Copy to clipboard failed"),e.remove()},copyToClipboard:function(t){navigator.clipboard.writeText(t).then((()=>{})).catch((e=>{console.error("Unable to write to clipboard with navigator.clipboard.writeText:"+e),Utils.copyToClipboardOld(t)}))},isAnonymous:function(){return"anonymous"==ramaddaUser},getIcon:function(t){return ramaddaCdn+"/icons/"+t},imports:{},get:function(t,e,a){return t&&e<t.length?t[e]:a},getRotation:function(t){if(t[0].x){let e=[];t.forEach((t=>{e.push(t.x,t.y)})),t=e}var e=[(t[0]+t[4])/2,(t[1]+t[5])/2],a=[t[0]-t[6],t[1]-t[7]],n=180*Math.atan(a[0]/a[1])/Math.PI;return a[1]<0?n+=180:a[0]<0&&(n+=360),{center:e,angle:n}},rotate:function(t,e,a,n,i,l){if(0==i)return{x:parseFloat(a),y:parseFloat(n)};if(l)var r=Math.PI/180*i;else r=Math.PI/-180*i;var o=Math.cos(r),s=Math.sin(r);return{x:o*(a-t)+s*(n-e)+t,y:o*(n-e)-s*(a-t)+e}},splitFirst:function(t,e){let a=t.indexOf(e);return a<0?[t]:[t.substring(0,a),t.substring(a+1)]},debug:!1,split:function(t,e,a,n,i){if(!Utils.isDefined(t))return i;let l=[];e=e??",";let r=new RegExp("\\\\"+e,"g");return t=t.replace(r,"_HIDEDELIM_"),this.debug&&console.log(t),t.split(e).forEach((t=>{t=(t=t.replace(/_comma_/g,",")).replace(/_HIDEDELIM_/g,e),a&&(t=t.trim()),n&&""==t||l.push(t)})),l},sortNumbers:function(t){return t.sort(((t,e)=>+t-+e)),t},sortDates:function(t){return t.sort(((t,e)=>t.getTime()-e.getTime())),t},convertText:function(t){return t?(t.startsWith("base64:")&&(t=window.atob(t.substring(7))),t):t},decodeText:function(t){return t?(t=String(t),(t=Utils.convertText(t)).replace(/_leftbracket_/g,"[").replace(/_rightbracket_/g,"]").replace(/_dq_/g,'""').replace(/&quote;/gi,'"').replace(/_quote_/gi,'"').replace(/_qt_/gi,'"').replace(/_newline_/gi,"\n").replace(/newline/gi,"\n").replace(/_nl_/g,"\n")):null},handleActionResults:function(t,e){setTimeout((()=>{$.getJSON(e,(a=>{let n="";a.message&&(n=a.message.replace(/\n/g,"<br>")),$("#"+t).html(n),"running"==a.status&&Utils.handleActionResults(t,e)})).fail((e=>{$("#"+t).html("Error:"+e)}))}),1e3)},sumList:function(t){let e=0;return t.forEach((t=>{isNaN(t)||(e+=t)})),e},moveBefore:function(t,e,a){const n=(t=this.removeItem(t,a)).indexOf(e);return t.splice(n,0,a),t},toFront:function(t,e,a){const n=t.indexOf(a?e[0]:e);return n>-1&&(t.splice(n,1),a?t.push(...e):t.push(e)),t},toBack:function(t,e,a){const n=t.indexOf(a?e[0]:e);return n>-1&&(t.splice(n,1),a?t.unshift(...e):t.unshift(e)),t},makeKeyValueList:function(t){return Object.keys(t).map((e=>({key:e,value:t[e]})))},forEach:function(t,e){t&&t.forEach(e)},mergeLists:function(t,e,a,n,i){let l=[];return t&&t.map((t=>l.push(t))),e&&e.map((t=>l.push(t))),a&&a.map((t=>l.push(t))),n&&n.map((t=>l.push(t))),i&&i.map((t=>l.push(t))),l},getNameValue:function(t,e){if(!t)return null;for(var a={},n=t.split(","),i=0;i<n.length;i++){var l=n[i].split(":"),r=l[1].trim();e&&""==r||(r=r.replace(/_colon_/g,":"),a[l[0].trim()]=r)}return a},translatePoint:function(t,e,a,n,i,l){let r={x:t=+t,y:e=+e};if("nw"==i)r.x=t,r.y=e;else if("w"==i)r.x=t,r.y=e-n/2;else if("sw"==i)r.x=t,r.y=e-n;else if("s"==i)r.x=t-a/2,r.y=e-n;else if("se"==i)r.x=t-a,r.y=e-n;else if("e"==i)r.x=t-a,r.y=e-n/2;else if("ne"==i)r.x=t-a,r.y=e;else if("n"==i)r.x=t-a/2,r.y=e;else{if("c"!=i)throw new Error("Unknown point"+i);r.x=t-a/2,r.y=e-n/2}return null!=l&&(r.x+=+l.dx,r.y+=+l.dy),r},displayTimes:function(t,e,a,n){let i="",l=a?" ":"\n",r=a?" ":"\t";i+=t+l;for(var o=0;o<e.length-1;o++){let t=null;n&&o<n.length&&(t=n[o]),t||(t="time"+(o+1)),i+=r+t+": "+(e[o+1].getTime()-e[o].getTime())/1e3+l}console.log(i)},cloneList:function(t){return t?t.slice(0):null},removeElement:function(t,e){t||(t=[]);let a=t.indexOf(e);return a>=0&&t.splice(a,1),t},addUnique:function(t,e){return null==t&&(t=[]),t.includes(e)||t.push(e),t},replaceAll:function(t,e,a){let n=t.indexOf(e);return n<0?t:t.substring(0,n)+a+t.substring(n+e.length)},parseAttributes:function(t){let e,a={};for(;null!=(e=t.match(/([^ ]+) *= *"([^"]*)"/));)a[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+) *= *'([^']*)'/));)a[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+) *= *([^ ]*)( |$)/));)a[e[1].trim()]=e[2],t=Utils.replaceAll(t,e[0],"");for(;null!=(e=t.match(/([^ ]+)( |$)/));)a[e[1].trim()]="true",t=Utils.replaceAll(t,e[0],"");return a},parseAttributesAsList:function(t){let e=[],a=!1,n=!1,i="";for(let l=0;l<t.length;l++){let r=t[l],o='"'==r;n?(i+=r,n=!1):"\\"!=r?n?(i+=r,n=!1):o?a?(a=!1,e.push(i),i=""):a=!0:a||" "!=r&&"\n"!=r?i+=r:i.length>0&&(e.push(i),i=""):n?(i+=r,n=!1):n=!0}""!=i&&e.push(i);let l=[];return e.forEach((t=>{let e=t.indexOf("="),a=t,n="";e>=0&&(a=t.substring(0,e),n=t.substring(e+1)),l.push(a),l.push(n)})),l},hideMore:function(t){var e=GuiUtils.getDomObject("morelink_"+t),a=GuiUtils.getDomObject("morediv_"+t);hideObject(a),showObject(e)},showMore:function(t){var e=GuiUtils.getDomObject("morelink_"+t),a=GuiUtils.getDomObject("morediv_"+t);hideObject(e),showObject(a)},ramaddaUpdateMaps:function(){if("undefined"!=typeof ramaddaMaps)for(i=0;i<ramaddaMaps.length;i++){var t=ramaddaMaps[i];t.map&&t.map.updateSize()}},formDialogId:"",submitEntryForm:function(t){return Utils.popupFormLoadingDialog(t),!0},closeFormLoadingDialog:function(){$(Utils.formDialogId).dialog("close")},popupFormLoadingDialog:function(t){Utils.formDialogId=t,$(t).dialog({resizable:!1,height:100,modal:!0})},replaceRoot:function(t){var e=new RegExp("\\${root}");return t=t.replace(e,ramaddaBaseUrl)},loadScriptInfo:{},loadScript:function(t,e,a){let n="js:"+t,i=Utils.loadScriptInfo[n];if(i||(i=Utils.loadScriptInfo[n]={loaded:!1,loading:!1,callbacks:[]}),!a&&i.loaded)return e&&e(),!0;if(e&&i.callbacks.push(e),i.loading)return!1;i.loading=!0;let l=document.createElement("script");l.type="text/javascript",l.readyState?l.onreadystatechange=function(){"loaded"!==l.readyState&&"complete"!==l.readyState||(l.onreadystatechange=null,i.loaded=!0,i.callbacks.forEach((t=>t())))}:l.onload=function(){i.loaded=!0,i.callbacks.forEach((t=>t()))},i.callback=[],l.src=t,document.getElementsByTagName("head")[0].appendChild(l)},importJS:async function(t,e,a,n){t=this.replaceRoot(t);let i=this;var l="js:"+t;if(!n&&this.imports[l])return Utils.call(e);try{await $.ajax({url:t,dataType:"script",cache:!0,success:function(t){i.imports[l]=!0,Utils.call(e)}}).fail(((e,a,n)=>{console.log("initial importJS failed: "+t),console.log("error:"+n)}))}catch(n){try{await $.ajax({url:t,dataType:"text",success:function(a){console.log("got script as text -  "+t);var n=document.createElement("script");n.innerHTML=a,document.body.appendChild(n),Utils.call(e),i.imports[l]=!0}}).fail(((e,n,i)=>{a?a(e,n,i):console.log("importJS failed:"+t)}))}catch(t){}}},waitOn:async function(t,e){window[t]},importCSS:async function(t,e,a,n){var i="css:"+(t=this.replaceRoot(t));if(!n&&this.imports[i])return Utils.call(e);try{await $.ajax({url:t,dataType:"text",success:t=>{n||(this.imports[i]=!0),$('<style type="text/css">\n'+t+"</style>").appendTo("head"),Utils.call(e)}}).fail(a)}catch(t){}},doFetch:async function(t,e,a,n){t=this.replaceRoot(t);let i=!1;try{let l={url:t,success:function(t){Utils.call(e,t)}};n||(n="text/plain",l.beforeSend=function(t){t.overrideMimeType("text/plain;")}),l.xhrFields={responseType:n},await $.ajax(l).fail(((t,e,n)=>{i=!0,a&&a(t,e,n)}))}catch(t){i||Utils.call(a,t)}},formatXml:function(t,e){e&&$.extend({},e);let a,n=(new DOMParser).parseFromString(t,"text/xml"),i="";return a=function(t,e,n){let l="";for(let t=0;t<n;t++)l+="  ";if(n>5)i+=l+"...\n";else{if("#text"==t.nodeName){let e=t.nodeValue||"";return e=e.trim(),void(Utils.stringDefined(e)&&(i+=l+"text:"+e+"\n"))}if("#cdata-section"==t.nodeName)return i+=l+t.wholeText,void(i+="\n");""!=e&&(e+="."),e+=t.nodeName,i+=l+"&lt;"+HU.span(["data-path",e,TITLE,"Add path selector",STYLE,HU.css("cursor","pointer","text-decoration","underline"),CLASS,"ramadda-xmlnode"],t.nodeName)+"&gt;\n",t.childNodes.forEach((t=>{a(t,e,n+1)})),i+=l+"&lt;/"+t.nodeName+"&gt;\n"}},n.childNodes.forEach((t=>{if("parsererror"==t.nodeName)throw new Error("Parse error:"+t)})),n.childNodes.forEach((t=>{a(t,"",0)})),i},formatJson:function(t,e){var a=this.formatJsonInner(t,0,e);return this.formatJsonBlob(a,null,0,e)},formatJsonClick:function(t,e){var a=$("#"+e),n=$("#"+t);a.is(":visible")?(a.hide(),n.attr("src",icon_tree_closed)):(a.show(),n.attr("src",icon_tree_open))},formatJsonBlob:function(t,e,a,n){var i="";if(null!=e&&(i=e+": "),i+=t.value,t.inner){var l=HtmlUtils.getUniqueId(),r=HtmlUtils.image(icon_tree_closed,["id",l]),o=HtmlUtils.getUniqueId(),s="Utils.formatJsonClick('"+l+"','"+o+"')";i=HtmlUtils.div(["onclick",s,"class","json-label"],r+" "+i);var c=a<n?"block":"none";i+=HtmlUtils.div(["style","display:"+c+";","class","json-inner","id",o],t.inner)}return i},formatJsonInner:function(t,e,a){if(null==t)return{value:"null"};var n=typeof t;if("string"==n){var i="json-string";return t.match("^http")&&(i="json-url",t=HtmlUtils.href(t,t,["class",i])),{value:HtmlUtils.span(["class",i],'"'+t+'"')}}if("number"==n||"boolean"==n)return{value:HtmlUtils.span(["class","json-"+n],t)};if(t.toISOString)return{value:HtmlUtils.span(["class","json-date"],'"'+t.toISOString()+'"')};if("function"==n){var l=(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"");return l=(l=l.replace(/[/][*][^\/*]*[*][/]/g,"")).split("){",1)[0].replace(/^[^\(]*[\(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean),{value:HtmlUtils.span(["class","json-function"],t.name+"("+l+") {...}")}}var r=Array.isArray(t),o=r?HtmlUtils.span(["class","json-number"],"["+t.length+"]"):"",s=HtmlUtils.openTag("div"),c=[],d=[];if(r){for(var u=0;u<t.length;u++)c.push(u),d.push(u);0==d.length&&(s+=this.formatJsonBlob({value:HtmlUtils.span(["class","json-none"],"[]")},null,e+1,a))}else{for(var f in t)c.push(f),d.push(f);0==d.length&&(s+=this.formatJsonBlob({value:HtmlUtils.span(["class","json-none"],"No properties")},null,e+1,a))}for(u=0;u<d.length;u++){s+="<div>";var h=Utils.formatJsonInner(t[d[u]],e+1,a);s+=this.formatJsonBlob(h,c[u],e+1,a),s+="</div>"}return{value:o,inner:s+="</div>"}},padLeft:function(t,e,a){for(t=""+t,a||(a=" ");t.length<e;)t=a+t;return t},reverseArray:function(t){for(var e=[],a=t.length-1;a>=0;a--)e.push(t[a]);return e},makeArray:function(t){return Array.isArray(t)?t:[t]},getUniqueId:function(t){return HtmlUtils.getUniqueId(t)},uuidv4:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))},splitList:function(t,e){let a=[];if(t.length<e)a.push(t);else{let n=Math.ceil(t.length/e),i=Math.ceil(t.length/n),l=[];a.push(l),t.forEach((t=>{l.length>=i&&(l=[],a.push(l)),l.push(t)}))}return a},removeItem:function(t,e){for(var a=t.length-1;a>=0;a--)t[a]==e&&t.splice(a,1);return t},getStack:function(t){Utils.isDefined(t)||(t=100);let e="",a=new Error;if(!a.stack)return"no stack available";let n=Utils.split(a.stack,"\n",!0,!0);for(let a=1;a<t&&a<n.length;a++){let t=n[a];t=Utils.split(t,"@");let i=t[1].match(/\/([^/]+)$/);e=e+"  "+t[0]+":"+i[1].replace(/:[^:]+$/,"")+"\n"}return e},normalize:function(t){let e=Math.min(...t.filter((t=>!isNaN(t)))),a=Math.max(...t.filter((t=>!isNaN(t))))-e;return t.map((t=>0==a?0:(t-e)/a))},getBoolean:function(t){return!!Utils.isDefined(t)&&Utils.getProperty(t)},getProperty:function(t){if(Utils.isDefined(t)){if("string"!=typeof t)return t;let e=String(t).trim();return"true"===e||"false"!==e&&t}return null},triggerDownload:function(t){let e=document.createElement("a");if(e.href=t,e.target="_download",document.createEvent){let t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}else e.click()},join:function(t,e,a){void 0===a&&(a=0);for(var n="",i=a;i<t.length;i++)i>a&&(n+=e),n+=t[i];return n},wrap:function(t,e,a){if(!t)return null;let n="";return t.forEach((t=>{n+=e+t+a})),n},parseMap:function(t,e,a){if(null==t)return null;let n=t.split(e??","),i={};for(var l=0;l<n.length;l++){let t=n[l],e=t.indexOf(a??":");if(e>=0){let a=t.substring(0,e),n=t.substring(e+1);i[a]=n}}return i},getUniqueValues:function(t){for(var e=[],a={},n=0;n<t.length;n++){var i=t[n];this.isDefined(a[i])||(a[i]=!0,e.push(i))}return e},getMacro:function(t){return"${states}"==t?"Alabama,Alaska,Arizona,Arkansas,California,Colorado,Connecticut,Delaware,District of Columbia,Florida,Georgia,Hawaii,Idaho,Illinois,Indiana,Iowa,Kansas,Kentucky,Louisiana,Maine,Maryland,Massachusetts,Michigan,Minnesota,Mississippi,Missouri,Montana,Nebraska,Nevada,New Hampshire,New Jersey,New Mexico,New York,North Carolina,North Dakota,Ohio,Oklahoma,Oregon,Origin State,Pennsylvania,Rhode Island,South Carolina,South Dakota,Tennessee,Texas,Utah,Vermont,Virginia,Washington,West Virginia,Wisconsin,Wyoming":t},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesShortShort:["S","M","T","W","Th","F","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],createDate:function(t,e){let a=Utils.createDateInner(t);return a&&e&&(a=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours()-e,a.getUTCMinutes(),a.getUTCSeconds()))),a},createDateInner:function(t,e){if(!t)return t;if(t.getTime)return t;t=t.trim();let a=new RegExp("^(\\+|-)?([0-9]+) *(minute|hour|day|week|month|year)s?$"),n=t.match(a);if(n){let t=parseFloat(n[1]+n[2]),a=n[3];e||(e=new Date);let i=e.getTime();return"minute"==a||"minutes"==a?new Date(i+1e3*t*60):"hour"==a||"hours"==a?new Date(i+1e3*t*60*60):"day"==a||"days"==a?new Date(i+1e3*t*60*60*24):"week"==a||"weeks"==a?new Date(i+1e3*t*60*60*24*7):"month"==a||"months"==a?new Date(i+1e3*t*60*60*24*7*31):new Date(i+1e3*t*60*60*24*365)}if(t.match(/^[0-9,-]+$/)){let e=t.split(","),a=t.split("-");n=a.length>e.length?a:e;let i=0,l=t=>t>=n.length?null:1==t?+n[t]-1:+n[t];return new Date(Date.UTC(l(i++),l(i++),l(i++),l(i++),l(i++),l(i++)))}return new Date(t)},minutesSince:function(t){return Math.round(this.toMinutes((new Date).getTime()-t))},toMinutes:function(t){return t/1e3/60},formatHour:function(t,e){let a=e?"":"&nbsp;";return 0==t?"12"+a+"AM":12==t?"12"+a+"PM":t>12?t-12+a+"PM":t+a+"AM"},formatDateMonthDayYear:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date";var n=this.monthNames[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+" "+i+", "+t.getUTCFullYear()},formatDateYearMonth:function(t,e,a){return isNaN(t.getUTCMonth())?"Unknown date":this.monthNames[t.getUTCMonth()]+", "+t.getUTCFullYear()},formatDateMonthDay:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date";var n=this.monthNames[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+" "+i},formatDateMonDay:function(t,e,a){if(isNaN(t.getUTCMonth()))return"NA";var n=this.monthNamesShort[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+"-"+i},formatDateMDY:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=this.monthNamesShort[t.getUTCMonth()],i=t.getUTCDate();return i<10&&(i="0"+i),n+" "+i+", "+t.getUTCFullYear()},formatDateYYYYMMDD:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;n<10&&(n="0"+n);var i=t.getUTCDate();return i<10&&(i="0"+i),t.getUTCFullYear()+"-"+n+"-"+i},formatDateYYYYMMDDHHMM:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;let n=t.getUTCMonth()+1;n<10&&(n="0"+n);let i=t.getUTCDate();i<10&&(i="0"+i);let l=t.getUTCHours();l<10&&(l="0"+l);let r=t.getUTCMinutes();r<10&&(r="0"+r);let o=l+":"+r;return t.getUTCFullYear()+"-"+n+"-"+i+" "+o},formatDateYYYYMMDDHHMMSS:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;n<10&&(n="0"+n);var i=t.getUTCDate();i<10&&(i="0"+i);var l=t.getUTCHours()+1;l<10&&(l="0"+l);var r=t.getUTCMinutes();r<10&&(r="0"+r);var o=t.getUTCSeconds();o<10&&(o="0"+o);let s=l+":"+r+":"+o;return t.getUTCFullYear()+"-"+n+"-"+i+" "+s},formatDateYYYYMMDDHH:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;n<10&&(n="0"+n);var i=t.getUTCDate();i<10&&(i="0"+i);var l=Utils.formatHour(t.getUTCHours(),!0);return t.getUTCFullYear()+"-"+n+"-"+i+" "+l},formatDateYYYYMM:function(t,e,a){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;var n=t.getUTCMonth()+1;return n<10&&(n="0"+n),t.getUTCFullYear()+"-"+n},formatDateMMDD:function(t,e){if(isNaN(t.getUTCMonth()))return"Unknown date:"+t;let a=t.getUTCMonth()+1;a<10&&(a="0"+a);let n=t.getUTCDate();return n<10&&(n="0"+n),a+(e||"-")+n},formatDateHHMM:function(t,e){let a=t.getUTCHours();a<10&&(a="0"+a);let n=t.getUTCMinutes();return n<10&&(n="0"+n),a+":"+n},formatDateYYYY:function(t,e,a){return t.getUTCFullYear()},formatDateYYYYWeek:function(t,e,a){return t.getUTCFullYear()+" week:"+this.formatDateWeek(t)},formatDateWeek:function(t){var e=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-e)/864e5+1)/7)},formatDateWithFormat(t,e,a){if(null==e){if(a)return null;e="yyyymmdd"}let n=e.toLowerCase();return"yyyymmdd"==n?Utils.formatDateYYYYMMDD(t):"yyyymmddhh"==n?Utils.formatDateYYYYMMDDHH(t):"yyyymmddhhmm"==n?Utils.formatDateYYYYMMDDHHMM(t):"yyyymmddhhmmss"==n?Utils.formatDateYYYYMMDDHHMMSS(t):"yyyymm"==n?Utils.formatDateYYYYMM(t):"yearmonth"==n?Utils.formatDateYearMonth(t):"monthdayyear"==n?Utils.formatDateMonthDayYear(t):"monthday"==n?Utils.formatDateMonthDay(t):"mon_day"==n?Utils.formatDateMonDay(t):"mdy"==n?Utils.formatDateMDY(t):"hhmm"==n?Utils.formatDateHHMM(t):String(t.format(e,"UTC:",!0))},dateOptions:{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},formatDate:function(t,e,a){return this.formatDateWithFormat(t,"yyyy-mm-dd HH:MM")},incrementYear:function(t,e){return null==e&&(e=1),t.setUTCFullYear(t.getUTCFullYear()+e),t},incrementMonth:function(t,e){for(null==e&&(e=1);e>0;)11==t.getUTCMonth()?(t.setUTCFullYear(t.getUTCFullYear()+1),t.setUTCMonth(0)):t.setUTCMonth(t.getUTCMonth()+1),e--;return t},incrementDay:function(t,e){return null==e&&(e=1),t.setTime(t.getTime()+1e3*e*3600*24),t},getDayInYear:function(t){return(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())-Date.UTC(t.getUTCFullYear(),0,0))/24/60/60/1e3},monthShortNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthLongNames:["January","February","March","April","May","June","July","August","September","October","November","December"],getMonthShortNames:function(){return this.monthShortNames},xparseDate:function(t){return t=t.replaceAll(/\+0000$/,""),new Date(t)},dateRegex:new RegExp("(rel|now|today)(\\+|-)(.*)","i"),parseDate:function(t,e,a){if(null==t)return null;if("NA"==t)return null;if("number"==typeof t)return new Date(t);if(""==(t=t.trim()))return null;var n=t.match(this.dateRegex),i=0;null!=n&&(i=parseFloat(n[3]),"-"==n[2]&&(i=-i),t=n[1]);var l=null;if("now"==t);else if("rel"==t){if(null==a)return null;l=new Date(a.getTime())}else{if("today"!=t){let e=Date.parse(t);if(isNaN(e)){let e=t.split(/[^0-9]/).map((t=>parseInt(t,10)));return new Date(e[0],e[1]-1||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0)}return new Date(e)}(l=new Date(Date.now())).setMilliseconds(0),l.setSeconds(0),l.setMinutes(0),e&&l.setHours(24)}return 0!=i&&l.setDate(l.getDate()+i),l},makeDownloadFile:function(t,e){var a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},later:function(t){t&&setTimeout(t,1)},call:function(t,e,a,n,i){if(t){var l=[];Utils.isDefined(e)&&l.push(e),Utils.isDefined(a)&&l.push(a),Utils.isDefined(n)&&l.push(n),Utils.isDefined(i)&&l.push(i),t.apply(this,l)}return e},isTrue:function(t){return null!==t&&"true"==String(t)},isDefined:function(t){let e=!0;Array.from(arguments).every((t=>(null==t&&(e=!1),e)));return e},makeLabel:function(t,e){return t=String(t).trim(),e||(t=t.replace(/([a-z]+)([A-Z])/g,"$1 $2")),t=t.replace(/_/g," ").replace(/  +/g," ").replace(/-+/g," "),t=this.camelCase(t)},makeID:function(t){return Utils.makeId(t)},makeId:function(t){return t=(t=(t=(t=(t=(t=(t=String(t)).replace(/[^\x00-\x7F]/g,"_")).replace(/&/g,"_")).replace(/\./g,"_")).replace(/[:\//]+/g,"_")).replace(/_+$/,"")).trim().toLowerCase().replace(/ /g,"_")},camelCase:function(t,e){if(!t)return t;let a="",n=t.split(" ");for(let t=0;t<n.length;t++){let i=n[t],l=i.substring(0,1);(t>>0||!e)&&(l=l.toUpperCase()),i.length>1&&(l+=i.substring(1).toLowerCase()),""!=a&&(a+=" "),a+=l}return a},stripTags:function(t){return t.replace(/(<([^>]+)>)/gi," ")},articles:"that,this,they,those,with,them,their,have,than,there,when,more,much,many,will,were".split(","),stopWords:["not","no","will","must","just","a","about","above","after","again","against","all","am","an","and","any","are","as","at","be","because","been","before","being","below","between","both","but","by","could","did","do","does","doing","down","during","each","few","for","from","further","had","has","have","having","he","he'd","he'll","he's","her","here","here's","hers","herself","him","himself","his","how","how's","i","i'd","i'll","i'm","i've","if","in","into","is","it","it's","its","itself","let's","me","more","most","my","myself","nor","of","on","once","only","or","other","ought","our","ours","ourselves","out","over","own","same","she","she'd","she'll","she's","should","so","some","such","than","that","that's","the","their","theirs","them","themselves","then","there","there's","these","they","they'd","they'll","they're","they've","this","those","through","to","too","under","until","up","very","was","we","we'd","we'll","we're","we've","were","what","what's","when","when's","where","where's","which","while","who","who's","whom","why","why's","with","would","you","you'd","you'll","you're","you've","your","yours","yourself","yourselves"],tokenizeWords:function(t,e,a,n){e||(e=this.stopWords);for(var i=[],l=(t=t.replace(/https?:\/\/[^ ]+/g," ")).split(/[ ,\(\)\.:\;\n\?\-!\*]/),r=0;r<l.length;r++){var o=l[r].trim();if(""!=o){var s=o.toLowerCase();e.includes(s)||a&&a.includes(s)||n&&this.articles.includes(s)||o.match(/^[0-9]+$/)||i.push(o)}}return i},stringEquals:function(t,e){return null===t&&null===e||null!==t&&null!==e&&new String(t).valueOf()===new String(e).valueOf()},stringDefined:function(){for(let t=0;t<arguments.length;t++){let e=arguments[t];if(!Utils.isDefined(e))return!1;if(null==e||""==e)return!1}return!0},getStringDefined:function(){for(let t=0;t<arguments.length;t++)if(Utils.stringDefined(arguments[t]))return arguments[t];return null},getDefined:function(){for(let t=0;t<arguments.length;t++){let e=arguments[t];if(Utils.isDefined(e))return e}return null},tokenizeMacros:function(s,args,debug){let opts={};args&&$.extend(opts,args);let hook=opts.hook,tokens=[],tokenMap={},cnt=0;for(;s.length>0;){let t=s.indexOf("${");if(t<0)break;let e=s.substring(0,t);""!=e&&tokens.push({type:"string",s:e}),s=s.substring(t);let a="",n=0,i=!1;for(;n<s.length;){let t=s.charAt(n++);if('"'!=t&&"'"!=t){if("}"==t&&!i)break;a+=t}else i=!i,a+=t}if(n>s.length)break;s=s.substring(n);let l=a.substring(2),r={};t=l.indexOf(" ");let o="";if(t<0)o=l;else{o=l.substring(0,t).trim();let e=l.substring(t).trim();r=Utils.parseAttributes(e),debug&&console.dir(r)}let c={id:String(cnt++),attrs:r,tag:o,macro:l};tokens.push(c),tokenMap[o]=c}return""!=s&&tokens.push({type:"string",s:s}),{tokens:tokens,tokenMap:tokenMap,getAttributes:function(t){let e=this.tokenMap[t];return e?e.attrs:null},apply:function(source,debug,handler){let cnt=0,tokenFunc=t=>{let has=e=>Utils.isDefined(t.attrs[e])||Utils.isDefined(t.attrs[e.toLowerCase()]),get=e=>t.attrs[e]??t.attrs[e.toLowerCase()],value=source[t.tag];if(!value){let e=Object.keys(source);e.every((e=>e.match(t.tag)?(value=source[e],!1):(t.tag.indexOf("|")&&t.tag.split("|").every((t=>t!=e&&!e.match(t)||(value=source[e],!1))),!value)))}let s="";if("func"==t.tag){let f=t.attrs.f;if(!f)return"&lt;no function defined&gt;";let code="function macroFunc() {\n";for(a in source){if("default"==a)continue;let t=source[a];"number"!=typeof t&&(t='"'+t+'"'),code+=a+"="+t+";\n"}code+="return "+f+";\n}\n",code+="macroFunc()";try{value=eval(code)}catch(t){return console.log("Error applying macro function:"+code+"\n"+t),"&lt;Error:"+t+"&gt;"}}if(t.attrs.nonblank&&0==String(value).length)return"";if(!Utils.isDefined(value))return"${"+t.macro+"}";if(value.getTime){let e=t.attrs.offset??opts.timezoneOffset,a="";if(t.attrs.localTime){let t=60*(new Date).getTimezoneOffset()*1e3;value=new Date(value.getTime()-t)}return Utils.formatDateWithFormat(value,t.attrs.format||opts.dateFormat)+a}if(t.attrs.display&&handler){let e=handler(t,value);if(!1!==e)return e}if(t.attrs.missing&&(""==value||isNaN(value)))return t.attrs.missing;if(t.attrs.bar){let e=t.attrs.min||0,a=t.attrs.max;if(""==value||isNaN(value))return t.attrs.missing||value;if(Utils.isDefined(e,a)){let n=t.attrs.color||"#4E79A7",i=t.attrs.width||"100%",l=parseFloat(t.attrs.height||12),r=100-100*(value-e)/(a-e)+"%",o=t.attrs.border||"1px solid #ccc",s=t.attrs.includeValue||!0,c=HU.div([TITLE,value+"/"+a,STYLE,HU.css("display","inline-block","position","relative","height",l+2+"px","width",i,"border",o,"border-left","none")],HU.div([STYLE,HU.css("position","absolute","left","0px","right",r,"height",l+"px","background",n)]));return s?HU.row([["width","1%"],value],c):c}}if(t.attrs.stars){if(""==value||isNaN(value))return t.attrs.missing||value;let e=t.attrs.count||5,a=t.attrs.min||0,n=t.attrs.max;if(Utils.isDefined(a,n)){let i=t.attrs.color||"#F9CF03",l="",r="";for(let t=0;t<e;t++)l+=HU.getIconImage("far fa-star",null,[STYLE,HU.css("font-size","10pt","color","#000")]),r+=HU.getIconImage("fas fa-star",null,[STYLE,HU.css("font-size","10pt","color",i)]);let o=100-100*(value-a)/(n-a)+"%",s=t.attrs.includeValue||!0,c=HU.div([TITLE,value+"/"+n,STYLE,HU.css("display","inline-block","position","relative")],l+HU.div([STYLE,HU.css("white-space","nowrap","overflow-x","hidden","position","absolute","left","0px","right",o,"top","0px","bottom","0px")],r));return s?HU.row([["width","1%"],value],c):c}}if(Utils.isDefined(t.attrs.nan)&&isNaN(value)&&(value=t.attrs.nan),(t.attrs.positiveTemplate||t.attrs.negativeTemplate)&&(value=+value,value>=0?t.attrs.negativeTemplate&&(value=t.attrs.positiveTemplate.replace("${value}",value)):t.attrs.negativeTemplate&&(t.attrs.doAbsolute&&(value=-value),value=t.attrs.negativeTemplate.replace("${value}",value))),t.attrs.youtube)return 0==value.trim().length?null:(s+=Utils.embedYoutube(value,t.attrs),s);if(t.attrs.list)return value=String(value),s+="<ul>",value.split("\n").forEach((t=>{""!=(t=t.trim())&&(s+="<li> "+t)})),s+="</ul>",s;if(t.attrs.pre)return value=String(value),""!=value.trim()&&(value="<pre class=thin_pre>"+value.trim()+"</pre>"),value;if(t.attrs.showUrl){let e=t.attrs.label||value;value=HU.href(value,e,["target","_other","style",t.attrs.style||""])}if(t.attrs.delimiter&&t.attrs.fields){let e=[];Utils.stringDefined(value)&&e.push(value),t.attrs.fields.split(",").forEach((t=>{let a=source[t];Utils.stringDefined(a)&&e.push(a)})),value=Utils.join(e,t.attrs.delimiter)}if(t.attrs.urlField){let e=source[t.attrs.urlField];Utils.stringDefined(e)&&(value=HU.href(e,value))}if(t.attrs.offset1&&(value+=parseFloat(t.attrs.offset1)),t.attrs.scale&&(value*=parseFloat(t.attrs.scale)),t.attrs.offset2&&(value+=parseFloat(t.attrs.offset2)),t.attrs.decimals){value=parseFloat(value);let e=Math.pow(10,t.attrs.decimals);value=Math.floor(value*e)/e}if(t.attrs.format){let e=t.attrs.format;"comma"==e&&(isNaN(value)?value=0:0!=value&&(value=Utils.formatNumberComma(value)))}if(t.attrs.lowercase&&(value=String(value).toLowerCase()),t.attrs.uppercase&&(value=String(value).toUpperCase()),t.attrs.camelcase&&(value=Utils.camelCase(String(value),!0)),t.attrs.trim&&value.length>t.attrs.trim&&(value=value.substring(0,t.attrs.trim),t.attrs.ellipsis&&(value+="...")),t.attrs.replace){let e=t.attrs.replace;"_space_"==e&&(e=" ");let a=t.attrs.with??" ";("_nl_"==a||"\\n"==a)&&(a="\n");let n=new RegExp(e,"g");value=value.replace(n,a)}if(t.attrs.suffix&&(value+=t.attrs.suffix),t.attrs.prefix&&(value=t.attrs.prefix+value),t.attrs.toggle,t.attrs.image&&(Utils.stringDefined(value)&&t.attrs.urlPrefix&&(value=t.attrs.urlPrefix+value),!Utils.stringDefined(value)&&t.attrs.defaultUrl&&(value=t.attrs.defaultUrl),""!=value)){let e="";if(t.attrs.title)for(a in e=t.attrs.title,source)e=e.replace("{"+a+"}",source[a]);let n=["title",e,"data-caption",e];t.attrs.height?(n.push("height"),n.push(t.attrs.height)):(n.push("width"),n.push(t.attrs.width||"100%")),n.push("loading"),n.push("lazy");let i=value;if(value=HtmlUtils.image(i,n),t.attrs.doPopup){t.attrs.popupBase||(t.attrs.popupBase="gallery"+Utils.getUniqueId());let a=t.attrs.popupBase;value=HU.href(i,value,[CLASS,"popup_image","data-fancybox","fancybox","data-caption",e,"title",e])}}if(t.attrs.images&&""!=value){let e;value=value.trim(),e=value.startsWith("[")?JSON.parse(value):t.attrs.delimiter?value.split(t.attrs.delimiter):value.split(";");let n="";if(t.attrs.title)for(a in n=t.attrs.title,source)n=n.replace("{"+a+"}",source[a]);let i=["title",n];t.attrs.height?(i.push("height"),i.push(t.attrs.height)):(i.push("width"),i.push(t.attrs.width||"100%")),console.log("VALUE:"+value),value="",e.forEach((t=>{value+=HtmlUtils.image(t,i)})),console.log(value)}if(t.attrs.convertDegrees){let t=[["NNE",11.25,33.75],["NE",33.75,56.25],["ENE",56.25,78.75],["E",78.75,101.25],["ESE",101.25,123.75],["SE",123.75,146.25],["SSE",146.25,168.75],["S",168.75,191.25],["SSW",191.25,213.75],["SW",213.75,236.25],["WSW",236.25,258.75],["W",258.75,281.25],["WNW",281.25,303.75],["NW",303.75,326.25],["NNW",326.25,348.75]],e="N";return value=+value,t.every((t=>!(value>=t[1]&&value<=t[2])||(e=t[0],!1))),e}if(t.attrs.template&&(value=t.attrs.template.replace("{value}",value)),t.attrs.templateif){let e=t.attrs.templateif.split(":"),a=e[0],n=e.slice(1).join(":");value=String(value),value.match(a)&&(value=n.replace("{value}",value))}let maxLength=t.attrs.maxLength??t.attrs.maxlength;if(maxLength&&value.length>+maxLength&&(value=value.substring(0,+maxLength),(t.attrs.maxLengthSuffix??t.attrs.maxlengthsuffix)&&(value+=t.attrs.maxLengthSuffix)),t.attrs.cropLength&&value.length>+t.attrs.cropLength){let e=+t.attrs.cropLength;for(;e>=0&&" "!=value[e]&&"\n"!=value[e]&&"\t"!=value[e];)e--;if(0==e)for(;e<value.length&&" "!=value[e]&&"\n"!=value[e]&&"\t"!=value[e];)e++;let a=Utils.getUniqueId(),n=value.substring(0,e)+HU.span([ID,a+"_ellipsis"],"..."),i=HU.span([ID,a+"_post",STYLE,HU.css("display","none")],value.substring(e)),l=HU.div(["onclick","Utils.toggleShowMore('"+a+"')",ID,a,CLASS,"ramadda-showmore "+CLASS_CLICKABLE],"Show More "+HU.getIconImage("fas fa-sort-down"));value=n+i+l}return t.attrs.tableRow&&(value="<tr><td align=right>"+t.attrs.label+":</td><td>"+value+"</td></tr>"),has("prefixLabel")&&(value=get("label")+": "+value),has("maxHeight")&&(value=HU.div([STYLE,HU.css("display","inline-block","max-height",HU.getDimension(get("maxHeight")),"overflow-y","auto")],value)),has("maxWidth")&&(value=HU.div([STYLE,HU.css("display","inline-block","white-space","nowrap","max-width",HU.getDimension(get("maxWidth")),"overflow-x","auto")],value)),s+=value,s},s="";return this.tokens.forEach((t=>{if("string"==t.type)s+=t.s;else{let e=null;if(hook&&(e=hook(t,source[t.tag])),e||(e=tokenFunc(t)),!e)return;e.trim().length>0&&t.attrs.toggle&&(e=HU.toggleBlock(t.attrs.label||"More",e)),s+=e}})),s},getText:function(){let t=0,e="";return this.tokens.map((a=>{"string"==a.type?e+=a.s:(e+="${macro"+t+"}",t++)})),e}}},embedAudio:function(t){return HU.tag("audio",["controls",null],HU.tag("source",["src",t,"type","audio/mpeg"],"Your browser does not support the audio tag."))},embedYoutube:function(t,e){e=e||{};let a=t.match(/.*watch\?v=(.*)$/);if(a&&2==a.length||(a=t.match(/.*youtu.be\/(.*)$/)),!a||2!=a.length)return HU.href(t,t);let n="//www.youtube.com/embed/"+a[1]+"?enablejsapi=1&autoplay="+("true"==(e.autoplay||"false")?"1":"0")+"&playerapiid=video_1",i="";return e.includeLink&&(i+=HU.href(t,"Link")+"<br>"),i+=HU.tag("iframe",[ID,"ytplayer","allow","autoplay; fullscreen","type","text/html","frameborder","0",WIDTH,e.width||640,HEIGHT,e.height||360,SRC,n]),i},toggleShowMore:function(t){let e=$("#"+t),a=e.attr("open");a=!a,e.attr("open",a),a?($("#"+t+"_ellipsis").hide(),$("#"+t+"_post").show(),e.html("Show Less "+HU.getIconImage("fas fa-sort-up"))):($("#"+t+"_ellipsis").show(),$("#"+t+"_post").hide(),e.html("Show More "+HU.getIconImage("fas fa-sort-down")))},formatNumberComma:function(t,e,a){if(!Utils.isDefined(t))return"NA";let n=Math.floor(t),i=t-n,l=n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");if(0==i)return l;{let n=Math.abs(t);Utils.isDefined(e)||(e=n>=9999?0:n>=999?1:n>=99?2:n>=9?3:4);let i=number_format(t,e);return a&&console.log(t,e,i),i}},formatFileLength:function(t){return t<0?"":t<5e3?Math.round(t)+" bytes":t<1e6?(t=Math.round(100*t/1e3)/100,Math.round(t)+" KB"):(t=Math.round(100*t/1e6)/100)+" MB"},numberToString:null,trimDecimals:function(t,e){if(0==e)return parseInt(t);return t=parseFloat(t),parseInt(t*Math.pow(10,e))/Math.pow(10,e)},roundDecimals:function(t,e,a){null==this.numberToString&&(this.numberToString=new Intl.NumberFormat("fullwide",{useGrouping:!1}));let n=this.numberToString.format(t),i=Number(Math.round(n+"e"+e)+"e-"+e);return a&&console.log("decimals:"+n+" "+Math.round(n+"e"+e)),i},formatNumber:function(t,e,a){let n=this.formatNumberInner(t,a);return e?parseFloat(n):n},formatNumberInner:function(t,e){var a=Math.abs(t);if(a==Math.floor(a))return String(t);if(a>1e3)return number_format(t,0);if(a>100)return number_format(t,1);if(a>10)return number_format(t,2);if(a>1)return number_format(t,3);{let a=""+(t-Math.floor(t));return number_format(t,Math.min(a.length-2,5),e)}},isRealNumber:function(t){return!(t==Number.POSITIVE_INFINITY||isNaN(t)||!Utils.isNumber(t)||!Utils.isDefined(t)||null==t)},isNumber:function(t){return null!=t&&("number"==typeof t||!isNaN(t-0))},isType:function(t,e){return!(!t||typeof t!=e)},cleanId:function(t){return t=(t=t.replace(/:/g,"_").replace(/\./g,"_").replace(/=/g,"_").replace(/\//g,"_").replace(/[\(\)]/g,"_")).replace(/[^a-zA-Z0-9_]/g,"_")},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isFalse:function(t){return void 0!==t&&0==t},toFloat:function(t,e){return null==t||""==String(t).trim()?void 0!==e?e:NaN:parseFloat(t)},getUrlArgs:function(t){t=t.split("+").join(" ");for(var e,a={},n=/[?&]?([^=]+)=([^&]*)/g;e=n.exec(t);)a[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return a},checkTabs:function(t){for(;;){var e=new RegExp('id="(tabId[^"]+)"').exec(t);if(!e)break;var a=e[1];a.indexOf("-")<0&&jQuery((function(){jQuery("#"+a).tabs()}));var n=t.indexOf('id="tabId');if(n<0)break;t=t.substring(n+20)}},initRangeSelect:function(){let t=$(".ramadda-range-select"),e=function(){let t=$(this).attr("to-id");"between"==$(this).val()?$("#"+t).show():$("#"+t).hide()};t.each(e),t.change(e)},initNavbarPopup:function(t,e){let a={side:"right"};e&&$.extend(a,e),jqid(t).click((function(){let e=jqid(t+"_popup");if(e.is(":visible"))return void e.hide();e.css("display","inline-block");let n={of:$(this),my:a.side+" top",at:a.side+" bottom",collision:"fit fit"};e.show(400),e.position(n)}))},initPageReload:function(t,e,a){let n=$("#"+e),i=$("#"+e+"_label");n.length>0&&n.change((()=>{let l="Reload"+HtmlUtils.span([STYLE,"color:transparent"]," in 00  seconds");i.html(l),n.is(":checked")&&Utils.checkPageReload(t,e,a)})),(0==n.length||n.is(":checked"))&&Utils.checkPageReload(t,e,a)},checkPageReloadPending:!1,checkPageReload:function(t,e,a){let n=$("#"+e),i=$("#"+e+"_label");if(!(n.length>0)||n.is(":checked"))if(t<=0)location.reload();else{if(a){let e="Reload in "+t+" seconds";i.html(e)}t<=5?i.css("background","#eee"):i.css("background","transparent"),Utils.checkPageReloadPending||(Utils.checkPageReloadPending=!0,setTimeout((()=>{Utils.checkPageReloadPending=!1,Utils.checkPageReload(t-1,e,a)}),1e3))}},areDisplaysReady:function(){if(!Utils.getPageLoaded())return 0;if(0==Utils.displaysList.length)return 1;let t=!0;return Utils.displaysList.forEach((e=>{e.isDisplayFinished&&(e.isDisplayFinished()||(t=!1))})),t?1:0},checkForResize:function(){$(window).resize((()=>{this.pendingResizeTimeout&&(clearTimeout(this.pendingResizeTimeout),this.pendingResizeTimeout=null);this.pendingResizeTimeout=setTimeout((()=>{for(let t=0;t<Utils.displaysList.length;t++){let e=Utils.displaysList[t];e.handleWindowResize&&e.handleWindowResize()}this.pendingResizeTimeout=null}),1e3)}))},displaysList:[],displaysMap:[],addDisplay:function(t){this.displaysList.push(t),t.getId&&(this.displaysMap[t.getId()]=t),t.displayId&&(this.displaysMap[t.displayId]=t)},removeDisplay:function(t){let e=this.displaysList.indexOf(t);e>=0&&this.displaysList.splice(e,1),t.getId&&delete this.displaysMap[t.getId()],t.displayId&&delete this.displaysMap[t.displayId]},initDisplays:function(){this.displaysList.forEach((t=>{if(t.pageHasLoaded){new Date;t.pageHasLoaded();new Date}}))},getPageLoaded:function(){return this.pageLoaded},initBigText:function(t){let e=t.html(),a=t.attr("bigtext-length")??400;if(e.length<a)return;let n=t.attr("bigtext-label-more")??"More...",i=t.attr("bigtext-label-less")??"Less...",l=t.attr("bigtext-height")??"100px",r=HU.getUniqueId("fade_");t.css("padding-bottom","25px").css("max-height",l).css("overflow-y","hidden").css("position","relative");let o=$(HU.div([ATTR_STYLE,HU.css("height",t.attr("bigtext-fade-height")??"50px"),ATTR_ID,r,ATTR_CLASS,"ramadda-bigtext-fade"])).appendTo(t),s=HU.div([ATTR_TITLE,"Expand",ATTR_CLASS,"ramadda-clickable ramadda-bigtext-toggle"],n);s=$(s).appendTo(t);let c=!1;s.click((function(){c=!c,c?(o.hide(),s.html(i),t.css("max-height","1000px")):(s.html(n),t.css("max-height",l),o.show())}))},initContent:function(t){t?t+=" ":t="";try{let e=$(t+".ramadda-table");e.length&&HtmlUtils.formatTable(e)}catch(t){console.log("Error formatting table:"+t),console.log(t.stack)}$(t+".ramadda-bigtext").each((function(){Utils.initBigText($(this))})),$(t+".ramadda-snippet-hover").each((function(){let t=$(this),e=t.html(),a="ramadda-snippet-popup";e.length>200&&(a+=" ramadda-snippet-popup-large");let n=$(this).attr("hover-target")?jqid($(this).attr("hover-target")):t.parent();n.parent().attr("title",""),n.tooltip({content:()=>e,position:{my:"left+15 top",at:"left bottom-50"},classes:{"ui-tooltip":a},show:{effect:"slideDown",delay:600,duration:600}})}));let e=$(t+".ramadda-page-title"),a=$(t+".ramadda-header-fixedtitle");e.length&&a.length&&(e=e.first(),a=a.first(),$(window).scroll((()=>{e.offset().top<a.offset().top+a.height()+10?this.showingHeaderCenter||(this.showingHeaderCenter=!0,a.html(e.html()),e.html("&nbsp;")):this.showingHeaderCenter&&(this.showingHeaderCenter=!1,e.html(a.html()),a.html("&nbsp;"))}))),$(t+":submit").button().click((function(t){})),$(t+".ramadda-button").button().click((function(t){}));let n=$(t+".ramadda-linkable");n.mouseenter((function(){let t=$(this).attr("id");t&&($("#"+t+"-hover").html(HtmlUtils.getIconImage("fa-link",null,[STYLE,"font-size:10pt;"])),$("#"+t+"-hover").show())})),n.click((function(){let t=$(this).attr("id");t&&HU.scrollToAnchor(t,-50)})),n.mouseleave((function(){let t=$(this).attr("id");t&&$("#"+t+"-hover").hide()})),$(t+".ramadda-pulldown-with-icons").iconselectmenu({xxxwidth:300}).addClass("ui-menu-icons ramadda-select-icon")},searchLastInput:"",searchAscending:!1,searchCnt:0,searchSuggestInit:function(t,e,a,n,i){let l=$("#"+t),r=$("#"+e);Utils.isDefined(n)||(n=!0);let o=!1;if(!i){o=!0,i=HU.getUniqueId();let t=l.width(),e=HU.div([ID,i,STYLE,HU.css("border","0px","width",t+"px","position","absolute"),CLASS,"ramadda-popup ramadda-search-popup"],"");l.parent().append(e)}let s=$("#"+i),c=()=>{s.slideUp(250)},d=()=>{let t=l.val()||"";this.searchCnt++,this.pendingSearch&&(clearTimeout(this.pendingSearch),this.pendingSearch=null),0!=t.length?this.pendingSearch=setTimeout((()=>{this.pendingSearch=null,Utils.doSearchSuggest(this.searchCnt,l,r,s,a,o)}),200):c()};r.length&&r.change(d),Utils.searchLastInput=l.val(),l.keyup((t=>{let e=t.keyCode||t.which;27!=e&&13!=e?(t.stopPropagation(),d()):c()}))},doSearchSuggest:function(t,e,a,n,i,l){let r=this,o=e.val()||"";Utils.searchLastInput=o;let s=RamaddaUtil.getUrl("/search/suggest?text="+encodeURIComponent(o));i&&(s+="&type="+i),a.length>0&&a.is(":checked")&&ramaddaThisEntry&&(s+="&ancestor="+ramaddaThisEntry),s+="&ascending="+Utils.searchAscending,s+="&orderby=createdate";$.getJSON(s,(function(a){if(t!=r.searchCnt)return;let i=()=>{n.slideDown(400)};if(0==a.values.length)return n.html(HtmlUtils.div([CLASS,"ramadda-search-suggestion "],"No results")),void i();let o="",s=!0;if(a.values.forEach(((t,e)=>{let a,n=t.name,i=t.id,r=n.replace(/\"/g,"_quote_"),c=HU.href(RamaddaUtil.getUrl("/entry/show?entryid="+i),HU.getIconImage(t.icon||icon_blank16,["width",ramaddaGlobals.iconWidth])+SPACE+n,[TITLE,"View entry","data-type",t.typeName,"data-name",t.name,"data-icon",t.icon,STYLE,HU.css("display","inline-block","width","100%"),CLASS,"ramadda-highlightable"]);a=l?HU.span([CLASS,"ramadda-highlightable ramadda-search-input","index",e,TITLE,"Search for"],HtmlUtils.getIconImage("fa-search")):HU.href(RamaddaUtil.getUrl("/search/do?text="+encodeURIComponent(r)),HtmlUtils.getIconImage("fa-search"),[TITLE,"Search for text: "+t.name]);let d=a+SPACE+c;o+=HtmlUtils.div([CLASS,"ramadda-search-suggestion "],d),o+="\n",s=!s})),n.html(o),n.find(".ramadda-highlightable").tooltip({show:{delay:1e3,duration:300},content:function(){let t=$(this).attr("data-name");return"Click to view entry<br>"+HU.image($(this).attr("data-icon"),["width",ramaddaGlobals.iconWidth])+" "+HU.b(t)+HU.div([],"Type: "+$(this).attr("data-type"))}}),l){let t=n.find(".ramadda-search-input");t.css("cursor","pointer"),t.click((function(t){t.stopPropagation();let n=a.values[$(this).attr("index")].name;e.val(n),e.closest("form").submit()}))}i()})).fail((function(t,e,a){console.log("fail:"+e)}))},searchLink:function(){let t=$("#popup_search_input").val().trim(),e=$(this).attr("url");""!=t&&(e+="?text="+encodeURIComponent(t)),window.location=e},searchPopup:function(t,e){e=t;let a=Utils.searchLastInput||"",n="<form action='"+RamaddaUtil.getUrl("/search/do")+"'>",i=HU.tag("input",["value",a,"placeholder","Search text","autocomplete","off","autofocus","true","id","popup_search_input","class","ramadda-search-input",STYLE,HU.css("margin-left","4px","padding","2px","width","250px","border","0px"),"name","text"]),l="";ramaddaThisEntry&&(l=HU.span([ATTR_STYLE,HU.css("margin-right","5px"),ATTR_TITLE,"Search under this entry"],HU.checkbox("popup_search_here",["name","ancestor","value",ramaddaThisEntry],!1)+HU.tag("label",[CLASS,CLASS_CLICKABLE,"for","popup_search_here"],HU.div([ATTR_STYLE,"margin-left:5px;"],HU.getIconImage("fas fa-folder-tree"))))),n+=HU.leftCenterRight(i,"",l),n+="</form>";let r=HU.getUniqueId(),o=HU.link(RamaddaUtil.getUrl("/search/form"),HU.span([ATTR_CLASS,CLASS_CLICKABLE],HU.span([],"Search Form")),[TITLE,"Go to search form",STYLE,HU.css("xcolor","#888","xfont-size","16px")]),s=HU.link(RamaddaUtil.getUrl("/search/type"),HU.span([TITLE,"Go to type search form",ATTR_CLASS,CLASS_CLICKABLE],"Types")),c=HU.div(["id",r,STYLE,HU.css("text-align","right","font-size","12px")],o+HU.space(1)+"|"+HU.space(1)+s),d=HU.getUniqueId("searchresults"),u=HU.div([ID,d,CLASS,"ramadda-search-popup-results"]),f=HU.div([CLASS,"ramadda-search-popup"],n+u),h=($("#"+t),this.dialog=HU.makeDialog({content:f,my:"right top",at:"right bottom",title:c,anchor:e,draggable:!0,header:!0,inPlace:!1}));$("#"+r).find(".ramadda-link").click(Utils.searchLink);let p=$("#popup_search_input");p.mousedown((function(t){t.stopPropagation()})),p.keydown((function(t){"Escape"==t.key&&h.remove()})),Utils.searchSuggestInit("popup_search_input","popup_search_here",null,!0,d),p.focus()},handleKeyPress:function(t){HtmlUtils.getTooltip().hide()},handleMouseDown:function(t){return(HtmlUtils.hasPopupObject()||Utils.tooltipObject)&&setTimeout((()=>{if(Utils.tooltipObject&&(Utils.tooltipObject.hide(),Utils.tooltipObject=null),HtmlUtils.hasPopupObject()){let t=HtmlUtils.getPopupObject().attr("id");HtmlUtils.checkToHidePopup()&&t==HtmlUtils.getPopupObject().attr("id")&&HtmlUtils.hidePopupObject()}}),250),Utils.mouseIsDown=!0,Utils.mouseMoveCnt=0,!0},handleMouseUp:function(t){t=GuiUtils.getEvent(t),Utils.mouseIsDown=!1,GuiUtils.setCursor("default");let e=$("#ramadda-floatdiv");if(e.length){let t=Utils.entryDragInfo?GuiUtils.getDomObject(Utils.entryDragInfo.dragSource):null;if(t){let a=GuiUtils.getLeft(t.obj),n=GuiUtils.getTop(t.obj),i=parseInt(e.css("left")),l=parseInt(e.css("top")),r=10,o=(a-i)/r,s=(n-l)/r;Utils.flyBackAndHide("ramadda-floatdiv",0,r,i,l,o,s)}else e.hide();Utils.entryDragInfo=null}return!0},flyBackAndHide:function(t,e,a,n,i,l,r){var o=GuiUtils.getDomObject(t);if(o){e+=1,o.style.left=n+l*e+"px",o.style.top=i+r*e+"px";if(e<a){setTimeout((()=>{Utils.flyBackAndHide(t,e,a,n,i,l,r)}),30)}else setTimeout((()=>{Utils.finalHide(t)}),150)}},handleMouseMove:function(t){if(t=GuiUtils.getEvent(t),Utils.entryDragInfo&&Utils.mouseIsDown){Utils.mouseMoveCnt++;var e=$("#ramadda-floatdiv");6==Utils.mouseMoveCnt&&GuiUtils.setCursor("move"),Utils.mouseMoveCnt>=6&&e.length&&Utils.moveFloatDiv(GuiUtils.getEventX(t),GuiUtils.getEventY(t))}return!0},finalHide:function(t){var e=GuiUtils.getDomObject(t);e&&(hideObject(e),e.style.filter="alpha(opacity=80)",e.style.opacity="0.8")},centerDiv:function(t){return this.div(["style","text-align:center;"],this.div(["style","display:inline-block;text-align:left;"],t))},moveFloatDiv:function(t,e){let a=$("#ramadda-floatdiv");if(a.length){if(!("none"!=a.css("display"))){a.show();let t="";Utils.entryDragInfo&&(t=Utils.entryDragInfo.getHtml()),a.html(t+"<br>Drag to a group to copy/move/associate")}a.css("top",e).css("left",t+10)}},framesClick:function(t,e,a,n){let i=a.attr("data-url"),l=a.attr("data-label");jqid(t).find(".ramadda-frames-entry").removeClass("ramadda-frames-entry-active"),a.addClass("ramadda-frames-entry-active");let r=HU.href(i,HU.getIconImage("fa-solid fa-link")+" "+l,["class",CLASS_CLICKABLE]);jqid(e+"_header_link").html(r),n&&"default"!=n&&(i=i+"&template="+n),jqid(e).attr("src",i)},framesInit:function(t,e,a){let n=jqid(t);n.find(".ramadda-frames-entry").click((function(){Utils.framesClick(t,e,$(this),a)}));let i=jqid(e+"_leftheader");i.append(HU.div(["class","ramadda-frames-nav"],HU.span(["title","View previous","class","ramadda-clickable ramadda-frames-nav-link ramadda-frames-nav-link-prev","data-nav","prev"],HU.getIconImage("fas fa-caret-left",null,["style","font-size:130%"]))+HU.space(1)+HU.span(["title","View next","class","ramadda-clickable ramadda-frames-nav-link ramadda-frames-nav-link-next","data-nav","next"],HU.getIconImage("fas fa-caret-right",null,["style","font-size:130%"]))));i.find(".ramadda-frames-nav-link").click((function(){(i=>{let l,r=i.attr("data-nav"),o=n.find(".ramadda-frames-entry-active");l="next"==r?o.nextAll(".ramadda-frames-entry"):o.prevAll(".ramadda-frames-entry"),l.length>0&&Utils.framesClick(t,e,l.first(),a)})($(this))}))},copyText:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},foregroundColors:{purple:"white"},getContrastYIQ:function(t){return t=t.replace("#",""),(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"black":"white"},getForegroundColor:function(t){return t?(t.match("rgb")&&(t=Utils.rgbToHex(t)),t?!this.foregroundColors[t]&&t.startsWith("#")?this.getContrastYIQ(t):this.foregroundColors[t]||"#000":"#000"):null},darkerColor:function(t,e){return t?this.pSBC(e||-.5,t):t},brighterColor:function(t,e){return t?this.pSBC(e||.5,t):t},pSBC:function(t,e,a,n){e=this.colorToRgb[e]||e,a=this.colorToRgb[a]||a;let i,l,r,o,s,c,d,u=parseInt,f=Math.round,h="string"==typeof a;return"number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||a&&!h?null:(this.pSBCr||(this.pSBCr=t=>{let e=t.length,a={};if(e>9){if([i,l,r,h]=t=t.split(","),e=t.length,e<3||e>4)return null;a.r=u("a"==i[3]?i.slice(5):i.slice(4)),a.g=u(l),a.b=u(r),a.a=h?parseFloat(h):-1}else{if(8==e||6==e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=u(t.slice(1),16),9==e||5==e?(a.r=t>>24&255,a.g=t>>16&255,a.b=t>>8&255,a.a=f((255&t)/.255)/1e3):(a.r=t>>16,a.g=t>>8&255,a.b=255&t,a.a=-1)}return a}),d=e.length>9,d=h?a.length>9||"c"==a&&!d:d,s=this.pSBCr(e),o=t<0,c=a&&"c"!=a?this.pSBCr(a):o?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},o=1-(t=o?-1*t:t),s&&c?(n?(i=f(o*s.r+t*c.r),l=f(o*s.g+t*c.g),r=f(o*s.b+t*c.b)):(i=f((o*s.r**2+t*c.r**2)**.5),l=f((o*s.g**2+t*c.g**2)**.5),r=f((o*s.b**2+t*c.b**2)**.5)),h=s.a,c=c.a,s=h>=0||c>=0,h=s?h<0?c:c<0?h:h*o+c*t:0,d?"rgb"+(s?"a(":"(")+i+","+l+","+r+(s?","+f(1e3*h)/1e3:"")+")":"#"+(4294967296+16777216*i+65536*l+256*r+(s?f(255*h):0)).toString(16).slice(1,s?void 0:-2)):null)},colorToRgb:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},addAlphaToColor:function(t,e){if(t=this.colorToRgb[t]||t,Utils.isDefined(e)||(e="0.5"),0==t.indexOf("#")){let a=Utils.hexToRgb(t);return a&&(t="rgba("+a.r+","+a.g+","+a.b+","+e+")"),t}return t.replace(/rgba? *\(([^,]+),([^,]+),([^,\)]+).*/,"rgba($1,$2,$3,"+e+")")},enumTypeCount:-1,enumColorPalette:["rgb(141, 211, 199)","rgb(255, 255, 179)","rgb(190, 186, 218)","rgb(251, 128, 114)","rgb(128, 177, 211)","rgb(253, 180, 98)","rgb(179, 222, 105)","rgb(252, 205, 229)","rgb(217, 217, 217)","rgb(188, 128, 189)","rgb(204, 235, 197)","rgb(255, 237, 111)"],enumColors:{},getEnumColor:function(t){return t.color?t.color:(this.enumColors[t]||(this.enumTypeCount++,this.enumTypeCount>=this.enumColorPalette.length&&(this.enumTypeCount=0),this.enumColors[t]=this.enumColorPalette[this.enumTypeCount]),this.enumColors[t])},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},componentToHex:function(t){"string"==typeof t&&(t=+t);var e=t.toString(16);return 1==e.length?"0"+e:e},rgbToHex:function(t,e,a){if(null==e){let n=/.*\(([^,]+),([^,]+),(.*)\).*/i.exec(t);if(!n)return null;t=n[1].trim(),e=n[2].trim(),a=n[3].trim()}return t&&e&&a?"#"+Utils.componentToHex(t)+Utils.componentToHex(e)+Utils.componentToHex(a):null},hexStringToInt:function(t){return hex=parseInt(t.replace(/^#/,""),16)}},GuiUtils={getProxyUrl:function(t){return RamaddaUtil.getUrl("/proxy?trim=true&url=")+encodeURIComponent(t)},showingError:!1,pageUnloading:!1,handleError:function(t,e,a){this.pageUnloading||(console.log(t),console.trace(),e&&console.log(e),this.showingError||(a&&(this.showingError=!0,this.showingError=!1),Utils.closeFormLoadingDialog()))},isJsonError:function(t){if(null==t)return this.handleError("Null JSON data",null,!1),!0;if(null!=t.error){var e=t.errorcode;return null==e&&(e="error"),this.handleError("Error in Utils.isJsonError:"+t.error,null,!1),!0}return!1},loadXML:function(t,e,a){var n=!1;if(window.XMLHttpRequest)try{n=new XMLHttpRequest}catch(t){n=!1}else if(window.ActiveXObject)try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){n=!1}}n&&(n.onreadystatechange=function(){4==n.readyState&&200==n.status&&e(n,a)},n.open("GET",t,!0),n.send(""))},loadHtml:async function(t,e){await $.get(t,(function(t){e(t)})).done((function(){})).fail((function(){console.log("Failed to load url: "+t)}))},loadUrl:function(t,e,a){var n=!1;if(window.XMLHttpRequest)try{n=new XMLHttpRequest}catch(t){n=!1}else if(window.ActiveXObject)try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){n=!1}}n&&(n.onreadystatechange=function(){4==n.readyState&&200==n.status&&e(n,a)},n.open("GET",t,!0),n.send(""))},getUrlArg:function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==a||""==a?e:a[1]},setCursor:function(t){var e=document.cursor;!e&&document.getElementById&&(e=document.getElementById("cursor")),e||(document.body.style.cursor=t)},getDomObject:function(t){let e=new DomObject(t);return e.obj?e:null},getEvent:function(t){return t||window.event},getEventX:function(t){return t.pageX?t.pageX:t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft},getEventY:function(t){return t.pageY?t.pageY:t.clientY+document.body.scrollTop+document.documentElement.scrollTop},getTop:function(t){return t?t.offsetTop+this.getTop(t.offsetParent):0},getBottom:function(t){return t?this.getTop(t)+t.offsetHeight:0},setPosition:function(t,e,a){t.style.top=a,t.style.left=e},getLeft:function(t){return t?t.offsetLeft+this.getLeft(t.offsetParent):0},getRight:function(t){return t?t.offsetRight+this.getRight(t.offsetParent):0},getStyle:function(t){return t.style?t.style:document.layers?document.layers[t.name]:null},size_format:function(t){return t=t>=1073741824?number_format(t/1073741824,2)+" GB":t>=1048576?number_format(t/1048576,2)+" MB":t>=1024?number_format(t/1024,0)+" KB":number_format(t,0)+" bytes"},inputLengthOk:function(t,e,a){var n=$("#"+t).val();if(null==n)return!0;if(a){if(n.length<e)return Utils.closeFormLoadingDialog(),!1}else if(n.length>e)return Utils.closeFormLoadingDialog(),!1;return!0},inputValueOk:function(t,e,a){var n=$("#"+t).val();return null==n||(a&&n<e?(Utils.closeFormLoadingDialog(),!1):!(!a&&n>e)||(Utils.closeFormLoadingDialog(),!1))},inputIsRequired:function(t,e,a){var n=$("#"+t).val();return null!=n&&0!=n.trim().length||(Utils.closeFormLoadingDialog(),!1)}},HU=HtmlUtils=window.HtmlUtils=window.HtmlUtil={me:"HtmlUtils",loaded:{},getTitleBr:function(){return"&#10;"},hide:function(t){$("#"+t).hide()},toggleAllInit:function(){let t=Utils.getUniqueId("toggleall");document.write(HU.div([ATTR_ID,t],"Toggle Details"));let e=!1;jqid(t).button().click((function(){e=!e,$(".entry-toggleblock-label,.toggleblocklabel").each((function(){let t=$(this).attr("block-id"),a=$(this).attr("block-image-id"),n="fa-regular fa-square-minus",i="fa-regular fa-square-plus";$(this).hasClass("entry-toggleblock-label")&&(i="fas fa-caret-right",n="fas fa-caret-down"),HU.toggleBlockVisibility(t,a,n,i,null,e)}))}))},initTooltip:function(t){$(t).tooltip({delay:{show:0,hide:5e3},open:function(t,e){let a=$(this).attr("tooltip-width");a&&e.tooltip.css("width",a).css("max-width",a)},show:{delay:1e3},position:{xmy:"center bottom",xat:"center top",collision:"none"},hide:!1,content:function(){let t=$(this).attr("title");return t=Utils.convertText(t??""),HU.div([ATTR_CLASS,"ramadda-tooltip",ATTR_STYLE,"margin:5px;"],t)}})},initPageSearch:function(t,e,a,n,i){let l={focus:!0,inputSize:"15"};i&&$.extend(l,i);let r=HU.getUniqueId("search_"),o=HU.input("","",[ATTR_CLASS,"ramadda-pagesearch-input",ATTR_ID,r,"placeholder",a??"Search","size",l.inputSize]);l.target?$(l.target).html(o):document.write(o),l.focus&&jqid(r).focus(),jqid(r).keyup((function(){HU.doPageSearch($(this).val(),t,e,n)}))},classes:function(){return Utils.join(Array.from(arguments)," ")},doPageSearch(t,e,a,n){let i=$(e);n&&(Utils.stringDefined(t)?$(n).hide():$(n).show()),i.each((function(){let e=!0;if(Utils.stringDefined(t)){t=t.toLowerCase(),e=!1;let a=$(this).html(),n=$(this).attr("data-category");n&&(a+=" "+n);let i=$(this).attr("data-corpus");i&&(a+=" "+i);let l=a.match(/title *= *(\"|')([^(\"|')]+)/);l&&(a=a+" "+l[2]),a=Utils.stripTags(a),a=a.toLowerCase(),a.indexOf(t)>=0&&(e=!0)}e?($(this).attr("isvisible","true"),$(this).show()):($(this).attr("isvisible","false"),$(this).fadeOut())})),a&&$(a).each((function(){let t=!1;$(this).find(e).each((function(){"true"===$(this).attr("isvisible")&&(t=!0)})),t?$(this).show():$(this).fadeOut()}))},initScreenshot:function(t){t.width/=2,$(t).css("display","inline-block").css("max-width","90vw")},insertIntoTextarea:function(t,e,a){"string"==typeof t&&(t=document.getElementById(t)),e=Utils.decodeText(e),a&&(e="\n"+e);let n=t.scrollTop;if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e;else if(t.selectionStart||"0"==t.selectionStart){var i=t.selectionStart,l=t.selectionEnd;t.value=t.value.substring(0,i)+e+t.value.substring(l,t.value.length);let a=i+e.length;t.selectionEnd=a}else t.value+=e;a&&t.value&&(t.value=t.value.trim()),t.scrollTop=n},initLoadingImage:function(t){setTimeout((()=>{$(t).removeClass("ramadda-image-loading")}),2e3)},initRadioToggle(t,e){$(t).find("input[type=radio]").change((function(){for(a in e)a==$(this).attr("value")?$(e[a]).show():$(e[a]).hide()}))},initToggleAll:function(t,e){jqid(t).change((function(){let t=$(this).is(":checked");$(e).prop("checked",t),$(e).trigger("change")}))},getEmojis:function(t){this.emojis?t(this.emojis):$.getJSON(RamaddaUtil.getUrl("/emojis/emojis.json"),(e=>{let a,n=[],i={};this.emojis=[],e.forEach((t=>{let e=t.category??a;e&&(a=e);let l=i[e];l||(l={name:e,images:[]},i[e]=l,n.push(l));let r=t.image;r.startsWith("/")||(r="/emojis/"+r),l.images.push({name:t.name,image:RamaddaUtil.getUrl(r)})})),this.emojis=n,t(this.emojis)})).fail((t=>{console.log("Failed to load json:")}))},loadJqueryLib:function(t,e,a,n,i){let l=!1;HtmlUtils.loaded[t]||(e.forEach((t=>{$("<link rel='stylesheet' href='"+t+"' crossorigin='anonymous'>").appendTo("head")})),a.forEach((t=>{$("<script src='"+t+"'  type=text/JavaScript><\/script>").appendTo("head")})),HtmlUtils.loaded[t]=!0),$(n)[t]?i():setTimeout((()=>{HtmlUtils.loadJqueryLib(t,e,a,n,i)}),50)},createFancyBox:function(t,e){e=e||{},HtmlUtils.loadJqueryLib("fancybox",[ramaddaCdn+"/lib/fancybox-3/jquery.fancybox.min.css"],[ramaddaCdn+"/lib/fancybox-3/jquery.fancybox.min.js"],t,(()=>{$(t).fancybox(e)}))},checkToHidePopup:function(){if(this.popupTime){var t=new Date;return timeDiff=t-this.popupTime,timeDiff>1e3}return!0},jqid:function(t){return $("#"+t)},initInteractiveInput:function(t,e){HU.jqid(t).keyup((function(t){HtmlUtils.hidePopupObject();let a=$(this).val();if(!Utils.stringDefined(a))return;let n=$(this);$.getJSON(e+"?text="+a,(t=>{if(0==t.length)return;let e="";t.forEach((t=>{e+=HU.div([CLASS,CLASS_CLICKABLE+" ramadda-suggest","suggest",t],t)}));let a=HU.div([CLASS,"ramadda-search-popup",STYLE,HU.css("max-width","200px","padding","4px")],e);HU.makeDialog({content:a,my:"left top",at:"left bottom",anchor:n}).find(".ramadda-suggest").click((function(){HtmlUtils.hidePopupObject(),n.val($(this).attr("suggest"))}))})).fail((t=>{console.log("suggest call failed:"+e+"\n"+t),console.dir(t)}))}))},getTooltip:function(){return $("#ramadda-popupdiv")},getPopupObject:function(){return this.popupObject},hasPopupObject:function(){return null!=this.popupObject},clearPopupObject:function(){this.popupObject=null},isPopupObject:function(t){return!(!this.popupObject||!t)&&this.popupObject.attr("id")==t.attr("id")},setPopupObject:function(t){return this.isPopupObject(t)||(this.popupObject&&this.hidePopupObject(null,!0),this.popupObject=t,this.popupObject.attr("addedMouseListener")||(this.popupObject.attr("addedMouseListener","true"),this.popupObject.mousedown((function(t){t.stopPropagation()}))),this.popupObjectTime=new Date),t},hidePopupObject:function(t,e){if(!e&&this.popupObjectTime){if((new Date).getTime()-this.popupObjectTime.getTime()<500)return}this.popupObjectTime=null,this.popupObject&&(this.popupObject.hide(),"true"==this.popupObject.attr("removeonclose")&&this.popupObject.remove(),this.popupObject=null),this.popupTime=new Date,t&&t.stopPropagation()},lastCbxClicked:null,lastCbxIdClicked:null,checkboxClicked:function(t,e,a){if(!t)return;let n=GuiUtils.getDomObject(a);if(!n)return;n=n.obj;let l=new Array;if(!n.form)return;let r=n.form.elements;for(i=0;i<r.length;i++)(r[i].name.indexOf(e)>=0||r[i].id.indexOf(e)>=0)&&l.push(r[i]);let o=n.checked;if(t.ctrlKey)for(i=0;i<l.length;i++)l[i].checked=o;if(t.shiftKey){if(HtmlUtils.lastCbxClicked){let t=GuiUtils.getTop(n),e=GuiUtils.getTop(HtmlUtils.lastCbxClicked),r=$("#"+HtmlUtils.lastCbxIdClicked),s=$("#"+a);if(r.position()&&(e=r.offset().top),s.position()&&(t=s.offset().top),t>e){let a=t;t=e,e=a}for(i=0;i<l.length;i++){let a=$("#"+l[i].id).offset().top;a>=t&&a<=e&&(l[i].checked=o)}}}else HtmlUtils.lastCbxClicked=n,HtmlUtils.lastCbxIdClicked=a},tabLoaded:function(t,e){window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout(),window.ramaddaMapCheckLayout&&ramaddaMapCheckLayout()},elementScrolled:function(t){var e=$(window).scrollTop(),a=e+$(window).height(),n=$(t).offset().top,i=n+$(t).outerHeight(!0);return n<=a&&n>=e||(i<=a&&i>=e||i>=a&&n<=e)},initOdometer:function(t,e,a,n){Utils.isDefined(a)||(a=0),$(document).ready((function(){n?$("#"+t).html(e):setTimeout((function(){HtmlUtils.elementScrolled("#"+t)?setTimeout((function(){$("#"+t).html(e)}),a):$(window).scroll((function(){HtmlUtils.elementScrolled("#"+t)&&setTimeout((function(){$("#"+t).html(e)}),a)}))}),1e3)}))},callWhenScrolled:function(t,e,a){Utils.isDefined(a)||(a=0),$(document).ready((function(){setTimeout((function(){HtmlUtils.elementScrolled("#"+t)?setTimeout(e,a):$(window).scroll((function(){HtmlUtils.elementScrolled("#"+t)&&setTimeout(e,a)}))}),1e3)}))},waitForIt:function(t,e,a,n){window[t]?e():(Utils.isDefined(n)||(n=500),0!==n?setTimeout((()=>{HtmlUtils.waitForIt(t,e,a,n-1)}),50):a&&a())},loadAndWait:function(t,e,a,n){if(!window[t]){$(e).appendTo("head")}HtmlUtils.waitForIt(t,a,n)},makeMessage:function(t,e){return"<div class='ramadda-message ramadda-message-plain ' id='messageblock'><table width='100%'><tbody><tr valign='top'><td width='5%'><div class='ramadda-message-icon'><span><i class='"+t+"' style='font-size:32pt;'></i></span></div></td><td><div class='ramadda-message-inner'><p>"+e+"</p></div></td></tr></tbody></table></div>"},makeErrorMessage:function(t){return HtmlUtils.makeMessage("fas fa-exclamation-triangle text-danger",t)},makeInfoMessage:function(t){return HtmlUtils.makeMessage("fas fa-info",t)},makeRunningMessage:function(t){return HtmlUtils.makeMessage("fas fa-spinner fa-spin",t)},makeSlides:async function(t,e,a){Utils.isDefined(a)||(a=0),await HtmlUtils.loadSlides();let n={dots:!0,slidesToShow:1,variableWidth:!0};e&&$.extend(n,e),$("#"+t).slick(n),HU.swapHtml("#"+t+"_headercontents","#"+t+"_header"),setTimeout((()=>{let e=$("#"+t+"_header"),a=e.find(".ramadda-slides-header-item");a.click((function(){let e=+$(this).attr("slideindex");$("#"+t).slick("slickGoTo",e)})),$("#"+t).on("afterChange",(function(t,n,i){a.removeClass("ramadda-slides-header-item-selected"),e.find(HtmlUtils.attrSelect("slideindex",i)).addClass("ramadda-slides-header-item-selected")}))}))},loadSlides:async function(){return!!HtmlUtils.slidesLoaded||($("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:RamaddaUtil.getCdnUrl("/lib/slick/slick.css")}),$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:RamaddaUtil.getCdnUrl("/lib/slick/slick-theme.css")}),await Utils.importJS(RamaddaUtil.getCdnUrl("/lib/slick/slick.min.js")),HtmlUtils.slidesLoaded=!0,!1)},loadKatex:function(t,e){if(!window.katex){$("<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Main-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Math-Italic.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Size2-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'>\n<link rel='preload' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/fonts/KaTeX_Size4-Regular.woff2' as='font' type='font/woff2' crossorigin='anonymous'/>\n<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Lato:300,400,700,700i'>\n<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css' crossorigin='anonymous'>\n<script defer src='https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js' crossorigin='anonymous'><\/script>").appendTo("head")}HtmlUtils.waitForIt("katex",t,e)},applyMarkdown:function(t,e){let a="<script src='"+ramaddaCdn+"/lib/showdown.min.js'/>";HtmlUtils.loadAndWait("showdown",a,(()=>{let a=$("#"+t).html();try{var n=(new showdown.Converter).makeHtml(a);$("#"+e).html(n)}catch(t){$("#"+e).html("Error processing markdown:"+t)}}),(()=>{$("#"+e).html("Error loading showdown")}))},applyLatex:function(t,e){HtmlUtils.loadKatex((()=>{let a=$("#"+t).html();try{var n=katex.renderToString(a,{throwOnError:!0});$("#"+e).html(n)}catch(t){$("#"+e).html("Error processing markdown:"+t)}}),(()=>{$("#"+e).html("Error loading katex")}))},isFontAwesome:function(t){return t.startsWith("fa-")||t.startsWith("fas ")||t.startsWith("far ")||t.startsWith("fab ")},getIconImage:function(t,e,a){if(HtmlUtils.isFontAwesome(t)){let n;return n=t.startsWith("fa-thin")||t.startsWith("fa-light")||t.startsWith("fa-regular")||t.startsWith("fa-solid")||t.startsWith("fas ")||t.startsWith("fab ")||t.startsWith("far")?["class",t]:["class","fas "+t],a&&(n=Utils.mergeLists(n,a)),HtmlUtils.span(e,HtmlUtils.tag("i",n))}return HtmlUtils.image(t,e)},getObjectURL:function(t){return(window.URL||window.webkitURL).createObjectURL(t)},getErrorDialog:function(t){return'<div class="ramadda-message"><table><tr valign=top><td><div class="ramadda-message-link"><img border="0"  src="/repository/icons/error.png"  /></div></td><td><div class="ramadda-message-inner">'+t+"</div></td></tr></table></div>"},makeBreadcrumbsInit:function(t){if(Utils.getPageLoaded())HtmlUtils.makeBreadcrumbs(t);else{let e=t;Utils.addLoadFunction((()=>{HtmlUtils.makeBreadcrumbs(e)}))}},makeBreadcrumbs:function(t){let e=jQuery("#"+t),a=4;e.find("li").length>5&&(a=0),e.jBreadCrumb({previewWidth:0,easing:"easeOutQuad",beginingElementsToLeaveOpen:0,endElementsToLeaveOpen:a})},tooltipInit:function(t,e){$("#"+e).dialog({autoOpen:!1,minWidth:650,hide:{effect:"blind",duration:250}}),$("#"+t).click((function(){$("#"+e).dialog("open")}))},join:function(t,e){t.forEach||(t=[t]);let a="";return t.forEach(((t,n)=>{n>0&null!=e&&(a+=e),a+=t})),a},qt:function(t){return'"'+t+'"'},sqt:function(t){return"'"+t+"'"},getUniqueId:function(t){return window.uniqueCnt||(window.uniqueCnt=(new Date).getTime()),(t||"id_")+window.uniqueCnt++},inset:function(t,e,a,n,i){var l="";return e&&(l+="padding-top: "+e+"px; "),a&&(l+="padding-left: "+a+"px; "),n&&(l+="padding-bottom: "+n+"px; "),i&&(l+="padding-right: "+i+"px; "),HtmlUtils.div(["style",l],t)},makeTabs(t,e){let a={};e&&$.extend(a,e);let n=HU.getUniqueId("tabs_"),i=HU.open("div",["id",n]);return i+="\n",i+="<ul>\n",t.forEach(((t,e)=>{i+=HU.tag("li",[],HU.href("#"+n+"-"+(e+1),t.label??t.header)),i+="\n"})),i+="</ul>\n",t.forEach(((t,e)=>{let l=t.contents;a.contentsStyle&&(l=HU.div(["style",a.contentsStyle],l)),i+=HU.div(["id",n+"-"+(e+1)],l),i+="\n"})),i+="</div>",{contents:i,init:()=>{$("#"+n).tabs()}}},makeAccordionHtml(t){let e=HU.getUniqueId("accordion_"),a=HU.open("div",["class","ui-accordion ui-widget ui-helper-reset","id",e]);return t.forEach((t=>{a+=HU.tag("h3",["class","ui-accordion-header ui-helper-reset ui-corner-top","style","border:0px;background:none;"],HU.href("#",HU.span(["class",CLASS_CLICKABLE],t.header??t.label))),a+=HU.div(["id",HU.getUniqueId("accordion_"),"class","ramadda-accordion-contents"],t.contents)})),a+="</div>",{id:e,contents:a,init:()=>{HU.makeAccordion("#"+e)}}},makeAccordion:function(t,e){null==e&&(e={heightStyle:"content",collapsible:!0,active:0,decorate:!1,animate:200});var a={header:"iconClosed",activeHeader:"iconOpen"};$((function(){$(t+" .ramadda-accordion-contents").css("display","block");var n={animate:200,icons:a,collapsible:!0,heightStyle:"content",active:0,decorate:!0,activate:function(){window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout()}};($.extend(n,e),n.decorate)||$(t+" .ui-accordion-header").css("padding","0em 0em 0em 0em");n.active<0&&(n.active="none");let i=$(t).accordion(n),l=function(t,e){e.stopPropagation();let a=t.closest(".ui-accordion-header");a.find(":checkbox").is(":checked")?a.css("background","#fffeec"):a.css("background","transparent")},r=function(t){l($(this),t)};i.find(".accordion-toolbar").find(":checkbox").click(r),i.find(".accordion-toolbar").find("label").click(r),i.find(".accordion-toolbar").find(":checkbox").change((function(t){l($(this),t)}))}))},buttons:function(t,e,a){let n=Utils.wrap(t,"<div style='display:inline-block;margin-right:6px;'>","</div>");return HU.div(["class",e??"ramadda-button-bar","style",a??""],n)},vspace:function(t){return this.div(["style",this.css("margin-top",t??"0.5em")])},hbox:function(t,e){let a=HtmlUtils.openTag("tr",["valign","top"]);return a+=Utils.wrap(t,"<td align=left>"+HU.open("div",["style",e??""]),"</div></td>"),a+="</tr>",this.tag("table",["border","0","cellspacing","0","cellpadding","0"],a)},vbox:function(t){let e=HtmlUtils.join(t,"<br>");return this.div([STYLE,HU.css("display","inline-block")],e)},leftRight:function(t,e,a,n){return null==a&&(a="6"),null==n&&(n="6"),this.div(["class","row"],this.div(["class","col-md-"+a],t)+this.div(["class","col-md-"+n,"style","text-align:right;"],e))},leftCenterRight:function(t,e,a,n,i,l,r,o){return r||(r={}),r.valign||(r.valign="top"),o||(o=""),this.tag("table",["border",0,"width","100%","cellspacing","0","cellpadding","0"],this.tr(["valign",r.valign],this.td(["align","left","width",n,STYLE,o],t)+this.td(["align","center","width",i,STYLE,o],e)+this.td(["align","right","width",l,STYLE,o],a)))},row:function(){let t="<table cellpadding=0 cellspacing=0 border=0 width=100%><tr valign=center>";return Array.from(arguments).forEach((e=>{Array.isArray(e)?t+=HtmlUtils.tag("td",e[0],e[1]):t+=HtmlUtils.tag("td",[],e)})),t+="</tr></table>",t},hrow:function(){let t="";return Array.from(arguments).forEach((e=>{t+=HtmlUtils.div(["style","display:inline-block"],e)})),t},leftRightTable:function(t,e,a,n,i){i||(i={}),i.valign||(i.valign="top");var l=["align","left"],r=["align","right"];return a&&(l.push("width"),l.push(a)),n&&(r.push("width"),r.push(n)),this.tag("table",["border","0","width","100%","cellspacing","0","cellpadding","0"],this.tr(["valign",i.valign],this.td(l,t)+this.td(r,e)))},heading:function(t){return this.tag("h3",[],t)},bootstrapClasses:["col-md-12","col-md-6","col-md-4","col-md-4","col-md-4","col-md-2"],getBootstrapClass:function(t){return t-=1,(t=Math.max(t,0))<this.bootstrapClasses.length?this.bootstrapClasses[t]:"col-md-1"},toggleDialogs:{},makeOkCancelDialog:function(t,e,a,n,i,l){l=l??{};let r=[HU.div(["action","ok","class","ramadda-button "+CLASS_CLICKABLE],l.okLabel??"OK"),HU.div(["class","ramadda-button "+CLASS_CLICKABLE],l.cancelLabel??"Cancel")];i&&r.push(i);let o=HU.buttons(r),s=e+HU.vspace()+o;s=HU.div(["style",l.style??"padding:5px;"],s);let c=HU.makeDialog({content:s,header:!1,anchor:t,my:l.my??"left top",at:l.at??"left bottom",title:l.title,header:l.header,draggable:l.draggable});c.find("."+CLASS_CLICKABLE).button().click((function(){"ok"==$(this).attr("action")?a():n&&n(),c.remove()}))},initSideToggle:function(t,e,a){a=a??{},t=jqid(t),e=jqid(e);let n=a.width??a.boxWidth??"200px";a.buttonWidth&&t.css("width",a.buttonWidth),a.fontSize&&t.css("font-size",a.fontSize),(a.buttonColor||a.color)&&t.css("color",a.buttonColor??a.color),(a.buttonBackground||a.background)&&t.css("background",a.buttonBackground??a.background),(a.boxBackground||a.background)&&e.css("background",a.boxBackground??a.background),a.boxHeight&&e.css("height",a.boxHeight),(a.buttonTop??a.top)&&t.css("top",a.buttonTop??a.top),a.boxHeight&&e.css("height",a.boxHeight),(a.boxTop??a.top)&&e.css("top",a.boxTop??a.top),e.css("width",n),e.css("left","-"+n);let i=(t,e)=>{t.animate({left:e},Utils.isDefined(a.speed)?parseInt(a.speed):500)};t.click((function(){let a="toggle-open";"true"===t.attr(a)?(t.attr(a,"false"),i(t,"0px"),i(e,"-"+n)):(t.attr(a,"true"),i(t,n),i(e,"0px"))}))},makeDialog:function(args){HtmlUtils.hidePopupObject(null,!0);let opts={modal:!1,modalStrict:!1,modalContentsCss:"",sticky:!1,content:null,contentId:null,anchor:null,draggable:!1,resizable:!1,decorate:!0,header:!1,headerRight:null,remove:!0,my:"left top",at:"left bottom",animate:!1,animateSpeed:300,title:"",rightSideTitle:"",inPlace:!0,fit:!0},parentId,html;if(args&&(""==args.at&&delete args.at,""==args.my&&delete args.my,$.extend(opts,args)),opts.toggleid&&this.toggleDialogs[opts.toggleid]){let t=this.toggleDialogs[opts.toggleid];if(t.is(":visible"))return t.hide(),void(this.toggleDialogs[opts.toggleid]=null)}opts.anchor&&"string"==typeof opts.anchor&&(opts.anchor=$("#"+opts.anchor)),opts.anchor&&0==opts.anchor.length&&(console.log("Utils.makeDialog: Invalid anchor"),console.trace(),opts.anchor=null),opts.content&&(opts.inPlace=!1),opts.inPlace?(opts.remove=!1,parentId=HtmlUtils.getUniqueId(),html=HU.div([ID,parentId,STYLE,HU.css()],HU.SPACE)):(html=opts.content,null==html&&(html=opts.contentId?$("#"+opts.contentId).html():"No html provided"));let id=HtmlUtils.getUniqueId();if(opts.header&&(html=HU.div([CLASS,"ramadda-popup-inner"],html)),opts.header){let t=HtmlUtils.div([TITLE,"Close",CLASS,"ramadda-popup-close"],HU.jsLink("",HtmlUtils.getIconImage(icon_close),[ID,id+"_close",STYLE,HU.css("cursor","pointer")])),e=HU.div([CLASS,"ramadda-popup-title"],opts.title);opts.rightSideTitle&&(e+=HU.div([ATTR_CLASS,"ramadda-popup-title-right"],opts.rightSideTitle));let a=t+e;opts.headerRight&&(a+=HU.div(["style",HU.css("position","absolute","top","0px","right","0px")],opts.headerRight));let n=HtmlUtils.div([STYLE,HU.css("position","relative","text-align","left"),"class","ramadda-popup-header"],a);html=n+html}(opts.decorate||opts.header)&&(html=HU.div([CLASS,"ramadda-popup"],html));let innerId=HU.getUniqueId("model_inner");(opts.modal||opts.modalStrict)&&(html=HU.div([ID,innerId,STYLE,opts.modalContentsCss,CLASS,"ramadda-modal-contents"],html),html=HU.div([CLASS,"ramadda-modal "+(opts.modalStrict?"ramadda-modal-strict":"")],html));let popup=$(html).appendTo("body");if(popup.find("a,div").tooltip({classes:{"ui-tooltip":"wiki-editor-tooltip"},content:function(){return $(this).prop("title")},show:{effect:"slide",delay:500,duration:400},position:{my:"left top",at:"right top"}}),opts.remove&&popup.attr("removeonclose","true"),opts.inPlace){let t=$("#"+opts.contentId),e=$("#"+parentId);e.css("display","block").css("width","fit-content").css("height","fit-content"),t.appendTo(e),t.show()}if(opts.anchor&&(opts.width&&popup.css("width",opts.width),popup.position({of:opts.anchor,my:opts.my,at:opts.at,collision:opts.fit?"fit fit":null})),opts.animate&&"false"!==opts.animate)if(opts.animateSpeed=+opts.animateSpeed,popup.hide(),opts.slideLeft){let t="right bottom";popup.position({of:opts.anchor,my:opts.my,at:t,collision:opts.fit?"fit fit":null}),popup.show("slide",{direction:"right"},+opts.animateSpeed)}else popup.show(opts.animateSpeed);else popup.show();return opts.resizable&&(opts.modal?$("#"+innerId).resizable():popup.resizable()),opts.draggable?opts.modal?$("#"+innerId).draggable():popup.draggable():opts.sticky||opts.toggleid||HtmlUtils.setPopupObject(popup),opts.header&&$("#"+id+"_close").click((function(){popup.hide(),opts.callback&&opts.callback(popup),opts.remove&&popup.remove()})),opts.initCall&&("string"==typeof opts.initCall?(window.ramaddaGlobalDialog=popup,eval(opts.initCall)):opts.initCall()),opts.toggleid&&(this.toggleDialogs[opts.toggleid]=popup),Translate.translate(popup),popup},addToDocumentUrl:function(t,e,a){if(Utils.isPost())return;let n=String(window.location);a?(n.includes("?")||(n+="?"),n+="&"+HtmlUtils.urlArg(t,e)):(n=new URL(n),null===e?n.searchParams.delete(t):n.searchParams.set(t,e));try{window.history.replaceState&&window.history.replaceState("","",n)}catch(t){console.log("err:"+t),console.trace()}return n},removeFromDocumentUrl:function(t){try{let e=String(window.location),a=new RegExp("[?&]"+t+"=[^&]*(&|$)","gi");e=e.replace(a,"$1"),e=e.replace(/&$/,"").replace(/\?$/,""),window.history.replaceState&&window.history.replaceState("","",e)}catch(t){console.log("err:"+t)}},getUrlArgument:function(t){return new URLSearchParams(window.location.search).get(t)},pre:function(t,e){return this.tag("pre",t,e)},div:function(t,e){return this.tag("div",t,e)},center:function(t,e){return this.tag("center",e,t)},span:function(t,e){return this.tag("span",t,e)},movie:function(t,e){let a="";return e&&(a=HU.attrs(e)),"<video src='"+t+"' "+a+" controls='controls'></video>"},image:function(t,e){return"<img "+this.attrs(["src",t,"border","0"])+" "+this.attrs(e)+"/>"},swapHtml:function(t,e){$(document).ready((function(){let a=$(t),n=$(e);a.appendTo(n)}))},table:function(t,e){return HU.tag("table",t,e)},tr:function(t,e){return this.tag("tr",t,e)},css:function(...t){1==t.length&&Array.isArray(t[0])&&(t=t[0]);let e="";for(let a=0;a<t.length;a+=2)e+=t[a]+":"+t[a+1]+";";return e},h2:function(t){return HU.tag("h2",[],t)},h3:function(t){return HU.tag("h3",[],t)},cssTag:function(t){return'<style type="text/css">\n'+t+"</style>"},cssLink:function(t){return"<link href='"+t+"'  rel='stylesheet'  type='text/css' />"},javascriptLink:function(t){return"<script type='text/javascript' src='"+t+"'><\/script>"},BR_ENTITY:"&#10;",makeMultiline:function(t){return Utils.join(t,HtmlUtils.BR_ENTITY)},getDimension:t=>t?((t=String(t).trim()).match("calc")&&(t=(t=t.replace(/calc *\(/,"calc(").replace(/-/," - ").replace(/\+/," + ")).replace(/([0-9]) *\)/,"$1px)")),t.endsWith(")")||t.endsWith("%")||t.endsWith("px")||t.endsWith("vh")?t:t+"px"):null,td:function(t,e){return this.tag("td",t,e)},tds:function(t,e){if(!e)return"";Array.isArray(e)||(e=[e]);let a="";for(let n=0;n<e.length;n++)a+=this.td(t,e[n]);return a},ths:function(t,e){let a="";for(let n=0;n<e.length;n++)a+=this.th(t,e[n]);return a},onReturnEvent:function(t,e){"string"==typeof t&&(t=$(t)),t.keyup((function(t){13==(t.keyCode?t.keyCode:t.which)&&e($(this),t)}))},formatTable:function(t,e,a){HtmlUtils.loadJqueryLib("DataTable",[ramaddaCdn+"/lib/datatables-1.13.1/datatables.min.css"],[ramaddaCdn+"/lib/datatables-1.13.1/datatables.min.js"],t,(()=>{$(t).each((function(){if($.fn.dataTable.isDataTable(this))return;let t=HtmlUtils.formatTableInner($(this),e);a&&a($(this),t)}))}))},formatTableInner:function(t,e){let a={paging:!1,ordering:!1,info:!1,searching:!1,scrollCollapse:!0,retrieve:!0,fixedHeader:!1};e&&$.extend(a,e);let n=a.height||t.attr("table-height");n&&(a.scrollY=n);let i=t.attr("table-ordering");i&&(a.ordering="true"==i);let l=t.attr("table-searching");l&&(a.searching="true"==l);let r=t.attr("table-paging");if(r&&(a.paging="true"==r),Utils.isDefined(a.scrollY)){(""+a.scrollY).endsWith("px")||(a.scrollY+="px")}return t.DataTable(a),t},th:function(t,e){return this.tag("th",t,e)},attrSelect:function(t,e){return"["+t+'="'+e+'"]'},scrollToAnchor:function(t,e,a){Utils.isDefined(e)||(e=-50);let n=$("a[name='"+t+"']");if(e||(e=0),e=+e,Utils.scrollToAnchorTime=new Date,a){let t=jqid(a),e=n;t.animate({scrollTop:e.offset().top-t.offset().top+t.scrollTop()},1e3)}else $("html,body").animate({scrollTop:n.offset().top+e},"slow"),location.hash=t},scrollVisible:function(t,e,a){if(0==e.length||0==t.length)return;let n=e.offset().top-t.offset().top;Utils.isDefined(a)||(a=1e3),t.animate({scrollTop:n+t.scrollTop()},a)},initNavPopup:function(t,e){let a={align:"left"};e&&$.extend(a,e),$("#"+t).click((function(){let e,n,i=HtmlUtils.setPopupObject($("#"+t+"-popup"));"right"==a.align?(e="right top",n="right top"):(e="left top",n="right+5 top"),i.show(),i.position({of:i.parent(),my:e,at:n,collision:"fit fit"})}))},navLinkClicked:function(t,e){$(".ramadda-nav-left-link").removeClass("ramadda-nav-link-active"),$("#"+t+"_href").parent().addClass("ramadda-nav-link-active"),HtmlUtils.scrollToAnchor(t,e)},initNavLinks:function(t){let e={leftOpen:!0,showToggle:!0,leftWidth:"250px"};t&&$.extend(e,t);let a=$(".ramadda-nav-left"),n=$(".ramadda-nav-right");if(e.showToggle){let t=HU.div(["toggle-state",e.leftOpen?"open":"closed",TITLE,"Toggle left",ID,"ramadda-nav-left-toggle",CLASS,"ramadda-nav-left-toggle"],HtmlUtils.getIconImage("fa-bars"));$(t).appendTo(n),$("#ramadda-nav-left-toggle").click((function(){let t="closed"===$(this).attr("toggle-state");t?(a.show(),n.animate({"margin-left":e.leftWidth})):(a.hide(),n.animate({"margin-left":"0px"})),$(this).attr("toggle-state",t?"open":"closed")}))}let i=$(".ramadda-nav-left-links");i.mouseenter((function(){Utils.linksMouseIn=!0})),i.mouseleave((function(){Utils.linksMouseIn=!1}));let l=$(".ramadda-nav-anchor"),r=$(".ramadda-nav-left-link"),o=null;$(window).scroll((function(){if(Utils.linksMouseIn)return;let t=!1;if(Utils.scrollToAnchorTime){t=(new Date).getTime()-Utils.scrollToAnchorTime.getTime()<2e3}let e=$(window).scrollTop(),a=e+$(window).height(),n=null,i=null;if(l.each((function(){let t=$(this).offset().top,l=t+$(this).outerHeight(!0);(t<=a&&t>=e||l<=a&&l>=e||l>=a&&t<=e)&&(null==i||t<i)&&(i=t,n=$(this))})),!n)return;if(o&&o.attr("name")==n.attr("name"))return;o=n,r.removeClass("ramadda-nav-link-active");let s=null;r.each((function(){$(this).attr("navlink")==n.attr("name")&&($(this).addClass("ramadda-nav-link-active"),s=$(this))})),!t&&s&&HtmlUtils.scrollVisible(s.parent(),s,100)}))},setFormValue:function(t,e){$("#"+t).val(e)},setHtml:function(t,e){$("#"+t).html(e)},formTable:function(){return this.openTag("table",["class","formtable","cellspacing","0","cellspacing","0"])},formTableClose:function(){return this.closeTag("table")},formEntryTop:function(t,e,a){return a?HU.tag("tr",["valign","top"],HU.tag("td",["class","formlabel","align","right"],t)+HU.tag("td",[],e)+HU.tag("td",[],a)):this.tag("tr",["valign","top"],this.tag("td",["class","formlabel","align","right"],t)+this.tag("td",[],e))},formEntry:function(t,e){return this.tag("tr",[],this.tag("td",["class","formlabel","align","right"],t)+this.tag("td",[],e))},appendArg:function(t,e,a){return t.indexOf("?")<0?t+="?":t+="&",t+=HtmlUtils.urlArg(e,a)},getUrl:function(t,e){e.length>0&&(t+="?");for(let a=0;a<e.length;a+=2)a>0&&(t+="&"),t+=this.urlArg(e[a],e[a+1]);return t},b:function(t){return this.tag("b",[],t)},td:function(t,e){return this.tag("td",t,e)},th:function(t,e){return this.tag("th",t,e)},tag:function(t,e,a){a||"string"!=typeof e||(a=e,e=null);let n="<"+t+" "+this.attrs(e)+">";return null!=a&&(n+=a),n+="</"+t+">",n},openTag:function(t,e,a){let n="<"+t+" "+this.attrs(e)+">";return null!=a&&(n+=a),n},open:function(t,e,a){let n="<"+t+" "+this.attrs(e)+">";return a&&(n+=a),n},openRow:function(){return this.openTag("div",["class","row"])},closeRow:function(){return this.closeTag("div")},openDiv:function(t){return this.openTag("div",t)},closeDiv:function(){return this.closeTag("div")},closeTag:function(t){return"</"+t+">\n"},close:function(...t){let e="";return t.forEach((t=>{e+="</"+t+">\n"})),e},urlArg:function(t,e){return t+"="+encodeURIComponent(e)},attrSelect:function(t,e){return Utils.isDefined(e)?"["+t+"='"+e+"']":"["+t+"]"},space:function(t){let e="";for(let a=0;a<t;a++)e+="&nbsp;";return e},attr:function(t,e){return null==e?" "+t+" ":" "+t+"="+this.qt(e)+" "},attrs:function(t){if(!t)return"";if("string"==typeof t)return t;let e="";if(null==t)return e;if(1==t.length)return t[0];for(let a=0;a<t.length;a+=2){let n=t[a];if(!n)continue;let i=t[a+1];e+=null==i?" "+n+" ":this.attr(n,i)}return e},styleAttr:function(t){return this.attr("style",t)},classAttr:function(t){return this.attr("class",t)},makeFullScreen:function(t){if(null==t)return console.log("HtmlUtils.makeFullScreen: null elem argument"),void console.trace();t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():console.err("No full screen")},makeEnlargable:function(t,e,a){$(document).ready((function(){HU.makeEnlargableInner(t,e,a)}))},makeEnlargableInner:function(t,e,a){let n=$("#"+t),i=($("#"+t+"_inner"),$("#"+t+"_contents")),l=!1,r=i.height();e=Utils.getStringDefined(e,"Show more"),a=Utils.getStringDefined(a,"Show less");let o=HU.div([ATTR_ID,t+"_button",ATTR_CLASS,"ramadda-enlarge-button ramadda-enlarge-bbutton ramadda-clickable"],e);$(o).appendTo(n).click((function(){l=!l,i.css("height",l?"":r),$(this).html(l?a:e)}))},makeExpandable:function(t,e,a){let n={right:"0px",top:"0px",icon:"fa-solid fa-maximize"};a&&$.extend(n,a);let i=HtmlUtils.getIconImage(n.icon,["class",CLASS_CLICKABLE],[]),l=HtmlUtils.getUniqueId(),r=HU.css("display","none","cursor","pointer","text-align","right","position","absolute","margin-top","0px");r+=n.left?HU.css("left",n.left):HU.css("right",n.right),r+=HU.css("top",n.top);let o=HtmlUtils.div(["id",l,"title","Expand","class","ramadda-expandable-link",ATTR_STYLE,r],i);$(t).append(o);let s=$("#"+l),c=$(t).hasClass("ramadda-expand-now");s.attr("data-expanded",c);let d=$(t).css("background");$(t).mouseenter((function(){s.css("display","block")})),$(t).mouseleave((function(){s.css("display","none")}));let u=function(){let a,n="true"==$(this).attr("data-expanded");if(n)a=HtmlUtils.getIconImage("fa-expand-arrows-alt"),$(this).attr("title","Expand"),$(t).css("left","").css("right","").css("top","").css("bottom","").css("position","relative").css("height","").css("z-index","").css("background",d||""),$(t).removeClass("ramadda-expandable-expanded"),s.css("display","none"),$(t).find(".ramadda-expandable-target").each((function(){$(this).attr("isexpanded","false"),$(this).attr("style",$(this).attr("original-style"))}));else{let n=$(window).height();a=HtmlUtils.getIconImage("fa-compress-arrows-alt");$(t).offset().top;if($(this).attr("title","Contract"),e){let e=$(t).find(".ramadda-expandable");return e.css("background","#fff"),void HtmlUtils.makeFullScreen(e.get(0))}$(t).addClass("ramadda-expandable-expanded"),$(t).css("left","50px").css("right","5px").css("top","5px").css("position","fixed").css("z-index","2000").css("background","#fff").css("height",n+"px"),$(t).find(".ramadda-expandable-target").each((function(){$(this).attr("original-style",$(this).attr("style")),$(this).attr("isexpanded","true");let t=$(this).attr("expandable-height");(t||-1!=t)&&$(this).css("height",t||"95vh")})),s.css("display","block")}$(this).attr("data-expanded",!n+""),$(this).html(a),window.ramaddaDisplayCheckLayout&&ramaddaDisplayCheckLayout(),window.ramaddaMapCheckLayout&&ramaddaMapCheckLayout()};$("#"+l).click(u),c&&u()},makeDraggable:function(t){$(t).draggable({zIndex:1e3,drag:function(t,e){},start:function(t,e){if(!$(this).attr("started")){$(this).attr("started",!0);let t=$(this).offset();$(this).attr("oleft",t.left),$(this).attr("otop",t.top),$(this).css("position","absolute").css("left",t.left+"px").css("top",t.top+"px"),console.log("start:"+t.left+" "+t.top)}}})},idAttr:function(t){return this.attr("id",t)},link:function(t,e,a){null==a&&(a=[]);let n=[];for(i in a)n.push(a[i]);return(a=n).push("url"),a.push(t),a.push("class"),a.push("ramadda-link"),a.style?a.style+="display:inline-block;":a.style="style='display:inline-block;'",this.div(a,e)},getEntryImage:function(t,e){if(e.indexOf("::")>=0){var a=e.split("::");a[0].trim().length>0&&(t=a[0].trim());var n=a[1].trim();return RamaddaUtil.getUrl("/metadata/view/"+n+"?entryid="+t)}return e},jsLink:function(t,e,a){return a=a||[],HU.href("javascript:noop();",e,a)},url:function(t,e){let a=t;for(let t=0;t<e.length;t+=2){0==t&&a.indexOf("?")<0?a+="?":a+="&";let n=e[t],i=e[t+1];a+=encodeURIComponent(n)+"="+encodeURIComponent(i)}return a},href:function(t,e,a){null==a&&(a=[]);let n=[];for(let t in a)n.push(a[t]);return(a=n).push("href"),a.push(t),Utils.isDefined(e)&&""!=e||(e=t),this.tag("a",a,e)},onClick:function(t,e,a){let n=["onclick",t,"style","color:black;   cursor:pointer;"];if(null!=a)for(let t=0;t<a.length;t++)n.push(a[t]);return this.tag("a",n,e)},checkbox:function(t,e,a,n){if(e=e||[],!Utils.stringDefined(t))for(let a=0;a<e.length;a+=2)if(e[a]==ATTR_ID){t=e[a+1];break}e.push(ATTR_ID),e.push(t),e.push("type"),e.push("checkbox"),e.includes("value")||(e.push("value"),e.push("true")),a&&(e.push("checked"),e.push(null));let i=this.tag("input",e);if(n){let a="";for(let t=0;t<e.length;t+=2)if("title"==e[t]){a=e[t+1];break}i+="&nbsp;"+HU.tag("label",["for",t,"title",a],n)}return i},radioGroup:function(t,e,a){let n="";return e.forEach(((e,i)=>{let l=e;Array.isArray(e)?(l=e[1],e=e[0]):Utils.isDefined(e.value)&&(l=e.label??e.value,e=e.value);let r=HU.getUniqueId("radio_");n+=HU.radio(r,t,"",e,a?a==e:0==i)+HU.tag("label",["for",r],l)+"<br>",n+="\n"})),n},radio:function(t,e,a,n,i,l){l||(l="");let r="<input id='"+t+"'  class='"+a+"' name='"+e+"' type=radio value='"+n+"' ";return i&&(r+=" checked "),r+=" "+l,r+="/>",r},handleFormChangeShowUrl:function(t,e,n,i,l,r){let o={showInputField:!0,includeCopyArgs:!1};r&&$.extend(o,r),null==i&&(i=[".*OpenLayers_Control.*","authtoken"]);let s=$("#"+e).attr("action")+"?";s=s.replace(/ +/g,"_");let c=$("#"+e+" :input"),d=0,u=[],f="",h={},p=(t,e)=>{let a=t+"---"+e;return!!h[a]||(h[a]=!0,!1)};c.each((function(t,e){if(""==e.name||null==e.value||""==e.value)return;if("-all-"==e.value)return;if("submit"==e.type&&"Cancel"==e.value)return;if("checkbox"==e.type&&!e.checked)return;if("radio"==e.type&&!e.checked)return;if(e.attributes&&e.attributes.default&&e.attributes.default.value==e.value)return;if(null!=i)for(t=0;t<i.length;t++){let a=i[t];if(e.name.match(a))return}if("formurl"==e.id)return;let n=e.attributes["default-value"]?.value;e.name;var l=[];if("select-multiple"==e.type&&e.selectedOptions)for(a in e.selectedOptions)option=e.selectedOptions[a],Utils.isDefined(option.value)&&n!=option.value&&l.push(option.value);else n!=e.value&&l.push(e.value);for(v in 1==l.length&&l.forEach((t=>{"entryid"!=e.name&&"submit"!=e.name&&"output"!=e.name&&(f+=e.name+"="+t+"\n")})),l)value=l[v],u.push({item:e,value:value}),p(e.name,value)||(d>0&&(s+="&"),d++,s+=encodeURIComponent(e.name)+"="+encodeURIComponent(value))}));let m=window.location.protocol+"//"+window.location.host;s=m+s;let g=o.showInputField?HtmlUtils.input("formurl",s,["size","80","id","formurl"]):HtmlUtils.hidden("formurl",s,["size","80","id","formurl"]),b=HU.vspace()+HtmlUtils.div(["class","ramadda-form-url"],g+SPACE2+(o.includeCopyArgs?HU.span(["id","argscopy","class",CLASS_CLICKABLE,"title","Copy json for subset action"],HtmlUtils.getIconImage("fas fa-earth-americas"))+SPACE2:"")+HU.span(["id","clipboard","class",CLASS_CLICKABLE,"title","Copy URL to clipboard"],HtmlUtils.getIconImage("fas fa-clipboard"))+SPACE2+HU.href(s,HtmlUtils.getIconImage("fas fa-link"),["title","Form URL"]));l&&(b+=l({entryId:t,formId:e,inputs:c,itemValuePairs:u})),$("#"+n).html(b),jqid("argscopy").click((()=>{Utils.copyToClipboard(f),alert("args for subset are copied to clipboard")})),jqid("clipboard").click((()=>{Utils.copyToClipboard(jqid("formurl").val()),alert("URL copied to clipboard")}))},preventSubmitOnEnter:function(t){"Enter"===t.key&&t.preventDefault()},makeUrlShowingForm:function(t,e,a,n,i,l){jqid(e).find(":input").change((function(){HtmlUtils.handleFormChangeShowUrl(t,e,a,n,i,l)})),HtmlUtils.handleFormChangeShowUrl(t,e,a,n,i,l)},makeSelectTagPopup:function(t,e){let a={label:"Select",buttonLabel:"Select",hide:!0,addBreak:!1,after:!1,tooltip:"Select multiple",wrap:"${widget}",makeButton:!0};e&&$.extend(a,e);let n=a.label??"Select";a.hide&&t.hide();let i=HU.getUniqueId("btn"),l=HU.span([ATTR_CLASS,"ramadda-clickable",ATTR_TITLE,a.tooltip,ATTR_ID,i,ATTR_ID,i],a.buttonLabel)+(a.addBreak?"<br>":"");l=a.wrap.replace("${widget}",l),a.after?t.after(" "+l):t.before(l);let r={},o=function(e,a){let n=r[e.attr(ATTR_ID)];if(n){let i=e.is(":checked");n.prop("selected",i),a&&t.change()}},s=function(){o($(this),!0)},c=e=>{let a=[];t.find("option").each((function(){let t=$(this).attr("value"),e=$(this).is(":selected"),n=HU.getUniqueId("cbx");r[n]=$(this);let i=HU.checkbox(n,[],e,t);i=HU.div([ATTR_CLASS,"ramadda-select-tag","tag",$(this).html()+" "+t],i),a.push(i)}));let i=HU.div([ATTR_STYLE,HU.css("margin","5px","width","600px;","max-height","300px","overflow-y","auto")],Utils.wrap(a,"","")),l=HU.getUniqueId("input_"),c=HU.input("","",[ATTR_STYLE,HU.css("width","200px;"),"placeholder","Search for "+n.toLowerCase(),ATTR_ID,l]),d="";d+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action","data-action","clear"],"Clear all"),d+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action","data-action","selectshown"],"Select shown"),d+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action","data-action","showselected"],"Show selected"),d+=HU.space(1)+HU.div([ATTR_CLASS,"ramadda-select-action","data-action","showall"],"Show all"),c+=HU.div([ATTR_STYLE,HU.css("border-bottom","var(--basic-border)","padding","6px")],d);let u=HU.div([ATTR_STYLE,HU.css("margin","10px")],HU.center(c)+i),f=HU.makeDialog({content:u,anchor:e,title:n,draggable:!0,header:!0});f.find(":checkbox").change(s);let h=f.find(".ramadda-select-tag");f.find(".ramadda-select-action").button().click((function(){let e=$(this).attr("data-action");"showall"!=e?"showselected"!=e?("selectshown"==e&&(h.each((function(){if($(this).is(":visible")){let t=$(this).find(":checkbox");t.prop("checked",!0),o(t,!1)}})),t.change()),"clear"==e&&(h.each((function(){let t=$(this).find(":checkbox");t.prop("checked",!1),o(t,!1)})),t.change())):h.each((function(){$(this).find(":checkbox").is(":checked")||$(this).hide()})):h.show()})),$("#"+l).keyup((function(t){let e=$(this).val().trim().toLowerCase();h.each((function(){if(""==e)$(this).show();else{let t=$(this).attr("tag");t&&(t=t.toLowerCase(),t.indexOf(e)>=0?$(this).show():$(this).hide())}}))}))};a.makeButton&&jqid(i).button(),jqid(i).click((function(){c($(this))}))},select:function(t,e,a,n,i,l){var r=this.openTag("select",e);return r+=HU.makeOptions(a,n,i,l),r+=this.closeTag("select")},makeOptions:function(t,e,a,n){let i="";return t.forEach((t=>{let n=[],l=t;if(Array.isArray(t))l=t[1],t=t[0];else if(Utils.isDefined(t.value)){t.imgsrc&&n.push("img-src",t.imgsrc),t.datatitle&&n.push("title",t.datatitle),t.datastyle&&n.push("data-style",t.datastyle);let e=String(t.value).replace(/"/g,'\\"');l=t.label??e,t=e}let r=l;a&&l.length>a&&(l=l.substring(0,a)+"...");let o="";e&&Array.isArray(e)?e.indexOf(t)>=0&&(o=" selected "):e==t&&(o=" selected ");let s=r;t&&t!=s&&t.indexOf&&t.indexOf("base64")<0&&(s=s+HU.getTitleBr()+t),n.push("title",s,o,null,"value",t),i+=HU.tag("option",n,l)})),i},datePicker:function(t,e,a){return a.push("size"),a.push("8"),HtmlUtils.input(t,e,a)},makeClearDatePickerArgs:function(t){let e={showButtonPanel:!0,closeText:"Clear",onClose:function(t){$(window.event.srcElement).hasClass("ui-datepicker-close")&&$(this).val("")}};return t&&$.extend(e,t),e},datePickerInit:function(t){$("#"+t).datepicker({onSelect:function(t,e){t!==e.lastVal&&$(this).change()},dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,constrainInput:!1,yearRange:"1900:2100"})},rangeInput:function(t,e){var a='<form><div><input type="text" class="ramadda-slider-value sliderValue" data-index="0" value="10" /> <input type="text" class="ramadda-slider-value  sliderValue" data-index="1" value="90" /></div>'+HtmlUtils.div(["id",e])+"</form>";return console.log(a),a},rangeInputInit:function(t){$("#"+t).slider({min:0,max:100,step:1,values:[10,90],slide:function(t,e){for(var a=0;a<e.values.length;++a)$("input.sliderValue[data-index="+a+"]").val(e.values[a])}}),$("input.sliderValue").change((function(){var t=$(this);$("#slider").slider("values",t.data("index"),t.val())}))},input:function(t,e,a){return"<input "+HtmlUtils.attrs(a)+HtmlUtils.attrs(["value",e])+(null==t?"":HtmlUtils.attrs("name",t))+">"},hidden:function(t,e,a){return"<input type=hidden "+HtmlUtils.attrs(a)+HtmlUtils.attrs(["name",t,"value",e])+">"},textarea:function(t,e,a){return"<textarea "+HtmlUtils.attrs(a)+HtmlUtils.attrs(["name",t])+">"+e+"</textarea>"},initSelect:function(t,e){if(0==t.length)return;let a={showEffect:"fadeIn",showEffectSpeed:400,hideEffect:"fadeOut",hideEffectSpeed:400,autoWidth:!1};e&&$.extend(a,e),$(document).ready((function(){HtmlUtils.loadJqueryLib("selectBoxIt",[RamaddaUtil.getCdnUrl("/lib/selectboxit/stylesheets/jquery.selectBoxIt.css")],[RamaddaUtil.getCdnUrl("/lib/selectboxit/javascripts/jquery.selectBoxIt.min.js")],t,(()=>{setTimeout((()=>{$(t).selectBoxIt(a)}),100)}))}))},valueDefined:function(t){return""!=t&&0!=t.indexOf("--")},squote:function(t){return"'"+t+"'"},makeToggle:function(t,e,a){null===a&&(a=!0);let n=ramaddaCdn+"/icons/togglearrowdown.gif",i=ramaddaCdn+"/icons/togglearrowright.gif";$("#"+t).attr("state","open"),$("#"+t).attr("src",n),$("#"+t).css("cursor","pointer");let l=t=>{t.attr("state","close"),t.attr("src",i),$("#"+e).hide()};$("#"+t).click((function(t){var a;"open"==$(this).attr("state")?l($(this)):((a=$(this)).attr("state","open"),a.attr("src",n),$("#"+e).show()),t.preventDefault()})),a||l($("#"+t))},makeSplash:function(t,e){let a={width:"50%",style:"",showOk:!0};if(e&&$.extend(a,e),a.src&&(t=$("#"+a.src).html()),null==t||""==t.trim())return;t=HU.div([STYLE,"margin:10px;"],t);let n=Utils.getUniqueId("close_"),i=HU.div([ID,n,CLASS,CLASS_CLICKABLE,STYLE,HU.css("position","absolute","right","10px","top","10px")],HU.getIconImage("far fa-window-close"))+t;a.showOk&&(i+=HU.center(HU.div([ID,n+"_button"],"OK"))),i=HU.div([CLASS,"ramadda-shadow-box ramadda-splash",STYLE,HU.css("width",a.width)+a.style],i);let l=$(HU.div([CLASS,"ramadda-splash-container"],i)).appendTo($("body"));$("body").addClass("ramadda-splash-body");let r=()=>{$("body").removeClass("ramadda-splash-body"),l.remove()};l.click((t=>{})),$("#"+n).click((()=>{r()})),$("#"+n+"_button").button().click((()=>{r()}))},makeToggleImage:function(t,e){return e=e||"",HU.div([STYLE,HU.css("display","inline-block","min-width","10px")],HtmlUtils.getIconImage(t,["align","bottom"],[STYLE,e]))},toggleBlockListeners:{},toggleBlockVisibility:function(t,e,a,n,i,l){let r=!0;Utils.isDefined(r)||(r=!0),toggleVisibility(t,"block",i,l)?HU.isFontAwesome(a)?$("#"+e).html(HU.makeToggleImage(a)):$("#"+e).attr("src",a):(r=!1,HU.isFontAwesome(a)?$("#"+e).html(HU.makeToggleImage(n)):$("#"+e).attr("src",n)),Utils.ramaddaUpdateMaps(),HtmlUtils.toggleBlockListeners[t]&&HtmlUtils.toggleBlockListeners[t](t,r)},toggleBlock:function(t,e,a,n,i){let l={headerClass:"ramadda-noselect entry-toggleblock-label ramadda-hoverable "+CLASS_CLICKABLE,headerStyle:"",orientation:"h",imgopen:"fas fa-caret-down",imgclosed:"fas fa-caret-right"};n&&$.extend(l,n);let r="horizontal"==l.orientation;r&&(l.headerStyle+="line-height:1px;");let o=Utils.getUniqueId("block_"),s=o+"_img";i&&(i.id=o,i.imgid=s);let c=l.imgopen,d=l.imgclosed,u="HtmlUtils.toggleBlockVisibility("+HtmlUtils.join([HtmlUtils.squote(o),HtmlUtils.squote(s),HtmlUtils.squote(c),HtmlUtils.squote(d),l.animated],",")+");",f=HU.span([ID,s],HU.makeToggleImage(a?c:d)),h=HtmlUtils.div([STYLE,l.headerStyle,"class",l.headerClass,"onClick",u],f+" "+t),p=a?"display:block;visibility:visible":"display:none;",m=HtmlUtils.div(["class","hideshowblock","id",o,"style",p],e);return l.listener&&(HtmlUtils.toggleBlockListeners[o]=l.listener),l.separate?{header:h,body:m,id:o}:r?HU.hbox([h,m]):h+m},toggleBlockNew:function(t,e,a,n){Utils.isDefined(a)||(a=!1);let i={headerClass:"ramadda-noselect ramadda-toggleblock-label "+CLASS_CLICKABLE,headerStyle:""};n&&$.extend(i,n);let l=Utils.getUniqueId("block_"),r=l+"_img",o=HU.span([ID,r],HU.makeToggleImage(a?"fas fa-caret-down":"fas fa-caret-right")),s=["toggle-block-id",l,"toggle-block-visible",a,STYLE,i.headerStyle,"class",i.headerClass];i.extraAttributes&&(s=Utils.mergeLists(s,i.extraAttributes));let c=HtmlUtils.div(s,o+" "+t),d=a?"display:block;visibility:visible":"display:none;",u=HtmlUtils.div(["class","hideshowblock","id",l,"style",d],e);return i.separate?{header:c,body:u,id:l}:c+u},initToggleBlock:function(t,e){t.find("[toggle-block-id]").click((function(){let t=$(this).attr("toggle-block-id"),a=t+"_img",n="true"===$(this).attr("toggle-block-visible");n=!n,$(this).attr("toggle-block-visible",""+n),$("#"+a).html(HU.makeToggleImage(n?"fas fa-caret-down":"fas fa-caret-right")),n?$("#"+t).show():$("#"+t).hide(),e&&e(t,n,$(this))}))}},StringUtil={endsWith:function(t,e){return t.length>=e.length&&t.lastIndexOf(e)+e.length==t.length},startsWith:function(t,e){return t.length>=e.length&&0===t.lastIndexOf(e,0)}},blockCnt=0,SU;function DomObject(t){this.obj=null,document.getElementById?(this.obj=document.getElementById(t),this.obj&&(this.style=this.obj.style)):document.all?(this.obj=document.all[t],this.obj&&(this.style=this.obj.style)):document.layers&&(this.obj=document.layers[t],this.style=document.layers[t]),this.obj&&(this.id=this.obj.id,this.id||(this.id="obj"+blockCnt++))}function pageIsUnloading(){GuiUtils.pageUnloading=!0,window.onbeforeunload=confirmExit}function confirmExit(){return null}function Div(t,e){this.id=HtmlUtils.getUniqueId(),this.contents=t||"",this.extra="",this.clazz=e,this.setHidden=function(){},this.toString=function(){return HtmlUtils.div(["class",e||"","id",this.id],this.contents)},this.getId=function(){return this.id},this.jq=function(){return $("#"+this.id)},this.set=function(t,e){return e&&(this.extra=HtmlUtils.attrs(e)),this.contents=t,this.jq().html(t),this},this.append=function(t){this.content?this.content+=t:this.content=t,$("#"+this.id).append(t)},this.msg=function(t){return this.set(HtmlUtils.div([ATTR_CLASS,"display-message"],t))}}function number_format(t,e,a){let n,i=t<0,l=Utils.roundDecimals(t,e,!1);i?(n=Math.ceil(l),n=Math.abs(n)):n=Math.floor(l);let r=String(l).match(/\.(.*)/),o=r?r[1]:"",s=String(n).replace(/(.)(?=(\d{3})+$)/g,"$1,");return""!=o&&(s+="."+o),a&&console.log("number:"+t+" n:"+l+" i:"+n+" s:"+s),i&&0==n||i?"-"+s:s}$.widget("custom.iconselectmenu",$.ui.selectmenu,{_renderItem:function(t,e){let a=$("<li>"),n=$("<span>");e.disabled&&a.addClass("ui-state-disabled");let i=e.label,l=e.element.attr("img-src"),r=e.element.attr("title");"<blank>"==i&&(i="&lt;blank&gt;"),l&&(l=l.startsWith("fa")?HU.getIconImage(l):HU.image(l,[ATTR_STYLE,e.element.attr("data-style")||"","width",64,"title",r,"class","ui-icon "+e.element.attr("data-class")]),$(l).appendTo(n)),e.element.attr("isheader")?(n.css("padding-left","0px").css("pointer-events","none"),a.css("pointer-events","none")):i=HU.span(["title",i,STYLE,HU.css("display","inline-block","width","100%","margin-left",l?"32px":"4px","white-space","nowrap")],i);let o=e.element.attr("label-class");return o&&(i=HU.div([STYLE,HU.css("width","100%"),"class",o],i)),n.append(i),a.append(n).appendTo(t)}}),window.onbeforeunload=pageIsUnloading,function(t,e){t.fn.getCursorPosition=function(){var e=t(this).get(0),a=0;if("selectionStart"in e)a=e.selectionStart;else if("selection"in document){e.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-e.value.length),a=n.text.length-i}return a}}(jQuery);var SvgUtils=SU={translate:function(t,e){return" translate("+t+","+e+") "},scale:function(t){return" scale("+t+") "},rotate:function(t){return" rotate("+t+") "},skewX:function(t){return" skewX("+t+") "},transform:function(t,...e){return t.attr("transform",e.join(" ")),t},makeBlur:function(t,e,a){return t.append("defs").append("filter").attr("id",e).append("feGaussianBlur").attr("stdDeviation",a)}},dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,n=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(i,l,r){var o=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(i)||/\d/.test(i)||(l=i,i=void 0),i=i?new Date(i):new Date,isNaN(i))throw SyntaxError("invalid date");"UTC:"==(l=String(o.masks[l]||l||o.masks.default)).slice(0,4)&&(l=l.slice(4),r=!0);var s=r?"getUTC":"get",c=i[s+"Date"](),d=i[s+"Day"](),u=i[s+"Month"](),f=i[s+"FullYear"](),h=i[s+"Hours"](),p=i[s+"Minutes"](),m=i[s+"Seconds"](),g=i[s+"Milliseconds"](),b=r?0:i.getTimezoneOffset(),U={d:c,dd:n(c),ddd:o.i18n.dayNames[d],dddd:o.i18n.dayNames[d+7],m:u+1,mm:n(u+1),mmm:o.i18n.monthNames[u],mmmm:o.i18n.monthNames[u+12],yy:String(f).slice(2),yyyy:f,h:h%12||12,hh:n(h%12||12),H:h,HH:n(h),M:p,MM:n(p),s:m,ss:n(m),l:n(g,3),L:n(g>99?Math.round(g/10):g),t:h<12?"a":"p",tt:h<12?"am":"pm",T:h<12?"A":"P",TT:h<12?"AM":"PM",Z:r?"UTC":(String(i).match(e)||[""]).pop().replace(a,""),o:(b>0?"-":"+")+n(100*Math.floor(Math.abs(b)/60)+Math.abs(b)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return l.replace(t,(function(t){return t in U?U[t]:t.slice(1,t.length-1)}))}}();function jqid(t){return HtmlUtils.jqid(t)}dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(t,e){return dateFormat(this,t,e)},$(document).ready((function(){HU.documentReady=!0,Utils.checkForResize()})),Utils.areDisplaysReady();
