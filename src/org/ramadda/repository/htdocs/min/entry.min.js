var OUTPUT_JSON="json",OUTPUT_CSV="default.csv",OUTPUT_CHOOSE="default.ids",OUTPUT_ZIP="zip.tree",OUTPUT_EXPORT="zip.export",VALUE_ANY_TYPE="_any_",DEFAULT_MAX=100,ENTRY_NONGEO=-9999,OUTPUTS=[{id:OUTPUT_CHOOSE,name:"Select Output"},{id:OUTPUT_ZIP,name:"Download Files"},{id:OUTPUT_EXPORT,name:"Export"}];function getRamadda(t,e){t||(t=ramaddaBaseUrl);let n=t.split(";"),i=null;n.length>1&&(t=n[0].trim(),i=n[1].trim());let r,a=null,s=new RegExp("^(.*)\\((.+)\\).*$").exec(t);if(s&&(t=s[1].trim(),a=s[2]),"this"==t)return getGlobalRamadda();if(null==window.globalRamaddas&&(window.globalRamaddas={}),!e&&(r=window.globalRamaddas[t],null!=r))return r;let o=window[t];return null==o&&(o=window[t+"Repository"]),o&&(r=new Object,o.call(r,i,a)),null==r&&(r=new RamaddaRepository(t),null!=i&&(r.name=i)),addRepository(r),r}function addRepository(t){null==window.globalRamaddas&&(window.globalRamaddas={}),window.globalRamaddas[t.repositoryRoot]=t}function getGlobalRamadda(t){return getRamadda(ramaddaBaseUrl,t)}function Repository(t){let e=null,n=t.match("^(http.?://[^/]+)/");n&&n.length>0&&(e=n[1]),RamaddaUtil.defineMembers(this,{repositoryRoot:t,baseEntry:null,hostname:e,name:null,getId:function(){return this.repositoryRoot},getSearchMessage:function(){return"Searching "+this.getName()},getSearchLinks:function(t){return null},getSearchUrl:function(t){return null},getId:function(){return this.repositoryRoot},getIconUrl:function(t){return RamaddaUtil.getCdnUrl("/icons/page.png")},getEntryTypes:function(t){return new Array},getEntryType:function(t){return null},getMetadataCount:function(t,e){return 0},getEntryUrl:function(t,e){return null},getBaseEntry:function(t){if(null!=this.baseEntry)return this.baseEntry},getRoot:function(){return this.repositoryRoot},getHostname:function(){return this.hostname},canSearch:function(){return!0},getName:function(){if(this.children)return"Search all repositories";if(null!=this.name)return this.name;if(0==this.repositoryRoot.indexOf("/"))return this.name="This RAMADDA";let t=this.repositoryRoot,e=document.createElement(TAG_A);e.href=t;let n=e.hostname,i=e.pathname;return"/repository"==i?n:this.name=n+": "+i}})}function RepositoryContainer(t,e){let n;this._id="CONTAINER",RamaddaUtil.inherit(this,n=new Repository(t)),RamaddaUtil.defineMembers(this,{name:e,children:[],canSearch:function(){return!1},getSearchMessage:function(){return"Searching "+this.children.length+" repositories"},addRepository:function(t){this.children.push(t)},getEntryTypes:function(t){if(null!=this.entryTypes)return this.entryTypes;this.entryTypes=[];let e={};for(let t=0;t<this.children.length;t++){let n=this.children[t].getEntryTypes();if(null!=n)for(let t=0;t<n.length;t++){let i=n[t];if(null==e[i.getId()]){let t={};t=$.extend(t,i),e[i.getId()]=t,this.entryTypes.push(t)}else e[i.getId()].entryCount+=i.getEntryCount()}}return this.entryTypes}})}function RamaddaRepository(t){let e;null==t&&(t=ramaddaBaseUrl),RamaddaUtil.inherit(this,e=new Repository(t)),RamaddaUtil.defineMembers(this,{entryCache:{},entryTypes:null,entryTypeMap:{},toString:function(){return"ramadda:"+this.getId()},canSearch:function(){return!0},getJsonUrl:function(t){return this.repositoryRoot+"/entry/show?entryid="+t+"&output=json"},createEntriesFromJson:function(t){let e=new Array;for(let n=0;n<t.length;n++){let i=t[n];i.baseUrl=this.getRoot();let r=new Entry(i);this.addEntry(r),e.push(r)}return e},getEntryType:function(t){return this.entryTypeMap[t]},entryTypeCallPending:!1,entryTypeCallbacks:null,entryTypesMap:{},getEntryTypes:function(t,e,n){if(n||(n=""),null!=this.entryTypesMap[n])return this.entryTypesMap[n];if(this.entryTypeCallPending){let e=this.entryTypeCallbacks;return null==e&&(e=[]),e.push(t),this.entryTypeCallbacks=e,this.entryTypesMap[n]}let i=this,r=this.repositoryRoot+"/entry/types?forsearch=true";e&&(r=r+"&types="+e),Utils.stringDefined(n)&&(r=r+"&"+n),this.entryTypeCallPending=!0,this.entryTypeCallbacks=null;$.getJSON(r,(function(e){if(GuiUtils.isJsonError(e))return;i.entryTypesMap[n]=[];for(let t=0;t<e.length;t++){let r=new EntryType(e[t]);i.entryTypeMap[r.getId()]=r,i.entryTypesMap[n].push(r)}null!=t&&t(i,i.entryTypesMap[n]);let r=i.entryTypeCallbacks;if(i.entryTypeCallPending=!1,i.entryTypeCallbacks=null,r)for(let t=0;t<r.length;t++)r[t](i,i.entryTypesMap[n])})).done((function(t,e,n){i.entryTypeCallPending=!1})).always((function(t,e,n){i.entryTypeCallPending=!1})).fail((function(t,e,n){i.entryTypeCallPending=!1;let a="";n&&n.length>0&&(a+=":  "+n),GuiUtils.handleError("An error has occurred reading entry types"+a,"URL: "+r,!1)}));return this.entryTypesMap[n]},metadataCache:{},metadataCachePending:{},metadataCacheCallbacks:{},getMetadataCount:function(t,e){let n=t.getType(),i=this.metadataCache[n];if(null!=i)return e(t,i),null;if(this.metadataCachePending[n]){let t=this.metadataCacheCallbacks[n];return null==t&&(t=[]),t.push(e),this.metadataCacheCallbacks[n]=t,null}this.metadataCacheCallbacks[n]=null,this.metadataCachePending[n]=!0;let r=this.repositoryRoot+"/metadata/list?metadata_type="+t.getType()+"&response=json",a=this;$.getJSON(r,(function(i){let r=a.metadataCacheCallbacks[n];if(a.metadataCachePending[n]=!1,!GuiUtils.isJsonError(i)&&(a.metadataCache[n]=i,e(t,i),r))for(let e=0;e<r.length;e++)r[e](t,i)})).fail((function(t,e,i){a.metadataCachePending[n]=!1;let s=e+", "+i;GuiUtils.handleError("Error getting metadata count: "+s,r,!1)}));return null},getEntryUrl:function(t,e){let n;n="string"==typeof t?t:t.id;let i=this.getRoot()+"/entry/show?entryid="+n;return null!=e&&(StringUtil.startsWith(e,"&")||(i+="&"),i+=e),i},getEntryDownloadUrl:function(t,e){let n;if(n="string"==typeof t?t:t.id,n.startsWith("http"))return n.indexOf("ramadda.org")>=0?Ramadda.getUrl("/proxy?url="+encodeURIComponent(n)):n;let i=this.getRoot()+"/entry/get?entryid="+n;return null!=e&&(StringUtil.startsWith(e,"&")||(i+="&"),i+=e),i},getSearchLinks:function(t,e,n){let i=[];for(let r=0;r<OUTPUTS.length;r++){let a=OUTPUTS[r];n&&!n(a)||(e?i.push(HU.span([ATTR_CLASS,HU.classes("ramadda-search-link",CLASS_CLICKABLE),ATTR_TITLE,Utils.delimMsg("Click to download")+"; "+Utils.delimMsg("Shift-click to copy URL"),ATTR_DATA_NAME,a.name,"data-format",a.id,"data-url",this.getSearchUrl(t,a.id)],a.name)):i.push(HU.href(this.getSearchUrl(t,a.id),a.name,[ATTR_CLASS,"ramadda-search-link"])))}return i},getUrlRoot:function(){return this.repositoryRoot},getSearchUrl:function(t,e,n){let i=this.repositoryRoot+"/search/do?forsearch=true";e&&(i+="&output="+e);for(let e=0;e<t.types.length;e++){let n=t.types[e];n!=VALUE_ANY_TYPE&&(i+="&type="+n)}null!=t.parent&&t.parent.length>0&&(i+="&group="+t.parent),t.providers&&t.providers.forEach((t=>{i+="&provider="+t}));let r=(t,e)=>{Utils.stringDefined(e)&&(i+="&"+t+"="+e)};r("text",t.text),r("name",t.name),r("description",t.description),r("datadate.from",t.startDate),r("datadate.to",t.endDate),r("createdate.from",t.createstartDate),r("createdate.to",t.createendDate),r("changedate.from",t.changestartDate),r("changedate.to",t.changeendDate),t.entries&&t.entries.length>0&&(i+="&entries="+t.entries),t.orderBy&&(i+="&orderby="+t.orderBy,Utils.isDefined(t.ascending)&&(i+="&ascending="+(t.ascending?"true":"false"))),t.getAreaContains()&&(i+="&areamode=contains"),isNaN(t.getNorth())||(i+="&maxlatitude="+t.getNorth()),isNaN(t.getWest())||(i+="&minlongitude="+t.getWest()),isNaN(t.getSouth())||(i+="&minlatitude="+t.getSouth()),isNaN(t.getEast())||(i+="&maxlongitude="+t.getEast()),t.ancestor&&(i+="&ancestor="+encodeURIComponent(t.ancestor));for(let e=0;e<t.metadata.length;e++){let n=t.metadata[e],r=n.index;Utils.isDefined(r)||(r=1),i+="&metadata_attr"+r+"_"+n.type+"="+encodeURIComponent(n.value)}return i+="&max="+t.getMax(),i+="&skip="+t.getSkip(),t.rootEntry&&(i+="&rootEntry="+encodeURIComponent(t.rootEntry)),i+=t.getExtra(),i},isLocal(){return this.repositoryRoot&&this.repositoryRoot.startsWith("/")},addEntry:function(t){this.entryCache[t.getId()]=t},getEntry:async function(t,e){let n=!1;if(null==t)return console.log("Error in getEntry: entry id is null"),console.trace(),null;let i=this.entryCache[t];if(null!=i)return Utils.call(e,i);if(window.globalRamaddas)for(let n=0;n<window.globalRamaddas.length;n++){let i=window.globalRamaddas[n].entryCache[t];if(null!=i)return Utils.call(e,i)}if(null==e)return null;let r=this,a=this.getJsonUrl(t)+"&ancestors=true";await $.getJSON(a,(function(t){if(GuiUtils.isJsonError(t))return void 0;let n=createEntriesFromJson(t,r),i=null;n.length>0&&(i=n[0]),Utils.call(e,i,n)})).fail((function(t,e,n){let i=e+", "+n;GuiUtils.handleError("Error getting entry information: "+i,a,!1)}))}})}function createEntriesFromJson(t,e){return null==e&&(e=getGlobalRamadda()),e.createEntriesFromJson(t)}var metadataTypeCount=-1,metadataColorPalette=["#FDF5E6","#F0FFFF","#FFE3D5","#a7d0cd","#fbeeac","#dbe3e5","#e8e9a1"],metadataColors={};function getMetadataColor(t){return t.color?t.color:metadataColors[t]?metadataColors[t]:metadataColorPalette[0]}function MetadataType(t,e,n){$.extend(this,{type:t,label:e,value:n}),this.color=Utils.getEnumColor(t),$.extend(this,{getType:function(){return this.type},getColor:function(){return this.color},getAddNot:function(){return this.addNot},getLabel:function(){return null!=this.label?this.label:this.type},getSearchLabel:function(){return null!=this.searchLabel?this.searchLabel:this.getLabel()},getValue:function(){return this.value}})}function EntryTypeColumn(t){$.extend(this,t),RamaddaUtil.defineMembers(this,{getName:function(){return this.name},getLabel:function(){return this.label},getGroup:function(){return this.group},getSearchGroup:function(){return this.searchGroup??this.group},getSearchLabel:function(){return null!=this.searchLabel?this.searchLabel:this.getLabel()},getType:function(){return this.type},getValues:function(){return this.values},getSuffix:function(){return this.suffix},getSearchArg:function(){return"search."+this.namespace+"."+this.name},getCanSearch:function(){return this.cansearch},getCanShow:function(){return this.canshow},isEnumeration:function(){return"enumeration"==this.getType()||"enumerationplus"==this.getType()},isLatLon:function(){return"latlon"==this.getType()},isDate:function(){return"date"==this.getType()},isEntry:function(){return"entry"==this.getType()},showCheckboxes:function(){return this.searchShowCheckboxes},getSearchMultiples:function(){return this.searchMultiples},isNumeric:function(){return"double"==this.getType()||"int"==this.getType()},isUrl:function(){return"url"==this.getType()}})}function EntryType(t){let e=t.columns;null==e&&(e=[]);let n=[];for(let t=0;t<e.length;t++)n.push(new EntryTypeColumn(e[t]));t.columns=n,$.extend(this,t),RamaddaUtil.defineMembers(this,{getIsGroup:function(){return this.isgroup},getIcon:function(){return this.icon},getLabel:function(){return this.label||this.name},getId:function(){return null!=this.type?this.type:this.id},getCategory:function(){return this.category},getSuperCategory:function(){return this.superCategory},getEntryCount:function(){return this.entryCount},getIncludeInSearch:function(){return this.includeInSearch},getColumns:function(){return this.columns}})}function Entry(t){null==t.repositoryId&&(t.repositoryId=t.baseUrl),null==t.repositoryId&&(t.repositoryId=ramaddaBaseUrl);let e=ENTRY_NONGEO;if(t.typeObject)t.type=new EntryType(t.typeObject);else if(t.type){let e={id:t.type,name:null!=t.typeName?t.typeName:t.type};t.type=new EntryType(e)}if($.extend(this,{id:null,name:null,description:null,bbox:null,geometry:null,services:[],properties:[],childrenEntries:null,startDate:null,endDate:null,embedWikiText:null}),$.extend(this,t),this.domId=Utils.cleanId(this.id),this.createDate=Utils.parseDate(t.createDate),this.startDate=Utils.parseDate(t.startDate),this.endDate=Utils.parseDate(t.endDate),this.endDate&&this.startDate&&this.endDate.getTime()<this.startDate.getTime()){let t=this.startDate;this.startDate=this.endDate,this.endDate=t}this.attributes=[],this.metadata=[];for(let t=0;t<this.properties.length;t++){let e=this.properties[t];"attribute"==e.type?this.attributes.push(e):this.metadata.push(e)}RamaddaUtil.defineMembers(this,{getId:function(){return this.id},getIdForDom:function(){return this.domId},canEdit:function(){return this.canedit},isSynth:function(){return this.id.startsWith("synth:")},getFullId:function(){return this.getRamadda().getRoot()+","+this.id},doSave:function(t,e,n,i){RamaddaUtil.doSave(this.getId(),t,e,n,i)},getDisplayName:function(t){return this.displayName?this.displayName:this.getName(t)},getCreateDate:function(){return this.createCreate},getStartDate:function(){return this.startDate},getEndDate:function(){return this.endDate},getIsGroup:function(){return this.isGroup},getProperty:function(t,e,n){if(e=e??{},"name"==t)return this.canEdit()&&n?HU.input(null,this.getName(),[ATTR_SIZE,30,ATTR_ENTRYID,this.getId(),ATTR_TITLE,"Edit name",ATTR_CLASS,"ramadda-entry-inlineedit",ATTR_DATA_FIELD,"name"]):this.getName();if("fromdate"==t)return HU.span([ATTR_CLASS,"ramadda-datetime",ATTR_TITLE,this.startDate],this.startDateFormat);if("time"==t)return HU.span([ATTR_CLASS,"ramadda-datetime",ATTR_TITLE,this.startDate],this.hhmm);if("download"==t){if(!this.getIsFile())return"";let t=this.getResourceUrl(),e=HU.getIconImage("fas fa-download");return this.getFilesize()&&(e+=" "+this.getFormattedFilesize()),HU.href(t,e)}if("entryorder"==t)return this.canEdit()&&n?HU.input(null,this.order,[ATTR_SIZE,3,ATTR_ENTRYID,this.getId(),ATTR_TITLE,"Edit order",ATTR_CLASS,"ramadda-entry-inlineedit ramadda-entry-inlineedit-entryorder",ATTR_DATA_FIELD,"entryorder"]):this.order;if("creator"==t){let t=HU.url(RamaddaUtil.getUrl("/search/do"),"user_id",this.creator,"search.submit","true");return HU.href(t,Utils.stringDefined(this.creatorName)?this.creatorName:this.creator,[ATTR_TITLE,"Search for entries of this type created by this user"])}if("latitude"==t)return this.getLatitude();if("longitude"==t)return this.getLongitude();if("altitude"==t)return this.getAltitude();if("createdate"==t)return HU.span([ATTR_CLASS,"ramadda-datetime",ATTR_TITLE,this.createDate],this.createDateFormat);if("changedate"==t)return HU.span([ATTR_CLASS,"ramadda-datetime",ATTR_TITLE,this.changeDate],this.changeDateFormat);if("size"==t)return this.getFilesize()?this.getFormattedFilesize():"---";if("type"==t)return this.typeName;if("editcolumns"==t){if(!this.attributes)return"";let t="";return this.attributes.forEach((e=>{this.canEdit()&&e.caninlineedit&&(""==t&&(t=HU.formTable()),t+=HU.formEntryLabel(e.label,HU.input(null,e.value,[ATTR_SIZE,8,ATTR_ENTRYID,this.getId(),ATTR_TITLE,"Edit "+e.label,ATTR_CLASS,"ramadda-entry-inlineedit ramadda-entry-inlineedit-entryorder",ATTR_DATA_FIELD,e.id])))})),""!=t&&(t+=HU.formTableClose()),t}return"Unknown:"+t},getTypeName:function(){return this.typeName},getRoot:async function(t,e){let n=this;for(;;){let e;if(await n.getParentEntry((t=>e=t)),!e)return Utils.call(t,n);n=e}},map:async function(t,e){let n;await this.getChildrenEntries((t=>{n=t})),n.map(t),Utils.call(e)},getEmbedWikiText:function(){return this.embedWikiText},getParentName:function(){return this.parentName},getParentEntry:async function(t,e){return this.parent?this.parentEntry?Utils.call(t,this.parentEntry):void await this.getRamadda().getEntry(this.remoteParent||this.parent,(e=>{this.parentEntry=e,Utils.call(t,e)})):Utils.call(t,null)},getChildrenEntries:async function(t,e){if(null!=this.childrenEntries)return Utils.call(t,this.childrenEntries);new EntrySearchSettings({parent:this.getId()});let n=this.getRamadda().getJsonUrl(this.getAbsoluteId())+"&justchildren=true";null!=e&&(n+="&"+e);let i={entryListChanged:function(e){t(e.getEntries())}},r=new EntryList(this.getRamadda(),n,i,!1);await r.doSearch()},getType:function(){return this.typeObject,this.type},getThumbnail:function(){if(!this.metadata)return null;let t,e=t=>{if(t.value.attr1.startsWith("http"))return t.value.attr1;return this.getRamadda().getRoot()+"/metadata/view/"+t.value.attr1+"?element=1&entryid="+this.getAbsoluteId()+"&metadata_id="+t.id};for(let n=0;n<this.metadata.length;n++){let i=this.metadata[n];if("content.thumbnail"==i.type&&Utils.stringDefined(i.value.attr1)&&(t=i,"true"==i.attr3))return e(i)}return t?e(t):null},getMetadata:function(){return this.metadata},getRamadda:function(){return this.remoteRepository?getRamadda(this.remoteRepository.url):getRamadda(this.repositoryId)},checkGeo:function(t){return t==ENTRY_NONGEO?NaN:t},getLocationLabel:function(){return"n: "+this.getNorth()+" w:"+this.getWest()+" s:"+this.getSouth()+" e:"+this.getEast()},getServices:function(){return this.services},getService:function(t){for(let e=0;e<this.services.length;e++)if(this.services[e].relType==t)return this.services[e];return null},goodLoc:function(t){return!isNaN(t)&&t!=e},hasBounds:function(){return this.goodLoc(this.getNorth())&&this.goodLoc(this.getWest())&&this.goodLoc(this.getSouth())&&this.goodLoc(this.getEast())},hasLocation:function(){return this.goodLoc(this.getNorth())},getNorth:function(){return this.bbox?this.checkGeo(this.bbox[3]):this.geometry?this.checkGeo(this.geometry.coordinates[1]):NaN},getWest:function(){return this.bbox?this.checkGeo(this.bbox[0]):this.geometry?this.checkGeo(this.geometry.coordinates[0]):NaN},getSouth:function(){return this.bbox?this.checkGeo(this.bbox[1]):this.geometry?this.checkGeo(this.geometry.coordinates[1]):NaN},getEast:function(){return this.bbox?this.checkGeo(this.bbox[2]):this.geometry?this.checkGeo(this.geometry.coordinates[0]):NaN},getAltitude:function(){return Utils.isDefined(this.altitudeTop)?this.altitudeTop:Utils.isDefined(this.altitudeBottom)?this.altitudeBottom:NaN},getLatitude:function(){return this.geometry?this.checkGeo(this.geometry.coordinates[1]):this.getNorth()},getLongitude:function(){return this.geometry?this.checkGeo(this.geometry.coordinates[0]):this.getWest()},getIconUrl:function(){if(null==this.icon)return this.getRamadda().getIconUrl(this);if(this.icon.match("^http.*"))return this.icon;let t,e=this.getRamadda().getHostname();return t=e?e+this.icon:this.icon,t},getIconImage:function(t){return(t=t??[]).includes(ATTR_WIDTH)||t.push(ATTR_WIDTH,ramaddaGlobals.iconWidth),this.iconRelative?HU.image(this.iconRelative,t):HU.image(this.getIconUrl(),t)},getColumns:function(){return null==this.type.getColumns()?new Array:this.type.getColumns()},getAttributes:function(){return this.attributes},getAttribute:function(t){for(let e=0;e<this.attributes.length;e++){let n=this.attributes[e];if(n.id==t)return n}return null},getAttributeValue:function(t){let e=this.getAttribute(t);return null==e?null:e.value},getAttributeNames:function(){let t=[];for(let e=0;e<this.attributes.length;e++){let n=this.attributes[e];t.push(n.id)}return t},getAttributeLabels:function(){let t=[];for(let e=0;e<this.attributes.length;e++){let n=this.attributes[e];n.label?t.push(n.label):t.push(n.id)}return t},getName:function(t){let e;return e=null==this.name||""==this.name?"no name":this.name,t&&Utils.stringDefined(this.repositorySlug)&&(this.getRamadda().isLocal()||(e=this.repositorySlug+"-"+e)),e},getSnippet:function(t){return null==this.snippet?t:this.snippet},getDescription:function(t){return null==this.description?t:this.description},getFilesize:function(){let t=parseInt(this.filesize);return t==t?t:0},getFormattedFilesize:function(){return GuiUtils.size_format(this.getFilesize())},getEntryUrl:function(t){return this.remoteUrl?this.remoteUrl:this.getRamadda().getEntryUrl(this,t)},getFilename:function(){return this.filename},getIsEntryImage:function(){return this.isImage},getIsImage:function(){return!!(this.url&&this.url.search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)||(!!(this.hasResource()&&this.getFilename().search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)||!!this.getThumbnail())},getImageUrl:function(){if(this.url&&this.url.search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)return this.url;if(this.hasResource()&&this.getFilename().search(/(\.png|\.jpg|\.jpeg|\.gif)/i)>=0)return this.getResourceUrl();let t=this.getThumbnail();return t||null},getIsUrl:function(){return this.isurl},getIsFile:function(){return this.isfile},hasResource:function(){return null!=this.getFilename()},getAbsoluteId:function(){if(this.remoteRepository&&this.remoteUrl){let t=this.remoteUrl.match("entryid=(.*)");if(t&&t.length>1)return t[1]}return this.id},getResourceUrl:function(){if(this.url)return this.url;if(this.remoteRepository)return this.remoteRepository.url+"/entry/get?entryid="+this.getAbsoluteId();let t=this.getRamadda().getRoot()+"/entry/get";return null!=this.getFilename()&&(t+="/"+this.getFilename()),t+"?entryid="+this.id},getLink:function(t,e,n){return t||(t=this.getName()),(n=n||[]).push("href",this.getEntryUrl()),e&&(t=this.getIconImage()+SPACE+t),HU.tag(TAG_A,n,t)},getResourceLink:function(t){return t||(t=this.getName()),HU.tag(TAG_A,["href",this.getResourceUrl()],t)},toString:function(){return"entry:"+this.getName()+" id:"+this.getId()}})}function EntryList(t,e,n,i){$.extend(this,{repository:t,url:e,listener:n,haveLoaded:!1,entries:[],map:{},getRepository:function(){return this.repository},setEntries:function(t){this.entries=t,this.haveLoaded=!0},getEntry:async function(t,e){let n=this.map[t];if(null!=n)return Utils.call(e,n);await this.getRepository().getEntry(t,(t=>{Utils.call(e,t)}))},getEntries:function(){return this.entries},createEntries:function(t,e,n){this.entries=createEntriesFromJson(t,this.getRepository());for(let t=0;t<this.entries.length;t++){let e=this.entries[t];this.map[e.getId()]=e}null==e&&(e=this.listener),n?n(this):e&&e.entryListChanged&&e.entryListChanged(this)},doSearch:async function(t,e,n){null==t&&(t=this.listener);let i=this;await $.getJSON(this.url,(function(n,r,a){GuiUtils.isJsonError(n)||(i.haveLoaded=!0,i.createEntries(n,t,e))})).fail((function(e,r,a){GuiUtils.handleError("An error occurred doing search: "+a,i.url,!0),n?n(a):t&&t.handleSearchError&&t.handleSearchError(i.url,a)}))}}),i&&this.doSearch()}function EntrySearchSettings(t){$.extend(this,{types:[],parent:null,max:DEFAULT_MAX,skip:0,metadata:[],extra:"",orderBy:"",entries:null,startDate:null,endDate:null,north:NaN,west:NaN,north:NaN,east:NaN,areaContains:!1,clearProviders:function(t){this.providers=null},getProvider:function(t){return this.providers?this.providers[0]:null},setProvider:function(t){null!=t?(Array.isArray(t)||(t=[t]),this.providers=t):this.providers=null},getMax:function(){return this.max},setMax:function(t){this.max=parseInt(t)},getSkip:function(){return this.skip},toString:function(){return"n:"+this.north+" w:"+this.west+" s:"+this.south+" e:"+this.east},getAreaContains:function(){return this.areaContains},setAreaContains:function(t){this.areaContains=t},getNorth:function(){return this.north},getSouth:function(){return this.south},getWest:function(){return this.west},getEast:function(){return this.east},setDateRange:function(t,e){this.startDate=t,this.endDate=e},setCreateDateRange:function(t,e){this.createstartDate=t,this.createendDate=e},setChangeDateRange:function(t,e){this.changestartDate=t,this.changeendDate=e},setBounds:function(t,e,n,i){this.north=null==t||0==t.toString().length?NaN:parseFloat(t),this.west=null==e||0==e.toString().length?NaN:parseFloat(e),this.south=null==n||0==n.toString().length?NaN:parseFloat(n),this.east=null==i||0==i.toString().length?NaN:parseFloat(i)},getTypes:function(){return this.types},hasType:function(t){return this.types.indexOf(t)>=0},getExtra:function(){return this.extra},setExtra:function(t){this.extra=t},clearAndAddType:function(t){return this.types=[],this.addType(t),this},addType:function(t){if(null!=t&&0!=t.length&&!this.hasType(t))return this.types.push(t),this}}),null!=t&&$.extend(this,t)}function EntryListHolder(t){let e;RamaddaUtil.inherit(this,e=new EntryList(t,null)),$.extend(this,{entryLists:[],addEntryList:function(t){this.entryLists.push(t)},doSearch:function(t){let e=this;null==t&&(t=this.listener);for(let n=0;n<this.entryLists.length;n++){let i=this.entryLists[n];if(!i.getRepository().canSearch())continue;let r={entryListChanged:function(n){t&&t.entryListChanged(e,n)}};i.doSearch(r)}},getEntry:async function(t){for(let e=0;e<this.entryLists.length;e++){let n,i=this.entryLists[e];if(await i.getEntry(t,(t=>{n=t})),null!=n)return n}return null},getEntries:function(){let t=[];for(let e=0;e<this.entryLists.length;e++){let n=this.entryLists[e].getEntries();for(let e=0;e<n.length;e++)t.push(n[e])}return t}})}
