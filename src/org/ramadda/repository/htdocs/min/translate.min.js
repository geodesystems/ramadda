var LANGUAGE_ENGLISH="en",LANGUAGE_SPANISH="es",Translate={packs:{},missing:{},language:null,init:function(){let a=HU.getIconImage("fas fa-language ramadda-header-icon"),t=a+HU.space(1),e=HU.span([ATTR_TITLE,"Change language",ATTR_CLASS,CLASS_CLICKABLE+" ramadda-page-link",ATTR_ID,"ramadda_language_menu"],a);e=$(e).appendTo(jqid("ramadda_links_prefix")),e.click((()=>{let a="";a+=HU.div([ATTR_TITLE,"Clear language",ATTR_CLASS,"ramadda-clickable ramadda-language-switch ramadda-menu-language-switch ramadda-user-link"],t+"Clear"),ramaddaLanguages.forEach((e=>{a+=HU.div(["data-language",e.id,ATTR_TITLE,"Switch language",ATTR_CLASS,"ramadda-clickable ramadda-language-switch ramadda-menu-language-switch ramadda-user-link"],t+e.label)})),a=HU.div([],a),this.menuPopup&&this.menuPopup.remove(),this.menuPopup=HU.makeDialog({content:a,anchor:e,my:"right top",at:"right bottom"});let n=this;this.menuPopup.find(".ramadda-menu-language-switch").click((function(){n.switcherClicked($(this))}))})),this.switchLang=jqid("switchlang"),Translate.translate()},switcherClicked:function(a){let t=a.attr("data-language");"showmissing"!=t?(HU.hidePopupObject(),this.setLanguage(t),Utils.setLocalStorage("ramadda-language",t),t==LANGUAGE_ENGLISH?Translate.translateInner(null,LANGUAGE_ENGLISH,{},!0):Translate.translate(null,t)):Translate.showMissing()},setDefaultLanguage:function(a){this.defaultLanguage=a||LANGUAGE_ENGLISH,this.language=a,Translate.translate(null,a)},checkSwitcher:function(){let a=this.language;$(".ramadda-language-switch").each((function(){$(this).attr("data-language")==a?$(this).addClass("ramadda-link-bar-item-active"):$(this).removeClass("ramadda-link-bar-item-active")}))},showLanguages:function(a,t){let e=HU.getUniqueId("switcher"),n=HU.getUniqueId("contents"),l=HU.center(HU.div([ATTR_ID,e]))+HU.div([ATTR_ID,n]);jqid(a).html(l);let i=a=>{Translate.setLanguage(a),Translate.checkSwitcher(),a&&HU.addToDocumentUrl("language",a),Translate.loadPack(a,(a=>{let t=HU.getUniqueId("search"),e=HU.div([ATTR_ID,t]);e+=HU.open(TAG_TABLE),e+=HU.tr([],HU.tds([ATTR_STYLE,"min-width:400px;"],[HU.b("English"),HU.b("Translated")])),Object.keys(a).sort(((a,t)=>a.length-t.length)).forEach((t=>{t.startsWith("language.")||(e+=HU.tr([ATTR_CLASS,"phrase"],HU.tds([],[t,a[t]])))})),e+=HU.close(TAG_TABLE),jqid(n).html(e),HU.initPageSearch(".phrase",null,null,!1,{target:"#"+t,focus:!0})}))};t&&i(t),Translate.addSwitcher(e,null,!1,{callback:i,skipEnglish:!0}),Translate.disable()},addSwitcher:function(a,t,e,n){if(n=n??{},this.disabled)return;t?t=Utils.split(t,",",!0,!0):(t=[],ramaddaLanguages.forEach((a=>{t.push(a.id)})));let l=HU.open("div",[ATTR_CLASS,"ramadda-link-bar"]);t.forEach((a=>{n.skipEnglish&&a==LANGUAGE_ENGLISH||ramaddaLanguages.forEach((t=>{t.id==a&&(l+=HU.span(["data-language",t.id,ATTR_TITLE,"Switch language",ATTR_CLASS,"ramadda-clickable ramadda-link-bar-item ramadda-language-switch"],t.label))}))})),e&&(l+=HU.span(["data-language","showmissing",ATTR_CLASS,"ramadda-clickable ramadda-link-bar-item ramadda-language-switch"],"Download missing")),l+=HU.close("div");let i=$(l);i.appendTo(jqid(a));let s=this;i.find(".ramadda-language-switch").click((function(){if(n.callback){let a=$(this).attr("data-language");n.callback(a)}else s.switcherClicked($(this))})),this.checkSwitcher()},loadPack:function(a,t){if(Translate.packs[a])return void t(Translate.packs[a]);let e=RamaddaUtil.getUrl("/getlanguage?language="+a);ramaddaCurrentEntry&&(e+="&entryid="+ramaddaCurrentEntry),$.ajax({url:e,dataType:"text",success:function(e){let n=Translate.makePack(e);$('.ramadda-dict[lang="'+a+'"]').each((function(){let a=Translate.makePack($(this).text());n=$.extend(n,a)})),Translate.packs[a]=n,t(Translate.packs[a])}}).fail((function(){console.log("Failed to load url: "+e),Translate.packs[a]={}}))},makePack:function(a){let t={};return a?(Utils.split(a,"\n",!0,!0).forEach((a=>{if((a=a.replace(/\"/g,"")).startsWith("#"))return;let e=a.indexOf("=");if(e<0)return;let n=a.substring(0,e).trim(),l=a.substring(e+1).trim();"NA"!=l&&(t[n]=l)})),t):t},disable:function(){this.disabled=!0},setLanguage:function(a){this.language=ramaddaLanguage=a},translate:function(a,t){this.disabled||((t=this.language)||(t=this.defaultLanguage),t||("undefined"!==(t=this.language??Utils.getLocalStorage("ramadda-language"))&&"null"!==t||(t=null),t=t??ramaddaLanguage??navigator?.language??navigator?.userLanguage),Utils.stringDefined(t)?(t=(t=t.toLowerCase()).replace(/-.*/,""),this.setLanguage(t),t!=LANGUAGE_ENGLISH?Translate.loadPack(t,(e=>{Translate.translateInner(a,t,e)})):Translate.translateInner(a,t,{},!0)):t=LANGUAGE_ENGLISH)},haveDoneAnyTranslations:!1,phrases:{},definePhrase:function(a,t,e){let n=Translate.phrases[a];n||(n=Translate.phrases[a]={}),n[t]=e},canTranslate:function(a,t,e){return!a.hasClass("ramadda-notranslate")&&!a.hasClass("ramadda-language-block")&&(!(!t||t.indexOf("<")>=0)&&(!(t.length<=1)&&(!t.match(/.*[0-9].*/)&&(!t.match(/^[0-9]+/)&&!t.match(/ [0-9]+$/)))))},translateInner:function(a,t,e,n){let l,i;if(t=this.language,a?(l=$(a).find("*"),i=$(a).find(".ramadda-language-block")):(l=$("*"),i=$(".ramadda-language-block")),i.each((function(){$(this).attr("data-lang")==t?$(this).show():$(this).hide()})),this.checkSwitcher(),n&&!this.haveDoneAnyTranslations)return;if(this.haveDoneAnyTranslations=!0,!e)return void console.log("no language pack:"+t);let s=Translate.phrases[t];s&&$.extend(e,s);let r=a=>"lang-orig-"+(a??""),d=(a,t,l)=>{if("I"==a.prop("tagName")&&"title"!=l)return null;if(t=t.trim(),n){let t=a.attr(r(l));return t||null}if(t.indexOf(Utils.MSGCHAR)>=0){let e=t.split(Utils.MSGCHAR).filter(Boolean),n="";return e.forEach((t=>{let e=d(a,t,l);n+=e||t})),n}return Translate.canTranslate(a,t,l)?e[t]?"<skip>"==e[t]?null:(a.attr(r(l),t),e[t]):(Translate.missing[t]=!0,a.attr(r(l))):null},g={SCRIPT:!0,BR:!0,HTML:!0,STYLE:!0,TEXTAREA:!0,HEAD:!0,META:!0,LINK:!0,BODY:!0},c=["placeholder","title","value"];l.each((function(){let a,t=$(this),e=t.prop("tagName");if(g[e])return;c.forEach((n=>{if("value"==n&&("INPUT"!=e||"submit"!=t.attr("type")))return;let l=t.attr(n);l&&(a=d(t,t.attr(r(n))??l,n),a&&t.attr(n,a))}));let n=r(),l=t.attr(n)??t.html();Translate.canTranslate(t,l)&&(a=d(t,l),a&&t.html(a))}))},showMissing:function(){let a="";Object.keys(Translate.missing).forEach((t=>{t.length>100||t.match(/^[0-9]+/)||t.match(/ [0-9]+$/)||t.match(/^:.*/)||t.match(/^-.*/)||t.match(/.*&.*/)||t.match(/.*yyyy.*/i)||t.match(/.*ramadda.*/i)||Utils.isNoMsg(t)||(console.log(t),a+=t+"=\n")})),Utils.makeDownloadFile("phrases.txt",a)}};ramaddaLanguagesEnabled&&$(document).ready((function(){Translate.init()}));
