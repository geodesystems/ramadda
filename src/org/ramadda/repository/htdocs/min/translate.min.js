var LANGUAGE_ENGLISH="en",LANGUAGE_SPANISH="es",Translate={packs:{},missing:{},init:function(){this.switchPrefix=HU.getIconImage("fas fa-language")+HU.space(1);let a=HU.span([ATTR_TITLE,"Change language",ATTR_CLASS,CLASS_CLICKABLE,ATTR_ID,"ramadda_language_menu"],HU.getIconImage("fas fa-language"));a=$(a).appendTo(jqid("ramadda_links_prefix")),a.click((()=>{let t="";t+=HU.div([ATTR_TITLE,"Clear language",ATTR_CLASS,"ramadda-clickable ramadda-language-switch ramadda-menu-language-switch ramadda-user-link"],this.switchPrefix+"Clear"),ramaddaLanguages.forEach((a=>{t+=HU.div(["data-language",a.id,ATTR_TITLE,"Switch language",ATTR_CLASS,"ramadda-clickable ramadda-language-switch ramadda-menu-language-switch ramadda-user-link"],this.switchPrefix+a.label)})),t=HU.div([],t),this.menuPopup&&this.menuPopup.remove(),this.menuPopup=HU.makeDialog({content:t,anchor:a,my:"right top",at:"right bottom"});let e=this;this.menuPopup.find(".ramadda-menu-language-switch").click((function(){e.switcherClicked($(this))}))})),this.switchLang=jqid("switchlang"),Translate.translate()},switcherClicked:function(a){let t=a.attr("data-language");HU.hidePopupObject(),this.setLanguage(t),Utils.setLocalStorage("ramadda-language",t),t==LANGUAGE_ENGLISH?Translate.translateInner(null,LANGUAGE_ENGLISH,{},!0):Translate.translate(null,t)},setDefaultLanguage:function(a){this.defaultLanguage=a||LANGUAGE_ENGLISH},addSwitcher:function(a,t){t&&(t=Utils.split(t,",",!0,!0));let e=HU.open("div",[ATTR_CLASS,"ramadda-link-bar"]),n=0;ramaddaLanguages.forEach((a=>{t&&t.length&&!t.includes(a.id)||(e+=HU.span(["data-language",a.id,ATTR_TITLE,"Switch language",ATTR_STYLE,n>0?HU.css("border-left","var(--basic-border)"):"",ATTR_CLASS,"ramadda-clickable ramadda-language-switch"],a.label),n++)})),e+=HU.close("div");let l=$(e);l.appendTo(jqid(a));let i=this;l.find(".ramadda-language-switch").click((function(){i.switcherClicked($(this))}))},loadPack:function(a,t){if(Translate.packs[a])return void t(Translate.packs[a]);let e=RamaddaUtil.getUrl("/getlanguage?language="+a);console.dir(e),$.ajax({url:e,dataType:"text",success:function(e){let n=Translate.makePack(e);$('.ramadda-dict[lang="'+a+'"]').each((function(){let a=Translate.makePack($(this).text());n=$.extend(n,a)})),Translate.packs[a]=n,t(Translate.packs[a])}}).fail((function(){console.log("Failed to load url: "+e),Translate.packs[a]={}}))},makePack:function(a){let t={};return a?(Utils.split(a,"\n",!0,!0).forEach((a=>{if((a=a.replace(/\"/g,"")).startsWith("#"))return;let e=a.indexOf("=");if(e<0)return;let n=a.substring(0,e).trim(),l=a.substring(e+1).trim();t[n]=l})),t):t},setLanguage:function(a){this.language=ramaddaLanguage=a},translate:function(a,t){t||(t=this.defaultLanguage),t||("undefined"!==(t=this.language??Utils.getLocalStorage("ramadda-language"))&&"null"!==t||(t=null),t=t??ramaddaLanguage??navigator?.language??navigator?.userLanguage),Utils.stringDefined(t)?(t=(t=t.toLowerCase()).replace(/-.*/,""),this.setLanguage(t),t!=LANGUAGE_ENGLISH?Translate.loadPack(t,(e=>{Translate.translateInner(a,t,e)})):Translate.translateInner(a,t,{},!0)):t=LANGUAGE_ENGLISH},haveDoneAnyTranslations:!1,translateInner:function(a,t,e,n){let l,i;if(a?(l=$(a).find("*"),i=$(a).find(".ramadda-language-block")):(l=$("*"),i=$(".ramadda-language-block")),i.each((function(){$(this).attr("data-lang")==t?$(this).show():$(this).hide()})),$(".ramadda-language-switch").each((function(){$(this).attr("data-language")==t?$(this).addClass("ramadda-language-switch-active"):$(this).removeClass("ramadda-language-switch-active")})),n&&!this.haveDoneAnyTranslations)return;if(this.haveDoneAnyTranslations=!0,!e)return void console.log("no language pack:"+t);let s=a=>"lang-orig-"+(a??""),r=(a,t,e)=>!a.hasClass("ramadda-notranslate")&&!(!t||t.indexOf("<")>=0),g=(a,t,l)=>{if(n){let t=a.attr(s(l));return t||null}if(r(a,t))return e[t]?"<skip>"==e[t]?null:(a.attr(s(l),t),e[t]):(Translate.missing[t]=!0,a.attr(s(l)))},d={SCRIPT:!0,BR:!0,HTML:!0,STYLE:!0,TEXTAREA:!0,HEAD:!0,META:!0,LINK:!0,BODY:!0},u=["placeholder","title","value"];l.each((function(){let a,t=$(this),e=t.prop("tagName");if(d[e])return;u.forEach((n=>{("value"!=n||"INPUT"==e&&"submit"==t.attr("type"))&&t.attr(n)&&(a=g(t,t.attr(s(n))??t.attr(n),n),a&&t.attr(n,a))}));let n=s(),l=t.attr(n)??t.html();r(t,l)&&(a=g(t,l),a&&t.html(a))}))},showMissing:function(){let a="";Object.keys(Translate.missing).forEach((t=>{a+=t+"\n"})),console.log(a),Utils.makeDownloadFile("missing.txt",a)}};ramaddaLanguagesEnabled&&$(document).ready((function(){Translate.init()}));
