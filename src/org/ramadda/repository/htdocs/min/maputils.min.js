var debugBounds=!1,getMapDebug=!1,debugPopup=!1,debugSelect=!1,RamaddaToFloat=e=>(null!=e&&(e=parseFloat(e)),e),MapUtils={me:"MapUtils",regions:null,POSITIONMARKERID:"location",LABEL_MAP:{aiannhr:"Federal Recognition",mtfcc:"Feature Class",geoid:"Geographic ID",aland:"Land Area",awater:"Water Area",countyfp:"County FIPS",statefp:"State FIPS",namelsad:"Name-LSAD",lsad:"Legal Area Descriptor",aiannhce:"American Indian Census Code",aiannhns:"Anerican Indian Standard Code",classfp:"Class Code",comptyp:"Component Type",intptlat:"Latitude",intptlon:"Longitude",usps:"USPS State Abbrev.",ansicode:"ANSI Code",funcstat:"Functional Status",drawseq:"Draw Sequence",cdsessn:"CD Session",cd115fp:"CD FIPS",affgeoid:"Amer. Fact Finder ID"},properties:{},testSize:{active:!1,out:null,fontUnit:"px",fontSize:3,line:"ABCDEFGHIJKLMNOPQRSTUVWXYZABCD\nABCDEFGHIJKLMNOPQRSTUVWXYZABCD",rows:2,seen:{}},handleSize:function(e){if(!this.testSize.active)return;if(this.testSize.out||(this.testSize.out="let "+this.testSize.fontUnit+"Map={"),this.testSize.seen[this.testSize.fontSize])return;this.testSize.seen[this.testSize.fontSize]=!0;let t=this.testSize.fontSize+":{x:"+Utils.trimDecimals(e.width/this.testSize.line.length,2)+",y:"+Utils.trimDecimals(e.height/this.testSize.rows,2)+"},";console.log(t),this.testSize.out+=t+"\n",24==this.testSize.fontSize&&Utils.makeDownloadFile(this.testSize.fontUnit+"map.txt",this.testSize.out+"\n};\n")},loadTurf:function(e){if(!window.turf){let t=ramaddaCdn+"/lib/turf.min.js";return Utils.loadScript(t,e),!1}return!0},extendBounds:function(e,t){return e?(t&&e.extend(t),e):t},intercept:function(e,t,a,r){let n=e,i=t,o=a,s=r,l=Math.abs(i-s);return l>180&&(l=360-l),n+(180-i)*((o-n)/l)},crossIDL:function(e,t){if(e>0&&t<0||e<0&&t>0){if(Math.abs(e-t)>180)return!0}return!1},addMapProperty:function(e,t){this.properties[e]=t},getMapProperty:function(e,t){return this.properties[e]??t},makeLabel:function(e){if(!e)return e;let t=e.toLowerCase();return this.LABEL_MAP[t]??Utils.makeLabel(e)},stopEvent:function(e){OpenLayers.Event.stop(e)},createGraticule:function(e){return new OpenLayers.Control.Graticule(e)},createLinearRing:function(e){return new OpenLayers.Geometry.LinearRing(e)},createLineString:function(e){return new OpenLayers.Geometry.LineString(e)},createPolygon:function(e){return new OpenLayers.Geometry.Polygon(e)},createVector:function(e,t,a){return new OpenLayers.Feature.Vector(e,t,a)},formatLocationValue:function(e){e=parseFloat(e);let t=Math.pow(10,7);return e=Math.floor(e*t)/t},getVectorStyle:function(e){return OpenLayers.Feature.Vector.style[e]},createStyleMap:function(e){return new OpenLayers.StyleMap(e)},createLonLat:function(e,t){return new OpenLayers.LonLat(RamaddaToFloat(e),RamaddaToFloat(t))},createPoint:function(e,t){return new OpenLayers.Geometry.Point(RamaddaToFloat(e),RamaddaToFloat(t))},getCenter:function(e){return MapUtils.createPoint(e.left+(e.right-e.left)/2,e.bottom+(e.top-e.bottom)/2)},boundsDefined:function(e){return null!=e&&null!=e.left},createBoundsFromPoints:function(e){let t=0,a=0,r=0,n=0;return e.forEach(((e,i)=>{t=0==i?e.x:Math.min(t,e.x),a=0==i?e.x:Math.max(a,e.x),n=0==i?e.y:Math.max(n,e.y),r=0==i?e.y:Math.min(r,e.y)})),this.createBounds(t,r,a,n)},createBounds:function(e,t,a,r,n){if(!Utils.isNumber(e)&&e&&e.left&&!n)return this.createBounds(e.left,e.bottom,e.right,e.top,!0);return new OpenLayers.Bounds(RamaddaToFloat(e),RamaddaToFloat(t),RamaddaToFloat(a),RamaddaToFloat(r))},createPixel:function(e,t){return new OpenLayers.Pixel(e,t)},createSize:function(e,t){return new OpenLayers.Size(e,t)},createMarker:function(e,t){return new OpenLayers.Marker(e,t)},createBox:function(e){return new OpenLayers.Marker.Box(e)},createIcon:function(e,t,a,r){return new OpenLayers.Icon(e,t,a,r)},createImage:function(e,t,a,r){return OpenLayers.Util.createImage(e,t,a,r)},createLayerGeoJson:function(e,t,a){return MapUtils.createLayerVector(t,{projection:e.displayProjection,strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:a,format:new OpenLayers.Format.GeoJSON({})})})},createLayerKML:function(e,t,a){return MapUtils.createLayerVector(t,{projection:e.displayProjection,strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:a,format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0,maxDepth:2})})})},createLayerGPX:function(e,t,a){return MapUtils.createLayerVector(t,{strategies:[new OpenLayers.Strategy.Fixed],projection:e.displayProjection,protocol:new OpenLayers.Protocol.HTTP({url:a,format:new OpenLayers.Format.GPX({extractStyles:!0,extractAttributes:!0,maxDepth:2})})})},createLayerImage:function(e,t,a,r,n){return new OpenLayers.Layer.Image(e,t,a,r,n)},createLayerWMS:function(e,t,a){return new OpenLayers.Layer.WMS(e,t,a)},createLayerXYZ:function(e,t,a){return new OpenLayers.Layer.XYZ(e,t,a)},createLayerMarkers:function(e,t){return new OpenLayers.Layer.Markers(e,t)},createLayerBoxes:function(e,t){return new OpenLayers.Layer.Boxes(e,t)},createLayerVector:function(e,t){return new OpenLayers.Layer.Vector(e,t)},createProjection:function(e){return new OpenLayers.Projection(e)},distance:function(e,t,a,r){const n=e*Math.PI/180,i=a*Math.PI/180,o=(a-e)*Math.PI/180,s=(r-t)*Math.PI/180,l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(i)*Math.sin(s/2)*Math.sin(s/2),p=6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)));return MapUtils.metersToFeet(p)},metersToFeet:function(e){return 3.28084*e},squareMetersToSquareFeet:function(e){return 10.7639*e},calculateArea:function(e){let t=0,a=e=>e*Math.PI/180;if(e.length>2){for(let r=0;r<e.length;r++){let n=e[r],i=r<e.length-1?e[r+1]:e[0];t+=a(i.x-n.x)*(2+Math.sin(a(n.y))+Math.sin(a(i.y)))}return t=6378137*t*6378137/2,t<0&&(t=-t),t=MapUtils.squareMetersToSquareFeet(t),t}return-1},squareFeetInASquareMile:27878400,symbols:{lightning:[0,0,4,2,6,0,10,5,6,3,4,5,0,0],rectangle:[0,0,4,0,4,10,0,10,0,0],diamond:[5,0,10,5,5,10,0,5,5,0],church:[4,0,6,0,6,4,10,4,10,6,6,6,6,14,4,14,4,6,0,6,0,4,4,4,4,0],_x:[0,0,6,6,3,3,6,0,0,6,3,3],thinx:[0,0,6,6,3,3,6,0,0,6,3,3],arrow:[0,0,5,10,10,0],downtriangle:[0,0,5,10,10,0],plane:[5,0,5,0,4,1,4,3,0,5,0,6,4,5,4,8,2,10,3,10,5,9,5,9,8,10,8,10,6,8,6,5,10,6,10,5,6,3,6,1,5,0,5,0]},initSymbols:function(){for(a in this.symbols)OpenLayers.Renderer.symbol[a]=this.symbols[a]},isFeatureVisible:function(e){return!e.style||"none"!=e.style.display},setFeatureVisible:function(e,t){if(!e.style){if(t)return;e.style=e.layer?$.extend({},e.layer.style):{}}e.style.display=t?"inline":"none",$.extend(e.style,{display:e.style.display})},gridFilter:function(e,t,a){let r={fontSize:"12px",padding:2};a&&$.extend(r,a),r.padding=Math.min(10,r.padding);let n={4:{x:1.75,y:5.99},5:{x:2.19,y:7.5},6:{x:2.63,y:8.99},7:{x:3.07,y:10.16},8:{x:3.51,y:11.83},9:{x:3.94,y:13.25},10:{x:4.38,y:14.66},11:{x:4.82,y:16.08},12:{x:5.26,y:17.5},13:{x:5.69,y:19.16},14:{x:6.13,y:20.33},15:{x:6.56,y:22},16:{x:7,y:23.41},17:{x:7.44,y:24.83},18:{x:7.88,y:26.25},19:{x:8.31,y:27.66},20:{x:8.75,y:29.08},21:{x:9.19,y:30.5},22:{x:9.62,y:31.91},23:{x:10.06,y:33.58},24:{x:10.5,y:34.75}},i=(r.fontSize??"12px").match(/^([0-9]+)($|[^\d]+)/),o=12,s="px";i&&(o=parseInt(i[1]),s=i[2]);let l={4:{x:1.31,y:4.5},5:{x:1.64,y:5.62},6:{x:1.97,y:6.75},7:{x:2.3,y:7.87},8:{x:2.63,y:9},9:{x:2.96,y:10},10:{x:3.29,y:11.25},11:{x:3.62,y:12},12:{x:3.94,y:13.25},13:{x:4.27,y:14.25},14:{x:4.6,y:15.24},15:{x:4.93,y:16.5},16:{x:5.26,y:17.5},17:{x:5.58,y:18.75},18:{x:5.91,y:19.75},19:{x:6.24,y:21},20:{x:6.56,y:22},21:{x:6.89,y:22.75},22:{x:7.22,y:24},23:{x:7.55,y:25},24:{x:7.88,y:26.25}};"pt"==s&&(l=n);let p,y=()=>l[o]?l[o]:o<4?l[4]:l[25];if(r.pixelsPerCharacter||(r.pixelsPerCharacter=y().x*r.padding),r.pixelsPerLine||(r.pixelsPerLine=y().y*r.padding),this.testSize.active){let e=++this.testSize.fontSize;t.forEach((t=>{t.style.fontSize=e+this.testSize.fontUnit,t.style.label=this.testSize.line}))}if(t.forEach((t=>{if(t.labelInfo=null,t.geometry&&t.style&&t.style.label){let a=t.style.label.split("\n"),n=0;a.forEach((e=>{n=Math.max(n,e.length)}));let i=t.geometry.getBounds().getCenterLonLat(),o=e.getMap().getViewPortPxFromLonLat(i),s=r.pixelsPerCharacter*n,l=r.pixelsPerLine*a.length,y=o.x-s/2,c=o.x+s/2,u=o.y,m=o.y+l;p?(p.minx=Math.min(p.minx,y),p.maxx=Math.max(p.maxx,c),p.miny=Math.min(p.miny,u),p.maxy=Math.max(p.maxy,m)):p={minx:y,maxx:c,miny:u,maxy:m},t.labelInfo={height:l,width:s,center:i,left:y,right:c,top:u,bottom:m}}})),!p)return;let c=-p.minx,u=-p.miny,m=parseInt(p.maxx+c),d=parseInt(p.maxy+u),M={};t.forEach(((e,t)=>{if(!this.isFeatureVisible(e))return;let a=e.labelInfo,r=parseInt(c+a.left),n=parseInt(u+a.top),i=!0;if(r+e.labelInfo.width<0||n+e.labelInfo.height<0)i=!1,console.log("skipping:",r,n);else{let t=[];r=Math.max(0,r),n=Math.max(0,n);for(let a=r;i&&a<r+e.labelInfo.width&&!(a>=m);a++)for(let r=n;i&&r<n+e.labelInfo.height&&!(r>=d);r++){M[a+"_"+r]?i=!1:t.push([a,r])}i&&t.forEach((e=>{let t=e[0]+"_"+e[1];M[t]=!0}))}this.testSize.active&&(i=!1),i?MapUtils.setFeatureVisible(e,!0):MapUtils.setFeatureVisible(e,!1)}))},makeDefaultFeatureText:function(e,t,a,r){t||(t=Object.keys(e));let n="<table>",i=[],o=[],s=[];return t.forEach((e=>{let t=e.toLowerCase();"latitude"==t||"lat"==t||"longitude"==t||"lon"==t||"long"==t?s.push(e):"name"==t?i.push(e):o.push(e)})),(t=Utils.mergeLists(i,o,s)).forEach((t=>{let i,o,s=t.toLowerCase();if("objectid"!=s&&"feature_type"!=s&&"shapearea"!=s&&"styleurl"!=s&&"shapelen"!=s){if(r&&(i=r(t)),Utils.isDefined(i)||(i=MapUtils.makeLabel(t)),"startdate"==s?i="Start Date":"enddate"==s?i="End Date":"aland"==s?i="Land Area":"awater"==s&&(i="Water Area"),n+="<tr valign=top><td align=right><div style='margin-right:5px;margin-bottom:3px;'><b>"+HU.span(["title",t],i)+":</b></div></td><td><div style='margin-right:5px;margin-bottom:3px;'>",null==e[t]||"object"!=typeof e[t]&&"Object"!=typeof e[t])o=""+e[t];else{o=""+e[t].value}(o.startsWith("http:")||o.startsWith("https:"))&&(o="<a href='"+o+"'>"+o+"</a>"),"null"!=o&&(a&&(o=a(t,o)),n+=o,n+="</div></td></tr>")}})),n+="</table>",n}};MapUtils.defaults={maxLatValue:85,zoomLevels:40,defaultZoomLevel:-1,maxExtent:MapUtils.createBounds(-20037508,-20037508,20037508,20037508),sourceProjection:MapUtils.createProjection("EPSG:900913"),displayProjection:MapUtils.createProjection("EPSG:4326"),units:"m",doSphericalMercator:!0,wrapDateline:!0,location:MapUtils.createLonLat(0,0)},MapUtils.circleHiliteAttrs={strokeColor:"black",strokeWidth:1,fill:!0,fillOpacity:.5,fillColor:"red"};var RAMADDA_MAP_LAYERS=[],RAMADDA_MAP_LAYERS_MAP={};function MapLayer(e,t,a,r){this.opts=r??{},Utils.stringDefined(e)||(e=Utils.makeID(t)),this.id=e,Utils.stringDefined(t)||(t=Utils.makeLabel(e)),this.name=t,this.url=a,RAMADDA_MAP_LAYERS.push(this),RAMADDA_MAP_LAYERS_MAP[e]=this}MapLayer.prototype={isForMap:function(){return!Utils.isDefined(this.opts.isForMap)||this.opts.isForMap},createMapLayer:function(e){return this.layer=this.createMapLayerInner(e),this.layer},createMapLayerInner:function(e){return this.opts.creator?this.opts.creator(this,e):"simple"==this.opts.type?e.makeSimpleWms(this.id):"wms"==this.opts.type?e.addWMSLayer(this.name,this.url,this.opts.layer,!Utils.isDefined(this.opts.isOverlay)||!this.opts.isOverlay):e.createXYZLayer(this.name,this.url,this.opts.attribution,this.opts.isOverlay)}};var map_default_layer="osm";new MapLayer("osm","OSM",["//a.tile.openstreetmap.org/${z}/${x}/${y}.png","//b.tile.openstreetmap.org/${z}/${x}/${y}.png","//c.tile.openstreetmap.org/${z}/${x}/${y}.png"],{attribution:"Map courtesy of OSM"}),new MapLayer("esri.topo","ESRI Topo","https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/${z}/${y}/${x}",{isForMap:!0,attribution:"Map courtesy of ESRI"}),new MapLayer("google.roads","Google Maps - Roads","https://mt0.google.com/vt/lyrs=m&hl=en&x=${x}&y=${y}&z=${z}",{attribution:"Map courtesy of Google"}),new MapLayer("google.hybrid","Google Maps - Hybrid","https://mt0.google.com/vt/lyrs=y&hl=en&x=${x}&y=${y}&z=${z}",{attribution:"Map courtesy of Google"}),new MapLayer("esri.street","ESRI Streets","https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/${z}/${y}/${x}",{attribution:"Map courtesy of ESRI"}),new MapLayer("opentopo","OpenTopo","//a.tile.opentopomap.org/${z}/${x}/${y}.png}",{attribution:"Map courtesy of OpenTopo"}),new MapLayer("usfs","Forest Service","https://caltopo.com/tile/f16a/${z}/${x}/${y}.png",{attribution:"Map courtesy of Caltopo"}),new MapLayer("caltopo.mapbuilder","MapBuilder Topo","https://img.caltopo.com/tile/mbt/${z}/${x}/${y}.png",{attribution:"Map courtesy of Caltopo"}),new MapLayer("usgs.topo","USGS Topo","https://basemap.nationalmap.gov/ArcGIS/rest/services/USGSTopo/MapServer/tile/${z}/${y}/${x}",{attribution:"USGS - The National Map"}),new MapLayer("google.terrain","Google Maps - Terrain","https://mt0.google.com/vt/lyrs=p&hl=en&x=${x}&y=${y}&z=${z}",{attribution:"Map courtesy of Google"}),new MapLayer("google.satellite","Google Maps - Satellite","https://mt0.google.com/vt/lyrs=s&hl=en&x=${x}&y=${y}&z=${z}",{attribution:"Map courtesy of Google"}),new MapLayer("naip","NAIP Imagery","https://caltopo.com/tile/n/${z}/${x}/${y}.png",{attribution:"Map courtesy of Caltopo"}),new MapLayer("usgs.imagery","USGS Imagery","https://basemap.nationalmap.gov/ArcGIS/rest/services/USGSImageryOnly/MapServer/tile/${z}/${y}/${x}",{attribution:"USGS - The National Map"}),new MapLayer("esri.shaded","ESRI Shaded Relief","https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/${z}/${y}/${x}",{attribution:"Map courtesy of ESRI"}),new MapLayer("esri.lightgray","ESRI Light Gray","https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/${z}/${y}/${x}",{attribution:"Map courtesy of ESRI"}),new MapLayer("esri.darkgray","ESRI Dark Gray","https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/${z}/${y}/${x}",{attribution:"Map courtesy of ESRI"}),new MapLayer("esri.terrain","ESRI Terrain","https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/${z}/${y}/${x}",{attribution:"Map courtesy of ESRI"}),new MapLayer("shadedrelief","Shaded Relief","https://caltopo.com/tile/hs_m315z45s3/${z}/${x}/${y}.png",{attribution:"Map courtesy of Caltopo"}),new MapLayer("publiclands","Public Lands","https://caltopo.com/tile/sma/${z}/${x}/${y}.png",{attribution:"Map courtesy of Caltopo",isOverlay:!0,legend:ramaddaBaseUrl+"/images/publiclands.png"}),new MapLayer("federallands","Federal Lands",["//gis.blm.gov/arcgis/rest/services/lands/BLM_Natl_SMA_Cached_without_PriUnk/MapServer/tile/${z}/${y}/${x}"],{legend:ramaddaBaseUrl+"/images/federallands.png",attribution:"Map courtesy of BLM"}),new MapLayer("seafloor","Seafloor",["//tiles.arcgis.com/tiles/C8EMgrsFcRFL6LrL/arcgis/rest/services/GEBCO_basemap_NCEI/MapServer/tile/${z}/${y}/${x}"]),new MapLayer("historic","Historic","https://caltopo.com/tile/1900/${z}/${x}/${y}.png",{attribution:"Map courtesy of Caltopo",isOverlay:!0}),new MapLayer("esri.aeronautical","ESRI Aeronautical","https://wms.chartbundle.com/mp/service",{type:"wms",layer:"sec",attribution:"Map courtesy of ESRI"}),new MapLayer("osm.toner","OSM-Toner","https://tiles.stadiamaps.com/tiles/stamen_toner/${z}/${x}/${y}.png",{attribution:"Map courtesy of OSM"}),new MapLayer("osm.toner.lite","OSM-Toner Lite","https://tiles.stadiamaps.com/tiles/stamen_toner_lite/${z}/${x}/${y}.png",{attribution:"Map courtesy of OSM"}),new MapLayer("cartolight","Carto-Light","https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/${z}/${x}/${y}.png"),new MapLayer("moon","Moon","https://cartocdn-gusc.global.ssl.fastly.net/opmbuilder/api/v1/map/named/opm-moon-basemap-v0-1/all/${z}/${x}/${y}.png"),new MapLayer("mars","Mars","https://cartocdn-gusc.global.ssl.fastly.net/opmbuilder/api/v1/map/named/opm-mars-basemap-v0-1/all/${z}/${x}/${y}.png"),new MapLayer("lightblue","","",{type:"simple"}),new MapLayer("blue","","",{type:"simple"}),new MapLayer("white","","",{type:"simple"}),new MapLayer("black","","",{type:"simple"}),new MapLayer("gray","","",{type:"simple"}),MapUtils.initSymbols();var ARG_ZOOMLEVEL="zoomLevel",ARG_MAPCENTER="mapCenter",ramaddaMapMap={};function ramaddaMapAdd(e){null==window.globalMapList&&(window.globalMapList=[]),window.globalMapList.push(e),ramaddaMapMap[e.mapId]=e}function ramaddaMapRemove(e){null==window.globalMapList&&(window.globalMapList=[]),window.globalMapList.push(e),delete ramaddaMapMap[e.mapId]}function ramaddaMapCheckLayout(){setTimeout((()=>{null!=window.globalMapList&&window.globalMapList.map((e=>{e.map.updateSize()}))}),1e3)}var ramaddaMapLastShareTime=0,ramaddaMapLastShareMap="";function ramaddaMapShareState(e,t){let a=(new Date).getTime();if(e.mapId!=ramaddaMapLastShareMap&&a-ramaddaMapLastShareTime<2e3)return;if(ramaddaMapLastShareTime=a,ramaddaMapLastShareMap=e.mapId,e.stateIsBeingSet)return;let r=e.params.linkGroup;if(e.params.linked||e.params.linkMouse||r){e.getBounds(),e.map.baseLayer,e.map.getZoom();for(var n=0;n<window.globalMapList.length;n++){var i=window.globalMapList[n];i.stateIsBeingSet||i.mapId==e.mapId||r==i.params.linkGroup&&(i.stateIsBeingSet=!0,i.receiveShareState(e,t),i.stateIsBeingSet=!1)}}}
