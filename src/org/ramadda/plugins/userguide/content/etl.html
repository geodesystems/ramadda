[ht::head {ETL Tools}]
<%nochildlist%>

[
proc etlcat {cat} {
append ::etl [ug::subheading $cat [string tolower $cat]]
}
proc etl {cmd label desc args} {
regsub --  {-} $cmd {} id
regsub -all {<} $cmd {\&lt;} cmd
regsub -all {>} $cmd {\&gt;} cmd
regsub -all {<} $desc {\&lt;} desc
regsub -all {>} $desc {\&gt;} desc
regsub -all {\(} $desc {} desc
regsub -all {\)} $desc {} desc
regsub -all {\n} $desc {<br>} desc

    set argHtml ""
    set argCnt 0
foreach argt $args {
    foreach {a d} $argt break
    regsub  -all "\n" $d { } d
    regsub  -all "<br>" $d { } d    
    if {$argCnt>0} {
         append argHtml "\n\t";
    }
    append argHtml " &lt;<i>$a</i>";
    append argHtml "&gt; ";
    if {$d!=""} {
    append argHtml "$d ";
    }
    incr argCnt
}



append ::etl [ug::subsubheading "$label" $id]
append ::etl "<pre>$cmd $argHtml</pre>"
append ::etl $desc
append ::etl "<p>"
}]


[ug::subheading {Extract, Transform, Load CSV Files} etl]

RAMADDA provides an interactive facility to transform CSV, JSON, XML or HTML files and create structured
point data files and databases.
<p>
To start, upload the CSV/JSON/XML/HTML file into RAMADDA. Go to the  [ht::menu {Main Menu} View {Convert Data}] menu to see the conversion interface below.  <a href="https://geodesystems.com/repository/entry/show/Home/Content/RAMADDA+Examples+Data/Documentation/World%27s+Oldest+People+Raw+Html+File?entryid=920b0986-c7c2-4a8f-8e8f-22e52fd865e8&output=convert_form">Here</a> is the convert page for the below example.
[ht::cimg images/etl.png {CSV Conversion Interface} {width=90%}]

A pipeline of commands are defined for manipulating the rows and columns of the source file. 
These commands can be on the same line or on multiple lines. If on multiple lines then the intermediate processing results of each line of commands is available. Prefix a line with "#" to comment out the line.


<ul>
  <li> The <span><i class="fa fa-plus"></i></span> button allows you to add a new command. Once added you can edit the command in place or right click on the command to bring up the command editor dialog (see below).
  <li> The <span><i class="fa fa-file"></i></span> button allows you to insert a reference to another file in RAMADDA for those c
ommands (e.g., join) that require other files.
  <li> The <span><i class="fa fa-sliders-h"></i></span> button allows you to specify settings -
    <ul>
    </ul>
  <li> The <span><i class="fa fa-question-circle"></i></span> button displays help.
  <li> The Header, Table, Records, etc., buttons runs the commands and produces different output.
The Save checkbox saves the command text when you run the commands so you can return to it later. 
The Do Commands checkbox applies the commands when you press one of the run buttons.
</ul>


Many of the commands below take a columns specification. This takes the form of:
[ht::pre {
"colA,colB,colC-colD,colE,..."
e.g.:
"0,1,2,7-10,12"
}]


[ug::subheading {Extracting HTML} html]
The conversion service supports extracting data from an HTML table in a HTML page. Save the HTML page and upload to RAMADDA as a CSV File entry type. Then go to the conversion page.  The first command to enter is the -html command:
[ht::pre {
-html "name value arguments"
}]


The name/value arguments include:
[ht::pre {
-html "skip <how many tables in the HTML file to skip>"
-html "removePattern <regexp pattern to remove>  removePattern2 <another pattern to remove>"
}]

Because there are many levels of parsing of escape characters if 
you need to remove text that contains special regular expression characters - \[,\],(,) and . - use the special tags:
_leftbracket_, _rightbracket_, _leftparent_, _rightparen_, _dot_, e.g.:

[ht::pre {
-html "removePattern _leftbracket_.*?_rightbracket_ "
}]


[
set ::etl ""
source etlcommands.tcl
set ::etl 
]

[ht::foot]


</body>
